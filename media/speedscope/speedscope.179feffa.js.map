{"version":3,"sources":["../src/options.js","../src/constants.js","../src/create-element.js","../src/component.js","../src/render.js","../src/create-context.js","../src/util.js","../src/diff/children.js","../src/diff/props.js","../src/diff/index.js","../src/clone-element.js","../src/diff/catch-error.js","../src/lib/utils.ts","../src/lib/lru-cache.ts","../src/lib/math.ts","../node_modules/process/browser.js","../src/gl/graphics.ts","../src/gl/utils.ts","../src/gl/rectangle-batch-renderer.ts","../src/lib/color.ts","../src/gl/row-atlas.ts","../src/gl/texture-renderer.ts","../src/gl/overlay-rectangle-renderer.ts","../src/gl/flamechart-color-pass-renderer.ts","../src/gl/canvas-context.ts","../src/app-state/getters.ts","../src/index.js","../src/PureComponent.js","../src/memo.js","../src/forwardRef.js","../src/Children.js","../src/suspense.js","../src/suspense-list.js","../src/portals.js","../src/events.js","../src/lib/atom.ts","../src/lib/view-mode.ts","../src/lib/hash-params.ts","../src/app-state/profile-group.ts","../src/app-state/index.ts","../src/app-state/active-profile-state.ts","../src/app-state/color-scheme.ts","../src/views/themes/dark-theme.ts","../src/views/themes/light-theme.ts","../src/views/themes/theme.tsx","../node_modules/css-in-js-utils/lib/isPrefixedValue.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/calc.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/crossFade.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/cursor.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/filter.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/flex.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/flexboxIE.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/flexboxOld.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/gradient.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/imageSet.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/position.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/sizing.js","../node_modules/hyphenate-style-name/index.js","../node_modules/css-in-js-utils/lib/hyphenateProperty.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/utils/capitalizeString.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/plugins/transition.js","../node_modules/string-hash/index.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/utils/prefixProperty.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/utils/prefixValue.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/utils/addNewValuesOnly.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/utils/isObject.js","../node_modules/aphrodite/node_modules/inline-style-prefixer/static/createPrefixer.js","../node_modules/asap/browser-raw.js","../node_modules/asap/browser-asap.js","../node_modules/aphrodite/es/index.js","../src/views/style.ts","../src/lib/profile-search.ts","../src/views/search-view.tsx","../src/lib/emscripten.ts","../src/views/color-chit.tsx","../src/views/scrollable-list-view.tsx","../src/views/profile-table-view.tsx","../src/lib/flamechart.ts","../src/gl/flamechart-renderer.ts","../src/views/flamechart-style.ts","../src/lib/text-utils.ts","../src/views/flamechart-minimap-view.tsx","../src/views/flamechart-detail-view.tsx","../src/lib/canvas-2d-batch-renderers.ts","../src/lib/vscode-extension.ts","../src/views/flamechart-pan-zoom-view.tsx","../src/views/hovertip.tsx","../src/views/flamechart-search-view.tsx","../src/lib/preact-helpers.tsx","../src/views/flamechart-view.tsx","../src/views/flamechart-view-container.tsx","../src/views/flamechart-wrapper.tsx","../src/views/inverted-caller-flamegraph-view.tsx","../src/views/callee-flamegraph-view.tsx","../src/views/sandwich-search-view.tsx","../src/views/sandwich-view.tsx","../src/lib/value-formatters.ts","../node_modules/parcel-bundler/src/builtins/bundle-url.js","../node_modules/parcel-bundler/src/builtins/bundle-loader.js","../src/lib/profile.ts","../src/lib/file-format-spec.ts","../package.json","../src/lib/file-format.ts","../src/lib/fuzzy-find.ts","../src/views/profile-select.tsx","../src/views/toolbar.tsx","../src/lib/js-source-map.ts","../src/views/application.tsx","../src/views/application-container.tsx","../src/speedscope.tsx","../node_modules/parcel-bundler/src/builtins/loaders/browser/js-loader.js"],"names":["options","isValidElement","rerenderQueue","rerenderCount","defer","prevDebounce","IS_HYDRATE","i","EMPTY_OBJ","EMPTY_ARR","IS_NON_DIMENSIONAL","assign","obj","props","removeNode","node","parentNode","removeChild","createElement","type","children","normalizedProps","arguments","length","push","defaultProps","createVNode","key","ref","original","vnode","_children","_parent","_depth","_dom","_nextDom","_component","constructor","_original","createRef","Fragment","Component","context","getDomSibling","childIndex","indexOf","sibling","updateParentDomPointers","child","base","enqueueRender","c","_dirty","debounceRendering","process","queue","sort","a","b","_vnode","some","component","commitQueue","oldVNode","newDom","oldDom","parentDom","_parentDom","diff","_globalContext","ownerSVGElement","commitRoot","diffChildren","newParentVNode","oldParentVNode","globalContext","isSvg","excessDomChildren","isHydrating","j","sibDom","firstChildDom","refs","oldChildren","oldChildrenLength","toChildArray","childVNode","undefined","nextDom","outer","appendChild","nextSibling","insertBefore","value","unmount","applyRef","callback","flattened","Array","isArray","diffProps","dom","newProps","oldProps","hydrate","setProperty","setStyle","style","test","name","oldValue","s","useCapture","nameLower","cssText","replace","toLowerCase","slice","addEventListener","eventProxy","_listeners","removeEventListener","removeAttributeNS","setAttributeNS","removeAttribute","setAttribute","e","event","newVNode","tmp","isNew","oldState","snapshot","clearProcessingException","provider","componentContext","newType","_diff","contextType","_id","_defaultValue","_processingException","_pendingError","prototype","render","doRender","sub","state","_renderCallbacks","_nextState","getDerivedStateFromProps","componentWillMount","componentDidMount","componentWillReceiveProps","_force","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","_render","getChildContext","getSnapshotBeforeUpdate","diffElementNodes","diffed","_catchError","root","_commit","cb","call","oldHtml","newHtml","nodeType","localName","document","createTextNode","createElementNS","is","data","childNodes","dangerouslySetInnerHTML","attributes","__html","innerHTML","checked","current","parentVNode","skipRemove","r","componentWillUnmount","this","replaceNode","_root","cloneElement","createContext","defaultValue","ctx","Consumer","Provider","subs","_this","_props","old","splice","_contextRef","error","hasCaught","getDerivedStateFromError","setState","componentDidCatch","update","forceUpdate","Promise","then","bind","resolve","setTimeout","cachedSetTimeout","cachedClearTimeout","module","exports","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","runClearTimeout","marker","clearTimeout","currentQueue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","len","run","Item","array","noop","nextTick","args","apply","title","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","currentIndex","currentComponent","prevRaf","currentHook","afterPaintEffects","oldBeforeRender","oldAfterDiff","oldCommit","oldBeforeUnmount","getHookState","index","_hook","hooks","__hooks","_list","_pendingEffects","useState","initialState","useReducer","invokeOrReturn","reducer","init","hookState","_value","action","nextValue","useEffect","_skipEffects","argsChanged","_args","useLayoutEffect","useRef","initialValue","useMemo","useImperativeHandle","createHandle","factory","_factory","useCallback","useContext","_context","useDebugValue","formatter","useErrorBoundary","errState","err","flushAfterPaintEffects","forEach","invokeCleanup","invokeEffect","hook","_cleanup","result","oldArgs","newArgs","arg","f","requestAnimationFrame","raf","done","cancelAnimationFrame","window","filter","shallowDiffers","PureComponent","isPureReactComponent","memo","comparer","shouldUpdate","nextProps","updateRef","Memoed","isReactComponent","displayName","_forwarded","oldDiffHook","forwardRef","fn","Forwarded","clone","mapFn","reduce","acc","Children","map","count","only","toArray","oldCatchError","detachedClone","Suspense","_pendingSuspensionCount","_suspenders","_detachOnNextRender","suspended","_suspended","lazy","loader","prom","Lazy","default","SuspenseList","_next","_map","_childDidSuspend","promise","suspendingComponent","resolved","onResolved","onSuspensionComplete","_suspendedComponentWillUnmount","pop","fallback","list","delete","revealOrder","size","delegated","get","unsuspend","wrappedUnsuspend","Map","reverse","set","ContextProvider","Portal","container","wrap","_container","_temp","_unmount","_wrap","_hasMounted","createPortal","CAMEL_PROPS","REACT_ELEMENT_TYPE","Symbol","for","parent","firstChild","preactRender","preactHydrate","oldEventHook","setSafeDescriptor","proto","Object","defineProperty","configurable","v","persist","stoppedPropagating","defaultPrevented","origStopPropagation","stopPropagation","origPreventDefault","preventDefault","isPropagationStopped","isDefaultPrevented","nativeEvent","classNameDescriptor","class","oldVNodeHook","$$typeof","className","enumerable","shouldSanitize","attrs","multiple","selected","ondoubleclick","ondblclick","onbeforeinput","onchange","normalized","oninput","_patchedLifecycles","createFactory","element","preactCloneElement","unmountComponentAtNode","findDOMNode","unstable_batchedUpdates","w","m","ms","wm","wms","wmms","staticPrefixData","plugins","calc","crossFade","cursor","flex","flexboxIE","flexboxOld","gradient","imageSet","position","sizing","transition","prefixMap","_typeof","iterator","_createClass","defineProperties","target","descriptor","writable","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","MAP_EXISTS","OrderedElements","elements","keyOrder","shouldReorder","hasOwnProperty","nested","_nested","keys","has","addStyleType","styleType","UPPERCASE_RE","UPPERCASE_RE_TO_KEBAB","match","String","kebabifyStyleName","string","isUnitlessNumber","animationIterationCount","borderImageOutset","borderImageSlice","borderImageWidth","boxFlex","boxFlexGroup","boxOrdinalGroup","columnCount","flexGrow","flexPositive","flexShrink","flexNegative","flexOrder","gridRow","gridColumn","fontWeight","lineClamp","lineHeight","opacity","order","orphans","tabSize","widows","zIndex","zoom","fillOpacity","floodOpacity","stopOpacity","strokeDasharray","strokeDashoffset","strokeMiterlimit","strokeOpacity","strokeWidth","prefixKey","prefix","charAt","toUpperCase","substring","prefixes","prop","stringifyValue","stringifyAndImportantifyValue","importantify","hashString","toString","hashObject","object","JSON","stringify","_toConsumableArray","arr","arr2","from","prefixAll","defaultSelectorHandlers","pseudoSelectors","selector","baseSelector","generateSubtreeStyles","mediaQueries","generated","join","generateCSS","styleTypes","selectorHandlers","stringHandlers","useImportant","merged","plainDeclarations","generatedStyles","val","handler","newSelector","console","warn","generatedRuleset","generateCSSRuleset","unshift","runStringHandlers","declarations","stringHandlerKeys","transformRule","transformValue","arrayToObjectKeysReducer","originalElements","create","prefixedElements","elementNames","originalStyle","originalIndex","rules","_i","_typeof$1","_toConsumableArray$1","styleTag","injectStyleTag","cssRules","querySelector","head","getElementsByTagName","sheet","styleSheet","insertRule","numRules","rule","innerText","fontFamily","injectStyleOnce","src","animationName","finalVal","valVal","valKey","injectGeneratedCSSOnce","alreadyInjected","injectionBuffer","isBuffering","generatedCSS","_injectionBuffer","flushToStyleTag","definitions","reset","getBufferedStyles","startBuffering","flushToArray","ret","flushToString","getRenderedClassNames","addRenderedClassNames","classNames","processStyleDefinitions","styleDefinitions","classNameBits","definitionBits","_name","_definition","_len","injectAndGetClassName","unminifiedHashFn","str","initialHashFn","hashFn","StyleSheet","sheetDefinition","mappedSheetDefinition","stringVal","rehydrate","renderedClassNames","StyleSheetServer","renderStatic","renderFunc","html","css","content","StyleSheetTestUtils","makeExports","extend","extensions","extensionSelectorHandlers","extension","selectorHandler","minify","shouldMinify","_key","Aphrodite","StyleSheet$1","StyleSheetServer$1","StyleSheetTestUtils$1","bundleURL","getBundleURLCached","getBundleURL","matches","stack","getBaseURL","url","require","loadBundlesLazy","bundles","id","code","LazyPromise","reject","loadBundles","all","loadBundle","bundleLoaders","registerBundleLoader","load","register","bundle","lastIndexOf","bundleLoader","catch","executor","onSuccess","onError","description","repository","main","bin","speedscope","scripts","deploy","prepack","prettier","lint","jest","coverage","typecheck","serve","files","browserslist","author","license","devDependencies","acorn","aphrodite","eslint","jsverify","jszip","pako","preact","protobufjs","typescript","transform","setupFilesAfterEnv","testRegex","collectCoverageFrom","moduleFileExtensions","dependencies","open","script","async","charset","onerror","onload"],"mappings":";AAWMA,aAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,OAAAA,EAAAA,QAAAA,QAAAA,EAAAA,QAAAA,EAAAA,QAAAA,cAAAA,EAAAA,QAAAA,SAAAA,EAAAA,QAAAA,UAAAA,EAAAA,QAAAA,UAAAA,EAAAA,QAAAA,aAAAA,EAAAA,QAAAA,cAAAA,EAAAA,QAAAA,aAAAA,EAAAA,QAAAA,SAAAA,EAAAA,QAAAA,QAAAA,QAAAA,oBAAAA,ECXC,IDWDA,EEyFOC,ECiETC,EACAC,EAQEC,EAcFC,ECvLEC,ECHKC,EJFEC,EAAY,GACZC,EAAY,GACZC,EAAqB,8DKK3B,SAASC,EAAOC,EAAKC,GACtB,IAAA,IAAIN,KAAKM,EAAOD,EAAIL,GAAKM,EAAMN,GAAAA,OAAAA,EAU9B,SAASO,EAAWC,GACtBC,IAAAA,EAAaD,EAAKC,WAClBA,GAAYA,EAAWC,YAAYF,GJVxC,SAAgBG,EAAcC,EAAMN,EAAOO,GAEzCb,IAAAA,EAAAA,EAAAA,UADGc,EAAkB,GAEjBd,IAAAA,KAAKM,EACC,QAANN,GAAqB,QAANA,IAAac,EAAgBd,GAAKM,EAAMN,IAGxDe,GAAAA,UAAUC,OAAS,EAAA,IACtBH,EAAW,CAACA,GAEPb,EAAI,EAAGA,EAAIe,UAAUC,OAAQhB,IACjCa,EAASI,KAAKF,EAAUf,IAGV,GAAA,MAAZa,IACHC,EAAgBD,SAAWA,GAKT,mBAARD,GAA2C,MAArBA,EAAKM,aAAAA,IAChClB,KAAKY,EAAKM,kBAAAA,IACVJ,EAAgBd,KACnBc,EAAgBd,GAAKY,EAAKM,aAAalB,IAKnCmB,OAAAA,EACNP,EACAE,EACAR,GAASA,EAAMc,IACfd,GAASA,EAAMe,IACf,MAgBK,SAASF,EAAYP,EAAMN,EAAOc,EAAKC,EAAKC,GAG5CC,IAAAA,EAAQ,CACbX,KAAAA,EACAN,MAAAA,EACAc,IAAAA,EACAC,IAAAA,EACAG,IAAW,KACXC,GAAS,KACTC,IAAQ,EACRC,IAAM,KAKNC,SAAAA,EACAC,IAAY,KACZC,iBAAAA,EACAC,IAAWT,GAGI,OAAA,MAAZA,IAAkBC,EAAMQ,IAAYR,GACpC9B,EAAQ8B,OAAO9B,EAAQ8B,MAAMA,GAE1BA,EAGR,SAAgBS,IACR,MAAA,GAGD,SAASC,EAAS3B,GACjBA,OAAAA,EAAMO,SChFP,SAASqB,EAAU5B,EAAO6B,GAC3B7B,KAAAA,MAAQA,EAAAA,KACR6B,QAAUA,EAqET,SAASC,EAAcb,EAAOc,GAClB,GAAA,MAAdA,EAAAA,OAEId,EAAME,GACVW,EAAcb,EAAME,GAASF,EAAME,GAAQD,IAAUc,QAAQf,GAAS,GACtE,KAAA,IAAA,IAGAgB,EACGF,EAAad,EAAMC,IAAUR,OAAQqB,IAAAA,GAG5B,OAFfE,EAAUhB,EAAMC,IAAUa,KAEa,MAAhBE,EAAQZ,IAAAA,OAIvBY,EAAQZ,IASW,MAAA,mBAAdJ,EAAMX,KAAqBwB,EAAcb,GAAS,KAsCjE,SAASiB,EAAwBjB,GAGtBvB,IAAAA,EACJyC,EAHyB,GAAA,OAA1BlB,EAAQA,EAAME,KAAwC,MAApBF,EAAMM,IAAoB,CAChEN,IAAAA,EAAMI,IAAOJ,EAAMM,IAAWa,KAAO,KAC5B1C,EAAI,EAAGA,EAAIuB,EAAMC,IAAUR,OAAQhB,IAAAA,GAE9B,OADTyC,EAAQlB,EAAMC,IAAUxB,KACO,MAAdyC,EAAMd,IAAc,CACxCJ,EAAMI,IAAOJ,EAAMM,IAAWa,KAAOD,EAAMd,IAAAA,MAKtCa,OAAAA,EAAwBjB,IAqC1B,SAASoB,EAAcC,KAE1BA,EAAEC,MACFD,EAAEC,KAAAA,IACHlD,EAAcsB,KAAK2B,KAClBhD,KACFE,IAAiBL,EAAQqD,sBAEzBhD,EAAeL,EAAQqD,oBACNjD,GAAOkD,GAK1B,SAASA,IAAAA,IAAAA,IACJC,EACIpD,EAAgBD,EAAcqB,QACrCgC,EAAQrD,EAAcsD,KAAK,SAACC,EAAGC,GAAMD,OAAAA,EAAEE,IAAO1B,IAASyB,EAAEC,IAAO1B,MAChE/B,EAAgB,GAGhBqD,EAAMK,KAAK,SAAAT,GApGYU,IAAAA,EAMnBC,EACEC,EAGFC,EATDlC,EACHmC,EACAC,EAkGKf,EAAEC,MAnGPa,GADGnC,GADoB+B,EAqGQV,GApGVQ,KACNzB,KACfgC,EAAYL,EAAUM,OAGlBL,EAAc,IACZC,EAAWpD,EAAO,GAAImB,IACnBQ,IAAYyB,EAEjBC,EAASI,EACZF,EACApC,EACAiC,EACAF,EAAUQ,SAAAA,IACVH,EAAUI,gBACV,KACAR,EACU,MAAVG,EAAiBtB,EAAcb,GAASmC,GAEzCM,EAAWT,EAAahC,GAEpBkC,GAAUC,GACblB,EAAwBjB,OIjH3B,SAAgB0C,EACfN,EACAO,EACAC,EACAC,EACAC,EACAC,EACAf,EACAG,EACAa,GAEIvE,IAAAA,EAAGwE,EAAGhB,EAAUC,EAAQgB,EAAQC,EAAeC,EAI/CC,EAAeT,GAAkBA,EAAe3C,KAActB,EAE9D2E,EAAoBD,EAAY5D,OAMhC0C,GAAAA,GAAUzD,IAEZyD,EADwB,MAArBY,EACMA,EAAkB,GACjBO,EACDzC,EAAc+B,EAAgB,GAE9B,MAIXnE,EAAI,EACJkE,EAAe1C,IAAYsD,EAC1BZ,EAAe1C,IACf,SAAAuD,GACmB,GAAA,MAAdA,EAAoB,CACvBA,GAAAA,EAAWtD,GAAUyC,EACrBa,EAAWrD,IAASwC,EAAexC,IAAS,EAS9B,QAHd8B,EAAWoB,EAAY5E,KAIrBwD,GACAuB,EAAW3D,KAAOoC,EAASpC,KAC3B2D,EAAWnE,OAAS4C,EAAS5C,KAE9BgE,EAAY5E,QAAAA,OAAKgF,IAIZR,EAAI,EAAGA,EAAIK,EAAmBL,IAAK,CAAA,IACvChB,EAAWoB,EAAYJ,KAKtBO,EAAW3D,KAAOoC,EAASpC,KAC3B2D,EAAWnE,OAAS4C,EAAS5C,KAC5B,CACDgE,EAAYJ,QAAAA,EAAKQ,MAGlBxB,EAAW,KAObC,GAAAA,EAASI,EACRF,EACAoB,EALDvB,EAAWA,GAAYvD,EAOtBmE,EACAC,EACAC,EACAf,EACAG,EACAa,IAGIC,EAAIO,EAAW1D,MAAQmC,EAASnC,KAAOmD,IACtCG,IAAMA,EAAO,IACdnB,EAASnC,KAAKsD,EAAK1D,KAAKuC,EAASnC,IAAK,KAAM0D,GAChDJ,EAAK1D,KAAKuD,EAAGO,EAAWlD,KAAc4B,EAAQsB,IAIjC,MAAVtB,EAAgB,CAKfwB,IAAAA,EAJiB,GAAA,MAAjBP,IACHA,EAAgBjB,QAAAA,IAIbsB,EAAWnD,IAIdqD,EAAUF,EAAWnD,IAMrBmD,EAAWnD,SAAAA,OACL,GACN0C,GAAqBd,GACrBC,GAAUC,GACW,MAArBD,EAAOhD,WACN,CAKDyE,EAAO,GAAc,MAAVxB,GAAkBA,EAAOjD,aAAekD,EAClDA,EAAUwB,YAAY1B,GACtBwB,EAAU,SACJ,CAGLR,IAAAA,EAASf,EAAQc,EAAI,GACpBC,EAASA,EAAOW,cAAgBZ,EAAIK,EACrCL,GAAK,EAAA,GAEDC,GAAUhB,EAAAA,MACPyB,EAGRvB,EAAU0B,aAAa5B,EAAQC,GAC/BuB,EAAUvB,EAaPQ,UAAAA,EAAetD,OAClB+C,EAAU2B,MAAQ,IAQnB5B,OAAAA,IADGuB,EACMA,EAEAxB,EAAO2B,YAGiB,mBAAvBlB,EAAetD,OASzBsD,EAAetC,IAAW8B,QAG3BA,GACAF,EAAS7B,KAAQ+B,GACjBA,EAAOjD,YAAckD,IAIrBD,EAAStB,EAAcoB,IAIzBxD,OAAAA,IACO+E,IAITb,EAAevC,IAAO+C,EAGG,MAArBJ,GAA2D,mBAAvBJ,EAAetD,KAAAA,IACjDZ,EAAIsE,EAAkBtD,OAAQhB,KACN,MAAxBsE,EAAkBtE,IAAYO,EAAW+D,EAAkBtE,IAK5DA,IAAAA,EAAI6E,EAAmB7E,KACL,MAAlB4E,EAAY5E,IAAYuF,EAAQX,EAAY5E,GAAI4E,EAAY5E,IAI7D2E,GAAAA,EAAAA,IACE3E,EAAI,EAAGA,EAAI2E,EAAK3D,OAAQhB,IAC5BwF,EAASb,EAAK3E,GAAI2E,IAAO3E,GAAI2E,IAAO3E,IAcvC,SAAgB8E,EAAajE,EAAU4E,EAAUC,GAC/B,GAAA,MAAbA,IAAmBA,EAAY,IAEnB,MAAZ7E,GAAuC,kBAAZA,EAC1B4E,GAAUC,EAAUzE,KAAKwE,EAAS,YAChC,GAAIE,MAAMC,QAAQ/E,GAAAA,IACnB,IAAIb,EAAI,EAAGA,EAAIa,EAASG,OAAQhB,IACpC8E,EAAajE,EAASb,GAAIyF,EAAUC,QAKrCA,EAAUzE,KAHCwE,EAGIA,EADc,iBAAZ5E,GAA2C,iBAAZA,EACxBM,EAAY,KAAMN,EAAU,KAAM,KAAMA,GACrC,MAAjBA,EAASc,KAAuC,MAAvBd,EAASgB,IAG1CV,EACCN,EAASD,KACTC,EAASP,MACTO,EAASO,IACT,KACAP,EAASkB,KAKYlB,GAhBTA,GAmBT6E,OAAAA,ECvQD,SAASG,EAAUC,EAAKC,EAAUC,EAAU3B,EAAO4B,GACrDjG,IAAAA,EAECA,IAAAA,KAAKgG,EACC,aAANhG,GAA0B,QAANA,GAAiBA,KAAK+F,GAC7CG,EAAYJ,EAAK9F,EAAG,KAAMgG,EAAShG,GAAIqE,GAIpCrE,IAAAA,KAAK+F,EAENE,GAAiC,mBAAfF,EAAS/F,IACvB,aAANA,GACM,QAANA,GACM,UAANA,GACM,YAANA,GACAgG,EAAShG,KAAO+F,EAAS/F,IAEzBkG,EAAYJ,EAAK9F,EAAG+F,EAAS/F,GAAIgG,EAAShG,GAAIqE,GAKjD,SAAS8B,EAASC,EAAOhF,EAAKkE,GACzBlE,MAAAA,EAAI,GACPgF,EAAMF,YAAY9E,EAAKkE,GAKvBc,EAAMhF,GAHU,iBAATkE,IAAAA,IACPnF,EAAmBkG,KAAKjF,GAEXkE,EAAQ,KACF,MAATA,EACG,GAEAA,EAYR,SAASY,EAAYJ,EAAKQ,EAAMhB,EAAOiB,EAAUlC,GACnDmC,IAAAA,EAAGC,EAAYC,EAsBP1G,EAQAA,EA5BRqE,GAAAA,EACU,cAATiC,IACHA,EAAO,SAEW,UAATA,IACVA,EAAO,aAGK,UAATA,EACHE,GAAAA,EAAIV,EAAIM,MAEY,iBAATd,EACVkB,EAAEG,QAAUrB,MACN,CACiB,GAAA,iBAAZiB,IACVC,EAAEG,QAAU,GACZJ,EAAW,MAGRA,EAAAA,IACMvG,KAAKuG,EACPjB,GAAStF,KAAKsF,GACnBa,EAASK,EAAGxG,EAAG,IAKdsF,GAAAA,EAAAA,IACMtF,KAAKsF,EACRiB,GAAYjB,EAAMtF,KAAOuG,EAASvG,IACtCmG,EAASK,EAAGxG,EAAGsF,EAAMtF,QAOL,MAAZsG,EAAK,IAA0B,MAAZA,EAAK,IAChCG,EAAaH,KAAUA,EAAOA,EAAKM,QAAQ,WAAY,KACvDF,EAAYJ,EAAKO,cACjBP,GAAQI,KAAaZ,EAAMY,EAAYJ,GAAMQ,MAAM,GAE/CxB,GACEiB,GAAUT,EAAIiB,iBAAiBT,EAAMU,EAAYP,IACrDX,EAAImB,IAAenB,EAAImB,EAAa,KAAKX,GAAQhB,GAElDQ,EAAIoB,oBAAoBZ,EAAMU,EAAYP,IAGlC,SAATH,GACS,YAATA,GAGS,SAATA,GACS,SAATA,GACS,SAATA,IACCjC,GACDiC,KAAQR,EAERA,EAAIQ,GAAiB,MAAThB,EAAgB,GAAKA,EACP,mBAATA,GAAgC,4BAATgB,IACpCA,KAAUA,EAAOA,EAAKM,QAAQ,WAAY,KAChC,MAATtB,IAAAA,IAAiBA,EACpBQ,EAAIqB,kBACH,+BACAb,EAAKO,eAGNf,EAAIsB,eACH,+BACAd,EAAKO,cACLvB,GAIO,MAATA,IAAAA,IACCA,IAOC,MAAMe,KAAKC,GAEbR,EAAIuB,gBAAgBf,GAEpBR,EAAIwB,aAAahB,EAAMhB,IAU1B,SAAS0B,EAAWO,GACdN,KAAAA,EAAWM,EAAE3G,MAAMnB,EAAQ+H,MAAQ/H,EAAQ+H,MAAMD,GAAKA,GCvI5D,SAAgB1D,EACfF,EACA8D,EACAjE,EACAY,EACAC,EACAC,EACAf,EACAG,EACAa,GAEImD,IAAAA,EAWE9E,EAAG+E,EAAO3B,EAAU4B,EAAUC,EAAUC,EACxC/B,EAKAgC,EACAC,EAjBLC,EAAUR,EAAS7G,KAAAA,QAAAA,IAIhB6G,EAAS3F,YAA2B,OAAO,MAE1C4F,EAAMjI,EAAQyI,MAAQR,EAAID,GAAAA,IAG9BvC,EAAO,GAAsB,mBAAX+C,EAAuB,CAEpClC,GAAAA,EAAW0B,EAASnH,MAKpByH,GADJL,EAAMO,EAAQE,cACQ/D,EAAcsD,EAAIU,KACpCJ,EAAmBN,EACpBK,EACCA,EAASzH,MAAMgF,MACfoC,EAAIW,GACLjE,EAGCZ,EAAS3B,IAEZiG,GADAlF,EAAI6E,EAAS5F,IAAa2B,EAAS3B,KACNyG,GAAuB1F,EAAE2F,KAGlD,cAAeN,GAAWA,EAAQO,UAAUC,OAC/ChB,EAAS5F,IAAae,EAAI,IAAIqF,EAAQlC,EAAUiC,IAEhDP,EAAS5F,IAAae,EAAI,IAAIV,EAAU6D,EAAUiC,GAClDpF,EAAEd,YAAcmG,EAChBrF,EAAE6F,OAASC,GAERX,GAAUA,EAASY,IAAI/F,GAE3BA,EAAEtC,MAAQyF,EACLnD,EAAEgG,QAAOhG,EAAEgG,MAAQ,IACxBhG,EAAET,QAAU6F,EACZpF,EAAEkB,IAAiBM,EACnBuD,EAAQ/E,EAAEC,KAAAA,EACVD,EAAEiG,IAAmB,IAIF,MAAhBjG,EAAEkG,MACLlG,EAAEkG,IAAalG,EAAEgG,OAEsB,MAApCX,EAAQc,2BACPnG,EAAEkG,KAAclG,EAAEgG,QACrBhG,EAAEkG,IAAa1I,EAAO,GAAIwC,EAAEkG,MAG7B1I,EACCwC,EAAEkG,IACFb,EAAQc,yBAAyBhD,EAAUnD,EAAEkG,OAI/C9C,EAAWpD,EAAEtC,MACbsH,EAAWhF,EAAEgG,MAGTjB,EAEkC,MAApCM,EAAQc,0BACgB,MAAxBnG,EAAEoG,oBAEFpG,EAAEoG,qBAGwB,MAAvBpG,EAAEqG,mBACLrG,EAAEiG,IAAiB5H,KAAK2B,EAAEqG,uBAErB,CAE+B,GAAA,MAApChB,EAAQc,0BACRhD,IAAaC,GACkB,MAA/BpD,EAAEsG,2BAEFtG,EAAEsG,0BAA0BnD,EAAUiC,IAIpCpF,EAAEuG,KACwB,MAA3BvG,EAAEwG,wBAAAA,IACFxG,EAAEwG,sBACDrD,EACAnD,EAAEkG,IACFd,IAEDP,EAAS1F,MAAcyB,EAASzB,MAAca,EAAE0F,GAChD,CACD1F,IAAAA,EAAEtC,MAAQyF,EACVnD,EAAEgG,MAAQhG,EAAEkG,IAERrB,EAAS1F,MAAcyB,EAASzB,MAAWa,EAAEC,KAAAA,GACjDD,EAAEQ,IAASqE,EACXA,EAAS9F,IAAO6B,EAAS7B,IACzB8F,EAASjG,IAAYgC,EAAShC,IAC1BoB,EAAEiG,IAAiB7H,QACtBuC,EAAYtC,KAAK2B,GAGb8E,EAAM,EAAGA,EAAMD,EAASjG,IAAUR,OAAQ0G,IAC1CD,EAASjG,IAAUkG,KACtBD,EAASjG,IAAUkG,GAAKjG,GAAUgG,GAI9BvC,MAAAA,EAGHtC,MAAAA,EAAEyG,qBACLzG,EAAEyG,oBAAoBtD,EAAUnD,EAAEkG,IAAYd,GAGnB,MAAxBpF,EAAE0G,oBACL1G,EAAEiG,IAAiB5H,KAAK,WACvB2B,EAAE0G,mBAAmBtD,EAAU4B,EAAUC,KAK5CjF,EAAET,QAAU6F,EACZpF,EAAEtC,MAAQyF,EACVnD,EAAEgG,MAAQhG,EAAEkG,KAEPpB,EAAMjI,EAAQ8J,MAAU7B,EAAID,GAEjC7E,EAAEC,KAAAA,EACFD,EAAEQ,IAASqE,EACX7E,EAAEgB,IAAaD,EAEf+D,EAAM9E,EAAE6F,OAAO7F,EAAEtC,MAAOsC,EAAEgG,MAAOhG,EAAET,SAGnCsF,EAASjG,IADD,MAAPkG,GAAeA,EAAI9G,MAAQqB,GAAuB,MAAXyF,EAAItG,IAEzCsG,EAAIpH,MAAMO,SACV8E,MAAMC,QAAQ8B,GACdA,EACA,CAACA,GAEqB,MAArB9E,EAAE4G,kBACLpF,EAAgBhE,EAAOA,EAAO,GAAIgE,GAAgBxB,EAAE4G,oBAGhD7B,GAAsC,MAA7B/E,EAAE6G,0BACf5B,EAAWjF,EAAE6G,wBAAwBzD,EAAU4B,IAGhD3D,EACCN,EACA8D,EACAjE,EACAY,EACAC,EACAC,EACAf,EACAG,EACAa,GAGD3B,EAAEF,KAAO+E,EAAS9F,IAEdiB,EAAEiG,IAAiB7H,QACtBuC,EAAYtC,KAAK2B,GAGdkF,IACHlF,EAAE2F,IAAgB3F,EAAE0F,GAAuB,MAG5C1F,EAAEuG,KAAAA,OAEmB,MAArB7E,GACAmD,EAAS1F,MAAcyB,EAASzB,KAEhC0F,EAASjG,IAAYgC,EAAShC,IAC9BiG,EAAS9F,IAAO6B,EAAS7B,KAEzB8F,EAAS9F,IAAO+H,EACflG,EAAS7B,IACT8F,EACAjE,EACAY,EACAC,EACAC,EACAf,EACAgB,IAIGmD,EAAMjI,EAAQkK,SAASjC,EAAID,GAC/B,MAAOF,GACRE,EAAS1F,IAAY,KACrBtC,EAAQmK,IAAYrC,EAAGE,EAAUjE,GAG3BiE,OAAAA,EAAS9F,IAQV,SAASqC,EAAWT,EAAasG,GACnCpK,EAAQqK,KAASrK,EAAQqK,IAAQD,EAAMtG,GAE3CA,EAAYF,KAAK,SAAAT,GAAAA,IAEfW,EAAcX,EAAEiG,IAChBjG,EAAEiG,IAAmB,GACrBtF,EAAYF,KAAK,SAAA0G,GAChBA,EAAGC,KAAKpH,KAER,MAAO2E,GACR9H,EAAQmK,IAAYrC,EAAG3E,EAAEQ,QAmB5B,SAASsG,EACR5D,EACA2B,EACAjE,EACAY,EACAC,EACAC,EACAf,EACAgB,GAEIvE,IAAAA,EASIyC,EA+CHwH,EACAC,EAOOlK,EA/DRgG,EAAWxC,EAASlD,MACpByF,EAAW0B,EAASnH,MAGxB+D,GAAAA,EAA0B,QAAlBoD,EAAS7G,MAAkByD,EAEV,MAArBC,EAAAA,IACEtE,EAAI,EAAGA,EAAIsE,EAAkBtD,OAAQhB,IAAAA,GAO/B,OANJyC,EAAQ6B,EAAkBtE,OAOX,OAAlByH,EAAS7G,KACW,IAAnB6B,EAAM0H,SACN1H,EAAM2H,YAAc3C,EAAS7G,OAC/BkF,GAAOrD,GACP,CACDqD,EAAMrD,EACN6B,EAAkBtE,GAAK,KAAA,MAMf,GAAA,MAAP8F,EAAa,CACM,GAAA,OAAlB2B,EAAS7G,KAAAA,OACLyJ,SAASC,eAAevE,GAGhCD,EAAMzB,EACHgG,SAASE,gBAAgB,6BAA8B9C,EAAS7G,MAChEyJ,SAAS1J,cACT8G,EAAS7G,KACTmF,EAASyE,IAAM,CAAEA,GAAIzE,EAASyE,KAGjClG,EAAoB,KAEpBC,GAAAA,EAGqB,GAAA,OAAlBkD,EAAS7G,KACRoF,IAAaD,GAAYD,EAAI2E,MAAQ1E,IACxCD,EAAI2E,KAAO1E,OAEN,CACmB,GAAA,MAArBzB,IACHA,EAAoBpE,EAAU4G,MAAMkD,KAAKlE,EAAI4E,aAK1CT,GAFJjE,EAAWxC,EAASlD,OAASL,GAEN0K,wBACnBT,EAAUnE,EAAS4E,yBAIlBpG,EAAa,CACbyB,GAAAA,IAAa/F,EAAAA,IAChB+F,EAAW,GACFhG,EAAI,EAAGA,EAAI8F,EAAI8E,WAAW5J,OAAQhB,IAC1CgG,EAASF,EAAI8E,WAAW5K,GAAGsG,MAAQR,EAAI8E,WAAW5K,GAAGsF,OAInD4E,GAAWD,KAETC,GAAYD,GAAWC,EAAQW,QAAUZ,EAAQY,SACrD/E,EAAIgF,UAAaZ,GAAWA,EAAQW,QAAW,KAKlDhF,EAAUC,EAAKC,EAAUC,EAAU3B,EAAOE,GAGtC2F,EACHzC,EAASjG,IAAY,IAErBiG,EAASjG,IAAYiG,EAASnH,MAAMO,SACpCoD,EACC6B,EACA2B,EACAjE,EACAY,EACkB,kBAAlBqD,EAAS7G,MAAmCyD,EAC5CC,EACAf,EACAtD,EACAsE,IAKGA,IAEH,UAAWwB,QAAAA,KACV/F,EAAI+F,EAAST,QACdtF,IAAM8F,EAAIR,OAEVY,EAAYJ,EAAK,QAAS9F,EAAGgG,EAASV,OAAAA,GAGtC,YAAaS,QAAAA,KACZ/F,EAAI+F,EAASgF,UACd/K,IAAM8F,EAAIiF,SAEV7E,EAAYJ,EAAK,UAAW9F,EAAGgG,EAAS+E,SAAAA,IAKpCjF,OAAAA,EASR,SAAgBN,EAASnE,EAAKiE,EAAO/D,GAAAA,IAEjB,mBAAPF,EAAmBA,EAAIiE,GAC7BjE,EAAI2J,QAAU1F,EAClB,MAAOiC,GACR9H,EAAQmK,IAAYrC,EAAGhG,IAYzB,SAAgBgE,EAAQhE,EAAO0J,EAAaC,GACvCC,IAAAA,EAOArF,EAsBM9F,EA5BNP,GAAAA,EAAQ8F,SAAS9F,EAAQ8F,QAAQhE,IAEhC4J,EAAI5J,EAAMF,OACT8J,EAAEH,SAAWG,EAAEH,UAAYzJ,EAAMI,KAAM6D,EAAS2F,EAAG,KAAMF,IAI1DC,GAAmC,mBAAd3J,EAAMX,OAC/BsK,EAAmC,OAArBpF,EAAMvE,EAAMI,MAK3BJ,EAAMI,IAAOJ,EAAMK,SAAAA,EAEW,OAAzBuJ,EAAI5J,EAAMM,KAAqB,CAC/BsJ,GAAAA,EAAEC,qBAAAA,IAEJD,EAAEC,uBACD,MAAO7D,GACR9H,EAAQmK,IAAYrC,EAAG0D,GAIzBE,EAAEzI,KAAOyI,EAAEvH,IAAa,KAGpBuH,GAAAA,EAAI5J,EAAMC,IAAAA,IACLxB,EAAI,EAAGA,EAAImL,EAAEnK,OAAQhB,IACzBmL,EAAEnL,IAAIuF,EAAQ4F,EAAEnL,GAAIiL,EAAaC,GAInCpF,MAAAA,GAAavF,EAAWuF,GAI7B,SAAS4C,EAASpI,EAAOsI,EAAOzG,GACxBkJ,OAAAA,KAAKvJ,YAAYxB,EAAO6B,GLpchC,SAAgBsG,EAAOlH,EAAOoC,EAAW2H,GAMpC/G,IAAAA,EAOAf,EAMAD,EAlBA9D,EAAQ8L,IAAO9L,EAAQ8L,GAAMhK,EAAOoC,GAYpCH,GAPAe,EAAc+G,IAAgBvL,GAQ/B,KACCuL,GAAeA,EAAY9J,KAAcmC,EAAUnC,IACvDD,EAAQZ,EAAcsB,EAAU,KAAM,CAACV,IAGnCgC,EAAc,GAClBM,EACCF,GAGEY,EAAcZ,EAAY2H,GAAe3H,GAAWnC,IAAYD,EAClEiC,GAAYvD,EACZA,OAAAA,IACA0D,EAAUI,gBACVuH,IAAgB/G,EACb,CAAC+G,GACD9H,EACA,KACAtD,EAAU4G,MAAMkD,KAAKrG,EAAU+G,YAClCnH,EACA+H,GAAerL,EACfsE,GAIDP,EAAWT,EAAahC,GASlB,SAAS0E,EAAQ1E,EAAOoC,GAC9B8E,EAAOlH,EAAOoC,EAAW5D,GMrDnB,SAASyL,EAAajK,EAAOjB,GAG/BQ,IAAAA,EACOd,EAAAA,IAAAA,KAHXM,EAAQF,EAAOA,EAAO,GAAImB,EAAMjB,OAAQA,GACpCS,UAAUC,OAAS,IAAGV,EAAMO,SAAWX,EAAU4G,MAAMkD,KAAKjJ,UAAW,IACvED,EAAkB,GACNR,EACL,QAANN,GAAqB,QAANA,IAAac,EAAgBd,GAAKM,EAAMN,IAGrDmB,OAAAA,EACNI,EAAMX,KACNE,EACAR,EAAMc,KAAOG,EAAMH,IACnBd,EAAMe,KAAOE,EAAMF,IACnB,MLpBK,SAASoK,EAAcC,GACvBC,IAAAA,EAAM,GAENxJ,EAAU,CACfiG,IAAK,OAASpI,IACdqI,GAAeqD,EACfE,SAAAA,SAAStL,EAAO6B,GACR7B,OAAAA,EAAMO,SAASsB,IAEvB0J,SAAAA,SAASvL,GAEDwL,IAAAA,EAAAA,EAAAA,KADFT,OAAAA,KAAK7B,kBACHsC,EAAO,GAAA,KACRtC,gBAAkB,WACtBmC,OAAAA,EAAIxJ,EAAQiG,KAAO2D,EACZJ,GAAAA,KAGHvC,sBAAwB,SAAA4C,GACxBD,EAAKzL,MAAMgF,QAAU0G,EAAO1G,OAC/BwG,EAAKzI,KAAK,SAAAT,GACTA,EAAET,QAAU6J,EAAO1G,MACnB3C,EAAcC,MAAAA,KAKZ+F,IAAM,SAAA/F,GACVkJ,EAAK7K,KAAK2B,GACNqJ,IAAAA,EAAMrJ,EAAEwI,qBACZxI,EAAEwI,qBAAuB,WACxBU,EAAKI,OAAOJ,EAAKxJ,QAAQM,GAAI,GAC7BqJ,GAAOA,EAAIjC,KAAKpH,MAKZtC,EAAMO,WAIfsB,OAAAA,EAAQyJ,SAASzD,YAAchG,EAO/BA,EAAQ0J,SAASM,GAAchK,EAExBA,EL1CF1C,QAAAA,eAAAA,EAAAA,QAAAA,QAAAA,EAAAA,QAAAA,QAAAA,EAAU,CACfmK,IWHM,SAAqBwC,EAAO7K,GAAAA,IAAAA,IAE9B+B,EAAW+I,EAEP9K,EAAQA,EAAME,IAAAA,IAChB6B,EAAY/B,EAAMM,OAAgByB,EAAUgF,GAAAA,IAG9ChF,GAAAA,EAAUxB,aACwC,MAAlDwB,EAAUxB,YAAYwK,2BAEtBD,GAAAA,EACA/I,EAAUiJ,SACTjJ,EAAUxB,YAAYwK,yBAAyBF,KAId,MAA/B9I,EAAUkJ,oBACbH,GAAAA,EACA/I,EAAUkJ,kBAAkBJ,IAGzBC,EACH,OAAO1J,EAAeW,EAAUiF,IAAgBjF,GAChD,MAAOiE,GACR6E,EAAQ7E,EAKL6E,MAAAA,IT6DM1M,QAAAA,eAAAA,EAAiB,SAAA6B,GACpB,OAAA,MAATA,QAAAA,IAAiBA,EAAMO,aC5ExBI,EAAUsG,UAAU+D,SAAW,SAASE,EAAQhH,GAE3Ce,IAAAA,EAEHA,EADG6E,KAAKvC,MAAeuC,KAAKzC,MACxByC,KAAKvC,IAELuC,KAAKvC,IAAa1I,EAAO,GAAIiL,KAAKzC,OAGlB,mBAAV6D,IACVA,EAASA,EAAOjG,EAAG6E,KAAK/K,QAGrBmM,GACHrM,EAAOoG,EAAGiG,GAIG,MAAVA,GAEApB,KAAKjI,MACJqC,GAAU4F,KAAKxC,IAAiB5H,KAAKwE,GACzC9C,EAAc0I,QAShBnJ,EAAUsG,UAAUkE,YAAc,SAASjH,GACjCrC,KAAAA,MAAAA,KAIH+F,KAAAA,EACD1D,GAAU4F,KAAKxC,IAAiB5H,KAAKwE,GACzC9C,EAAc0I,QAchBnJ,EAAUsG,UAAUC,OAASxG,EAwFzBtC,EAAgB,GAChBC,EAAgB,EAQdC,EACa,mBAAX8M,QACJA,QAAQnE,UAAUoE,KAAKC,KAAKF,QAAQG,WACpCC,WC5KEhN,EAAaE,ECHRD,EAAI;;AOyUd,aA3UK,SAAU,EAAU,GACjB,OAAA,EAAG,EAAG,OAAS,IAAM,KAGxB,SAAU,EAAU,EAAS,GAMjC,EAAG,KALM,SAAW,EAAM,GAClB,MAAA,EAAO,EAAI,GACX,EAAO,EAAI,GACV,OAAA,EAAO,GAAQ,EAAI,EAAO,EAAO,EAAI,IAK1C,SAAU,EAAkB,EAAgB,EAAM,GAE/C,OADF,EAAI,IAAI,IAAI,EAAI,IAAI,EAAG,EAAS,IAC9B,EAAI,IAAI,GAGX,SAAU,EAAgB,EAAgB,EAAM,GAChD,OAAC,EAAI,IAAI,GACN,EAAI,IAAI,GADS,EAAS,GAI7B,SAAU,EAAiB,EAAgB,GAC3C,IAAC,EAAI,IAAI,GACL,MAAA,IAAI,sBAAsB,KAE3B,OAAA,EAAI,IAAI,GAgThB,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,OAAA,EAAA,QAAA,OAAA,EAAA,QAAA,YAAA,EAAA,QAAA,UAAA,EAAA,QAAA,WAAA,EAAA,QAAA,MAAA,EAAA,QAAA,UAAA,EAAA,QAAA,SAAA,EAAA,QAAA,QAAA,EAAA,QAAA,cAAA,EAAA,QAAA,MAAA,EAAA,QAAA,SAAA,EAAA,QAAA,gBAAA,EAAA,QAAA,gBAAA,EAAA,QAAA,KAAA,EAAA,QAAA,2BAAA,EAAA,QAAA,yBAAA,EAAA,QAAA,mBAAA,EAAA,QAAA,WAAA,EAAA,QAAA,aAAA,EAAA,QAAA,cAAA,EA5RK,MAAO,EAAb,cACU,KAAA,IAAM,IAAI,IAElB,YAAY,GACJ,MAAA,EAAM,EAAE,IACR,EAAW,KAAK,IAAI,IAAI,GAC1B,OAAA,IACC,KAAA,IAAI,IAAI,EAAK,GACX,GAET,QAAQ,GACD,KAAA,IAAI,QAAQ,GAElB,CAAA,OAAO,YACC,OAAA,KAAK,IAAI,UAId,SAAW,EAAY,EAAiB,GACvC,IAAA,IAAI,KAAK,QACN,EAAE,GAIN,SAAU,EAAa,EAAiB,GACvC,IAAA,IAAI,KAAK,EACZ,EAAE,GAIA,SAAU,EAAe,EAAiB,EAAsB,GAChE,IAAA,EAAW,EACV,IAAA,IAAI,KAAK,EACZ,EAAQ,EAAE,EAAO,GAEZ,OAAA,EAGH,SAAU,EAAQ,EAAW,GAC1B,OAAA,IAAI,MAAM,KAAK,IAAI,EAAQ,EAAE,OAAQ,GAAK,GAAG,KAAK,KAAO,EAG5D,SAAU,EAAc,GACxB,IAAA,KAAsB,EAAQ,QAAQ,MAMnC,OALS,MAAZ,EAAiB,EAAmB,OAC/B,EAAU,GAAI,EAAmB,OACjC,EAAU,IAAM,EAAmB,SACnC,EAAU,EAAG,KAAsB,EAAQ,QAAQ,MACnD,EAAU,KAAI,KAAsB,EAAQ,QAAQ,OACtD,EAGH,SAAU,EAAM,GACb,OAAA,EAAI,KAAK,MAAM,GAGlB,SAAU,EAAS,GAChB,OAAA,EAAM,KAAK,IAAI,EAAM,GAAK,IAAO,EAGpC,SAAU,EACd,EACA,EACA,EACA,EACA,EAAkB,GAGX,IADP,QAAQ,QAAQ,MAAM,KAAqB,MAAM,MACpC,CACP,GAAA,EAAK,GAAM,EAAiB,MAAO,CAAC,EAAI,GACtC,MAAA,GAAO,EAAK,GAAM,EACZ,EAAE,GACJ,EAAQ,EAAK,EAClB,EAAK,GAgBR,SAAU,EAAmB,EAAS,GACtC,GAAc,IAAd,EAAG,OAAc,OAAQ,EAEzB,IAAA,EAAK,EACL,EAAK,EAAG,OAAS,EAEd,KAAA,IAAO,GAAI,CACV,MAAA,EAAM,KAAK,OAAO,EAAK,GAAM,GAE/B,EAAE,EAAG,IAEP,EAAK,EAGL,EAAK,EAAM,EAIR,OAAA,EAAE,EAAG,IAAO,GAAM,EAGrB,SAAU,KAAQ,IAElB,SAAU,EAA6C,EAAM,GAC5D,IAAA,IAAI,KAAO,EACV,GAAA,EAAE,KAAS,EAAE,GAAM,OAAO,EAE3B,IAAA,IAAI,KAAO,EACV,GAAA,EAAE,KAAS,EAAE,GAAM,OAAO,EAEzB,OAAA,EAGH,SAAU,EAA8C,GACxD,IAAA,EAAoC,KAChC,OAAA,IACF,IAAA,EACA,OAAQ,MAAR,GACF,EAAS,EAAG,GACZ,EAAO,CAAC,KAAA,EAAM,OAAA,GACP,GACE,EAA2B,EAAK,KAAM,GACxC,EAAK,QAEZ,EAAK,KAAO,EACZ,EAAK,OAAS,EAAG,GACV,EAAK,SAKZ,SAAU,EAAyB,GACnC,IAAA,EAAoC,KAChC,OAAA,IACF,IAAA,EACA,OAAQ,MAAR,GACF,EAAS,EAAG,GACZ,EAAO,CAAC,KAAA,EAAM,OAAA,GACP,GACE,EAAK,OAAS,EAChB,EAAK,QAEZ,EAAK,KAAO,EACZ,EAAK,OAAS,EAAG,GACV,EAAK,SAKZ,SAAU,EAAc,GACxB,IAAA,EAA2B,KACxB,MAAA,KACO,MAAR,IACF,EAAO,CAAC,OAAQ,MAEX,EAAK,QAwHf,QAAA,SAAA,EApHD,MAAM,EAAoB,EACxB,KACQ,MAAA,EAAW,mEACX,EAAM,IAAI,IACX,IAAA,IAAI,EAAI,EAAG,EAAI,EAAS,OAAQ,IACnC,EAAI,IAAI,EAAS,OAAO,GAAI,GAGvB,OADP,EAAI,IAAI,KAAM,GACP,IAQL,SAAU,EAAa,GAGrB,MAAA,EAAc,IAahB,GAAA,EAAQ,OAAS,GAAM,EACnB,MAAA,IAAI,yFAC2E,EAAQ,UAIzF,MAAA,EAAe,EAAQ,OAAS,EAClC,IAAA,EA0BE,EAJF,EAAQ,QAAU,GACuB,MAAvC,EAAQ,OAAO,EAAQ,OAAS,GACS,MAAvC,EAAQ,OAAO,EAAQ,OAAS,GAEP,EAAf,EAAmB,EAGJ,EAAf,EAAmB,EAQR,EAAf,EAGR,MAAA,EAAQ,IAAI,WAAW,GACzB,IAAA,EAAS,EAER,IAAA,IAAI,EAAI,EAAG,EAAI,EAAc,IAAK,CAC/B,MAAA,EAAO,EAAQ,OAAW,EAAJ,EAAQ,GAC9B,EAAO,EAAQ,OAAW,EAAJ,EAAQ,GAC9B,EAAO,EAAQ,OAAW,EAAJ,EAAQ,GAC9B,EAAO,EAAQ,OAAW,EAAJ,EAAQ,GAE9B,EAAU,EAAY,IAAI,GAC1B,EAAU,EAAY,IAAI,GAC1B,EAAU,EAAY,IAAI,GAC1B,EAAU,EAAY,IAAI,GAE5B,GAAW,MAAX,GAA8B,MAAX,GAA8B,MAAX,GAA8B,MAAX,EACrD,MAAA,IAAI,oCAC0B,EAAJ,QAAgB,EAAJ,EAAQ,MAAM,EAAQ,UAC1D,EAAJ,EACI,EAAJ,EAAQ,MAKd,EAAM,KAAa,GAAW,EAAM,GAAW,EAClC,MAAT,IACF,EAAM,MAAwB,GAAV,IAAiB,EAAM,GAAW,GAE3C,MAAT,IACF,EAAM,MAAwB,EAAV,IAAgB,EAAK,GAIzC,GAAA,IAAW,EACP,MAAA,IAAI,4BAA4B,6BAAqC,MAGtE,OAAA;;ACrOY,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,SAAA,QAAA,UAAA,EArGrB,MAAM,EAGJ,YAAqB,GAAA,KAAA,KAAA,EAFrB,KAAA,KAA2B,KAC3B,KAAA,KAA2B,MAIvB,MAAO,EAIX,cAHQ,KAAA,KAA2B,KAC3B,KAAA,KAA2B,KAC3B,KAAA,KAAe,EAGvB,UACS,OAAA,KAAK,KAEd,UACS,OAAA,KAAK,KAEd,UACS,OAAA,KAAK,KAGd,OAAO,GACA,KAAK,MAGH,KAAA,KAAK,KAAO,EACjB,EAAK,KAAO,KAAK,KACZ,KAAA,KAAO,GAJP,KAAA,KAAO,KAAK,KAAO,EAMrB,KAAA,OAGP,QAAQ,GASC,OARF,KAAK,MAGH,KAAA,KAAK,KAAO,EACjB,EAAK,KAAO,KAAK,KACZ,KAAA,KAAO,GAJP,KAAA,KAAO,KAAK,KAAO,EAMrB,KAAA,OACE,EAGT,MACM,GAAC,KAAK,KAEH,CACC,MAAA,EAAM,KAAK,KASV,OARH,EAAI,MACD,KAAA,KAAO,EAAI,KACX,KAAA,KAAK,KAAO,MAEZ,KAAA,KAAO,KAAK,KAAO,KAErB,KAAA,OACL,EAAI,KAAO,KACJ,EAXA,OAAA,KAeX,UACM,GAAC,KAAK,KAEH,CACC,MAAA,EAAM,KAAK,KASV,OARH,EAAI,MACD,KAAA,KAAO,EAAI,KACX,KAAA,KAAK,KAAO,MAEZ,KAAA,KAAO,KAAK,KAAO,KAErB,KAAA,OACL,EAAI,KAAO,KACJ,EAXA,OAAA,KAeX,OAAO,GACY,MAAb,EAAK,KACF,KAAA,UACiB,MAAb,EAAK,KACT,KAAA,OAIL,EAAK,KAAK,KAAO,EAAK,KACtB,EAAK,KAAK,KAAO,EAAK,KACtB,EAAK,KAAO,KACZ,EAAK,KAAO,KACP,KAAA,SAUU,QAAA,KAAA,EAAf,MAAO,EAIX,YAAoB,GAAA,KAAA,SAAA,EAHZ,KAAA,KAAO,IAAI,EACX,KAAA,IAAM,IAAI,IAIlB,IAAI,GACK,OAAA,KAAK,IAAI,IAAI,GAGtB,IAAI,GACI,MAAA,EAAO,KAAK,IAAI,IAAI,GACtB,OAAC,GAIA,KAAA,KAAK,OAAO,EAAK,UACjB,KAAA,KAAK,QAAQ,EAAK,UAEhB,EAAO,EAAK,MAAQ,MANlB,KASX,UACS,OAAA,KAAK,KAAK,UAGnB,cACS,OAAA,KAAK,SAGd,OAAO,EAAQ,GACP,MAAA,EAAO,KAAK,IAAI,IAAI,GAKnB,IAJH,GACG,KAAA,KAAK,OAAO,EAAK,UAGjB,KAAK,KAAK,WAAa,KAAK,UAC5B,KAAA,IAAI,OAAO,KAAK,KAAK,MAAO,MAE7B,MAAA,EAAW,KAAK,KAAK,QAAQ,IAAI,EAAS,IAC3C,KAAA,IAAI,IAAI,EAAK,CAAC,MAAA,EAAO,SAAA,IAG5B,YAAY,EAAQ,GACd,IAAA,EAAQ,KAAK,IAAI,GAKd,OAJM,MAAT,IACF,EAAQ,EAAE,GACL,KAAA,OAAO,EAAK,IAEZ,EAGT,YACQ,MAAA,EAAS,KAAK,KAAK,MACrB,IAAC,EAAQ,OAAO,KACd,MAAA,EAAM,EAAO,KACb,EAAQ,KAAK,IAAI,IAAI,GAAM,MAE1B,OADF,KAAA,IAAI,OAAO,GACT,CAAC,EAAK,GAGf,QACO,KAAA,KAAO,IAAI,EACX,KAAA,IAAM,IAAI,KA/DE,QAAA,SAAA;;ACmPZ,aAxVH,SAAU,EAAM,EAAW,EAAgB,GAC3C,OAAA,EAAI,EAAe,EACnB,EAAI,EAAe,EAChB,EAqVA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,MAAA,EAAA,QAAA,KAAA,QAAA,gBAAA,QAAA,UAAA,EAlVH,MAAO,EACX,YAAqB,EAAoB,GAApB,KAAA,EAAA,EAAoB,KAAA,EAAA,EACzC,MAAM,GACG,OAAA,IAAI,EAAK,EAAG,KAAK,GAE1B,MAAM,GACG,OAAA,IAAI,EAAK,KAAK,EAAG,GAG1B,KAAK,GACI,OAAA,IAAI,EAAK,KAAK,EAAI,EAAM,EAAG,KAAK,EAAI,EAAM,GAEnD,MAAM,GACG,OAAA,IAAI,EAAK,KAAK,EAAI,EAAM,EAAG,KAAK,EAAI,EAAM,GAEnD,MAAM,GACG,OAAA,IAAI,EAAK,KAAK,EAAI,EAAQ,KAAK,EAAI,GAE5C,eAAe,GACN,OAAA,IAAI,EAAK,KAAK,EAAI,EAAM,EAAG,KAAK,EAAI,EAAM,GAEnD,mBAAmB,GACV,OAAA,IAAI,EAAK,KAAK,EAAI,EAAM,EAAG,KAAK,EAAI,EAAM,GAEnD,IAAI,GACK,OAAA,KAAK,EAAI,EAAM,EAAI,KAAK,EAAI,EAAM,EAE3C,OAAO,GACE,OAAA,KAAK,IAAM,EAAM,GAAK,KAAK,IAAM,EAAM,EAEhD,aAAa,EAAa,EAAU,MAC3B,OAAA,KAAK,IAAI,KAAK,EAAI,EAAM,GAAK,GAAW,KAAK,IAAI,KAAK,EAAI,EAAM,GAAK,EAG9E,UACS,OAAA,KAAK,IAAI,MAElB,SACS,OAAA,KAAK,KAAK,KAAK,WAExB,MACS,OAAA,IAAI,EAAK,KAAK,IAAI,KAAK,GAAI,KAAK,IAAI,KAAK,IAG3C,WAAI,EAAS,GACX,OAAA,IAAI,EAAK,KAAK,IAAI,EAAE,EAAG,EAAE,GAAI,KAAK,IAAI,EAAE,EAAG,EAAE,IAG/C,WAAI,EAAS,GACX,OAAA,IAAI,EAAK,KAAK,IAAI,EAAE,EAAG,EAAE,GAAI,KAAK,IAAI,EAAE,EAAG,EAAE,IAG/C,aAAM,EAAS,EAAW,GACxB,OAAA,IAAI,EAAK,EAAM,EAAE,EAAG,EAAI,EAAG,EAAI,GAAI,EAAM,EAAE,EAAG,EAAI,EAAG,EAAI,IAMlE,UACS,MAAA,CAAC,KAAK,EAAG,KAAK,IAsRhB,QAAA,KAAA,EA1RA,EAAA,KAAO,IAAI,EAAK,EAAG,GACnB,EAAA,KAAO,IAAI,EAAK,EAAG,GAOtB,MAAO,EACX,YACW,EAAM,EACN,EAAM,EACN,EAAM,EACN,EAAM,EACN,EAAM,EACN,EAAM,GALN,KAAA,IAAA,EACA,KAAA,IAAA,EACA,KAAA,IAAA,EACA,KAAA,IAAA,EACA,KAAA,IAAA,EACA,KAAA,IAAA,EAGX,UAAU,GACJ,IAAA,IAAC,EAAD,IAAM,EAAN,IAAW,EAAX,IAAgB,EAAhB,IAAqB,EAArB,IAA0B,GAAO,KAG9B,OAFP,EAAM,EAAE,EACR,EAAM,EAAE,EACD,IAAI,EAAgB,EAAK,EAAK,EAAK,EAAK,EAAK,GAE/C,iBAAU,GACR,OAAA,IAAI,GAAkB,UAAU,GAEzC,SAAS,GACA,OAAA,EAAgB,UAAU,GAAG,MAAM,MAE5C,WACS,OAAA,IAAI,EAAK,KAAK,IAAK,KAAK,KAGjC,gBAAgB,GACV,IAAA,IAAC,EAAD,IAAM,EAAN,IAAW,EAAX,IAAgB,EAAhB,IAAqB,EAArB,IAA0B,GAAO,KAG9B,OAFP,EAAM,EAAE,EACR,EAAM,EAAE,EACD,IAAI,EAAgB,EAAK,EAAK,EAAK,EAAK,EAAK,GAE/C,uBAAgB,GACd,OAAA,IAAI,GAAkB,gBAAgB,GAE/C,iBACS,OAAA,IAAI,EAAK,KAAK,IAAK,KAAK,KAEjC,aAAa,GACJ,OAAA,EAAgB,gBAAgB,GAAG,MAAM,MAG3C,oBAAa,EAAY,GACvB,OAAA,EAAgB,gBAAgB,EAAK,OAAO,OAAO,IACvD,SAAS,IAAI,EAAK,EAAG,KAAK,EAAI,EAAK,KAAK,EAAG,EAAG,KAAK,EAAI,EAAK,KAAK,IACjE,aAAa,EAAG,QAGrB,MAAM,GACE,MAAA,EAAM,KAAK,IAAM,EAAM,IAAM,KAAK,IAAM,EAAM,IAC9C,EAAM,KAAK,IAAM,EAAM,IAAM,KAAK,IAAM,EAAM,IAC9C,EAAM,KAAK,IAAM,EAAM,IAAM,KAAK,IAAM,EAAM,IAAM,KAAK,IAEzD,EAAM,KAAK,IAAM,EAAM,IAAM,KAAK,IAAM,EAAM,IAC9C,EAAM,KAAK,IAAM,EAAM,IAAM,KAAK,IAAM,EAAM,IAC9C,EAAM,KAAK,IAAM,EAAM,IAAM,KAAK,IAAM,EAAM,IAAM,KAAK,IACxD,OAAA,IAAI,EAAgB,EAAK,EAAK,EAAK,EAAK,EAAK,GAGtD,OAAO,GAEH,OAAA,KAAK,KAAO,EAAM,KAClB,KAAK,KAAO,EAAM,KAClB,KAAK,KAAO,EAAM,KAClB,KAAK,KAAO,EAAM,KAClB,KAAK,KAAO,EAAM,KAClB,KAAK,KAAO,EAAM,IAItB,aAAa,EAAwB,EAAU,MAE3C,OAAA,KAAK,IAAI,KAAK,IAAM,EAAM,KAAO,GACjC,KAAK,IAAI,KAAK,IAAM,EAAM,KAAO,GACjC,KAAK,IAAI,KAAK,IAAM,EAAM,KAAO,GACjC,KAAK,IAAI,KAAK,IAAM,EAAM,KAAO,GACjC,KAAK,IAAI,KAAK,IAAM,EAAM,KAAO,GACjC,KAAK,IAAI,KAAK,IAAM,EAAM,KAAO,EAIrC,YAAY,GACJ,MAAA,IAAC,EAAD,IAAM,EAAN,IAAW,EAAX,IAAgB,EAAhB,IAAqB,EAArB,IAA0B,GAAO,KAChC,OAAA,IAAI,EAAgB,EAAI,EAAK,EAAI,EAAK,EAAI,EAAK,EAAI,EAAK,EAAI,EAAK,EAAI,GAG9E,MACQ,MAAA,IAAC,EAAD,IAAM,EAAN,IAAW,EAAX,IAAgB,EAAhB,IAAqB,EAArB,IAA0B,GAAO,KAMrC,OAAA,GAHU,EAGH,EAJG,EAIS,GAAa,GAHtB,EAG6B,EAL7B,EAKyC,GAAa,GAJtD,EAI6D,EAL7D,EAKyE,GAIvF,MACQ,MAAA,IAAC,EAAD,IAAM,EAAN,IAAW,EAAX,IAAgB,EAAhB,IAAqB,EAArB,IAA0B,GAAO,KAmBhC,OAAA,IAAI,IAhBC,EASc,EAVd,EAU0B,KAT1B,EAUc,EAXd,EAW0B,KACZ,EAAM,EAAM,EAAM,KAXhC,EAYc,EAdd,EAc0B,KAZ1B,EAac,EAfd,EAe0B,KACZ,EAAM,EAAM,EAAM,IAK9C,WACQ,MAAA,EAAM,KAAK,MACb,OAAQ,IAAR,EAAkB,KACV,KAAK,MACN,YAAY,EAAI,GAG7B,gBAAgB,GACP,OAAA,IAAI,EAAK,EAAE,EAAI,KAAK,IAAM,EAAE,EAAI,KAAK,IAAK,EAAE,EAAI,KAAK,IAAM,EAAE,EAAI,KAAK,KAG/E,uBAAuB,GACf,MAAA,EAAM,KAAK,WACb,OAAC,EACE,EAAI,gBAAgB,GADV,KAInB,kBAAkB,GACT,OAAA,IAAI,EACT,EAAE,EAAI,KAAK,IAAM,EAAE,EAAI,KAAK,IAAM,KAAK,IACvC,EAAE,EAAI,KAAK,IAAM,EAAE,EAAI,KAAK,IAAM,KAAK,KAI3C,yBAAyB,GACjB,MAAA,EAAM,KAAK,WACb,OAAC,EACE,EAAI,kBAAkB,GADZ,KAInB,cAAc,GACN,MAAA,EAAO,KAAK,gBAAgB,EAAE,MAC9B,EAAS,KAAK,kBAAkB,EAAE,QAEpC,OAAA,EAAK,EAAI,GAAK,EAAK,EAAI,EAClB,IAAI,EAAK,EAAO,KAAK,GAAO,EAAK,OAC/B,EAAK,EAAI,EACX,IAAI,EAAK,EAAO,MAAM,EAAO,EAAI,EAAK,GAAI,EAAK,OAC7C,EAAK,EAAI,EACX,IAAI,EAAK,EAAO,MAAM,EAAO,EAAI,EAAK,GAAI,EAAK,OAGjD,IAAI,EAAK,EAAQ,GAG1B,qBAAqB,GACb,MAAA,EAAM,KAAK,WACb,OAAC,EACE,EAAI,cAAc,GADR,KAInB,UAGS,MAAA,CACL,KAAK,IAAK,KAAK,IAAK,EACpB,KAAK,IAAK,KAAK,IAAK,EACpB,KAAK,IAAK,KAAK,IAAK,IAiGjB,QAAA,gBAAA,EA5FH,MAAO,EACX,YAAqB,EAAuB,GAAvB,KAAA,OAAA,EAAuB,KAAA,KAAA,EAE5C,UACS,OAAgB,GAAhB,KAAK,SAAiC,GAAjB,KAAK,SAGnC,QACS,OAAA,KAAK,KAAK,EAEnB,SACS,OAAA,KAAK,KAAK,EAGnB,OACS,OAAA,KAAK,OAAO,EAErB,QACS,OAAA,KAAK,OAAS,KAAK,QAE5B,MACS,OAAA,KAAK,OAAO,EAErB,SACS,OAAA,KAAK,MAAQ,KAAK,SAG3B,UACS,OAAA,KAAK,OAEd,WACS,OAAA,KAAK,OAAO,KAAK,IAAI,EAAK,KAAK,QAAS,IAGjD,cACS,OAAA,KAAK,OAAO,KAAK,KAAK,MAE/B,aACS,OAAA,KAAK,OAAO,KAAK,IAAI,EAAK,EAAG,KAAK,WAG3C,WAAW,GACF,OAAA,IAAI,EAAK,EAAQ,KAAK,MAE/B,SAAS,GACA,OAAA,IAAI,EAAK,KAAK,OAAQ,GAG/B,eAAe,GACN,OAAA,IAAI,EAAK,EAAM,EAAE,EAAG,KAAK,OAAQ,KAAK,SAAU,EAAM,EAAE,EAAG,KAAK,MAAO,KAAK,WAGrF,aAAa,GACJ,OAAA,EAAE,MAAM,KAAK,eAAe,IAAI,SAGzC,SAAS,GACA,OAAyB,IAAzB,KAAK,aAAa,GAG3B,oBAAoB,GACZ,MAAA,EAAM,KAAK,IAAI,KAAK,MAAO,EAAM,OAEnC,GADW,KAAK,IAAI,EAAK,KAAK,IAAI,KAAK,SAAU,EAAM,WAC9C,GAAQ,EAAG,OAAO,EAEzB,MAAA,EAAO,KAAK,IAAI,KAAK,OAAQ,EAAM,QAErC,OADU,KAAK,IAAI,EAAM,KAAK,IAAI,KAAK,QAAS,EAAM,UAC9C,GAAS,EAIvB,cAAc,GACN,MAAA,EAAU,EAAK,IAAI,KAAK,UAAW,EAAM,WACzC,EAAc,EAAK,IAAI,EAAS,EAAK,IAAI,KAAK,cAAe,EAAM,gBAElE,OAAA,IAAI,EAAK,EAAS,EAAY,MAAM,IAG7C,OAAO,GACE,OAAA,KAAK,OAAO,OAAO,EAAM,SAAW,KAAK,KAAK,OAAO,EAAM,MAGpE,aAAa,GACJ,OAAA,KAAK,OAAO,aAAa,EAAM,SAAW,KAAK,KAAK,aAAa,EAAM,MAGhF,OACS,OAAA,KAAK,KAAK,EAAI,KAAK,KAAK,GAK1B,QAAA,KAAA,EAFA,EAAA,MAAQ,IAAI,EAAK,EAAK,KAAM,EAAK,MACjC,EAAA,KAAO,IAAI,EAAK,EAAK,KAAM,EAAK,MAChC,EAAA,IAAM,IAAI,EAAK,IAAI,GAAM,GAAI,GAAI,IAAI,EAAK,EAAG;;;ACvVtD,IAOIgN,EACAC,EARAlK,EAAUmK,OAAOC,QAAU,GAU/B,SAASC,IACC,MAAA,IAAIC,MAAM,mCAEpB,SAASC,IACC,MAAA,IAAID,MAAM,qCAsBpB,SAASE,EAAWC,GACZR,GAAAA,IAAqBD,WAEdA,OAAAA,WAAWS,EAAK,GAGvB,IAACR,IAAqBI,IAAqBJ,IAAqBD,WAEzDA,OADPC,EAAmBD,WACZA,WAAWS,EAAK,GAEvB,IAEOR,OAAAA,EAAiBQ,EAAK,GAC/B,MAAMjG,GACA,IAEOyF,OAAAA,EAAiBhD,KAAK,KAAMwD,EAAK,GAC1C,MAAMjG,GAEGyF,OAAAA,EAAiBhD,KAAK,KAAMwD,EAAK,KAMpD,SAASC,EAAgBC,GACjBT,GAAAA,IAAuBU,aAEhBA,OAAAA,aAAaD,GAGpB,IAACT,IAAuBK,IAAwBL,IAAuBU,aAEhEA,OADPV,EAAqBU,aACdA,aAAaD,GAEpB,IAEOT,OAAAA,EAAmBS,GAC5B,MAAOnG,GACD,IAEO0F,OAAAA,EAAmBjD,KAAK,KAAM0D,GACvC,MAAOnG,GAGE0F,OAAAA,EAAmBjD,KAAK,KAAM0D,MAjEhD,WACO,IAEIV,EADsB,mBAAfD,WACYA,WAEAK,EAEzB,MAAO7F,GACLyF,EAAmBI,EAEnB,IAEIH,EADwB,mBAAjBU,aACcA,aAEAL,EAE3B,MAAO/F,GACL0F,EAAqBK,GAjB5B,GAwED,IAEIM,EAFA5K,EAAQ,GACR6K,GAAW,EAEXC,GAAc,EAElB,SAASC,IACAF,GAAaD,IAGlBC,GAAW,EACPD,EAAa5M,OACbgC,EAAQ4K,EAAaI,OAAOhL,GAE5B8K,GAAc,EAEd9K,EAAMhC,QACNiN,KAIR,SAASA,IACDJ,IAAAA,EAAAA,CAGAK,IAAAA,EAAUX,EAAWQ,GACzBF,GAAW,EAGLM,IADFA,IAAAA,EAAMnL,EAAMhC,OACVmN,GAAK,CAGA,IAFPP,EAAe5K,EACfA,EAAQ,KACC8K,EAAaK,GACdP,GACAA,EAAaE,GAAYM,MAGjCN,GAAc,EACdK,EAAMnL,EAAMhC,OAEhB4M,EAAe,KACfC,GAAW,EACXJ,EAAgBS,IAiBpB,SAASG,EAAKb,EAAKc,GACVd,KAAAA,IAAMA,EACNc,KAAAA,MAAQA,EAYjB,SAASC,KA5BTxL,EAAQyL,SAAW,SAAUhB,GACrBiB,IAAAA,EAAO,IAAI9I,MAAM5E,UAAUC,OAAS,GACpCD,GAAAA,UAAUC,OAAS,EACd,IAAA,IAAIhB,EAAI,EAAGA,EAAIe,UAAUC,OAAQhB,IAClCyO,EAAKzO,EAAI,GAAKe,UAAUf,GAGhCgD,EAAM/B,KAAK,IAAIoN,EAAKb,EAAKiB,IACJ,IAAjBzL,EAAMhC,QAAiB6M,GACvBN,EAAWU,IASnBI,EAAK7F,UAAU4F,IAAM,WACZZ,KAAAA,IAAIkB,MAAM,KAAM,KAAKJ,QAE9BvL,EAAQ4L,MAAQ,UAEhB5L,EAAQ6L,IAAM,GACd7L,EAAQ8L,KAAO,GACf9L,EAAQ+L,QAAU,GAClB/L,EAAQgM,SAAW,GAInBhM,EAAQiM,GAAKT,EACbxL,EAAQkM,YAAcV,EACtBxL,EAAQmM,KAAOX,EACfxL,EAAQoM,IAAMZ,EACdxL,EAAQqM,eAAiBb,EACzBxL,EAAQsM,mBAAqBd,EAC7BxL,EAAQuM,KAAOf,EACfxL,EAAQwM,gBAAkBhB,EAC1BxL,EAAQyM,oBAAsBjB,EAE9BxL,EAAQ0M,UAAY,SAAUnJ,GAAe,MAAA,IAE7CvD,EAAQ2M,QAAU,SAAUpJ,GAClB,MAAA,IAAI+G,MAAM,qCAGpBtK,EAAQ4M,IAAM,WAAqB,MAAA,KACnC5M,EAAQ6M,MAAQ,SAAUC,GAChB,MAAA,IAAIxC,MAAM,mCAEpBtK,EAAQ+M,MAAQ,WAAoB,OAAA;;;AC0HpC,IAAA,EAAA,QAAA,WAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,MAAA,QAAA,cAAA,EArRA,MAAM,OACe,IAAZ,GAA2B,EAAQ,MAAO,EAEnD,SAAS,EAAO,GACV,IAAC,IACE,EAAW,MAAM,IAAI,MAAM,qBAIpC,SAAS,EAAa,EAAS,IACN,IAAnB,EAAG,QAAQ,IAAW,EAAG,KAAK,GAGpC,SAAS,EAAa,EAAS,GACvB,MAAA,EAAQ,EAAG,QAAQ,IACV,IAAX,GAAc,EAAG,OAAO,EAAO,GAGrC,SAAS,EAAU,EAA2B,GAEpC,OADR,EAAO,GAAS,GAAK,GAAS,IACtB,EAAG,SAAW,EAGlB,IAAW,EA8PA,EAAjB,QAAA,SAAA,EA9PA,SAAiB,GACF,EAAA,KAAA,MACX,YACS,EAAY,EACZ,EAAY,EACZ,EAAgB,EAChB,EAAiB,GAHjB,KAAA,EAAA,EACA,KAAA,EAAA,EACA,KAAA,MAAA,EACA,KAAA,OAAA,EAGT,IAAI,EAAW,EAAW,EAAe,GAClC,KAAA,EAAI,EACJ,KAAA,EAAI,EACJ,KAAA,MAAQ,EACR,KAAA,OAAS,EAGhB,OAAO,GAEH,OAAA,KAAK,IAAM,EAAM,GACjB,KAAK,IAAM,EAAM,GACjB,KAAK,QAAU,EAAM,OACrB,KAAK,SAAW,EAAM,SAKf,MAAA,EACX,YACS,EACA,EACA,EACA,GAHA,KAAA,KAAA,EACA,KAAA,OAAA,EACA,KAAA,MAAA,EACA,KAAA,OAAA,EAGT,OAAO,GAEH,OAAA,KAAK,OAAS,EAAM,MACpB,KAAK,SAAW,EAAM,QACtB,KAAK,QAAU,EAAM,OACrB,KAAK,SAAW,EAAM,QAQhB,IAAA,EAkBA,EA0FA,EAkDA,EAKA,EAvKH,EAAA,YAAc,IAAI,EAAM,EAAG,EAAG,EAAG,GAjB7B,EAAA,MAAK,EAqBlB,SAAY,GACV,EAAA,EAAA,KAAA,GAAA,OACA,EAAA,EAAA,IAAA,GAAA,MAEA,EAAA,EAAA,aAAA,GAAA,eACA,EAAA,EAAA,aAAA,GAAA,eACA,EAAA,EAAA,qBAAA,GAAA,uBACA,EAAA,EAAA,qBAAA,GAAA,uBAEA,EAAA,EAAA,aAAA,GAAA,eACA,EAAA,EAAA,aAAA,GAAA,eACA,EAAA,EAAA,qBAAA,GAAA,uBACA,EAAA,EAAA,qBAAA,GAAA,uBAEA,EAAA,EAAA,SAAA,IAAA,WACA,EAAA,EAAA,iBAAA,IAAA,mBAfF,CAAY,EAAA,EAAA,iBAAA,EAAA,eAAc,KAkB1B,SAAY,GACV,EAAA,EAAA,UAAA,GAAA,YACA,EAAA,EAAA,eAAA,GAAA,iBAFF,CAAY,EAAA,EAAA,YAAA,EAAA,UAAS,KA+FL,SAAA,EAAoB,GAC3B,OAAA,GAAQ,EAAc,MAAQ,EAAI,EA3FrB,EAAA,QAAA,MAAtB,cAmDY,KAAA,oBAAsB,IAAI,IAbpC,oBACO,KAAA,cAAc,EAAe,IAAK,EAAe,MAExD,mBACO,KAAA,cAAc,EAAe,IAAK,EAAe,KAExD,6BACO,KAAA,cAAc,EAAe,IAAK,EAAe,sBAExD,+BACO,KAAA,cAAc,EAAe,aAAc,EAAe,sBAIjE,2BAA2B,GACpB,KAAA,oBAAoB,IAAI,GAE/B,8BAA8B,GACvB,KAAA,oBAAoB,OAAO,KA6BpC,SAAY,GACV,EAAA,EAAA,MAAA,GAAA,QACA,EAAA,EAAA,KAAA,GAAA,OAFF,CAAY,EAAA,EAAA,gBAAA,EAAA,cAAa,KAKT,EAAA,oBAAmB,EAItB,MAAA,EACX,YACW,EACA,EACA,EACA,GAHA,KAAA,KAAA,EACA,KAAA,KAAA,EACA,KAAA,MAAA,EACA,KAAA,WAAA,GALA,EAAA,UAAS,EAST,EAAA,aAAA,MAAb,cACU,KAAA,YAA2B,GAC3B,KAAA,QAAU,EAEd,iBACK,OAAA,KAAK,YAEV,aACK,OAAA,KAAK,QAGd,IAAI,EAAc,EAAqB,GAG9B,OAFF,KAAA,WAAW,KAAK,IAAI,EAAU,EAAM,EAAM,EAAO,KAAK,SACtD,KAAA,SAAW,EAAQ,EAAoB,GACrC,OAIW,EAAA,aAAA,MAKpB,mBAAmB,GACZ,KAAA,OAAO,IAAI,WAAW,EAAO,QAAS,GAE7C,aAAa,GACN,KAAA,mBAAmB,IAAI,aAAa,MAK7C,SAAY,GACV,EAAA,EAAA,QAAA,GAAA,UACA,EAAA,EAAA,OAAA,GAAA,SAFF,CAAY,EAAA,EAAA,cAAA,EAAA,YAAW,KAKvB,SAAY,GACV,EAAA,EAAA,OAAA,GAAA,SACA,EAAA,EAAA,MAAA,GAAA,QAFF,CAAY,EAAA,EAAA,YAAA,EAAA,UAAS,KAKR,MAAA,EACX,YACW,EACA,EACA,GAFA,KAAA,UAAA,EACA,KAAA,UAAA,EACA,KAAA,KAAA,GAGJ,EAAA,aAAe,IAAI,EAAc,EAAY,OAAQ,EAAY,OAAQ,EAAU,OACnF,EAAA,6BAA+B,IAAI,EACxC,EAAY,OACZ,EAAY,QACZ,EAAU,OAEL,EAAA,cAAgB,IAAI,EACzB,EAAY,QACZ,EAAY,QACZ,EAAU,OAhBD,EAAA,cAAa,EAvN5B,CAAiB,IAAA,QAAA,SAAA,EAAQ,KA8PzB,QAAA,MAAA,EAAA,SAAiB,GACF,MAAA,UAAgB,EAAS,QAwBpC,YAAY,EAA4B,SAAS,cAAc,WAC7D,QAxBM,KAAA,gBAAkB,EAElB,KAAA,iBAAmB,EACnB,KAAA,sBAAwC,GACxC,KAAA,mBAAqB,EAAS,MAAM,YACpC,KAAA,qBAA4C,KAC5C,KAAA,iBAAmB,IAAI,EAAS,KAChC,KAAA,mBAAoB,EACpB,KAAA,YAAc,EAEd,KAAA,QAAU,EACV,KAAA,oBAAsB,EACtB,KAAA,iBAAwC,KACxC,KAAA,aAAe,IAAI,EAAS,KAC5B,KAAA,OAAS,EAuDT,KAAA,2BAA6B,MAC9B,KAAA,gBAAkB,EAClB,KAAA,mBAAqB,EAAS,MAAM,YACpC,KAAA,mBAAoB,EACpB,KAAA,cACA,IAAA,IAAI,KAAW,KAAK,sBACvB,MA0KI,KAAA,uBAAwD,KACxD,KAAA,mCAA6C,EA7N/C,IAAA,EAAK,EAAO,WAAW,QAAS,CAClC,OAAO,EACP,WAAW,EACX,OAAO,EACP,uBAAuB,EACvB,SAAS,IAGP,GAAM,MAAN,EACI,MAAA,IAAI,MAAM,iBAGb,KAAA,IAAM,EACP,IAAA,EAAQ,EAAO,MACnB,EAAO,MAAQ,EACf,EAAO,OAAS,EAChB,EAAM,MAAQ,EAAM,OAAS,IAE7B,EAAO,iBAAiB,mBAAqB,IAC3C,EAAE,mBAGJ,EAAO,iBAAiB,uBAAwB,KAAK,4BAGhD,KAAA,mBAAqB,CACvB,CAAA,EAAS,eAAe,MAAO,KAAK,IAAI,KACxC,CAAA,EAAS,eAAe,KAAM,KAAK,IAAI,IAEvC,CAAA,EAAS,eAAe,cAAe,KAAK,IAAI,UAChD,CAAA,EAAS,eAAe,cAAe,KAAK,IAAI,UAChD,CAAA,EAAS,eAAe,sBAAuB,KAAK,IAAI,oBACxD,CAAA,EAAS,eAAe,sBAAuB,KAAK,IAAI,oBAExD,CAAA,EAAS,eAAe,cAAe,KAAK,IAAI,UAChD,CAAA,EAAS,eAAe,cAAe,KAAK,IAAI,UAChD,CAAA,EAAS,eAAe,sBAAuB,KAAK,IAAI,oBACxD,CAAA,EAAS,eAAe,sBAAuB,KAAK,IAAI,oBAExD,CAAA,EAAS,eAAe,UAAW,KAAK,IAAI,eAC5C,CAAA,EAAS,eAAe,kBAAmB,KAAK,IAAI,0BAjDrD,oBACK,OAAA,KAAK,OAEV,qBACK,OAAA,KAAK,QA2DP,kBACA,KAAA,6BAGH,SACK,OAAA,KAAK,IAEV,iBACK,OAAA,KAAK,YAEd,uBAAuB,GACrB,EAAU,KAAK,sBAAuB,GAExC,0BAA0B,GACxB,EAAU,KAAK,sBAAuB,GAGpC,0BACK,OAAA,KAAK,qBAGd,aACO,KAAA,gBAAgB,MAGvB,YAEA,cAAc,EAAiC,GACxC,KAAA,iBAAmB,EAAQ,gBAAgB,EAAQ,GAG1D,YAAY,EAAW,EAAW,EAAe,IAChB,MAA7B,KAAK,qBACH,KAAK,qBAAqB,SAC1B,KAAK,kBACP,IAAI,EAAG,EAAG,EAAO,GAGjB,eACK,OAA6B,MAA7B,KAAK,qBACR,KAAK,qBAAqB,SAC1B,KAAK,iBAGP,gCACK,OAA6B,MAA7B,KAAK,qBACR,KAAK,qBAAqB,SAAS,MACnC,KAAK,OAGP,iCACK,OAA6B,MAA7B,KAAK,qBACR,KAAK,qBAAqB,SAAS,OACnC,KAAK,QAGX,KACE,EACA,EACA,GAGK,KAAA,iCACL,EAAS,KAAK,GAAU,UAGxB,EAAa,KAAK,GAAU,UACvB,KAAA,cAAc,EAAS,QAGvB,KAAA,oBAEA,KAAA,IAAI,WACP,GAAa,EAAS,UAAU,UAAY,KAAK,IAAI,UAAY,KAAK,IAAI,eAC1E,EACA,KAAK,MAAM,EAAS,UAAY,EAAS,OAAO,SAI7C,KAAA,mBAAoB,EAG3B,OACE,EACA,EACA,EACA,GAEI,IAAA,EAAS,KAAK,IAAI,OAChB,MAAA,EAAS,EAAO,wBAGpB,GAAA,KAAK,SAAW,GAChB,KAAK,UAAY,GACjB,EAAO,QAAU,GACjB,EAAO,SAAW,EAGlB,OAGE,IAAA,EAAQ,EAAO,MACnB,EAAO,MAAQ,EACf,EAAO,OAAS,EAChB,EAAM,SAAW,MACjB,EAAM,UAAY,MACb,KAAA,YAAY,EAAG,EAAG,EAAe,GACjC,KAAA,OAAS,EACT,KAAA,QAAU,EAEV,KAAA,oBAAoB,QAAQ,GAAM,KAGzC,MAAM,GACC,KAAA,iCACA,KAAA,oBAEA,EAAM,OAAO,KAAK,sBAChB,KAAA,IAAI,WAAW,EAAM,KAAM,EAAM,OAAQ,EAAM,MAAO,EAAM,QAC5D,KAAA,mBAAqB,GAGvB,KAAA,IAAI,MAAM,KAAK,IAAI,kBAG1B,gBAAgB,GACT,KAAA,qBAAuB,EAAa,KAAK,GAGhD,eACE,EACA,EACA,GAEI,IAAA,EAAW,IAAI,EAAS,KAAM,EAAQ,EAAc,GAWjD,OAFP,EAAS,QAEF,EAGT,mBAAmB,GAEV,OADP,EAAO,EAAY,GAAK,EAAY,GAAK,GAClC,IAAI,EAAa,KAAM,GAGhC,cACE,EACA,EACA,EACA,GAEO,OAAA,IAAI,EAAQ,KAAM,EAAQ,EAAO,EAAQ,GAGlD,mBAAmB,GACV,OAAA,IAAI,EAAa,KAAM,EAAQ,KAAK,IAK7C,4BAIM,GAHA,KAAK,oCAAsC,KAAK,cAC7C,KAAA,uBAAyB,OAE3B,KAAK,yBACH,KAAA,uBAAyB,KAAK,GAAG,aAAa,2BAC9C,KAAK,wBACF,MAAA,IAAI,MAAM,kDAGb,OAAA,KAAK,uBAGd,iCACM,IAAA,EAAe,KAAK,qBACpB,EAA2B,MAAhB,EAAuB,EAAa,SAAW,KAAK,iBAC/D,EAAK,KAAK,KAEV,KAAK,mBAAqB,KAAK,kBAAoB,KACrD,EAAG,gBAAgB,EAAG,YAAa,EAAe,EAAa,YAAc,MACxE,KAAA,iBAAmB,IAGtB,KAAK,mBAAsB,KAAK,aAAa,OAAO,KACtD,EAAG,SACD,EAAS,EACT,KAAK,2BAA6B,EAAS,EAAI,EAAS,OACxD,EAAS,MACT,EAAS,QAEN,KAAA,aAAa,IAAI,EAAS,EAAG,EAAS,EAAG,EAAS,MAAO,EAAS,SAI3E,oBACM,GAAA,KAAK,mBAAqB,KAAK,qBAAuB,KAAK,iBAAkB,CAC3E,IAAA,EAAK,KAAK,IACV,EAAa,KAAK,iBAClB,EAAgB,KAAK,oBACrB,EAAuB,GAAb,EACV,EAAU,GAAc,EAE5B,EAAO,KAAU,KAAK,oBACtB,EAAO,KAAU,KAAK,oBAGlB,GAAc,EAAQ,sBACxB,EAAG,QAAQ,EAAG,SAEV,KAAK,mBAAqB,GAAiB,EAAQ,wBACrD,EAAG,OAAO,EAAG,OAIf,EAAG,UAAU,KAAK,mBAAmB,GAAS,KAAK,mBAAmB,KAGnE,KAAA,oBAAsB,GAI/B,cAAc,GAER,IAAA,EAAK,KAAK,IACV,EAAa,EAAO,WACpB,EAAQ,EAAW,OAClB,IAAA,IAAI,EAAI,EAAG,EAAI,EAAO,IAAK,CAC1B,IAAA,EAAY,EAAW,GACvB,EAAS,EAAU,MAAQ,EAAS,cAAc,KACtD,EAAG,oBACD,EACA,EAAU,MACV,EAAS,EAAG,cAAgB,EAAG,MAC/B,EACA,EAAO,OACP,EAAU,YAKP,KAAA,KAAK,gBAAkB,GAC5B,EAAG,wBAAwB,KAAK,iBAC3B,KAAA,kBAEA,KAAA,KAAK,gBAAkB,GACvB,KAAA,kBACL,EAAG,yBAAyB,KAAK,iBAE9B,KAAA,gBAAkB,EAGzB,eACQ,MAAA,EAAM,KAAK,GAAG,aAAa,6BAI1B,MAAA,CAAC,SAHS,EAAM,KAAK,GAAG,aAAa,EAAI,yBAA2B,KAGzD,OAFH,EAAM,KAAK,GAAG,aAAa,EAAI,uBAAyB,KAE7C,QADV,KAAK,GAAG,aAAa,KAAK,GAAG,UAIxC,YAAK,GAEH,OADP,EAAkB,MAAX,GAAmB,aAAmB,GACtC,EAGF,uBACL,EACA,GAEO,OAAA,EAAU,GAAU,GAGtB,EAAA,sBAAwB,EAAQ,gBACrC,EAAS,eAAe,IACxB,EAAS,eAAe,MAzWf,EAAA,QAAO,EA6WL,MAAA,EACb,YACqB,EACA,EACT,EAAc,EACd,EAAyC,KACzC,GAAW,GAJF,KAAA,UAAA,EACA,KAAA,MAAA,EACT,KAAA,YAAA,EACA,KAAA,UAAA,EACA,KAAA,SAAA,EAMR,eACE,IAAA,EAAU,EAAQ,KAAK,KAAK,UAAU,SACtC,GAAA,KAAK,aAAe,EAAQ,aACzB,KAAA,UAAY,EAAQ,GAAG,mBAAmB,KAAK,UAAU,QAAS,KAAK,OACvE,KAAA,YAAc,EAAQ,YAGtB,GAAS,CACR,IAAA,EAAU,KAAK,UAAU,QACzB,EAAK,EAAQ,GACZ,IAAA,IAAI,EAAI,EAAG,EAAK,EAAG,oBAAoB,EAAS,EAAG,iBAAkB,EAAI,EAAI,IAAK,CACjF,IAAA,EAAO,EAAG,iBAAiB,EAAS,GACpC,GAAA,GAAQ,EAAK,MAAQ,KAAK,MAEpB,OADR,EAAoB,GAAb,EAAK,MACJ,EAAK,MACN,KAAA,EAAG,MACN,EAAO,gBAAgB,GACvB,MAEG,KAAA,EAAG,WACN,EAAO,gBAAgB,GACvB,MAEG,KAAA,EAAG,WACN,EAAO,gBAAgB,GACvB,MAEG,KAAA,EAAG,WACN,EAAO,gBAAgB,GACvB,MAEG,KAAA,EAAG,WACN,EAAO,gBAAgB,GACvB,MAEG,KAAA,EAAG,IACN,EAAO,gBAAgB,GACvB,MAEG,KAAA,EAAG,WACN,EAAO,gBAAgB,GACvB,MAEF,QACE,GAAO,KAMf,IAAC,KAAK,UACF,MAAA,IAAI,MAAM,kCAEX,OAAA,KAAK,WAIV,MAAA,UAAqB,EAA3B,cAnbF,SAAA,WAobY,KAAA,GAAK,EAEb,IAAI,GACE,GAAK,KAAK,KACP,KAAA,GAAK,EACL,KAAA,UAAW,GAIpB,UACM,IAAA,EAAU,EAAQ,KAAK,KAAK,UAAU,UACtC,KAAK,aAAe,EAAQ,YAAc,KAAK,YACjD,EAAQ,GAAG,UAAU,KAAK,SAAU,KAAK,IACpC,KAAA,UAAW,IAKhB,MAAA,UAAmB,EAAzB,cAtcF,SAAA,WAucY,KAAA,GAAK,EAEb,IAAI,GACE,GAAK,KAAK,KACP,KAAA,GAAK,EACL,KAAA,UAAW,GAIpB,UACM,IAAA,EAAU,EAAQ,KAAK,KAAK,UAAU,UACtC,KAAK,aAAe,EAAQ,YAAc,KAAK,YACjD,EAAQ,GAAG,UAAU,KAAK,SAAU,KAAK,IACpC,KAAA,UAAW,IAKhB,MAAA,UAAoB,EAA1B,cAzdF,SAAA,WA0dY,KAAA,GAAK,EACL,KAAA,GAAK,EAEb,IAAI,EAAW,GACT,GAAK,KAAK,IAAM,GAAK,KAAK,KACvB,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,UAAW,GAIpB,UACM,IAAA,EAAU,EAAQ,KAAK,KAAK,UAAU,UACtC,KAAK,aAAe,EAAQ,YAAc,KAAK,YACjD,EAAQ,GAAG,UAAU,KAAK,SAAU,KAAK,GAAI,KAAK,IAC7C,KAAA,UAAW,IAKhB,MAAA,UAAoB,EAA1B,cA9eF,SAAA,WA+eY,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,GAAK,EAEb,IAAI,EAAW,EAAW,GACpB,GAAK,KAAK,IAAM,GAAK,KAAK,IAAM,GAAK,KAAK,KACvC,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,UAAW,GAIpB,UACM,IAAA,EAAU,EAAQ,KAAK,KAAK,UAAU,UACtC,KAAK,aAAe,EAAQ,YAAc,KAAK,YACjD,EAAQ,GAAG,UAAU,KAAK,SAAU,KAAK,GAAI,KAAK,GAAI,KAAK,IACtD,KAAA,UAAW,IAKhB,MAAA,UAAoB,EAA1B,cArgBF,SAAA,WAsgBY,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,GAAK,EAEb,IAAI,EAAW,EAAW,EAAW,GAC/B,GAAK,KAAK,IAAM,GAAK,KAAK,IAAM,GAAK,KAAK,IAAM,GAAK,KAAK,KACvD,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,GAAK,EACL,KAAA,UAAW,GAIpB,UACM,IAAA,EAAU,EAAQ,KAAK,KAAK,UAAU,UACtC,KAAK,aAAe,EAAQ,YAAc,KAAK,YACjD,EAAQ,GAAG,UAAU,KAAK,SAAU,KAAK,GAAI,KAAK,GAAI,KAAK,GAAI,KAAK,IAC/D,KAAA,UAAW,IAKhB,MAAA,UAAoB,EAA1B,cA9hBF,SAAA,WA+hBY,KAAA,QAAU,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAE3D,IACE,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GAGA,EAAY,cAAc,GAAK,EAC/B,EAAY,cAAc,GAAK,EAC/B,EAAY,cAAc,GAAK,EAC/B,EAAY,cAAc,GAAK,EAC/B,EAAY,cAAc,GAAK,EAC/B,EAAY,cAAc,GAAK,EAC/B,EAAY,cAAc,GAAK,EAC/B,EAAY,cAAc,GAAK,EAC/B,EAAY,cAAc,GAAK,EAE1B,IAAA,IAAI,EAAI,EAAG,EAAI,EAAG,IACjB,GAAA,EAAY,cAAc,IAAM,KAAK,QAAQ,GAAI,CAC/C,IAAA,EAAO,KAAK,QACX,KAAA,QAAU,EAAY,cAC3B,EAAY,cAAgB,EACvB,KAAA,UAAW,EAChB,OAKN,UACM,IAAA,EAAU,EAAQ,KAAK,KAAK,UAAU,UACtC,KAAK,aAAe,EAAQ,YAAc,KAAK,YACjD,EAAQ,GAAG,iBAAiB,KAAK,UAAU,EAAO,KAAK,SAClD,KAAA,UAAW,IAKb,EAAA,cAAgB,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAG5D,MAAA,UAAuB,EAA7B,cA9kBF,SAAA,WA+kBY,KAAA,SAA2B,KAC3B,KAAA,QAAU,EAElB,IAAI,EAA2B,GACzB,KAAK,UAAY,GAAW,KAAK,QAAU,IACxC,KAAA,SAAW,EAAQ,KAAK,GACxB,KAAA,OAAS,EACT,KAAA,UAAW,GAIpB,UACM,IAAA,EAAU,EAAQ,KAAK,KAAK,UAAU,SACtC,EAAK,EAAQ,GACjB,EACmB,MAAjB,KAAK,UAC4B,MAA/B,EAAQ,qBACR,KAAK,UAAY,EAAQ,oBAAoB,UAE7C,KAAK,aAAe,EAAQ,YAAc,KAAK,YACjD,EAAG,UAAU,KAAK,SAAU,KAAK,QAC5B,KAAA,UAAW,GAElB,EAAG,cAAc,EAAU,EAAI,KAAK,SACpC,EAAG,YACD,EAAG,WACc,MAAjB,KAAK,UAAoB,KAAK,SAAS,MAAQ,GAAK,KAAK,SAAS,OAAS,EACvE,KAAK,SAAS,QACd,OAKJ,MAAA,EACJ,YACmB,EACA,EACA,EACA,EACA,EAAyC,GACzC,EAA2B,GACpC,EAAc,EACd,EAAgC,MAPvB,KAAA,SAAA,EACA,KAAA,QAAA,EACA,KAAA,cAAA,EACA,KAAA,gBAAA,EACA,KAAA,aAAA,EACA,KAAA,cAAA,EACT,KAAA,YAAA,EACA,KAAA,SAAA,EAGN,cACK,OAAA,KAAK,SAEV,aACK,OAAA,KAAK,QAEV,mBACK,OAAA,KAAK,cAEV,qBACK,OAAA,KAAK,gBAGd,gBAAgB,EAAc,GACxB,IAAA,EAAU,KAAK,aAAa,IAAS,KAC1B,MAAX,IACF,EAAU,IAAI,EAAa,KAAM,GAC5B,KAAA,aAAa,GAAQ,EACrB,KAAA,cAAc,KAAK,IAE1B,EAAO,aAAmB,GACxB,EAAyB,IAAI,GAGjC,cAAc,EAAc,GACtB,IAAA,EAAU,KAAK,aAAa,IAAS,KAC1B,MAAX,IACF,EAAU,IAAI,EAAW,KAAM,GAC1B,KAAA,aAAa,GAAQ,EACrB,KAAA,cAAc,KAAK,IAE1B,EAAO,aAAmB,GACxB,EAAuB,IAAI,GAG/B,eAAe,EAAc,EAAW,GAClC,IAAA,EAAU,KAAK,aAAa,IAAS,KAC1B,MAAX,IACF,EAAU,IAAI,EAAY,KAAM,GAC3B,KAAA,aAAa,GAAQ,EACrB,KAAA,cAAc,KAAK,IAE1B,EAAO,aAAmB,GACxB,EAAwB,IAAI,EAAG,GAGnC,eAAe,EAAc,EAAW,EAAW,GAC7C,IAAA,EAAU,KAAK,aAAa,IAAS,KAC1B,MAAX,IACF,EAAU,IAAI,EAAY,KAAM,GAC3B,KAAA,aAAa,GAAQ,EACrB,KAAA,cAAc,KAAK,IAE1B,EAAO,aAAmB,GACxB,EAAwB,IAAI,EAAG,EAAG,GAGtC,eAAe,EAAc,EAAW,EAAW,EAAW,GACxD,IAAA,EAAU,KAAK,aAAa,IAAS,KAC1B,MAAX,IACF,EAAU,IAAI,EAAY,KAAM,GAC3B,KAAA,aAAa,GAAQ,EACrB,KAAA,cAAc,KAAK,IAE1B,EAAO,aAAmB,GACxB,EAAwB,IAAI,EAAG,EAAG,EAAG,GAGzC,eACE,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEI,IAAA,EAAU,KAAK,aAAa,IAAS,KAC1B,MAAX,IACF,EAAU,IAAI,EAAY,KAAM,GAC3B,KAAA,aAAa,GAAQ,EACrB,KAAA,cAAc,KAAK,IAE1B,EAAO,aAAmB,GACxB,EAAwB,IAAI,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAGxE,kBAAkB,EAAc,EAA2B,GACrD,IAAA,EAAU,KAAK,aAAa,IAAS,KAC1B,MAAX,IACF,EAAU,IAAI,EAAe,KAAM,GAC9B,KAAA,aAAa,GAAQ,EACrB,KAAA,cAAc,KAAK,IAE1B,EAAO,aAAmB,GACxB,EAA2B,IAAI,EAAS,GAGxC,cACE,IAAA,EAAK,KAAK,SAAS,GACnB,GAAA,KAAK,aAAe,KAAK,SAAS,WAAY,CAC3C,KAAA,SAAW,EAAG,gBACd,KAAA,eAAe,EAAI,EAAG,cAAe,KAAK,cAC1C,KAAA,eAAe,EAAI,EAAG,gBAAiB,KAAK,gBAC7C,IAAA,EAAa,KAAK,OAAO,WACxB,IAAA,IAAI,EAAI,EAAG,EAAI,EAAW,OAAQ,IACrC,EAAG,mBAAmB,KAAK,SAAU,EAAG,EAAW,GAAG,MAGpD,GADJ,EAAG,YAAY,KAAK,WACf,EAAG,oBAAoB,KAAK,SAAU,EAAG,aACtC,MAAA,IAAI,SAAS,EAAG,kBAAkB,KAAK,aAK3C,GAHC,KAAA,YAAc,KAAK,SAAS,YAG5B,EACE,IAAA,IAAI,KAAa,EAElB,IAAA,IAAI,EAAI,EAAG,EAAK,EAAG,oBAAoB,KAAK,QAAS,EAAG,mBACxD,EAAI,EACJ,IACA,CACI,IAAA,EAAO,EAAG,gBAAgB,KAAK,QAAS,GACxC,GAAA,GAAQ,EAAK,MAAQ,EAAU,KAEzB,OADR,EAAoB,GAAb,EAAK,MACJ,EAAU,OACX,KAAA,EACH,EAAO,EAAK,MAAQ,EAAG,OACvB,MAEG,KAAA,EACH,EAAO,EAAK,MAAQ,EAAG,YACvB,MAEG,KAAA,EACH,EAAO,EAAK,MAAQ,EAAG,YACvB,MAEG,KAAA,EACH,EAAO,EAAK,MAAQ,EAAG,YACvB,MAEF,QACE,GAAO,KAQd,OAAA,KAAK,SAGd,UACO,KAAA,SAAS,GAAG,WAAW,KAAK,SAC5B,IAAA,IAAI,KAAW,KAAK,cACvB,EAAQ,UAIZ,eAAe,EAA2B,EAAc,GAClD,IAAA,EAAS,EAAG,aAAa,GACzB,IAAC,EACG,MAAA,IAAI,MAAM,2BAId,GAFJ,EAAG,aAAa,EAAQ,GACxB,EAAG,cAAc,IACZ,EAAG,mBAAmB,EAAQ,EAAG,gBAC9B,MAAA,IAAI,SAAS,EAAG,iBAAiB,MAErC,IAAC,KAAK,SACF,MAAA,IAAI,MAAM,qDAElB,EAAG,aAAa,KAAK,SAAU,GAG1B,YAAK,GAEH,OADP,EAAmB,MAAZ,GAAoB,aAAoB,GACxC,GAIL,MAAA,UAAqB,EAAS,aAYlC,YAAY,EAAkB,GAC5B,QAXM,KAAA,YAAc,EACd,KAAA,QAA8B,KAC9B,KAAA,OAA4B,KAC5B,KAAA,UAAW,EACX,KAAA,UAAY,EAAa,QACzB,KAAA,UAAY,EACZ,KAAA,UAAY,EAAa,QACzB,KAAA,UAAY,EACZ,KAAA,WAAa,EAId,KAAA,SAAW,EACX,KAAA,WAAa,EACb,KAAA,OAAS,IAAI,WAAW,GAG3B,cACK,OAAA,KAAK,SAEV,gBACK,OAAA,KAAK,WAGd,KAAK,EAA0B,EAA0B,GACvD,EAAO,GAAa,GACpB,EAAO,GAAK,GAAoB,EAAmB,GAAa,KAAK,YACrE,EAAO,GAAK,GAAoB,EAAmB,GAAa,KAAK,YAEjE,KAAK,QAAU,GAAoB,GAAiC,GAAb,IACpD,KAAA,OAAO,IAAI,KAAK,OAAO,SAAS,EAAkB,KAAK,YAAa,GACpE,KAAA,iBACH,KAAK,IAAI,EAAkB,GAC3B,KAAK,IAAI,EAAkB,GAAoB,IAKrD,OAAO,EAAmB,EAAqB,GAC7C,EAAO,GAAK,GAAc,EAAa,EAAM,QAAU,KAAK,YAC5D,EAAsB,MAAf,KAAK,QACP,KAAA,OAAQ,IAAI,EAAO,GACnB,KAAA,iBAAiB,EAAY,EAAa,EAAM,QAGvD,OACM,KAAK,SACF,KAAA,SAAS,GAAG,aAAa,KAAK,SAKhC,KAAA,YAAc,EAGrB,UACM,IAAA,EAAK,KAAK,SAAS,GAEnB,KAAK,cAAgB,KAAK,SAAS,aAChC,KAAA,QAAU,EAAG,eACb,KAAA,YAAc,KAAK,SAAS,WAC5B,KAAA,UAAW,GAGlB,EAAG,WAAW,EAAG,aAAc,KAAK,SAEhC,KAAK,WACP,EAAG,WAAW,EAAG,aAAc,KAAK,WAAY,EAAG,cAC9C,KAAA,UAAY,KAAK,UACjB,KAAA,UAAY,KAAK,UACjB,KAAA,UAAW,GAGd,KAAK,UAAY,KAAK,YACxB,EAAG,cACD,EAAG,aACH,KAAK,UACL,KAAK,OAAQ,SAAS,KAAK,UAAW,KAAK,YAExC,KAAA,UAAY,EAAa,QACzB,KAAA,UAAY,GAIrB,iBAAiB,EAAa,GACvB,KAAA,UAAY,KAAK,IAAI,KAAK,UAAW,GACrC,KAAA,UAAY,KAAK,IAAI,KAAK,UAAW,GACrC,KAAA,UAAY,KAAK,IAAI,KAAK,UAAW,GACrC,KAAA,UAAY,KAAK,IAAI,KAAK,UAAW,GAKrC,YAAK,GAEH,OADP,EAAiB,MAAV,GAAkB,aAAkB,GACpC,GAJF,EAAA,QAAU,WAQb,MAAA,EACJ,YACmB,EACT,EACA,EACA,EACA,EAA6B,KAC7B,EAAgC,KAChC,EAAc,EACd,GAAiB,EACjB,GAAkB,GART,KAAA,SAAA,EACT,KAAA,QAAA,EACA,KAAA,OAAA,EACA,KAAA,QAAA,EACA,KAAA,QAAA,EACA,KAAA,SAAA,EACA,KAAA,YAAA,EACA,KAAA,eAAA,EACA,KAAA,gBAAA,EAGN,cACK,OAAA,KAAK,SAEV,aACK,OAAA,KAAK,QAEV,YACK,OAAA,KAAK,OAEV,aACK,OAAA,KAAK,QAGd,OAAO,EAAe,EAAgB,EAA4B,MAC3D,KAAA,OAAS,EACT,KAAA,QAAU,EACV,KAAA,QAAU,EACV,KAAA,iBAAkB,EAGzB,UAAU,GACJ,KAAK,SAAW,IACb,KAAA,QAAU,EACV,KAAA,gBAAiB,GAItB,cACE,IAAA,EAAK,KAAK,SAAS,GAoDhB,OAjDH,KAAK,aAAe,KAAK,SAAS,aAC/B,KAAA,SAAW,EAAG,gBACd,KAAA,YAAc,KAAK,SAAS,WAC5B,KAAA,gBAAiB,EACjB,KAAA,iBAAkB,GAIrB,KAAK,iBACP,EAAG,YAAY,EAAG,WAAY,KAAK,UACnC,EAAG,cACD,EAAG,WACH,EAAG,mBACH,KAAK,OAAO,WAAa,EAAS,YAAY,QAAU,EAAG,QAAU,EAAG,QAE1E,EAAG,cACD,EAAG,WACH,EAAG,mBACH,KAAK,OAAO,WAAa,EAAS,YAAY,QAAU,EAAG,QAAU,EAAG,QAE1E,EAAG,cACD,EAAG,WACH,EAAG,eACH,KAAK,OAAO,MAAQ,EAAS,UAAU,OAAS,EAAG,OAAS,EAAG,eAEjE,EAAG,cACD,EAAG,WACH,EAAG,eACH,KAAK,OAAO,MAAQ,EAAS,UAAU,OAAS,EAAG,OAAS,EAAG,eAE5D,KAAA,gBAAiB,GAGpB,KAAK,kBACP,EAAG,YAAY,EAAG,WAAY,KAAK,UACnC,EAAG,WACD,EAAG,WACH,EACA,EAAG,KACH,KAAK,OACL,KAAK,QACL,EACA,EAAG,KACH,EAAG,cACH,KAAK,SAEF,KAAA,iBAAkB,GAGlB,KAAK,SAGd,OACM,KAAK,UACF,KAAA,SAAS,GAAG,cAAc,KAAK,SAC/B,KAAA,YAAc,GAIhB,YAAK,GAEH,OADP,EAAkB,MAAX,GAAmB,aAAmB,GACtC,GAIL,MAAA,EACJ,YACU,EACA,EACA,EAAwC,KACxC,EAAc,EACd,GAAW,EACX,EAAY,IAAI,EAAS,MALzB,KAAA,SAAA,EACA,KAAA,SAAA,EACA,KAAA,aAAA,EACA,KAAA,YAAA,EACA,KAAA,SAAA,EACA,KAAA,UAAA,EAGN,cACK,OAAA,KAAK,SAEV,cACK,OAAA,KAAK,SAEV,eACK,OAAA,KAAK,UAEd,SAAS,GACH,KAAK,UAAY,IACd,KAAA,SAAW,EAAQ,KAAK,GACxB,KAAA,UAAW,GAIhB,kBACE,IAAA,EAAK,KAAK,SAAS,GACnB,EAAU,KAAK,SAAS,QAiBrB,OAdH,KAAK,aAAe,KAAK,SAAS,aAC/B,KAAA,aAAe,EAAG,oBAClB,KAAA,YAAc,KAAK,SAAS,WAC5B,KAAA,UAAW,GAId,KAAK,WACP,EAAG,gBAAgB,EAAG,YAAa,KAAK,cACxC,EAAG,qBAAqB,EAAG,YAAa,EAAG,kBAAmB,EAAG,WAAY,EAAS,GACtF,EAAO,EAAG,uBAAuB,EAAG,cAAgB,EAAG,sBAClD,KAAA,UAAW,GAGX,KAAK,aAGd,OACM,KAAK,eACF,KAAA,SAAS,GAAG,kBAAkB,KAAK,cACnC,KAAA,YAAc,GAIhB,YAAK,GAEH,OADP,EAAuB,MAAhB,GAAwB,aAAwB,GAChD,IAjkCb,CAAiB,IAAA,QAAA,MAAA,EAAK;;AC7RrB,aAjBK,SAAU,EACd,EACA,EACA,GAEI,IAAA,IAAC,EAAD,IAAM,EAAN,IAAW,EAAX,IAAgB,EAAhB,IAAqB,EAArB,IAA0B,GAAO,EACrC,EAAS,eAAe,EAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAG,EAAG,GAE9D,SAAU,EAAe,EAA6B,EAAc,GACxE,EAAS,eAAe,EAAM,EAAI,EAAG,EAAI,GAGrC,SAAU,EAAW,EAAsB,EAA+B,GAC9E,EAAG,gBAAgB,GACnB,EAAG,YAAY,EAAG,EAAG,EAAO,QAAQ,MAAO,EAAO,QAAQ,QAC1D,IACA,EAAG,gBAAgB,MACpB,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,0BAAA,EAAA,QAAA,eAAA,EAAA,QAAA,WAAA;;AC4FkC,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,uBAAA,QAAA,oBAAA,EAhHnC,IAAA,EAAA,QAAA,eAEA,EAAA,QAAA,cACA,EAAA,QAAA,WAEA,MAAM,EAAe,IAAI,EAAS,SAAA,aAClC,EAAa,IAAI,iBAAkB,EAAS,SAAA,cAAc,MAAO,GACjE,EAAa,IAAI,QAAS,EAAS,SAAA,cAAc,MAAO,GAExD,MAAM,EAAO,wRAcP,EAAO,0HASP,MAAO,EAGX,YAAoB,GAAA,KAAA,GAAA,EAFZ,KAAA,MAAgB,GAChB,KAAA,OAAkB,GAOlB,KAAA,OAAuC,KAJ/C,eACS,OAAA,KAAK,MAAM,OAIpB,YACM,GAAA,KAAK,OACA,OAAA,KAAK,OAGR,MAAA,EAAU,CACd,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,IAGA,EAAQ,IAAI,WAAW,EAAa,OAAS,EAAQ,OAAS,KAAK,MAAM,QACzE,EAAS,IAAI,aAAa,EAAM,QAClC,IAAA,EAAM,EAEL,IAAA,IAAI,EAAI,EAAG,EAAI,KAAK,MAAM,OAAQ,IAAK,CACpC,MAAA,EAAO,KAAK,MAAM,GAClB,EAAQ,KAAK,OAAO,GAOrB,IAAA,IAAI,KAAU,EACjB,EAAO,KAAS,EAAK,OAAO,EAAI,EAAO,GAAK,EAAK,KAAK,EACtD,EAAO,KAAS,EAAK,OAAO,EAAI,EAAO,GAAK,EAAK,KAAK,EAEtD,EAAO,KAAS,EAAM,EACtB,EAAO,KAAS,EAAM,EACtB,EAAO,KAAS,EAAM,EAItB,GAAA,IAAQ,EAAO,OACX,MAAA,IAAI,MAAM,yCAKX,OAFF,KAAA,OAAS,KAAK,GAAG,mBAAmB,EAAM,QAC1C,KAAA,OAAO,OAAO,GACZ,KAAK,OAGd,QAAQ,EAAY,GACb,KAAA,MAAM,KAAK,GACX,KAAA,OAAO,KAAK,GAEb,KAAK,SACF,KAAA,OAAO,OACP,KAAA,OAAS,MAIlB,OACM,KAAK,SACF,KAAA,OAAO,OACP,KAAA,OAAS,OAWe,QAAA,eAAA,EAA7B,MAAO,EAEX,YAAoB,GAAA,KAAA,GAAA,EACb,KAAA,SAAW,EAAG,eAAe,EAAc,EAAM,GAGxD,OAAO,IAEH,EAAA,EAAA,2BAAA,KAAK,SACL,mBACA,MACQ,MAAA,EAAmB,EAAgB,gBAAA,aACvC,EAAM,mBACN,EAAM,sBAGF,EAAe,IAAI,EAAJ,KAAS,KAAK,GAAG,SAAS,MAAO,KAAK,GAAG,SAAS,QAMhE,OAJe,EAAgB,gBAAA,gBAAgB,IAAI,EAAJ,MAAU,EAAG,IAAI,MACrE,EAAgB,gBAAA,UAAU,IAAI,EAAJ,KAAS,GAAI,GAAG,mBAAmB,KAG1C,MAAM,IAZ7B,IAgBG,KAAA,GAAG,+BACH,KAAA,GAAG,KAAK,EAAS,SAAA,UAAU,UAAW,KAAK,SAAU,EAAM,MAAM,cA3BvC,QAAA,uBAAA;;AC9GjB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,WAAA,EAFlB,IAAA,EAAA,QAAA,UAEM,MAAO,EACX,YACW,EAAY,EACZ,EAAY,EACZ,EAAY,EACZ,EAAY,GAHZ,KAAA,EAAA,EACA,KAAA,EAAA,EACA,KAAA,EAAA,EACA,KAAA,EAAA,EAGJ,yBAAkB,EAAW,EAAW,GAMvC,MAAA,EAAS,EAAI,GACb,EAAI,GAAK,EAAI,KAAK,IAAK,EAAS,EAAK,KACpC,EAAI,EAAI,GACb,EAAS,EACL,CAAC,EAAG,EAAG,GACP,EAAS,EACT,CAAC,EAAG,EAAG,GACP,EAAS,EACT,CAAC,EAAG,EAAG,GACP,EAAS,EACT,CAAC,EAAG,EAAG,GACP,EAAS,EACT,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,GAEP,EAAI,GAAK,GAAM,EAAK,IAAO,EAAK,IAAO,GAEtC,OAAA,IAAI,GAAM,EAAM,EAAA,OAAA,EAAK,EAAG,EAAG,IAAI,EAAM,EAAA,OAAA,EAAK,EAAG,EAAG,IAAI,EAAM,EAAA,OAAA,EAAK,EAAG,EAAG,GAAI,GAG3E,kBAAW,GACZ,GAAe,IAAf,EAAI,QAA2B,MAAX,EAAI,GACpB,MAAA,IAAI,6BAA6B,KAEnC,MAAA,EAAI,SAAS,EAAI,OAAO,EAAG,GAAI,IAAM,IACrC,EAAI,SAAS,EAAI,OAAO,EAAG,GAAI,IAAM,IACrC,EAAI,SAAS,EAAI,OAAO,EAAG,GAAI,IAAM,IACvC,GAAA,EAAI,GAAK,EAAI,GAAK,EAAI,GAAK,EAAI,GAAK,EAAI,GAAK,EAAI,EAC7C,MAAA,IAAI,6BAA6B,KAElC,OAAA,IAAI,EAAM,EAAG,EAAG,GAGzB,UAAU,GACD,OAAA,IAAI,EAAM,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,GAG3C,QACS,eAAS,IAAM,KAAK,GAAG,eAAe,IAAM,KAAK,GAAG,eACzD,IAAM,KAAK,GACX,cAAc,KAAK,EAAE,QAAQ,OAtDjB,QAAA,MAAA;;ACMG,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,cAAA,EARrB,IAAA,EAAA,QAAA,oBACA,EAAA,QAAA,8BACA,EAAA,QAAA,eACA,EAAA,QAAA,gBACA,EAAA,QAAA,cAEA,EAAA,QAAA,WAEM,MAAO,EAMX,YACU,EACA,EACA,GAFA,KAAA,GAAA,EACA,KAAA,uBAAA,EACA,KAAA,gBAAA,EAEH,KAAA,QAAU,EAAG,cAAc,EAAS,SAAA,cAAc,cAAe,KAAM,MACvE,KAAA,aAAe,EAAG,mBAAmB,KAAK,SAC1C,KAAA,SAAW,IAAI,EAAJ,SAAa,KAAK,QAAQ,QACrC,KAAA,eAAiB,IAAI,EAAJ,eAAmB,GACpC,KAAA,eAAe,QAAQ,EAAK,KAAA,KAAM,IAAI,EAAJ,MAAU,EAAG,EAAG,EAAG,IAK1D,EAAG,uBAAuB,KACnB,KAAA,SAAS,UAIlB,IAAI,GACK,OAAA,KAAK,SAAS,IAAI,GAE3B,gBACS,OAAA,KAAK,QAAQ,MAEtB,cACS,OAAA,KAAK,QAAQ,OAGd,aAAa,GACf,GAAA,KAAK,SAAS,UAAY,KAAK,SAAS,cAAe,CAEnD,MAAA,EAAM,KAAK,SAAS,UAEnB,OADF,KAAA,SAAS,OAAO,EAAK,GACnB,EACF,CAEC,MAAG,CAAA,GAAO,KAAK,SAAS,YAEvB,OADF,KAAA,SAAS,OAAO,EAAK,GACnB,GAIX,qBAAqB,EAAW,IACnB,EAAA,EAAA,YAAA,KAAK,GAAI,KAAK,aAAc,KAChC,IAAA,IAAI,KAAO,EAAM,CAChB,IAAA,EAAM,KAAK,SAAS,IAAI,GACxB,GAAO,MAAP,EAEF,SAGF,EAAM,KAAK,aAAa,GAElB,MAAA,EAAc,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAG,GAAM,IAAI,EAAJ,KAAS,KAAK,QAAQ,MAAO,IACvE,KAAA,uBAAuB,OAAO,CACjC,MAAO,KAAK,eACZ,mBAAoB,EAAK,KAAA,KACzB,qBAAsB,IAExB,EAAO,EAAa,MAK1B,eAAe,EAAQ,GACjB,IAAA,EAAM,KAAK,SAAS,IAAI,GACxB,GAAO,MAAP,EACK,OAAA,EAGH,MAAA,EAAc,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAG,GAAM,IAAI,EAAJ,KAAS,KAAK,QAAQ,MAAO,IASrE,OALF,KAAA,gBAAgB,OAAO,CAC1B,QAAS,KAAK,QACd,QAAS,EACT,QAAS,KAEJ,GAtFU,QAAA,SAAA;;ACiCO,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,qBAAA,EAzC5B,IAAA,EAAA,QAAA,eACA,EAAA,QAAA,cACA,EAAA,QAAA,WAQA,MAAM,EAAO,4RAcP,EAAO,0JAiBP,MAAO,EAIX,YAAoB,GAAA,KAAA,GAAA,EACZ,MAAA,EAAe,IAAI,EAAS,SAAA,aAClC,EAAa,IAAI,WAAY,EAAS,SAAA,cAAc,MAAO,GAC3D,EAAa,IAAI,KAAM,EAAS,SAAA,cAAc,MAAO,GAE/C,MAAA,EAAW,CACf,CAAC,IAAK,EAAE,EAAG,GAAI,GAAI,CAAC,EAAG,IACvB,CAAC,IAAK,CAAC,EAAG,GAAI,GAAI,CAAC,EAAG,IACtB,CAAC,IAAK,EAAE,GAAI,GAAI,GAAI,CAAC,EAAG,IACxB,CAAC,IAAK,CAAC,GAAI,GAAI,GAAI,CAAC,EAAG,KAEnB,EAAmB,GACpB,IAAA,IAAI,KAAK,EACZ,EAAO,KAAK,EAAE,IAAI,IAClB,EAAO,KAAK,EAAE,IAAI,IAClB,EAAO,KAAK,EAAE,GAAG,IACjB,EAAO,KAAK,EAAE,GAAG,IAGd,KAAA,OAAS,EAAG,mBAAmB,EAAa,OAAS,EAAS,QAC9D,KAAA,OAAO,OAAO,IAAI,WAAW,IAAI,aAAa,GAAQ,SACtD,KAAA,SAAW,EAAG,eAAe,EAAc,EAAM,GAGxD,OAAO,GACA,KAAA,SAAS,kBAAkB,UAAW,EAAM,QAAS,IAExD,EAAA,EAAA,2BAAA,KAAK,SACL,cACA,MACQ,MAAA,QAAC,EAAD,QAAU,GAAW,EASrB,EARe,EAAgB,gBAAA,gBAAgB,IAAI,EAAJ,KAAS,EAAG,IAC9D,MAAM,EAAgB,gBAAA,UAAU,IAAI,EAAJ,KAAS,GAAI,KAC7C,MACC,EAAgB,gBAAA,aACd,IAAI,EAAJ,KAAS,EAAK,KAAA,KAAM,IAAI,EAAJ,KAAS,EAAQ,MAAO,EAAQ,SACpD,EAAK,KAAA,OAGiB,cAAc,GACnC,OAAA,EAAgB,gBAAA,aAAa,EAAK,KAAA,KAAM,IAXjD,KAeA,EAAA,EAAA,2BAAA,KAAK,SACL,oBACA,MACQ,MAAA,QAAC,GAAW,GAEZ,SAAC,GAAY,KAAK,GAClB,EAAe,IAAI,EAAJ,KAAS,EAAS,MAAO,EAAS,QAKjD,EAHgB,EAAgB,gBAAA,UAAU,IAAI,EAAJ,KAAS,GAAI,IAAI,MAC/D,EAAgB,gBAAA,aAAa,IAAI,EAAJ,KAAS,EAAK,KAAA,KAAM,GAAe,EAAK,KAAA,MAEzC,cAAc,GACrC,OAAA,EAAgB,gBAAA,aAAa,EAAK,KAAA,IAAK,IAVhD,IAcG,KAAA,GAAG,+BACH,KAAA,GAAG,KAAK,EAAS,SAAA,UAAU,eAAgB,KAAK,SAAU,KAAK,SAjE5C,QAAA,gBAAA;;AC2BU,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,+BAAA,EApEtC,IAAA,EAAA,QAAA,gBAGA,EAAA,QAAA,cACA,EAAA,QAAA,WAOA,MAAM,EAAe,IAAI,EAAS,SAAA,aAClC,EAAa,IAAI,WAAY,EAAS,SAAA,cAAc,MAAO,GAE3D,MAAM,EAAO,kGAQP,EAAQ,IACN,MAAA,EAAC,EAAD,EAAI,EAAJ,EAAO,GAAK,EAAM,MAAA,WAAW,EAAM,kBACnC,KAAS,EAAE,QAAQ,OAAO,EAAE,QAAQ,OAAO,EAAE,QAAQ,KACpD,k0CAkCqB,gGAGA,gCAMxB,MAAO,EAIX,YAAoB,EAAsB,GAAtB,KAAA,GAAA,EACZ,MAAA,EAAW,CACf,EAAE,EAAG,GACL,CAAC,EAAG,GACJ,EAAE,GAAI,GACN,CAAC,GAAI,IAED,EAAmB,GACpB,IAAA,IAAI,KAAK,EACZ,EAAO,KAAK,EAAE,IACd,EAAO,KAAK,EAAE,IAEX,KAAA,OAAS,EAAG,mBAAmB,EAAa,OAAS,EAAS,QAC9D,KAAA,OAAO,OAAO,IAAI,WAAW,IAAI,aAAa,GAAQ,SACtD,KAAA,SAAW,EAAG,eAAe,EAAc,EAAM,EAAK,IAG7D,OAAO,IAEH,EAAA,EAAA,2BAAA,KAAK,SACL,iCACA,EAAM,iCAIO,EAAA,EAAA,gBAAA,KAAK,SAAU,4BAA6B,EAAM,wBAAwB,SAC1E,EAAA,EAAA,gBAAA,KAAK,SAAU,0BAA2B,EAAM,wBAAwB,MAGjF,MAAA,EAAW,KAAK,GAAG,SACpB,KAAA,SAAS,eAAe,iBAAkB,EAAS,EAAG,EAAS,GAC/D,KAAA,SAAS,eAAe,eAAgB,EAAS,MAAO,EAAS,QAEjE,KAAA,SAAS,gBAAgB,oBAAqB,KAAK,GAAG,4BAEtD,KAAA,GAAG,cACN,EAAS,SAAA,eAAe,aACxB,EAAS,SAAA,eAAe,sBAErB,KAAA,GAAG,KAAK,EAAS,SAAA,UAAU,eAAgB,KAAK,SAAU,KAAK,SA3ClC,QAAA,0BAAA;;ACgCE,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,iCAAA,EApGxC,IAAA,EAAA,QAAA,eAEA,EAAA,QAAA,cACA,EAAA,QAAA,WAEA,MAAM,EAAe,IAAI,EAAS,SAAA,aAClC,EAAa,IAAI,WAAY,EAAS,SAAA,cAAc,MAAO,GAC3D,EAAa,IAAI,KAAM,EAAS,SAAA,cAAc,MAAO,GAErD,MAAM,EAAO,4RAcP,EAAQ,mwBA6BV,06CAgDE,MAAO,EAIX,YAAoB,EAAsB,GAAtB,KAAA,GAAA,EACZ,MAAA,EAAW,CACf,CAAC,IAAK,EAAE,EAAG,GAAI,GAAI,CAAC,EAAG,IACvB,CAAC,IAAK,CAAC,EAAG,GAAI,GAAI,CAAC,EAAG,IACtB,CAAC,IAAK,EAAE,GAAI,GAAI,GAAI,CAAC,EAAG,IACxB,CAAC,IAAK,CAAC,GAAI,GAAI,GAAI,CAAC,EAAG,KAEnB,EAAmB,GACpB,IAAA,IAAI,KAAK,EACZ,EAAO,KAAK,EAAE,IAAI,IAClB,EAAO,KAAK,EAAE,IAAI,IAClB,EAAO,KAAK,EAAE,GAAG,IACjB,EAAO,KAAK,EAAE,GAAG,IAGd,KAAA,OAAS,EAAG,mBAAmB,EAAa,OAAS,EAAS,QAC9D,KAAA,OAAO,aAAa,GACpB,KAAA,SAAW,EAAG,eAAe,EAAc,EAAM,EAAK,EAAM,qBAGnE,OAAO,GACC,MAAA,QAAC,EAAD,gBAAU,GAAmB,EAS7B,EARe,EAAgB,gBAAA,gBAAgB,IAAI,EAAJ,KAAS,EAAG,IAC9D,MAAM,EAAgB,gBAAA,UAAU,IAAI,EAAJ,KAAS,GAAI,KAC7C,MACC,EAAgB,gBAAA,aACd,IAAI,EAAJ,KAAS,EAAK,KAAA,KAAM,IAAI,EAAJ,KAAS,EAAgB,MAAO,EAAgB,SACpE,EAAK,KAAA,OAGiB,cAAc,GACpC,EAAc,EAAgB,gBAAA,aAAa,EAAK,KAAA,KAAM,IAEtD,QAAC,GAAW,EACZ,EAAe,IAAI,EAAJ,KAAS,KAAK,GAAG,SAAS,MAAO,KAAK,GAAG,SAAS,QAKjE,EAHgB,EAAgB,gBAAA,UAAU,IAAI,EAAJ,KAAS,GAAI,IAAI,MAC/D,EAAgB,gBAAA,aAAa,IAAI,EAAJ,KAAS,EAAK,KAAA,KAAM,GAAe,EAAK,KAAA,MAEzC,cAAc,GACtC,EAAoB,EAAgB,gBAAA,aAAa,EAAK,KAAA,IAAK,GAE3D,EAAmB,EAAK,KAAA,KAAK,mBACjC,IAAI,EAAJ,KAAS,EAAM,gBAAgB,MAAO,EAAM,gBAAgB,SAGzD,KAAA,SAAS,kBAAkB,eAAgB,EAAM,gBAAiB,IAC7C,EAAA,EAAA,2BAAA,KAAK,SAAU,cAAe,GACnD,KAAA,SAAS,gBAAgB,iBAAkB,EAAM,eAAiB,EAAM,GACxE,KAAA,SAAS,eAAe,mBAAoB,EAAiB,EAAG,EAAiB,IAC5D,EAAA,EAAA,2BAAA,KAAK,SAAU,oBAAqB,GAEzD,KAAA,GAAG,+BACH,KAAA,GAAG,KAAK,EAAS,SAAA,UAAU,eAAgB,KAAK,SAAU,KAAK,SAzDhC,QAAA,4BAAA;;ACzFd,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,mBAAA,EAX1B,IAAA,EAAA,QAAA,cACA,EAAA,QAAA,8BACA,EAAA,QAAA,sBACA,EAAA,QAAA,eACA,EAAA,QAAA,gCACA,EAAA,QAAA,oCACA,EAAA,QAAA,gBAKM,MAAO,EAQX,YAAY,EAA2B,GAuB/B,KAAA,sBAAuC,KACvC,KAAA,oBAAsB,IAAI,IAY1B,KAAA,cAAgB,MACjB,KAAA,sBAAwB,KACxB,KAAA,GAAG,YAAY,EAAG,EAAG,KAAK,GAAG,0BAA2B,KAAK,GAAG,4BAC/D,MAAA,EAAQ,EAAM,MAAA,WAAW,KAAK,MAAM,gBACrC,KAAA,GAAG,MAAM,IAAI,EAAS,SAAA,MAAM,EAAM,EAAG,EAAM,EAAG,EAAM,EAAG,EAAM,IAE7D,IAAA,MAAM,KAAW,KAAK,oBACzB,MA1CG,KAAA,GAAK,IAAI,EAAM,MAAA,QAAQ,GACvB,KAAA,uBAAyB,IAAI,EAAJ,uBAA2B,KAAK,IACzD,KAAA,gBAAkB,IAAI,EAAJ,gBAAoB,KAAK,IAC3C,KAAA,0BAA4B,IAAI,EAAJ,0BAA8B,KAAK,GAAI,GACnE,KAAA,4BAA8B,IAAI,EAAJ,4BAAgC,KAAK,GAAI,GACvE,KAAA,MAAQ,EAIR,KAAA,GAAG,2BAA2B,KAAK,eAElC,MAAA,EAAY,KAAK,GAAG,eACtB,GACF,QAAQ,oCAC0B,EAAU,qBAAqB,EAAU,oBAAoB,EAAU,WAGzG,OAAc,gBAAsB,MAC/B,KAAA,GAAG,oBAMZ,sBAAsB,GACf,KAAA,oBAAoB,IAAI,GAE/B,yBAAyB,GAClB,KAAA,oBAAoB,OAAO,GAElC,eACO,KAAK,wBACH,KAAA,sBAAwB,sBAAsB,KAAK,gBAc5D,YAAY,EAAsB,GAC1B,MAAA,OAAC,EAAD,KAAS,GAAQ,EACnB,IAAA,EAAiB,KAAK,GAAG,SACxB,KAAA,GAAG,YAAY,EAAO,EAAG,EAAO,EAAG,EAAK,EAAG,EAAK,GAErD,IAEI,IAAA,EAAC,EAAD,EAAI,EAAJ,MAAO,EAAP,OAAc,GAAU,EACvB,KAAA,GAAG,YAAY,EAAG,EAAG,EAAO,GAGnC,aAAa,EAAa,GAClB,MAAA,EAAS,EAAG,wBACZ,EAAiB,IAAI,EAAJ,KACrB,IAAI,EAAJ,KAAS,EAAO,KAAO,OAAO,iBAAkB,EAAO,IAAM,OAAO,kBACpE,IAAI,EAAJ,KAAS,EAAO,MAAQ,OAAO,iBAAkB,EAAO,OAAS,OAAO,mBAGrE,KAAA,YAAY,EAAgB,IAzEX,QAAA,cAAA;;ACuCnB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,sBAAA,QAAA,iBAAA,QAAA,YAAA,QAAA,iBAAA,QAAA,0BAAA,QAAA,kCAAA,EAjDP,IAAA,EAAA,QAAA,gBACA,EAAA,QAAA,mBACA,EAAA,QAAA,wBAIO,MAAM,GAA+B,EACzC,EAAA,oBAAA,GACS,GACC,EAAmB,IAAI,EAAM,MAAQ,GAwC3C,QAAA,6BAAA,EAnCA,MAAM,GAA4B,EACvC,EAAA,0BAAA,EACE,MAAA,EACA,mBAAA,MAKM,MAAA,EAAyB,EAA6B,GACpD,OAAA,IACA,MAAA,EAAI,EAAuB,GAAS,IACnC,OAAA,EAAM,eAAe,GAAG,WAwB9B,QAAA,0BAAA,EAnBA,MAAM,GAAmB,EAC9B,EAAA,0BAAA,EAAE,MAAA,EAAO,OAAA,KACA,IAAI,EAAJ,cAAkB,EAAQ,IAiB9B,QAAA,iBAAA,EAbA,MAAM,GAAc,EAAoB,EAAA,oBAAA,GACtC,IAAI,EAAJ,SACL,EAAc,GACd,EAAc,uBACd,EAAc,kBASX,QAAA,YAAA,EALA,MAAM,GAAmB,EAC9B,EAAA,0BAAA,EAAE,QAAA,EAAS,iBAAA,KACF,EAAmB,EAAQ,mCAAqC,GAGpE,QAAA,iBAAA,EAAA,MAAM,GAAwB,EAClC,EAAA,oBAAA,IACO,MAAA,EAAkB,GAEf,SAAA,EAAI,GACJ,OAAC,EAAE,MAAQ,IAAM,EAAE,KAF5B,EAAQ,aAAa,GAAK,EAAO,KAAK,IAOtC,EAAO,KAHE,SAAQ,EAAU,GAClB,OAAA,EAAI,GAAK,EAAI,GAAK,GAAK,IAG1B,MAAA,EAAqB,IAAI,IAC1B,IAAA,IAAI,EAAI,EAAG,EAAI,EAAO,OAAQ,IACjC,EAAmB,IAAI,EAAO,GAAG,IAAK,KAAK,MAAO,IAAM,EAAK,EAAO,SAG/D,OAAA,IAhBJ,QAAA,sBAAA;;AC5BPrQ,aAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,SAAAA,EAAAA,QAAAA,WAAAA,EAAAA,QAAAA,UAAAA,EAAAA,QAAAA,gBAAAA,EAAAA,QAAAA,OAAAA,EAAAA,QAAAA,oBAAAA,EAAAA,QAAAA,QAAAA,EAAAA,QAAAA,YAAAA,EAAAA,QAAAA,WAAAA,EAAAA,QAAAA,cAAAA,EAAAA,QAAAA,iBAAAA,EAAAA,IAnBIsQ,EAGAC,EAcAC,EAEJxQ,EAAAA,QAAAA,UAbIyQ,EAAc,EAGdC,EAAoB,GAEpBC,EAAkB3Q,EAAQ8J,QAAAA,IAC1B8G,EAAe5Q,EAAQkK,QAAAA,OACvB2G,EAAY7Q,EAAQqK,QAAAA,IACpByG,EAAmB9Q,EAAQ8F,QAAAA,QAyE/B,SAASiL,EAAaC,EAAO7P,GAChB8P,EAAAA,QAAAA,KACXjR,EAAQiR,QAAAA,IAAMV,EAAkBS,EAAOP,GAAetP,GAEvDsP,EAAc,EAORS,IAAAA,EACLX,EAAiBY,MAChBZ,EAAiBY,IAAU,CAC3BC,GAAO,GACPC,IAAiB,KAGfL,OAAAA,GAASE,EAAME,GAAM7P,QACxB2P,EAAME,GAAM5P,KAAK,IAEX0P,EAAME,GAAMJ,GAMb,SAASM,EAASC,GACxBd,OAAAA,EAAc,EACPe,EAAWC,EAAgBF,GASnC,SAAgBC,EAAWE,EAASH,EAAcI,GAE3CC,IAAAA,EAAYb,EAAaT,IAAgB,GAC1CsB,OAAAA,EAAUxP,MACdwP,EAAUxP,IAAamO,EAEvBqB,EAAUC,GAAS,CACjBF,EAAiDA,EAAKJ,GAA/CE,OAAAA,EAA0BF,GAElC,SAAAO,GACOC,IAAAA,EAAYL,EAAQE,EAAUC,GAAO,GAAIC,GAC3CF,EAAUC,GAAO,KAAOE,IAC3BH,EAAUC,GAAO,GAAKE,EACtBH,EAAUxP,IAAW0K,SAAS,QAM3B8E,EAAUC,GAOX,SAASG,EAAUhM,EAAUgJ,GAE7B7F,IAAAA,EAAQ4H,EAAaT,IAAgB,IACtCtQ,EAAQiS,QAAAA,KAAgBC,EAAY/I,EAAMgJ,IAAOnD,KACrD7F,EAAM0I,GAAS7L,EACfmD,EAAMgJ,IAAQnD,EAEduB,EAAiBY,IAAQE,IAAgB7P,KAAK2H,IAQzC,SAASiJ,EAAgBpM,EAAUgJ,GAEnC7F,IAAAA,EAAQ4H,EAAaT,IAAgB,IACtCtQ,EAAQiS,QAAAA,KAAgBC,EAAY/I,EAAMgJ,IAAOnD,KACrD7F,EAAM0I,GAAS7L,EACfmD,EAAMgJ,IAAQnD,EAEduB,EAAiBnH,IAAiB5H,KAAK2H,IAIlC,SAASkJ,EAAOC,GACtB7B,OAAAA,EAAc,EACP8B,EAAQ,WAAO,MAAA,CAAEhH,QAAS+G,IAAiB,IAQnD,SAAgBE,EAAoB5Q,EAAK6Q,EAAczD,GACtDyB,EAAc,EACd2B,EACC,WACmB,mBAAPxQ,EAAmBA,EAAI6Q,KACzB7Q,IAAKA,EAAI2J,QAAUkH,MAErB,MAARzD,EAAeA,EAAOA,EAAKT,OAAO3M,IAQ7B,SAAS2Q,EAAQG,EAAS1D,GAE1B7F,IAAAA,EAAQ4H,EAAaT,IAAgB,GACvC4B,OAAAA,EAAY/I,EAAMgJ,IAAOnD,IAC5B7F,EAAMgJ,IAAQnD,EACd7F,EAAMwJ,IAAWD,EACTvJ,EAAM0I,GAASa,KAGjBvJ,EAAM0I,GAOP,SAASe,EAAY5M,EAAUgJ,GACrCyB,OAAAA,EAAc,EACP8B,EAAQ,WAAMvM,OAAAA,GAAUgJ,GAMzB,SAAS6D,EAAWnQ,GACpB4F,IAAAA,EAAWiI,EAAiB7N,QAAQA,EAAQiG,KAI5CQ,EAAQ4H,EAAaT,IAAgB,GAI3CnH,OAAAA,EAAM2J,IAAWpQ,EACZ4F,GAEe,MAAhBa,EAAM0I,KACT1I,EAAM0I,IAAAA,EACNvJ,EAASY,IAAIqH,IAEPjI,EAASzH,MAAMgF,OANAnD,EAAQkG,GAaxB,SAASmK,EAAclN,EAAOmN,GACxBD,EAAAA,QAAAA,eACX/S,EAAQ+S,QAAAA,cAAcC,EAAYA,EAAUnN,GAASA,GAIhD,SAASoN,EAAiB3I,GAC1BnB,IAAAA,EAAQ4H,EAAaT,IAAgB,IACrC4C,EAAW5B,IACjBnI,OAAAA,EAAM0I,GAASvH,EACViG,EAAiBxD,oBACrBwD,EAAiBxD,kBAAoB,SAAAoG,GAChChK,EAAM0I,IAAQ1I,EAAM0I,GAAOsB,GAC/BD,EAAS,GAAGC,KAGP,CACND,EAAS,GACT,WACCA,EAAS,QAAA,KAQZ,SAASE,IACR1C,EAAkB9M,KAAK,SAAAC,GAClBA,GAAAA,EAAUM,IAAAA,IAEZN,EAAUsN,IAAQE,IAAgBgC,QAAQC,GAC1CzP,EAAUsN,IAAQE,IAAgBgC,QAAQE,GAC1C1P,EAAUsN,IAAQE,IAAkB,GACnC,MAAOvJ,GACRjE,OAAAA,EAAUsN,IAAQE,IAAkB,GACpCrR,EAAQmK,QAAAA,IAAYrC,EAAGjE,EAAUF,MAAAA,KAKpC+M,EAAoB,GA4CrB,SAAS4C,EAAcE,GAClBA,EAAKC,GAAUD,EAAKC,IAOzB,SAASF,EAAaC,GACfE,IAAAA,EAASF,EAAK3B,KACC,mBAAV6B,IAAsBF,EAAKC,EAAWC,GAOlD,SAASxB,EAAYyB,EAASC,GAAAA,OACrBD,GAAWC,EAAQhQ,KAAK,SAACiQ,EAAK7C,GAAU6C,OAAAA,IAAQF,EAAQ3C,KAGjE,SAASS,EAAeoC,EAAKC,GACT,MAAA,mBAALA,EAAkBA,EAAED,GAAOC,EAjV1C9T,EAAQ8J,QAAAA,IAAU,SAAAhI,GACb6O,GAAiBA,EAAgB7O,GAGrCwO,EAAe,GADfC,EAAmBzO,EAAMM,KAGJ+O,MACpBZ,EAAiBY,IAAQE,IAAgBgC,QAAQC,GACjD/C,EAAiBY,IAAQE,IAAgBgC,QAAQE,GACjDhD,EAAiBY,IAAQE,IAAkB,KAI7CrR,EAAQkK,QAAAA,OAAS,SAAApI,GACZ8O,GAAcA,EAAa9O,GAEzBqB,IAAAA,EAAIrB,EAAMM,IACXe,GAAAA,EAAAA,CAEC+N,IAAAA,EAAQ/N,EAAEgO,IACZD,GACCA,EAAMG,IAAgB9P,SA6RJ,IA5RVmP,EAAkBlP,KAAK2B,IA4RRqN,IAAYxQ,EAAQ+T,QAAAA,yBAC/CvD,EAAUxQ,EAAQ+T,QAAAA,wBAvBpB,SAAwB/N,GAQnBgO,IAAAA,EAPEC,EAAO,WACZ/F,aAAaO,GACbyF,qBAAqBF,GACrB1G,WAAWtH,IAENyI,EAAUnB,WAAW2G,EArSR,KAwSE,oBAAVE,SACVH,EAAMD,sBAAsBE,MAcAb,MAzR9BpT,EAAQqK,QAAAA,IAAU,SAACvI,EAAOgC,GACzBA,EAAYF,KAAK,SAAAC,GAAAA,IAEfA,EAAUuF,IAAiBiK,QAAQC,GACnCzP,EAAUuF,IAAmBvF,EAAUuF,IAAiBgL,OAAO,SAAA9J,GAAAA,OAC9DA,EAAGuH,IAAS0B,EAAajJ,KAEzB,MAAOxC,GACRhE,EAAYF,KAAK,SAAAT,GACZA,EAAEiG,MAAkBjG,EAAEiG,IAAmB,MAE9CtF,EAAc,GACd9D,EAAQmK,QAAAA,IAAYrC,EAAGjE,EAAUF,QAI/BkN,GAAWA,EAAU/O,EAAOgC,IAGjC9D,EAAQ8F,QAAAA,QAAU,SAAAhE,GACbgP,GAAkBA,EAAiBhP,GAEjCqB,IAAAA,EAAIrB,EAAMM,IACXe,GAAAA,EAAAA,CAEC+N,IAAAA,EAAQ/N,EAAEgO,IACZD,GAAAA,EAAAA,IAEFA,EAAME,GAAMiC,QAAQ,SAAAG,GAAQA,OAAAA,EAAKC,GAAYD,EAAKC,MACjD,MAAO3L,GACAqC,EAAAA,QAAAA,IAAYrC,EAAG3E,EAAEQ;;AA8Cb,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,IAAA,EAAA,CAAA,SAAA,EAAA,UAAA,EAAA,QAAA,EAAA,SAAA,EAAA,wBAAA,EAAA,cAAA,EAAA,eAAA,EAAA,cAAA,EAAA,gBAAA,EAAA,aAAA,EAAA,eAAA,EAAA,MAAA,EAAA,YAAA,EAAA,yBAAA,EAAA,UAAA,EAAA,cAAA,EAAA,MAAA,EAAA,eAAA,EAAA,eAAA,EAAA,WAAA,EAAA,UAAA,EAAA,WAAA,GAAA,QAAA,OAAA,EAAA,QAAA,QAAA,EAAA,QAAA,uBAAA,EAAA,QAAA,aAAA,EAAA,QAAA,cAAA,EAAA,QAAA,aAAA,EAAA,QAAA,eAAA,EAAA,QAAA,YAAA,EAAA,QAAA,KAAA,EAAA,QAAA,WAAA,EAAA,QAAA,SAAA,EAAA,QAAA,aAAA,EAAA,QAAA,KAAA,EAAA,OAAA,eAAA,QAAA,gBAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,iBAAA,OAAA,eAAA,QAAA,gBAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,iBAAA,OAAA,eAAA,QAAA,YAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,aAAA,OAAA,eAAA,QAAA,WAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,YAAA,OAAA,eAAA,QAAA,YAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,aAAA,QAAA,wBAAA,QAAA,cAAA,QAAA,SAAA,QAAA,QAAA,QAAA,aAAA,EAAA,IAAA,EAAA,QAAA,gBAAA,OAAA,KAAA,GAAA,QAAA,SAAA,GAAA,YAAA,GAAA,eAAA,IAAA,OAAA,UAAA,eAAA,KAAA,EAAA,IAAA,OAAA,eAAA,QAAA,EAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,SAAA,IAAA,EAAA,QAAA,UpBtHR,SAAShD,EAAOC,EAAKC,GACtB,IAAA,IAAIN,KAAKM,EAAOD,EAAIL,GAAKM,EAAMN,GAAAA,OAAAA,EAU9B,SAAS8T,EAAe5Q,EAAGC,GAC5B,IAAA,IAAInD,KAAKkD,EAAAA,GAAa,aAANlD,KAAsBA,KAAKmD,GAAI,OAAA,EAC/C,IAAA,IAAInD,KAAKmD,EAAAA,GAAa,aAANnD,GAAoBkD,EAAElD,KAAOmD,EAAEnD,GAAI,OAAA,EAAO,OAAA,EACxD,IqBfK+T,EAAb,SAAA,GAAA,IAAA,EAAA,EAAA,SAAA,EACazT,GAAAA,IAAAA,EAAAA,OAAAA,EAAAA,EAAAA,KAAAA,KACLA,IAAAA,MAED0T,sBAAAA,EAAuB,EAAA,OAAA,EAAA,GAAA,EAAA,GAAA,UAAA,OAAA,OAAA,EAAA,WAAA,EAAA,UAAA,YAAA,EAAA,EAAA,UAAA,EAAA,EAAA,UAG7B5K,sBAAA,SAAsB9I,EAAOsI,GAE3BkL,OAAAA,EAAezI,KAAK/K,MAAOA,IAAUwT,EAAezI,KAAKzC,MAAOA,IAAAA,EATnE,CAAmC1G,EAAnC,WCIO,SAAS+R,EAAKrR,EAAGsR,GACdC,SAAAA,EAAaC,GACjB/S,IAAAA,EAAMgK,KAAK/K,MAAMe,IACjBgT,EAAYhT,GAAO+S,EAAU/S,IAAAA,OAC5BgT,GAAahT,IACjBA,EAAI2I,KAAO3I,EAAI,MAASA,EAAI2J,QAAU,MAGlCkJ,GAIGA,EAAS7I,KAAK/K,MAAO8T,KAAeC,EAHpCP,EAAezI,KAAK/K,MAAO8T,GAM3BE,SAAAA,EAAOhU,GAAAA,OAAAA,KACV8I,sBAAwB+K,GACtBxT,EAAciC,EAAAA,eAAAA,EAAGxC,EAAO,GAAIE,IAEpCgU,OAAAA,EAAO9L,UAAU+L,kBAAAA,EACjBD,EAAOE,YAAc,SAAW5R,EAAE4R,aAAe5R,EAAE0D,MAAQ,IAC3DgO,EAAOG,GAAAA,EACAH,EF6FO,QAAA,cAAA,EG1Hf,IAAII,EAAcjV,EAAQyI,QAAAA,IAgBnB,SAASyM,EAAWC,GACjBC,SAAAA,EAAUvU,GACdwU,IAAAA,EAAQ1U,EAAO,GAAIE,GAAAA,cAChBwU,EAAMzT,IACNuT,EAAGE,EAAOxU,EAAMe,KAExBwT,OAAAA,EAAUrM,UAAU+L,iBAAmBM,EAAUJ,GAAAA,EACjDI,EAAUL,YAAc,eAAiBI,EAAGJ,aAAeI,EAAGtO,MAAQ,IAC/DuO,EAvBRpV,EAAQyI,QAAAA,IAAQ,SAAA3G,GACXA,EAAMX,MAAQW,EAAMX,KAAK6T,GAAclT,EAAMF,MAChDE,EAAMjB,MAAMe,IAAME,EAAMF,IACxBE,EAAMF,IAAM,MAETqT,GAAaA,EAAYnT,IAAAA,ICPxBwT,EAAQ,SAAClU,EAAU+T,GACnB/T,OAAAA,GACEiE,EAAajE,EAAAA,cAAAA,GAAUmU,OAC7B,SAACC,EAAK3P,EAAOmL,GAAUwE,OAAAA,EAAIjH,OAAO4G,EAAGtP,EAAOmL,KAC5C,IAHqB,MAQVyE,EAAW,CACvBC,IAAKJ,EACLjC,QAASiC,EACTK,MAAAA,SAAMvU,GACEA,OAAAA,GAAWiE,EAAajE,EAAAA,cAAAA,GAAUG,OAAS,GAEnDqU,KAAAA,SAAKxU,GAEoB,GAAA,KADxBA,GAAWiE,EAAajE,EAAAA,cAAAA,IACXG,OAAAA,MACN,IAAIqM,MAAM,2CAEVxM,OAAAA,EAAS,IAEjByU,QAASxQ,EAAAA,cCrBJyQ,EAAgB9V,EAAQmK,QAAAA,IAiB9B,SAAS4L,EAAcjU,GAClBA,OAAAA,KACHA,EAAQnB,EAAO,GAAImB,IACbM,IAAa,KACnBN,EAAMC,IAAYD,EAAMC,KAAaD,EAAMC,IAAU2T,IAAIK,IAEnDjU,EAIR,SAAgBkU,IAEVC,KAAAA,IAA0B,EAAA,KAC1BC,EAAc,KAAA,KACdC,IAAsB,KA6FrB,SAASC,EAAUtU,GACrB+B,IAAAA,EAAY/B,EAAME,GAAQI,IACvByB,OAAAA,GAAaA,EAAUwS,GAAcxS,EAAUwS,EAAWvU,GAG3D,SAASwU,EAAKC,GAChBC,IAAAA,EACA3S,EACA8I,EAEK8J,SAAAA,EAAK5V,GACR2V,GAAAA,IACJA,EAAOD,KACFpJ,KACJ,SAAAO,GACC7J,EAAY6J,EAAQgJ,SAAWhJ,GAEhC,SAAA5F,GACC6E,EAAQ7E,IAKP6E,EAAAA,MACGA,EAAAA,IAGF9I,EAAAA,MACE2S,EAGAtV,OAAAA,EAAc2C,EAAAA,eAAAA,EAAWhD,GAGjC4V,OAAAA,EAAK1B,YAAc,OACnB0B,EAAKzB,GAAAA,EACEyB,EC1JR,SAAgBE,IACVC,KAAAA,EAAQ,KAAA,KACRC,EAAO,KNkHE,QAAA,SAAA,EKzHf7W,EAAQmK,QAAAA,IAAc,SAASwC,EAAO3E,EAAUjE,GAC3C4I,GAAAA,EAAMQ,KAAAA,IAAAA,IAELtJ,EACA/B,EAAQkG,EAEJlG,EAAQA,EAAME,IAAAA,IAChB6B,EAAY/B,EAAMM,MAAeyB,EAAUiT,IAAAA,OAExCjT,EAAUiT,IAAiBnK,EAAO3E,EAAS5F,KAIrD0T,EAAcnJ,EAAO3E,EAAUjE,KAuBhCiS,EAASjN,UAAY,IAAItG,EAAJ,WAMFqU,IAAmB,SAASC,EAASC,GAEjD7T,IAAAA,EAAIyI,KAENzI,MAAAA,EAAE+S,IACL/S,EAAE+S,EAAc,IAEjB/S,EAAE+S,EAAY1U,KAAKwV,GAEb3J,IAAAA,EAAU+I,EAAUjT,EAAEQ,KAExBsT,GAAAA,EACEC,EAAa,WACdD,IAEJA,GAAAA,EAEI5J,EACHA,EAAQ8J,GAERA,MAIFH,EAAoBI,IACnBJ,EAAoBrL,qBACrBqL,EAAoBrL,qBAAuB,WAC1CuL,IAEIF,EAAoBI,KACvBJ,EAAoBI,OAIhBD,IAAAA,EAAuB,WAKvBf,IAAAA,EAAAA,MAJEjT,EAAE8S,IAAAA,IACR9S,EAAEQ,IAAO5B,IAAU,GAAKoB,EAAEgG,MAAMkN,EAChClT,EAAE2J,SAAS,CAAEuJ,EAAalT,EAAEgT,IAAsB,OAG1CC,EAAYjT,EAAE+S,EAAYmB,OACjCjB,EAAUnJ,eAKR9J,EAAE8S,OACN9S,EAAE2J,SAAS,CAAEuJ,EAAalT,EAAEgT,IAAsBhT,EAAEQ,IAAO5B,IAAU,KAEtEgV,EAAQ5J,KAAK+J,EAAYA,IAG1BlB,EAASjN,UAAUC,OAAS,SAASnI,EAAOsI,GACvCyC,OAAAA,KAAKuK,MAAAA,KACHxS,IAAO5B,IAAU,GAAKgU,EAAcnK,KAAKuK,KAAAA,KACzCA,IAAsB,MAGrB,EACNjV,EAAcuB,EAAAA,eAAAA,EAAdvB,UAAyB,KAAMiI,EAAMkN,EAAa,KAAOxV,EAAMO,UAC/D+H,EAAMkN,GAAcxV,EAAMyW,WCxF5B,IAAMjK,EAAU,SAACkK,EAAMvU,EAAOjC,GAAAA,KACvBA,EAdgB,KAcSA,EAfR,IAqBtBwW,EAAKV,EAAKW,OAAOxU,GAQhBuU,EAAK1W,MAAM4W,cACmB,MAA9BF,EAAK1W,MAAM4W,YAAY,KAAcF,EAAKV,EAAKa,MAAAA,IAQjD3W,EAAOwW,EAAKX,EACL7V,GAAM,CACLA,KAAAA,EAAKQ,OAAS,GACpBR,EAAKsW,KAALtW,GAEGA,GAAAA,EA1CiB,GA0CMA,EA3CL,GAAA,MA8CtBwW,EAAKX,EAAQ7V,EAAOA,EA5CJ,MAmDlB4V,EAAa5N,UAAY,IAAItG,EAAJ,WAEF4T,EAAa,SAASrT,GACtCuU,IAAAA,EAAO3L,KACP+L,EAAYvB,EAAUmB,EAAK5T,KAE7B5C,EAAOwW,EAAKV,EAAKe,IAAI5U,GACzBjC,OAAAA,EA5DuB,KA8DhB,SAAA8W,GACAC,IAAAA,EAAmB,WACnBP,EAAK1W,MAAM4W,aAKf1W,EAAKS,KAAKqW,GACVxK,EAAQkK,EAAMvU,EAAOjC,IAHrB8W,KAMEF,EACHA,EAAUG,GAEVA,MAKHnB,EAAa5N,UAAUC,OAAS,SAASnI,GACnC+V,KAAAA,EAAQ,KAAA,KACRC,EAAO,IAAIkB,IAEV3W,IAAAA,GAAWiE,EAAaxE,EAAAA,cAAAA,EAAMO,UAChCP,EAAM4W,aAAwC,MAAzB5W,EAAM4W,YAAY,IAI1CrW,EAAS4W,UAIL,IAAA,IAAIzX,EAAIa,EAASG,OAAQhB,KAAAA,KAYxBsW,EAAKoB,IAAI7W,EAASb,GAAKqL,KAAKgL,EAAQ,CAAC,EAAG,EAAGhL,KAAKgL,IAE/C/V,OAAAA,EAAMO,UAGduV,EAAa5N,UAAUc,mBAAqB8M,EAAa5N,UAAUS,kBAAoB,WAOhF+N,IAAAA,EAAO3L,KACb2L,EAAKV,EAAKxD,QAAQ,SAACtS,EAAMiC,GACxBqK,EAAQkK,EAAMvU,EAAOjC,MAAAA,IC1HjBmX,EAAAA,WAAAA,SAAAA,KAAAA,IAAAA,EAAAA,EAAAA,UAAAA,OAAAA,EACLnO,gBAAA,WACQ6B,OAAAA,KAAK/K,MAAM6B,SAAAA,EAEnBsG,OAAA,SAAOnI,GACCA,OAAAA,EAAMO,UAAAA,EALT8W,GAaN,SAASC,EAAOtX,GACXyL,IAAAA,EAAQV,KACRwM,EAAYvX,EAAMuX,UAClBC,GAAOnX,EACVgX,EAAAA,eAAAA,EACA,CAAExV,QAAS4J,EAAM5J,SACjB7B,EAAMiB,OAKHwK,OAAAA,EAAMgM,GAAchM,EAAMgM,IAAeF,IACxC9L,EAAMiM,EAAMvX,YAAYsL,EAAMgM,EAAWrX,YAAYqL,EAAMiM,IAC/DC,EAASlM,EAAAA,UAAAA,EAAMmM,GACfnM,EAAMoM,GAAAA,GAKH7X,EAAMiB,MACJwK,EAAMoM,GAoBVN,EAAUrW,IAAYuK,EAAMvK,KAC5BiH,EAAOqP,EAAAA,QAAAA,EAAMD,GACb9L,EAAMvK,IAAYqW,EAAUrW,MApB5BuK,EAAMiM,EAAQ3N,SAASC,eAAe,KAGtCrE,EAAQ,EAAA,SAAA,GAAI4R,GAEZA,EAAU1S,YAAY4G,EAAMiM,GAE5BjM,EAAMoM,GAAAA,EACNpM,EAAMgM,EAAaF,GAEnBpP,EAAOqP,EAAAA,QAAAA,EAAMD,EAAW9L,EAAMiM,GAC9BjM,EAAMvK,IAAYuK,EAAMiM,EAAMxW,KAcvBuK,EAAMoM,IACVpM,EAAMiM,EAAMvX,YAAYsL,EAAMgM,EAAWrX,YAAYqL,EAAMiM,IAC/DC,EAASlM,EAAAA,UAAAA,EAAMmM,IAGhBnM,EAAMmM,EAAQJ,EAEd/L,EAAMX,qBAAuB,WACxBW,EAAMiM,EAAMvX,YAAYsL,EAAMgM,EAAWrX,YAAYqL,EAAMiM,IAC/DC,EAASlM,EAAAA,UAAAA,EAAMmM,IAGT,KAQD,SAASE,EAAa7W,EAAOsW,GAC5BlX,OAAAA,EAAciX,EAAAA,eAAAA,EAAQ,CAAErW,MAAAA,EAAOsW,UAAAA,I7B1EvC,IAAMQ,EAAc,mOAGpBnW,EAAUsG,UAAAA,UAAU+L,iBAAmB,GAEvC,IAAa+D,EACM,oBAAVC,QAAyBA,OAAOC,KAAOD,OAAOC,IAAI,kBAC1D,MASD,SAAgB/P,EAAOlH,EAAOkX,EAAQhT,GAGb,GAAA,MAApBgT,EAAOjX,IAAAA,KACHiX,EAAOC,YACbD,EAAO/X,YAAY+X,EAAOC,YAI5BC,OAAAA,EAAapX,EAAAA,QAAAA,EAAOkX,GACG,mBAAZhT,GAAwBA,IAE5BlE,EAAQA,EAAMM,IAAa,KAGnC,SAAgBoE,EAAQ1E,EAAOkX,EAAQhT,GACtCmT,OAAAA,EAAcrX,EAAAA,SAAAA,EAAOkX,GACE,mBAAZhT,GAAwBA,IAE5BlE,EAAQA,EAAMM,IAAa,KAGnC,IAAIgX,EAAepZ,EAAQ+H,QAAAA,MAyB3B,SAASsR,EAAkBC,EAAO3X,GAC7B2X,EAAM,UAAY3X,KAAS2X,EAAM3X,IACpC4X,OAAOC,eAAeF,EAAO3X,EAAK,CACjC8X,cAAAA,EACA7B,IAAAA,WACQhM,OAAAA,KAAK,UAAYjK,IAMzBsW,IAAAA,SAAIyB,GACE,KAAA,UAAY/X,GAAO+X,KApC5B1Z,EAAQ+H,QAAAA,MAAQ,SAAAD,GACXsR,IAActR,EAAIsR,EAAatR,IACnCA,EAAE6R,QAAU,aACRC,IAAAA,GAAAA,EACHC,GAAAA,EAEKC,EAAsBhS,EAAEiS,gBAC9BjS,EAAEiS,gBAAkB,WACnBD,EAAoBvP,KAAKzC,GACzB8R,GAAAA,GAGKI,IAAAA,EAAqBlS,EAAEmS,eAC7BnS,OAAAA,EAAEmS,eAAiB,WAClBD,EAAmBzP,KAAKzC,GACxB+R,GAAAA,GAGD/R,EAAEoS,qBAAuB,WAAMN,OAAAA,GAC/B9R,EAAEqS,mBAAqB,WAAMN,OAAAA,GACrB/R,EAAEsS,YAActS,GAsBzB,IAAIuS,EAAsB,CACzBZ,cAAAA,EACA7B,IAAAA,WACQhM,OAAAA,KAAK0O,QAIVC,EAAeva,EAAQ8B,QAAAA,MAC3B9B,EAAQ8B,QAAAA,MAAQ,SAAAA,GACfA,EAAM0Y,SAAW3B,EAEb1X,IAAAA,EAAOW,EAAMX,KACbN,EAAQiB,EAAMjB,MAEdM,GAAAA,EAAM,CAELN,GAAAA,EAAMyZ,OAASzZ,EAAM4Z,YACxBJ,EAAoBK,WAAa,cAAe7Z,EACzB,MAAnBA,EAAM4Z,YAAmB5Z,EAAMyZ,MAAQzZ,EAAM4Z,WACjDlB,OAAOC,eAAe3Y,EAAO,YAAawZ,IAIxB,mBAARlZ,EAAoB,CAoB1BwZ,IAAAA,EAAgBC,EAAOra,EACtBA,IAAAA,KAnBDM,EAAMoL,mBAAAA,IAAgBpL,EAAMgF,QAC1BhF,EAAMgF,OAAyB,IAAhBhF,EAAMgF,QACzBhF,EAAMgF,MAAQhF,EAAMoL,qBAEdpL,EAAMoL,cAIV/F,MAAMC,QAAQtF,EAAMgF,QAAUhF,EAAMga,UAAqB,WAAT1Z,KACnDkE,EAAaxE,EAAAA,cAAAA,EAAMO,UAAUiS,QAAQ,SAAArQ,IACW,GAA3CnC,EAAMgF,MAAMhD,QAAQG,EAAMnC,MAAMgF,SACnC7C,EAAMnC,MAAMia,UAAAA,YAGPja,EAAMgF,OAKJhF,EAAAA,GAAY8Z,EAAiB/B,EAAYhS,KAAKrG,GAAK,MACzDoa,GAAAA,EAAAA,IAEEpa,KADLqa,EAAQ9Y,EAAMjB,MAAQ,GACZA,EACT+Z,EACChC,EAAYhS,KAAKrG,GAAKA,EAAE4G,QAAQ,WAAY,OAAOC,cAAgB7G,GAChEM,EAAMN,I8BxIR,SAAA,GAAmCY,IAAAA,E9B8IhBW,E8B9IgBX,KAAMN,E9B8ItBiB,E8B9IsBjB,MAC1CA,GAAAA,GAAwB,iBAARM,EAAAA,CACjBmF,IAAAA,EAAW,GAEV,IAAA,IAAI/F,KAAKM,EACT,mBAAmB+F,KAAKrG,KAC3BM,EAAMN,EAAE6G,eAAiBvG,EAAMN,UACxBM,EAAMN,IAEd+F,EAAS/F,EAAE6G,eAAiB7G,EAEzB+F,GAAAA,EAASyU,gBACZla,EAAMma,WAAana,EAAMyF,EAASyU,sBAC3Bla,EAAMyF,EAASyU,gBAEnBzU,EAAS2U,gBACZpa,EAAMoa,cAAgBpa,EAAMyF,EAAS2U,sBAC9Bpa,EAAMyF,EAAS2U,gBAItB3U,EAAS4U,WACC,aAAT/Z,GACwB,UAAvBA,EAAKiG,gBAA8B,eAAeR,KAAK/F,EAAMM,OAC9D,CACGga,IAAAA,EAAa7U,EAAS8U,SAAW,UAChCva,EAAMsa,KACVta,EAAMsa,GAActa,EAAMyF,EAAS4U,iBAC5Bra,EAAMyF,EAAS4U,aA5BlB,G9BqJW,mBAAR/Z,IACNA,EAAKka,GACNla,EAAK4H,YAELsQ,EAAkBlY,EAAK4H,UAAW,sBAClCsQ,EAAkBlY,EAAK4H,UAAW,6BAClCsQ,EAAkBlY,EAAK4H,UAAW,uBAClC5H,EAAKka,GAAAA,GAIHd,GAAcA,EAAazY,IAAAA,IsBtI1BuN,EAAU,SAMhB,SAASiM,EAAcna,GACfD,OAAAA,EAAckM,cAAAA,KAAK,KAAMjM,GAQjC,SAASlB,EAAesb,GAAAA,QACdA,GAAWA,EAAQf,WAAa3B,EAU1C,SAAS9M,EAAawP,GAChBtb,OAAAA,EAAesb,GACbC,EAAmBvM,aAAAA,MAAM,KAAM3N,WADDia,EAStC,SAASE,EAAuBrD,GAAAA,QAC3BA,EAAUrW,OACbmX,EAAa,EAAA,QAAA,KAAMd,IAAAA,GAWrB,SAASsD,EAAY7X,GAElBA,OAAAA,IACCA,EAAUZ,MAAgC,IAAvBY,EAAU6G,UAAkB7G,IACjD,KA0Ca,QAAA,QAAA,EA9Bf,IAAM8X,EAA0B,SAAC3V,EAAU6N,GAAQ7N,OAAAA,EAAS6N,IA8B7C,QAAA,wBAAA,EAAA,IAAA,EAAA,CACdvC,SAAAA,EADc,SAEdE,WAAAA,EAFc,WAGdQ,UAAAA,EAHc,UAIdI,gBAAAA,EAJc,gBAKdC,OAAAA,EALc,OAMdG,oBAAAA,EANc,oBAOdD,QAAAA,EAPc,QAQdK,YAAAA,EARc,YASdC,WAAAA,EATc,WAUdE,cAAAA,EAVc,cAWd1D,QA1Ge,SA2GfoG,SAAAA,EACAzM,OAAAA,EACAxC,QAASwC,EACTyS,uBAAAA,EACA9C,aAAAA,EACAzX,cAAAA,EAjBc,cAkBd8K,cAAAA,EAlBc,cAmBdsP,cAAAA,EACAvP,aAAAA,EACAxJ,UAAAA,EArBc,UAsBdC,SAAAA,EAtBc,SAuBdvC,eAAAA,EACAyb,YAAAA,EACAjZ,UAAAA,EAzBc,UA0Bd6R,cAAAA,EACAE,KAAAA,EACAU,WAAAA,EACAyG,wBAAAA,EACA3F,SAAAA,EACAW,aAAAA,EACAL,KAAAA,GAhCc,QAAA,QAAA;;AS2Bd,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,QAAA,EAAA,QAAA,UAAA,EA/FD,IAAA,EAAA,QAAA,gBAIA,IAAI,EAA6C,KAC7C,EAA0C,KAoBxC,MAAO,EAEX,YAAsB,EAAU,GAAV,KAAA,MAAA,EADd,KAAA,UAA4B,GAoB7B,KAAA,IAAM,KAAK,IAAI,KAAK,MACpB,KAAA,IAAM,KAAK,IAAI,KAAK,MAG3B,IAAI,GACE,KAAK,QAAU,IAId,KAAA,MAAQ,EACR,KAAA,UAAU,QAAQ,GAAM,MAG/B,MACS,OAAA,KAAK,MAGd,UAAU,GACH,KAAA,UAAU,KAAK,GAGtB,YAAY,GACJ,MAAA,EAAQ,KAAK,UAAU,QAAQ,IACtB,IAAX,GACG,KAAA,UAAU,OAAO,EAAO,IAK7B,SAAU,EAAW,GACnB,MAAC,EAAO,IAAY,EAAS,EAAA,UAAA,EAAK,OAkBjC,OAhBS,EAAA,EAAA,iBAAA,KAML,SAAA,IACP,EAAS,EAAK,OAIT,OAPP,EAAS,EAAK,OAMd,EAAK,UAAU,GACR,KACL,EAAK,YAAY,KAElB,CAAC,IAEG,EACR,QAAA,KAAA;;ACxJD,aAAA,IAAkB,EAAlB,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,cAAA,EAAA,QAAA,SAAA,EAAA,SAAkB,GAChB,EAAA,EAAA,mBAAA,GAAA,qBACA,EAAA,EAAA,uBAAA,GAAA,yBACA,EAAA,EAAA,cAAA,GAAA,gBAHF,CAAkB,IAAA,QAAA,SAAA,EAAQ;;ACqDzB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,cAAA,EArDD,IAAA,EAAA,QAAA,oBASA,SAAS,EAAY,GACX,OAAA,GACD,IAAA,eACI,OAAA,EAAS,SAAA,mBACb,IAAA,aACI,OAAA,EAAS,SAAA,uBACb,IAAA,WACI,OAAA,EAAS,SAAA,cAClB,QACS,OAAA,MAIP,SAAU,EAAc,EAAe,OAAO,SAAS,MACvD,IACE,IAAC,EAAa,WAAW,KACpB,MAAA,GAEH,MAAA,EAAa,EAAa,OAAO,GAAG,MAAM,KAC1C,EAAqB,GACtB,IAAA,MAAM,KAAa,EAAY,CAC9B,IAAC,EAAK,GAAS,EAAU,MAAM,KAE/B,GADJ,EAAQ,mBAAmB,GACf,eAAR,EACF,EAAO,WAAa,OACf,GAAY,UAAR,EACT,EAAO,MAAQ,OACV,GAAY,qBAAR,EACT,EAAO,iBAAmB,OACrB,GAAY,SAAR,EAAgB,CACnB,MAAA,EAAO,EAAY,GACZ,OAAT,EACF,EAAO,SAAW,EAElB,QAAQ,0CAA0C,MAIjD,OAAA,EACP,MAAO,GAGA,OAFP,QAAQ,MAAM,qCACd,QAAQ,MAAM,GACP;;ACIkD,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,iBAAA,QAAA,kBAAA,EAvD7D,IAyCY,EAzCZ,EAAA,QAAA,eACA,EAAA,QAAA,eAEA,EAAA,QAAA,gBAoD6D,QAAA,aAAA,EAd7D,SAAY,GACV,EAAA,WAAA,aACA,EAAA,OAAA,SACA,EAAA,0BAAA,4BACA,EAAA,iBAAA,mBAJF,CAAY,IAAA,QAAA,aAAA,EAAY,KAOxB,IAAI,EAAkD,CACpD,MAAO,KACP,aAAc,KACd,wBAAyB,EAAK,KAAA,MAC9B,yBAA0B,EAAK,KAAA,MAG3B,MAAO,UAAyB,EAAhC,KAAN,cAA6D,SAAA,WAc3D,KAAA,gBAAmB,CAAA,IACZ,KAAA,IAAI,CACP,KAAM,EAAM,KACZ,YAAa,EAAM,YACnB,SAAU,EAAM,SAAS,IAAI,IAAM,CACjC,QAAS,EACT,gBAAiB,EACjB,mBAAoB,EACpB,kBAAmB,CAAC,aAAc,aAKxC,KAAA,sBAAyB,CAAA,IACL,MAAd,KAAK,QAET,GAAc,EAAM,EAAA,OAAA,EAAa,EAAG,KAAK,MAAM,SAAS,OAAS,GAE5D,KAAA,IAAG,OAAA,OAAA,OAAA,OAAA,GACH,KAAK,OAAK,CACb,YAAA,QAyBJ,KAAA,iBAAoB,CAAA,IACd,GAAc,MAAd,KAAK,MAAe,OAGT,MADC,KAAK,oBAKhB,KAAA,8BAA8B,GACpB,MAAT,EACK,CAAC,aAAc,MAEjB,CACL,aAAc,CACZ,yBAA0B,EAC1B,iBAAkB,EAClB,cAAe,OA1EvB,IAAI,GACI,MAAA,EAAW,KAAK,MACN,MAAZ,GAAgC,MAAZ,IAAoB,EAA2B,EAAA,4BAAA,EAAU,IAG3E,MAAA,IAAI,GAGZ,mBAT2D,IAAA,EAUrD,OAAc,MAAd,KAAK,MAAsB,KACxB,KAAK,MAAM,SAAmB,QAAV,EAAA,KAAK,aAAK,IAAA,OAAA,EAAA,EAAE,cAAgB,KA2BjD,yBAAyB,GAC3B,GAAc,MAAd,KAAK,MAAe,OAClB,MAAA,YAAC,EAAD,SAAc,GAAY,KAAK,MAChC,KAAA,IAAG,OAAA,OAAA,OAAA,OAAA,GACH,KAAK,OAAK,CACb,SAAU,EAAS,IAAI,CAAC,EAAG,IACrB,GAAK,EAAoB,EACtB,EAAG,OAKR,8BACN,GAEK,KAAA,yBAAyB,GAAK,OAAA,OAAA,OAAA,OAAA,GAC9B,GAAC,CACJ,kBAAmB,EAAG,EAAE,sBA0BpB,sBACN,EACA,GAEQ,OAAA,GACD,KAAA,EAAa,OACX,KAAA,yBAAyB,GAAK,OAAA,OAAA,OAAA,OAAA,GAC9B,GAAC,CACJ,gBAAiB,EAAG,EAAE,oBAExB,MAGG,KAAA,EAAa,WACX,KAAA,yBAAyB,GAAK,OAAA,OAAA,OAAA,OAAA,GAC9B,GAAC,CACJ,mBAAoB,EAAG,EAAE,uBAE3B,MAGG,KAAA,EAAa,iBACX,KAAA,8BAA8B,GAAK,OAAA,OAAA,OAAA,OAAA,GACnC,GAAC,CACJ,aACoB,MAAlB,EAAE,aACE,KACD,OAAA,OAAA,OAAA,OAAA,GACM,EAAE,cAAY,CACjB,iBAAkB,EAAG,EAAE,aAAa,uBAG9C,MAGG,KAAA,EAAa,0BACX,KAAA,8BAA8B,GAAK,OAAA,OAAA,OAAA,OAAA,GACnC,GAAC,CACJ,aACoB,MAAlB,EAAE,aACE,KACD,OAAA,OAAA,OAAA,OAAA,GACM,EAAE,cAAY,CACjB,yBAA0B,EAAG,EAAE,aAAa,gCAQ5D,yBACE,EACA,GAEK,KAAA,sBAAsB,EAAI,GAAK,OAAA,OAAA,OAAA,OAAA,GAC/B,GAAC,CACJ,MAAA,KAIJ,gBAAgB,EAAkB,GAC3B,KAAA,sBAAsB,EAAI,GAAK,OAAA,OAAA,OAAA,OAAA,GAC/B,GAAC,CACJ,aAAA,KAIJ,2BAA2B,EAAkB,GACtC,KAAA,sBAAsB,EAAI,GAAK,OAAA,OAAA,OAAA,OAAA,GAC/B,GAAC,CACJ,wBAAA,KAIJ,4BAA4B,EAAkB,GACvC,KAAA,sBAAsB,EAAI,GAAK,OAAA,OAAA,OAAA,OAAA,GAC/B,GAAC,CACJ,yBAAA,KAIJ,iBAGO,KAAA,yBAAyB,EAAa,OAAQ,MAC9C,KAAA,yBAAyB,EAAa,WAAY,MAClD,KAAA,yBAAyB,EAAa,iBAAkB,MACxD,KAAA,yBAAyB,EAAa,0BAA2B,OAzKb,QAAA,iBAAA;;ACgBtD,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,oBAAA,QAAA,cAAA,QAAA,UAAA,QAAA,UAAA,QAAA,YAAA,QAAA,UAAA,QAAA,eAAA,QAAA,aAAA,QAAA,eAAA,QAAA,iBAAA,QAAA,aAAA,QAAA,gBAAA,QAAA,mBAAA,QAAA,0BAAA,EAvEP,IAAA,EAAA,QAAA,eACA,EAAA,QAAA,oBACA,EAAA,QAAA,sBACA,EAAA,QAAA,mBAGO,MAAM,EAAuB,IAAI,EAAJ,MAAkB,EAAO,oBAiEtD,QAAA,qBAAA,EA1DA,MAAM,EAAqB,IAAI,EAAJ,MAAkB,EAAO,kBA0DpD,QAAA,mBAAA,EAzDA,MAAM,EAAkB,IAAI,EAAJ,KAAiB,GAAI,mBAyD7C,QAAA,gBAAA,EAtDA,MAAM,EAAe,IAAI,EAAJ,KAAmB,EAAS,SAAA,mBAAoB,YAsDrE,QAAA,aAAA,EAnDA,MAAM,EAAmB,IAAI,EAAJ,iBAAqB,KAAM,gBAmDpD,QAAA,iBAAA,EAjDP,EAAa,UAAU,KAErB,EAAiB,mBAInB,MAAM,GAAa,EAAnB,EAAA,iBACa,EAAiB,IAAI,EAAJ,KAAqB,EAAY,cA0CxD,QAAA,eAAA,EAvCA,MAAM,EAAe,IAAI,EAAJ,KAAmC,KAAM,YAuC9D,QAAA,aAAA,EAnCA,MAAM,EAAiB,IAAI,EAAJ,MAAkB,EAAO,cAmChD,QAAA,eAAA,EA3BP,MAAM,EAAW,OAAO,SAAS,SACpB,EAAyB,UAAb,GAAqC,WAAb,EA0B1C,QAAA,UAAA,EAzBP,MAAM,EAAuB,GAAsC,MAAzB,EAAW,WACxC,EAAc,IAAI,EAAJ,KAAkB,EAAsB,WAwB5D,QAAA,YAAA,EApBA,MAAM,EAAY,IAAI,EAAJ,MAAkB,EAAO,SAElD,IAAY,EAMA,EAYL,QAAA,UAAA,EAAA,QAAA,UAAA,EAlBP,SAAY,GACV,EAAA,EAAA,YAAA,GAAA,cACA,EAAA,EAAA,KAAA,GAAA,OACA,EAAA,EAAA,MAAA,GAAA,QAHF,CAAY,IAAA,QAAA,UAAA,EAAS,KAkBd,QAAA,cAAA,EAZP,SAAY,GACV,EAAA,EAAA,UAAA,GAAA,YACA,EAAA,EAAA,WAAA,GAAA,aAFF,CAAY,IAAA,QAAA,cAAA,EAAa,KAYlB,MAAM,EAAsB,IAAI,EAAJ,KACjC,CACE,MAAO,EAAU,KACjB,UAAW,EAAc,YAE3B,mBALK,QAAA,oBAAA;;ACtCN,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,sBAAA,EAhCD,IAAA,EAAA,QAAA,aACA,EAAA,QAAA,KAEA,EAAA,QAAA,eAYM,SAAU,IACR,MAAA,GAAmB,EAAQ,EAAA,SAAA,EAAR,sBACnB,GAAoB,EAAQ,EAAA,SAAA,EAAR,kBAEtB,IAAC,EAAmB,OAAO,KAC3B,GAAA,EAAkB,aAAe,EAAkB,SAAS,OAAQ,OAAO,KAEzE,MAAA,EAAQ,EAAkB,YAC1B,EAAe,EAAkB,SAAS,GAChD,OAAA,OAAA,OAAA,OAAA,OAAA,GACK,EAAkB,SAAS,EAAkB,cAAY,CAC5D,SAAS,EAAiB,EAAA,kBAAA,CACxB,QAAS,EAAa,QACtB,iBAAA,IAEF,MAAO,EAAkB;;ACyC7B,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,gBAAA,QAAA,iBAAA,EAxEA,IAEkB,EAFlB,EAAA,QAAA,eAwEA,QAAA,YAAA,EAtEA,SAAkB,GAEhB,EAAA,EAAA,OAAA,GAAA,SAGA,EAAA,EAAA,KAAA,GAAA,OAGA,EAAA,EAAA,MAAA,GAAA,QARF,CAAkB,IAAA,QAAA,YAAA,EAAW,KAW7B,MAAM,EAAkB,0BAExB,SAAS,IACD,MAAA,EAAmB,OAAO,cAAgB,OAAO,aAAa,GAChE,MAAqB,SAArB,EACK,EAAY,KACW,UAArB,EACF,EAAY,MAEZ,EAAY,OAIvB,SAAS,IACA,OAAA,WAAW,gCAGpB,SAAS,EAAgB,GAOnB,GAN0B,IAA4B,QAOhD,OAAA,GACD,KAAA,EAAY,OACR,OAAA,EAAY,MAEhB,KAAA,EAAY,MACR,OAAA,EAAY,KAEhB,KAAA,EAAY,KACR,OAAA,EAAY,YAIf,OAAA,GACD,KAAA,EAAY,OACR,OAAA,EAAY,KAEhB,KAAA,EAAY,KACR,OAAA,EAAY,MAEhB,KAAA,EAAY,MACR,OAAA,EAAY,QAM3B,MAAM,UAAwB,EAA9B,KAAA,cAQA,SAAA,WAPE,KAAA,uBAAyB,MAClB,KAAA,IAAI,EAAgB,KAAK,WAI3B,MAAM,EAAkB,IAAI,EAAgB,IAAuB,eAE1E,QAAA,gBAAA,EAAA,EAAgB,UAAU,KAClB,MAAA,EAAQ,EAAgB,MAEtB,OAAA,GACD,KAAA,EAAY,KACf,OAAO,aAAa,GAAmB,OACvC,MAEG,KAAA,EAAY,MACf,OAAO,aAAa,GAAmB,QACvC,MAEG,KAAA,EAAY,cACR,OAAO,aAAa,GAC3B,MAEF,QAES,OADyB,EAI7B,OAAA;;ACjDF,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,eAAA,EA5CP,IAOK,EAPL,EAAA,QAAA,mBACA,EAAA,QAAA,oBAMA,SAAK,GACH,EAAA,aAAA,UACA,EAAA,WAAA,UACA,EAAA,KAAA,UACA,EAAA,UAAA,UACA,EAAA,YAAA,UACA,EAAA,UAAA,UACA,EAAA,MAAA,UACA,EAAA,KAAA,UACA,EAAA,UAAA,UACA,EAAA,MAAA,UACA,EAAA,YAAA,UACA,EAAA,MAAA,UAZF,CAAK,IAAA,EAAM,KAeX,MAAM,EAAM,GACN,EAAM,GACN,EAAM,GACN,EAAM,GAEN,EAAkB,IAChB,MAAA,GAAI,EAAS,EAAA,UAAA,GAAO,GACpB,EAAa,GAAM,EAAf,IACJ,EARI,GACA,GAOY,EAChB,EAPI,GACA,GAMY,EACf,OAAA,EAAM,MAAA,kBAAkB,EAAG,EAAG,IAEjC,4HAZM,GAgBQ,QAAQ,QAfhB,GAe4B,QAAQ,0BAdpC,GAeQ,QAAQ,QAdhB,GAc4B,QAAQ,+CAKnC,EAAmB,CAC9B,eAAgB,EAAO,aACvB,iBAAkB,EAAO,KAEzB,eAAgB,EAAO,UACvB,iBAAkB,EAAO,YAEzB,kBAAmB,EAAO,aAC1B,oBAAqB,EAAO,KAE5B,kBAAmB,EAAO,MAC1B,oBAAqB,EAAO,YAE5B,sBAAuB,EAAO,KAC9B,wBAAyB,EAAO,UAEhC,YAAa,EAAO,MAEpB,qBAAsB,EAAO,YAC7B,wBAAyB,EAAO,MAChC,0BAA2B,EAAO,YAElC,eAAA,EACA,mBAAA,GAvBK,QAAA,UAAA;;ACAA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,gBAAA,EA5CP,IAOK,EAPL,EAAA,QAAA,mBACA,EAAA,QAAA,oBAMA,SAAK,GACH,EAAA,MAAA,UACA,EAAA,UAAA,UACA,EAAA,WAAA,UACA,EAAA,KAAA,UACA,EAAA,UAAA,UACA,EAAA,UAAA,UACA,EAAA,MAAA,UACA,EAAA,UAAA,UACA,EAAA,eAAA,UACA,EAAA,MAAA,UACA,EAAA,OAAA,UACA,EAAA,OAAA,UAZF,CAAK,IAAA,EAAM,KAeX,MAAM,EAAM,IACN,EAAM,GACN,EAAM,GACN,EAAM,IAEN,EAAkB,IAChB,MAAA,GAAI,EAAS,EAAA,UAAA,GAAO,GACpB,EAAa,GAAM,EAAf,IACJ,EARI,IACA,GAOY,EAChB,EAPI,GACA,IAMY,EACf,OAAA,EAAM,MAAA,kBAAkB,EAAG,EAAG,IAEjC,4HAZM,IAgBQ,QAAQ,QAfhB,GAe4B,QAAQ,0BAdpC,GAeQ,QAAQ,QAdhB,IAc4B,QAAQ,+CAKnC,EAAoB,CAC/B,eAAgB,EAAO,MACvB,iBAAkB,EAAO,WAEzB,eAAgB,EAAO,MACvB,iBAAkB,EAAO,UAEzB,kBAAmB,EAAO,MAC1B,oBAAqB,EAAO,WAE5B,kBAAmB,EAAO,MAC1B,oBAAqB,EAAO,UAE5B,sBAAuB,EAAO,UAC9B,wBAAyB,EAAO,eAEhC,YAAa,EAAO,MAEpB,qBAAsB,EAAO,MAC7B,wBAAyB,EAAO,OAChC,0BAA2B,EAAO,OAElC,eAAA,EACA,mBAAA,GAvBK,QAAA,WAAA;;ACsDN,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,SAAA,EAAA,QAAA,UAAA,EAAA,QAAA,oBAAA,EAAA,QAAA,cAAA,EAAA,QAAA,kBAAA,EAlGD,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,gBACA,EAAA,QAAA,gCACA,EAAA,QAAA,kBAEA,EAAA,QAAA,mBACA,EAAA,QAAA,gBACA,EAAA,QAAA,iBA0BO,MAAM,GAAe,EAAqB,EAAA,eAAA,EAArB,YAEtB,SAAU,IACP,OAAA,EAAW,EAAA,YAAA,GAGd,SAAU,EAAa,GACpB,OAAA,EAAmB,EAAA,oBAAA,GAG5B,SAAS,IACA,OAAA,WAAW,gCAGd,SAAU,EAAoB,GAC1B,OAAA,GACD,KAAA,EAAY,YAAA,OACR,MAAA,SAEJ,KAAA,EAAY,YAAA,KACR,MAAA,OAEJ,KAAA,EAAY,YAAA,MACR,MAAA,SAKb,SAAS,EAAS,EAA0B,GAClC,OAAA,GACD,KAAA,EAAY,YAAA,OACR,OAAA,EAAwB,EAAH,UAAe,EAA3C,WAEG,KAAA,EAAY,YAAA,KACR,OAAA,EAAP,UAEG,KAAA,EAAY,YAAA,MACR,OAAA,EAAP,YAKA,SAAU,EAAc,GACtB,MAAC,EAAuB,IAA4B,EACxD,EAAA,UAAA,IAAM,IAA4B,SAG9B,GAAqB,EACxB,EAAA,aAAA,IACC,EAAyB,EAAM,UAEjC,CAAC,KAGO,EAAA,EAAA,WAAA,KACF,MAAA,EAAQ,IAEP,OADP,EAAM,iBAAiB,SAAU,GAC1B,KACL,EAAM,oBAAoB,SAAU,KAErC,CAAC,IAEE,MACA,EAAQ,GADM,EAAQ,EAAA,SAAA,EAAR,iBACgB,GAC7B,OAAA,EAAC,EAAA,GAAA,EAAa,SAAQ,CAAC,MAAO,EAAO,SAAU,EAAM,WAC7D,QAAA,aAAA;;AClGD,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EACA,IAAA,EAAA,sBAEA,SAAA,EAAA,GACA,MAAA,iBAAA,GAAA,EAAA,KAAA,GAEA,OAAA,QAAA,QAAA;;ACXA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,uCAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAEA,IAAA,EAAA,CAAA,WAAA,QAAA,IACA,SAAA,EAAA,EAAA,GACA,GAAA,iBAAA,KAAA,EAAA,EAAA,SAAA,IAAA,EAAA,QAAA,UAAA,EACA,OAAA,EAAA,IAAA,SAAA,GACA,OAAA,EAAA,QAAA,UAAA,EAAA,WAIA,OAAA,QAAA,QAAA;;ACrBA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,uCAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAGA,IAAA,EAAA,CAAA,WAAA,IACA,SAAA,EAAA,EAAA,GACA,GAAA,iBAAA,KAAA,EAAA,EAAA,SAAA,IAAA,EAAA,QAAA,gBAAA,EACA,OAAA,EAAA,IAAA,SAAA,GACA,OAAA,EAAA,QAAA,gBAAA,EAAA,iBAIA,OAAA,QAAA,QAAA;;ACtBA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EACA,IAAA,EAAA,CAAA,WAAA,QAAA,IAEA,EAAA,CACA,WAAA,EACA,YAAA,EACA,MAAA,EACA,UAAA,GAGA,SAAA,EAAA,EAAA,GACA,GAAA,WAAA,GAAA,EAAA,eAAA,GACA,OAAA,EAAA,IAAA,SAAA,GACA,OAAA,EAAA,IAIA,OAAA,QAAA,QAAA;;ACtBA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,uCAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAGA,IAAA,EAAA,CAAA,WAAA,IACA,SAAA,EAAA,EAAA,GACA,GAAA,iBAAA,KAAA,EAAA,EAAA,SAAA,IAAA,EAAA,QAAA,YAAA,EACA,OAAA,EAAA,IAAA,SAAA,GACA,OAAA,EAAA,QAAA,YAAA,EAAA,aAIA,OAAA,QAAA,QAAA;;ACtBA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EACA,IAAA,EAAA,CACA,KAAA,CAAA,cAAA,WAAA,cAAA,eAAA,QACA,cAAA,CAAA,qBAAA,kBAAA,qBAAA,sBAAA,gBAGA,SAAA,EAAA,EAAA,GACA,GAAA,YAAA,GAAA,EAAA,eAAA,GACA,OAAA,EAAA,GAGA,OAAA,QAAA,QAAA;;AChBA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EACA,IAAA,EAAA,CACA,eAAA,aACA,gBAAA,UACA,aAAA,QACA,WAAA,OAEA,EAAA,CACA,aAAA,iBACA,UAAA,kBACA,WAAA,cACA,eAAA,aACA,MAAA,cACA,SAAA,iBACA,WAAA,iBACA,UAAA,uBAGA,SAAA,EAAA,EAAA,EAAA,GACA,EAAA,eAAA,KACA,EAAA,EAAA,IAAA,EAAA,IAAA,GAGA,OAAA,QAAA,QAAA;;AC5BA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EACA,IAAA,EAAA,CACA,eAAA,UACA,gBAAA,UACA,aAAA,QACA,WAAA,MACA,eAAA,WACA,KAAA,YAGA,EAAA,CACA,WAAA,iBACA,eAAA,gBACA,SAAA,kBAGA,SAAA,EAAA,EAAA,EAAA,GACA,kBAAA,GAAA,iBAAA,IACA,EAAA,QAAA,WAAA,EACA,EAAA,gBAAA,WAEA,EAAA,gBAAA,aAEA,EAAA,QAAA,YAAA,EACA,EAAA,mBAAA,UAEA,EAAA,mBAAA,UAGA,EAAA,eAAA,KACA,EAAA,EAAA,IAAA,EAAA,IAAA,GAGA,OAAA,QAAA,QAAA;;ACtCA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,uCAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAEA,IAAA,EAAA,CAAA,WAAA,QAAA,IAEA,EAAA,sFAEA,SAAA,EAAA,EAAA,GACA,GAAA,iBAAA,KAAA,EAAA,EAAA,SAAA,IAAA,EAAA,KAAA,GACA,OAAA,EAAA,IAAA,SAAA,GACA,OAAA,EAAA,IAIA,OAAA,QAAA,QAAA;;ACxBA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,uCAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAGA,IAAA,EAAA,CAAA,WAAA,IACA,SAAA,EAAA,EAAA,GACA,GAAA,iBAAA,KAAA,EAAA,EAAA,SAAA,IAAA,EAAA,QAAA,eAAA,EACA,OAAA,EAAA,IAAA,SAAA,GACA,OAAA,EAAA,QAAA,eAAA,EAAA,gBAIA,OAAA,QAAA,QAAA;;ACtBA,aAMA,SAAA,EAAA,EAAA,GACA,GAAA,aAAA,GAAA,WAAA,EACA,MAAA,CAAA,iBAAA,UANA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAMA,OAAA,QAAA,QAAA;;ACXA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EACA,IAAA,EAAA,CAAA,WAAA,QAAA,IAEA,EAAA,CACA,WAAA,EACA,UAAA,EACA,OAAA,EACA,QAAA,EACA,aAAA,EACA,UAAA,EACA,WAAA,GAEA,EAAA,CACA,eAAA,EACA,eAAA,EACA,kBAAA,EACA,eAAA,EACA,kBAAA,GAGA,SAAA,EAAA,EAAA,GACA,GAAA,EAAA,eAAA,IAAA,EAAA,eAAA,GACA,OAAA,EAAA,IAAA,SAAA,GACA,OAAA,EAAA,IAIA,OAAA,QAAA,QAAA;;AChCA,aAEA,IAAA,EAAA,SACA,EAAA,OACA,EAAA,GAEA,SAAA,EAAA,GACA,OAAA,KAAA,EACA,EAAA,GACA,EAAA,GAAA,EACA,QAAA,EAAA,OACA,cACA,QAAA,EAAA,QAGA,OAAA,QAAA;;ACfA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,wBAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAEA,SAAA,EAAA,GACA,OAAA,EAAA,EAAA,SAAA,GAEA,OAAA,QAAA,QAAA;;AChBA,aAMA,SAAA,EAAA,GACA,OAAA,EAAA,OAAA,GAAA,cAAA,EAAA,MAAA,GALA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAIA,OAAA,QAAA,QAAA;;ACTA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,yCAEA,EAAA,EAAA,GAEA,EAAA,QAAA,uCAEA,EAAA,EAAA,GAEA,EAAA,QAAA,gCAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAEA,IAAA,EAAA,CACA,YAAA,EACA,oBAAA,EACA,kBAAA,EACA,0BAAA,EACA,eAAA,EACA,uBAAA,GAIA,EAAA,CACA,OAAA,WACA,IAAA,QACA,GAAA,QAGA,SAAA,EAAA,EAAA,GACA,IAAA,EAAA,EAAA,SAAA,GACA,OAAA,EAMA,IAFA,IAAA,EAAA,EAAA,MAAA,iCAEA,EAAA,EAAA,EAAA,EAAA,OAAA,EAAA,IAAA,EAAA,CACA,IAAA,EAAA,EAAA,GACA,EAAA,CAAA,GACA,IAAA,IAAA,KAAA,EAAA,CACA,IAAA,GAAA,EAAA,EAAA,SAAA,GAEA,GAAA,EAAA,QAAA,IAAA,GAAA,UAAA,EAEA,IADA,IAAA,EAAA,EAAA,GACA,EAAA,EAAA,EAAA,EAAA,OAAA,EAAA,IAAA,EAEA,EAAA,QAAA,EAAA,QAAA,EAAA,EAAA,EAAA,IAAA,IAKA,EAAA,GAAA,EAAA,KAAA,KAGA,OAAA,EAAA,KAAA,KAGA,SAAA,EAAA,EAAA,EAAA,EAAA,GAEA,GAAA,iBAAA,GAAA,EAAA,eAAA,GAAA,CACA,IAAA,EAAA,EAAA,EAAA,GAEA,EAAA,EAAA,MAAA,iCAAA,OAAA,SAAA,GACA,OAAA,aAAA,KAAA,KACA,KAAA,KAEA,GAAA,EAAA,QAAA,WAAA,EACA,OAAA,EAGA,IAAA,EAAA,EAAA,MAAA,iCAAA,OAAA,SAAA,GACA,OAAA,gBAAA,KAAA,KACA,KAAA,KAEA,OAAA,EAAA,QAAA,QAAA,EACA,GAGA,EAAA,UAAA,EAAA,EAAA,SAAA,IAAA,EACA,EAAA,OAAA,EAAA,EAAA,SAAA,IAAA,EACA,IAGA,OAAA,QAAA,QAAA;;AC5FA,aAEA,SAAA,EAAA,GAIA,IAHA,IAAA,EAAA,KACA,EAAA,EAAA,OAEA,GACA,EAAA,GAAA,EAAA,EAAA,aAAA,GAMA,OAAA,IAAA,EAGA,OAAA,QAAA;;AChBA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,sBAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAEA,SAAA,EAAA,EAAA,EAAA,GACA,GAAA,EAAA,eAAA,GAAA,CAKA,IAJA,IAAA,EAAA,GACA,EAAA,EAAA,GACA,GAAA,EAAA,EAAA,SAAA,GACA,EAAA,OAAA,KAAA,GACA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CACA,IAAA,EAAA,EAAA,GACA,GAAA,IAAA,EACA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IACA,EAAA,EAAA,GAAA,GAAA,EAAA,GAGA,EAAA,GAAA,EAAA,GAEA,OAAA,EAEA,OAAA,EAEA,OAAA,QAAA,QAAA;;AChCA,aAMA,SAAA,EAAA,EAAA,EAAA,EAAA,EAAA,GACA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,EAAA,IAAA,EAAA,CACA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,GAIA,GAAA,EACA,OAAA,GAXA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAYA,OAAA,QAAA,QAAA;;ACjBA,aAMA,SAAA,EAAA,EAAA,IACA,IAAA,EAAA,QAAA,IACA,EAAA,KAAA,GAIA,SAAA,EAAA,EAAA,GACA,GAAA,MAAA,QAAA,GACA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,EAAA,IAAA,EACA,EAAA,EAAA,EAAA,SAGA,EAAA,EAAA,GAhBA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAgBA,OAAA,QAAA,QAAA;;ACrBA,aAMA,SAAA,EAAA,GACA,OAAA,aAAA,SAAA,MAAA,QAAA,GALA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAIA,OAAA,QAAA,QAAA;;ACTA,aAEA,OAAA,eAAA,QAAA,aAAA,CACA,OAAA,IAEA,QAAA,QAAA,EAEA,IAAA,EAAA,QAAA,2BAEA,EAAA,EAAA,GAEA,EAAA,QAAA,wBAEA,EAAA,EAAA,GAEA,EAAA,QAAA,6BAEA,EAAA,EAAA,GAEA,EAAA,QAAA,qBAEA,EAAA,EAAA,GAEA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAEA,SAAA,EAAA,GACA,IAAA,EAAA,EAAA,UACA,EAAA,EAAA,QAuCA,OArCA,SAAA,EAAA,GACA,IAAA,IAAA,KAAA,EAAA,CACA,IAAA,EAAA,EAAA,GAGA,IAAA,EAAA,EAAA,SAAA,GACA,EAAA,GAAA,EAAA,QAEA,GAAA,MAAA,QAAA,GAAA,CAGA,IAFA,IAAA,EAAA,GAEA,EAAA,EAAA,EAAA,EAAA,OAAA,EAAA,IAAA,EAAA,CACA,IAAA,GAAA,EAAA,EAAA,SAAA,EAAA,EAAA,EAAA,GAAA,EAAA,IACA,EAAA,EAAA,SAAA,EAAA,GAAA,EAAA,IAKA,EAAA,OAAA,IACA,EAAA,GAAA,OAEA,CACA,IAAA,GAAA,EAAA,EAAA,SAAA,EAAA,EAAA,EAAA,EAAA,GAIA,IACA,EAAA,GAAA,GAGA,GAAA,EAAA,EAAA,SAAA,EAAA,EAAA,IAIA,OAAA,GAKA,OAAA,QAAA,QAAA;;;AC2JA,IAAA,EAAA,UAAA,GAlNA,SAAA,EAAA,GACA,EAAA,SACA,IACA,GAAA,GAGA,EAAA,EAAA,QAAA,EAPA,OAAA,QAAA,EAUA,IAOA,EAPA,EAAA,GAGA,GAAA,EAQA,EAAA,EAIA,EAAA,KAQA,SAAA,IACA,KAAA,EAAA,EAAA,QAAA,CACA,IAAA,EAAA,EAUA,GAPA,GAAA,EACA,EAAA,GAAA,OAMA,EAAA,EAAA,CAGA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,EAAA,EAAA,EAAA,IACA,EAAA,GAAA,EAAA,EAAA,GAEA,EAAA,QAAA,EACA,EAAA,GAGA,EAAA,OAAA,EACA,EAAA,EACA,GAAA,EAaA,IAAA,OAAA,IAAA,EAAA,EAAA,KACA,EAAA,EAAA,kBAAA,EAAA,uBAwDA,SAAA,EAAA,GACA,IAAA,EAAA,EACA,EAAA,IAAA,EAAA,GACA,EAAA,SAAA,eAAA,IAEA,OADA,EAAA,QAAA,EAAA,CAAA,eAAA,IACA,WACA,GAAA,EACA,EAAA,KAAA,GA4CA,SAAA,EAAA,GACA,OAAA,WAKA,IAAA,EAAA,WAAA,EAAA,GAIA,EAAA,YAAA,EAAA,IAEA,SAAA,IAGA,aAAA,GACA,cAAA,GACA,MA9GA,EADA,mBAAA,EACA,EAAA,GA8BA,EAAA,GAQA,EAAA,aAAA,EAgFA,EAAA,yBAAA;;ACvNA,aAGA,IAAA,EAAA,QAAA,SAEA,EAAA,GAGA,EAAA,GACA,EAAA,EAAA,yBAAA,GAEA,SAAA,IACA,GAAA,EAAA,OACA,MAAA,EAAA,QAaA,SAAA,EAAA,GACA,IAAA,GAEA,EADA,EAAA,OACA,EAAA,MAEA,IAAA,GAEA,KAAA,EACA,EAAA,GAKA,SAAA,IACA,KAAA,KAAA,KAfA,OAAA,QAAA,EAoBA,EAAA,UAAA,KAAA,WACA,IACA,KAAA,KAAA,OACA,MAAA,GACA,EAAA,QAIA,EAAA,QAAA,IAKA,EAAA,KAAA,GACA,KAEA,QACA,KAAA,KAAA,KACA,EAAA,EAAA,QAAA;;ACukCA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,gBAAA,QAAA,OAAA,QAAA,IAAA,QAAA,oBAAA,QAAA,iBAAA,QAAA,gBAAA,EAtoCA,IAAA,EAAA,EAAA,QAAA,8CACA,EAAA,EAAA,QAAA,mDACA,EAAA,EAAA,QAAA,gDACA,EAAA,EAAA,QAAA,gDACA,EAAA,EAAA,QAAA,8CACA,EAAA,EAAA,QAAA,mDACA,EAAA,EAAA,QAAA,oDACA,EAAA,EAAA,QAAA,kDACA,EAAA,EAAA,QAAA,kDACA,EAAA,EAAA,QAAA,kDACA,EAAA,EAAA,QAAA,gDACA,EAAA,EAAA,QAAA,oDACA,EAAA,EAAA,QAAA,gBACA,EAAA,EAAA,QAAA,gDACA,EAAA,EAAA,QAAA,SAwnCA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAtnCA,IAAIsF,EAAI,CAAC,UACLC,EAAI,CAAC,OACLC,EAAK,CAAC,MACNC,EAAK,CAAC,SAAU,OAChBC,EAAM,CAAC,SAAU,MACjBC,EAAO,CAAC,SAAU,MAAO,MAEzBC,EAAmB,CACrBC,QAAS,CAACC,EAAD,QAAOC,EAAP,QAAkBC,EAAlB,QAA0BlI,EAA1B,QAAkCmI,EAAlC,QAAwCC,EAAxC,QAAmDC,EAAnD,QAA+DC,EAA/D,QAAyEC,EAAzE,QAAmFC,EAAnF,QAA6FC,EAA7F,QAAqGC,EAArG,SACTC,UAAW,CAAef,UAAAA,EAAwBA,gBAAAA,EAAyBA,iBAAAA,EAAyBA,iBAAAA,EAA2BJ,mBAAAA,EAAkBA,YAAAA,EAAwBA,kBAAAA,EAAqBA,eAAAA,EAAuBA,iBAAAA,EAAgBA,UAAAA,EAAqBA,eAAAA,EAAyBA,mBAAAA,EAAwBA,kBAAAA,EAAwBA,kBAAAA,EAA8BA,wBAAAA,EAAoBA,cAAAA,EAAyBA,mBAAAA,EAA8BA,wBAAAA,EAAiBG,WAAAA,EAAkBE,WAAAA,EAAqBL,YAAAA,EAA2BA,qBAAAA,EAAmBA,aAAAA,EAAwBA,kBAAAA,EAAwBA,kBAAAA,EAAyBA,mBAAAA,EAAeA,SAAAA,EAAgBA,UAAAA,EAAeA,SAAAA,EAAiBA,WAAAA,EAAmBA,aAAAA,EAAeA,SAAAA,EAAiBA,WAAAA,EAAeA,SAAAA,EAAoBA,cAAAA,EAAWA,KAAAA,EAAuBA,iBAAAA,EAAqBA,eAAAA,EAAsBA,gBAAAA,EAAsBA,gBAAAA,EAAuBA,iBAAAA,EAAuBA,iBAAAA,EAAiBA,WAAAA,EAAeA,SAAAA,EAA0BG,oBAAAA,EAA0BA,mBAAAA,EAA0BA,mBAAAA,EAA2BA,oBAAAA,EAAcH,OAAAA,EAA0BG,oBAAAA,EAAkBE,WAAAA,EAAqBA,YAAAA,EAAqBA,YAAAA,EAAqBF,YAAAA,EAAkBA,WAAAA,EAAiBA,UAAAA,EAAkBA,WAAAA,EAAuBA,gBAAAA,EAAuBA,gBAAAA,EAAuBA,gBAAAA,EAAeA,QAAAA,EAAkBA,WAAAA,EAAmBA,YAAAA,EAAmBC,YAAAA,EAAaA,KAAAA,EAAkBJ,UAAAA,EAAoBI,cAAAA,EAAiBJ,SAAAA,EAAeI,SAAAA,EAAmBJ,WAAAA,EAAeI,SAAAA,EAAqBJ,aAAAA,EAAiBA,WAAAA,EAAgBA,UAAAA,EAAqBA,eAAAA,EAAYA,MAAAA,EAAsBA,gBAAAA,EAAyBA,mBAAAA,EAAyBA,mBAAAA,EAA+BA,yBAAAA,EAAqBA,eAAAA,EAAqBI,eAAAA,EAA0BA,kBAAAA,EAA0BA,kBAAAA,EAA8BA,sBAAAA,EAA6BA,qBAAAA,EAA4BJ,oBAAAA,EAAuBA,iBAAAA,EAAwBA,kBAAAA,EAAcK,QAAAA,EAAkBD,SAAAA,EAAiBA,SAAAA,EAAuBA,eAAAA,EAAkBH,UAAAA,EAAoBA,cAAAA,EAAcA,QAAAA,EAAeC,SAAAA,EAAmBA,YAAAA,EAAkBA,WAAAA,EAAmBA,YAAAA,EAA2BA,oBAAAA,EAAwBA,iBAAAA,EAAyBA,kBAAAA,EAAoBA,aAAAA,EAAuBA,gBAAAA,EAAoBA,aAAAA,EAAoBA,aAAAA,EAAYA,KAAAA,EAAoBA,aAAAA,EAAuBA,gBAAAA,EAAkBA,WAAAA,EAAeA,QAAAA,EAAkBA,WAAAA,EAAqBA,cAAAA,EAAqBA,cAAAA,EAAkBA,WAAAA,EAAgBA,SAAAA,EAAeA,QAAAA,EAAsBE,eAAAA,EAAoBJ,YAAAA,EAAwBA,kBAAAA,EAAwBA,kBAAAA,EAAuBA,iBAAAA,EAAwBA,kBAAAA,EAAuBA,iBAAAA,IAGhiFoB,EAA4B,mBAAXlE,QAAoD,iBAApBA,OAAOmE,SAAwB,SAAUrc,GAAc,cAAOA,GAAS,SAAUA,GAAcA,OAAAA,GAAyB,mBAAXkY,QAAyBlY,EAAIyB,cAAgByW,QAAUlY,IAAQkY,OAAO/P,UAAY,gBAAkBnI,GAElQsc,EAAe,WAAuBC,SAAAA,EAAiBC,EAAQvc,GAAc,IAAA,IAAIN,EAAI,EAAGA,EAAIM,EAAMU,OAAQhB,IAAK,CAAM8c,IAAAA,EAAaxc,EAAMN,GAAI8c,EAAW3C,WAAa2C,EAAW3C,aAAc,EAAO2C,EAAW5D,cAAe,EAAU,UAAW4D,IAAYA,EAAWC,UAAW,GAAM/D,OAAOC,eAAe4D,EAAQC,EAAW1b,IAAK0b,IAAwB,OAAA,SAAUE,EAAaC,EAAYC,GAAwJF,OAArIC,GAAYL,EAAiBI,EAAYxU,UAAWyU,GAAiBC,GAAaN,EAAiBI,EAAaE,GAAqBF,GAA7gB,GAEnB,SAASG,EAAgBC,EAAUJ,GAAmB,KAAEI,aAAoBJ,GAAsB,MAAA,IAAIK,UAAU,qCAEhH,IAAIC,EAA4B,oBAAR9F,IAEpB+F,EAAkB,WAMTA,SAAAA,IACLJ,EAAgB,KAAMI,GAEjBC,KAAAA,SAAW,GACXC,KAAAA,SAAW,GAoGbF,OAjGPZ,EAAaY,EAAiB,CAAC,CAC3Bnc,IAAK,UACLkE,MAAO,WAQIwN,OAPEA,SAAQrN,GACR,IAAA,IAAIzF,EAAI,EAAGA,EAAI,KAAKyd,SAASzc,OAAQhB,IAEtCyF,EAAS,KAAK+X,SAAS,KAAKC,SAASzd,IAAK,KAAKyd,SAASzd,KAJ7D,IAUR,CACCoB,IAAK,MACLkE,MAAO,WAyCIoS,OAxCEA,SAAItW,EAAoBkE,EAAmBoY,GAC5C,GAAC,KAAKF,SAASG,eAAevc,IAE3B,GAAIsc,EAAe,CAClBjN,IAAAA,EAAQ,KAAKgN,SAASnb,QAAQlB,GAC7Bqc,KAAAA,SAASvR,OAAOuE,EAAO,GACvBgN,KAAAA,SAASxc,KAAKG,SAJdqc,KAAAA,SAASxc,KAAKG,GAOnBkE,GAAS,MAATA,EAAAA,CAKAgY,GAAAA,GAAchY,aAAiBkS,KAAOlS,aAAiBiY,EAAiB,CAGpEK,IAAAA,EAAS,KAAKJ,SAASG,eAAevc,GAAO,KAAKoc,SAASpc,GAAO,IAAImc,EAK1E,OAJAjY,EAAMwN,QAAQ,SAAUxN,EAAOlE,GAC3Bwc,EAAOlG,IAAItW,EAAKkE,EAAOoY,UAEtBF,KAAAA,SAASpc,GAAOwc,GAIrB,GAACjY,MAAMC,QAAQN,IAA4E,iBAAhD,IAAVA,EAAwB,YAAcmX,EAAQnX,IAY9EkY,KAAAA,SAASpc,GAAOkE,MAZjB,CAKK,IAFDuY,IAAAA,EAAU,KAAKL,SAASG,eAAevc,GAAO,KAAKoc,SAASpc,GAAO,IAAImc,EACvEO,EAAO9E,OAAO8E,KAAKxY,GACdtF,EAAI,EAAGA,EAAI8d,EAAK9c,OAAQhB,GAAK,EAClC6d,EAAQnG,IAAIoG,EAAK9d,GAAIsF,EAAMwY,EAAK9d,IAAK0d,GAEpCF,KAAAA,SAASpc,GAAOyc,QAvBhBL,KAAAA,SAASpc,GAAOkE,GAX1B,IA2CR,CACClE,IAAK,MACLkE,MAAO,WAKI+R,OAJEA,SAAIjW,GACF,OAAA,KAAKoc,SAASpc,IAFtB,IAOR,CACCA,IAAK,MACLkE,MAAO,WAKIyY,OAJEA,SAAI3c,GACF,OAAA,KAAKoc,SAASG,eAAevc,IAFrC,IAOR,CACCA,IAAK,eACLkE,MAAO,WAgBI0Y,OAfEA,SAAaC,GACdlS,IAAAA,EAAQ,KAERuR,GAAAA,GAAcW,aAAqBzG,KAAOyG,aAAqBV,EAC/DU,EAAUnL,QAAQ,SAAUxN,EAAOlE,GAC/B2K,EAAM2L,IAAItW,EAAKkE,GAAO,UAIrB,IADDwY,IAAAA,EAAO9E,OAAO8E,KAAKG,GACdje,EAAI,EAAGA,EAAI8d,EAAK9c,OAAQhB,IACxB0X,KAAAA,IAAIoG,EAAK9d,GAAIie,EAAUH,EAAK9d,KAAK,IAX/C,MAoBJud,EA9GW,GAqHlBW,EAAe,WACfC,EAAwB,SAA+BC,GACvD,MAA4BC,IAAAA,OAAOD,EAAMvX,gBAIzCyX,EAAoB,SAA2BC,GAC3CpL,IAAAA,EAASoL,EAAO3X,QAAQsX,EAAcC,GACtChL,MAAc,MAAdA,EAAO,IAA4B,MAAdA,EAAO,IAA4B,MAAdA,EAAO,GAC1C,IAAMkL,OAAOlL,GAEjBA,GAOPqL,EAAmB,CACnBC,yBAAyB,EACzBC,mBAAmB,EACnBC,kBAAkB,EAClBC,kBAAkB,EAClBC,SAAS,EACTC,cAAc,EACdC,iBAAiB,EACjBC,aAAa,EACbhD,MAAM,EACNiD,UAAU,EACVC,cAAc,EACdC,YAAY,EACZC,cAAc,EACdC,WAAW,EACXC,SAAS,EACTC,YAAY,EACZC,YAAY,EACZC,WAAW,EACXC,YAAY,EACZC,SAAS,EACTC,OAAO,EACPC,SAAS,EACTC,SAAS,EACTC,QAAQ,EACRC,QAAQ,EACRC,MAAM,EAGNC,aAAa,EACbC,cAAc,EACdC,aAAa,EACbC,iBAAiB,EACjBC,kBAAkB,EAClBC,kBAAkB,EAClBC,eAAe,EACfC,aAAa,GAWjB,SAASC,EAAUC,EAAQvf,GAChBuf,OAAAA,EAASvf,EAAIwf,OAAO,GAAGC,cAAgBzf,EAAI0f,UAAU,GAQhE,IAAIC,EAAW,CAAC,SAAU,KAAM,MAAO,KAKvC/H,OAAO8E,KAAKU,GAAkB1L,QAAQ,SAAUkO,GAC5CD,EAASjO,QAAQ,SAAU6N,GACvBnC,EAAiBkC,EAAUC,EAAQK,IAASxC,EAAiBwC,OAIrE,IAAIC,EAAiB,SAAwB7f,EAC3C4f,GAEM,MAAgB,iBAATA,EACHxC,EAAiBpd,GACV,GAAK4f,EAELA,EAAO,KAGX,GAAKA,GAIhBE,EAAgC,SAAuC9f,EACzE4f,GAEE,OAAsBG,EAAaF,EAAe7f,EAAK4f,KAMvDI,EAAa,SAAoB7C,EAAuBnd,GACxD,OAA+Bmd,EAAAA,EAAAA,SAAAA,GAAQ8C,SAAS,KAYhDC,EAAa,SAAoBC,GACjC,OAAsBH,EAAWI,KAAKC,UAAUF,KAMhDJ,EAAe,SAAsB5C,GACrC,MAMmC,MAA/BA,EAAOA,EAAOvd,OAAS,KAAqC,gBAAtBud,EAAOzX,OAAO,IAAwByX,EAASF,OAAOE,GAAU,eAI9G,SAASmD,EAAmBC,GAAWhc,GAAAA,MAAMC,QAAQ+b,GAAM,CAAO,IAAA,IAAI3hB,EAAI,EAAG4hB,EAAOjc,MAAMgc,EAAI3gB,QAAShB,EAAI2hB,EAAI3gB,OAAQhB,IAAO4hB,EAAK5hB,GAAK2hB,EAAI3hB,GAAa4hB,OAAAA,EAAsBjc,OAAAA,MAAMkc,KAAKF,GAE1L,IAAIG,GAAY,EAAenG,EAAAA,SAAAA,GA8D3BoG,EAAoD,CAExD,WAQWC,OAPEA,SAAgBC,EAAUC,EAAcC,GACzCF,MAAgB,MAAhBA,EAAS,GACF,KAEJE,EAAsBD,EAAeD,IALpD,GAYA,WAUWG,OATEA,SAAaH,EAAUC,EAAcC,GACtCF,GAAgB,MAAhBA,EAAS,GACF,OAAA,KAGPI,IAAAA,EAAYF,EAAsBD,GAC/B,MAAA,CAAC7D,OAAO4D,GAAY,IAAM5D,OAAOgE,EAAUC,KAAK,KAAO,MAPtE,IAwDIC,EAAc,SAASA,EAAYN,EACrCO,EACAC,EACAC,EACAC,GAIO,IAFDC,IAAAA,EAAS,IAAIrF,EAERvd,EAAI,EAAGA,EAAIwiB,EAAWxhB,OAAQhB,IACnC4iB,EAAO5E,aAAawE,EAAWxiB,IAG/B6iB,IAAAA,EAAoB,IAAItF,EACxBuF,EAAkB,GAGtBF,EAAO9P,QAAQ,SAAUiQ,EAAK3hB,GAGPqhB,EAAiBpf,KAAK,SAAU2f,GAC3C7P,IAAAA,EAAS6P,EAAQ5hB,EAAK6gB,EAAU,SAAUgB,GACnCV,OAAAA,EAAYU,EAAa,CAACF,GAAMN,EAAkBC,EAAgBC,KAEzExP,GAAU,MAAVA,EAUO,OAPHxN,MAAMC,QAAQuN,GACd2P,EAAgB7hB,KAAKyN,MAAMoU,EAAiBpB,EAAmBvO,KAG/D+P,QAAQC,KAAK,yHAA+HH,GAC5IF,EAAgB7hB,KAAK,eAAiBod,OAAOlL,GAAU,OAEpD,KAMX0P,EAAkBnL,IAAItW,EAAK2hB,GAAK,KAGpCK,IAAAA,EAAmBC,EAAmBpB,EAAUY,EAAmBH,EAAgBC,EAAcF,GAM9FK,OAJHM,GACAN,EAAgBQ,QAAQF,GAGrBN,GASPS,EAAoB,SAA2BC,EACjDd,EACAD,GAEM,GAACC,EAKA,IADDe,IAAAA,EAAoBzK,OAAO8E,KAAK4E,GAC3B1iB,EAAI,EAAGA,EAAIyjB,EAAkBziB,OAAQhB,IAAK,CAC3CoB,IAAAA,EAAMqiB,EAAkBzjB,GACxBwjB,EAAazF,IAAI3c,IAUjBoiB,EAAa9L,IAAItW,EAAKshB,EAAethB,GAAKoiB,EAAanM,IAAIjW,GAAMqhB,IAAjE,KAURiB,EAAgB,SAAuBtiB,EACzCkE,EACAqe,GAEE,OAAsBtF,OAAOC,EAAkBld,IAAQ,IAAMid,OAAOsF,EAAeviB,EAAKkE,IAAU,KAIlGse,EAA2B,SAAkC3O,EAAK8N,GAE3D9N,OADPA,EAAI8N,IAAO,EACJ9N,GAkCPoO,EAAqB,SAA4BpB,EACnDuB,EACAd,EACAC,EACAF,GAGEc,EAAkBC,EAAcd,EAAgBD,GAE5CoB,IAAAA,EAAmB7K,OAAO8E,KAAK0F,EAAahG,UAAUxI,OAAO4O,EAA0B5K,OAAO8K,OAAO,OAGrGC,EAAmBjC,EAAU0B,EAAahG,UAE1CwG,EAAehL,OAAO8E,KAAKiG,GAC3BC,GAAAA,EAAahjB,SAAWwiB,EAAa/F,SAASzc,OAOzC,IAAA,IAAIhB,EAAI,EAAGA,EAAIgkB,EAAahjB,OAAQhB,IACjC,IAAC6jB,EAAiBG,EAAahkB,IAAK,CAIhCikB,IAAAA,OAAgB,EAgBhBA,IAZAA,EAHuB,MAAvBD,EAAahkB,GAAG,GAGAgkB,EAAahkB,GAAG,GAAG6G,cAAgBmd,EAAahkB,GAAG8G,MAAM,GAC3C,MAAvBkd,EAAahkB,GAAG,GAIPgkB,EAAahkB,GAAG,GAAG6G,cAAgBmd,EAAahkB,GAAG8G,MAAM,GAIzDkd,EAAahkB,GAAG,GAAG6G,cAAgBmd,EAAahkB,GAAG8G,MAAM,KAGxD+c,EAAiBI,GAAgB,CAC9CC,IAAAA,EAAgBV,EAAa/F,SAASnb,QAAQ2hB,GAClDT,EAAa/F,SAASvR,OAAOgY,EAAe,EAAGF,EAAahkB,SAK5DwjB,EAAa/F,SAAS6F,QAAQU,EAAahkB,IAStD,IAHD2jB,IAAAA,GAAkC,IAAjBhB,EAAyB1B,EAAiBC,EAE3DiD,EAAQ,GACHC,EAAK,EAAGA,EAAKZ,EAAa/F,SAASzc,OAAQojB,IAAM,CAClDhjB,IAAAA,EAAMoiB,EAAa/F,SAAS2G,GAC5B9e,EAAQye,EAAiB3iB,GACzBuE,GAAAA,MAAMC,QAAQN,GAIT,IAAA,IAAId,EAAI,EAAGA,EAAIc,EAAMtE,OAAQwD,IAC9B2f,EAAMljB,KAAKyiB,EAActiB,EAAKkE,EAAMd,GAAImf,SAG5CQ,EAAMljB,KAAKyiB,EAActiB,EAAKkE,EAAOqe,IAIzCQ,OAAAA,EAAMnjB,OACCqd,OAAO4D,GAAY,IAAM5D,OAAO8F,EAAM7B,KAAK,KAAO,IAElD,IAIX+B,EAA8B,mBAAX9L,QAAoD,iBAApBA,OAAOmE,SAAwB,SAAUrc,GAAc,cAAOA,GAAS,SAAUA,GAAcA,OAAAA,GAAyB,mBAAXkY,QAAyBlY,EAAIyB,cAAgByW,QAAUlY,IAAQkY,OAAO/P,UAAY,gBAAkBnI,GAExQ,SAASikB,EAAqB3C,GAAWhc,GAAAA,MAAMC,QAAQ+b,GAAM,CAAO,IAAA,IAAI3hB,EAAI,EAAG4hB,EAAOjc,MAAMgc,EAAI3gB,QAAShB,EAAI2hB,EAAI3gB,OAAQhB,IAAO4hB,EAAK5hB,GAAK2hB,EAAI3hB,GAAa4hB,OAAAA,EAAsBjc,OAAAA,MAAMkc,KAAKF,GAY5L,IAAI4C,EAAqC,KAOrCC,EAAiB,SAAwBC,GACrCF,GAAY,MAAZA,GAKgB,OAHhBA,EAAWla,SAASqa,cAAc,0BAGZ,CAGdC,IAAAA,EAAOta,SAASsa,MAAQta,SAASua,qBAAqB,QAAQ,IAClEL,EAAWla,SAAS1J,cAAc,UAEzBC,KAAO,WAChB2jB,EAASjd,aAAa,iBAAkB,IACxCqd,EAAKxf,YAAYof,GAIrBM,IAAAA,EAAQN,EAASO,YAAcP,EAASM,MAExCA,GAAAA,EAAME,WAAY,CACdC,IAAAA,EAAWH,EAAMJ,SAASzjB,OAC9ByjB,EAAS3R,QAAQ,SAAUmS,GACnB,IACAJ,EAAME,WAAWE,EAAMD,GACvBA,GAAY,EACd,MAAOzd,YAKbgd,EAASW,WAAaX,EAASW,WAAa,IAAMT,EAASnC,KAAK,KAMpEI,EAAiB,CAKjByC,WAAY,WAYDA,OAXEA,SAAAA,EAAWpC,GACZpd,OAAAA,MAAMC,QAAQmd,GACPA,EAAI5N,IAAIgQ,GAAY7C,KAAK,KACuC,iBAAhD,IAARS,EAAsB,YAAcsB,EAAUtB,KAC7DqC,GAAgBrC,EAAIsC,IAAK,aAAc,CAACtC,IAAM,GACvC,IAAM1E,OAAO0E,EAAIoC,YAAc,KAE/BpC,GARP,GAmCZuC,cAAe,WAyCJA,OAxCEA,SAAAA,EAAcvC,EAAKN,GACpB9c,GAAAA,MAAMC,QAAQmd,GACPA,OAAAA,EAAI5N,IAAI,SAAUgE,GACdmM,OAAAA,EAAcnM,EAAGsJ,KACzBH,KAAK,KACL,GAAoE,iBAAhD,IAARS,EAAsB,YAAcsB,EAAUtB,IAAoB,CAK7Ezc,IAAAA,EAAO,YAAc+X,OAAOiD,EAAWyB,IAIvCwC,EAAW,cAAgBjf,EAAO,IAoB/BA,OAbHyc,aAAexF,EACfwF,EAAIjQ,QAAQ,SAAU0S,EAAQC,GAC1BF,GAAYhD,EAAYkD,EAAQ,CAACD,GAAS/C,EAAkBC,GAAgB,GAAOJ,KAAK,MAG5FtJ,OAAO8E,KAAKiF,GAAKjQ,QAAQ,SAAU1R,GAC/BmkB,GAAYhD,EAAYnhB,EAAK,CAAC2hB,EAAI3hB,IAAOqhB,EAAkBC,GAAgB,GAAOJ,KAAK,MAK/FoD,GAAuBpf,EAAM,CAF7Bif,GAAY,MAILjf,EAEAyc,OAAAA,GArCJ,IA+Cf4C,EAAkB,GAGlBC,EAAmC,GAKnCC,IAAc,EAEdH,GAAyB,SAAgCtkB,EAAK0kB,GAC1DC,IAAAA,EAEAJ,IAAAA,EAAgBvkB,GAAhBukB,CAIA,IAACE,GAAa,CAGV,GAAoB,oBAAbxb,SACD,MAAA,IAAIgD,MAAM,kDAKpBwY,IAAc,GACTG,EAAAA,EAAAA,SAAAA,KAGRD,EAAmBH,GAAiB3kB,KAAKyN,MAAMqX,EAAkBzB,EAAqBwB,IACvFH,EAAgBvkB,IAAO,IAGvBgkB,GAAkB,SAAyBhkB,EAC7C6gB,EACAgE,EACAtD,GAEMF,IAAAA,EAA6C1hB,UAAUC,OAAS,QAAsBgE,IAAjBjE,UAAU,GAAmBA,UAAU,GAAK,GAEjH4kB,IAAAA,EAAgBvkB,GAAhBukB,CAIAtD,IAAAA,EAAYE,EAAYN,EAAUgE,EAAaxD,EAAkBC,EAAgBC,GAErF+C,GAAuBtkB,EAAKihB,KAG5B6D,GAAQ,WACRN,EAAkB,GAClBD,EAAkB,GAClBE,IAAc,EACdtB,EAAW,MAGX4B,GAAoB,WACbP,OAAAA,GAGPQ,GAAiB,WACbP,GAAAA,GACM,MAAA,IAAIxY,MAAM,yCAEpBwY,IAAc,GAGdQ,GAAe,WACfR,IAAc,EACVS,IAAAA,EAAMV,EAEHU,OADPV,EAAkB,GACXU,GAGPC,GAAgB,WACTF,OAAAA,KAAe/D,KAAK,KAG3B0D,GAAkB,WACdvB,IAAAA,EAAW4B,KACX5B,EAASzjB,OAAS,GAClBwjB,EAAeC,IAoSvB,QAAA,gBAAA,GAhSA,IAAI+B,GAAwB,WACjBxN,OAAAA,OAAO8E,KAAK6H,IAGnBc,GAAwB,SAA+BC,GACvDA,EAAW5T,QAAQ,SAAUoH,GACzByL,EAAgBzL,IAAa,KAIjCyM,GAA0B,SAASA,EAAwBC,EAC7DC,EACAC,EACA9lB,GAEO,IAAA,IAAIhB,EAAI,EAAGA,EAAI4mB,EAAiB5lB,OAAQhB,GAAK,EAG1C4mB,EAAiB5mB,KACb2F,MAAMC,QAAQghB,EAAiB5mB,IAE/BgB,GAAU2lB,EAAwBC,EAAiB5mB,GAAI6mB,EAAeC,EAAgB9lB,IAEtF6lB,EAAc5lB,KAAK2lB,EAAiB5mB,GAAG+mB,OACvCD,EAAe7lB,KAAK2lB,EAAiB5mB,GAAGgnB,aACxChmB,GAAU4lB,EAAiB5mB,GAAGinB,OAInCjmB,OAAAA,GAaPkmB,GAAwB,SAA+BvE,EACzDiE,EACAnE,GAEMoE,IAAAA,EAAgB,GAChBC,EAAiB,GAIjB9lB,EAAS2lB,GAAwBC,EAAkBC,EAAeC,EAAgB,GAGlFD,GAAyB,IAAzBA,EAAc7lB,OACP,MAAA,GAGPkZ,IAAAA,OAAY,EASTA,OAPHA,EAAqC,IAAzB2M,EAAc7lB,OAAe,IAAMqd,OAAOwI,EAAc,IAAM,IAAMxI,OAAO+C,EAAWyF,EAAcvE,SAAWjE,QAAQrd,EAAS,IAAIqgB,SAAS,KAK7J+D,GAAgBlL,EAAW,IAAMmE,OAAOnE,GAAY4M,EAAgBnE,EAAcF,GAE3EvI,GAcPiN,GAAmB,SAA0BC,EAAoBhmB,GAC1Did,OAAAA,OAAOjd,GAAO,IAAMid,OAAO+C,EAAWgG,KAQ7CC,GAAgB,WACT,OAAwCjG,GAG/CkG,GAASD,KAETE,GAAa,CACbzD,OAAQ,WAoBGA,OAnBEA,SAAO0D,GAIP,IAHDC,IAAAA,EAAwB,GACxB3J,EAAO9E,OAAO8E,KAAK0J,GAEdxnB,EAAI,EAAGA,EAAI8d,EAAK9c,OAAQhB,GAAK,EAAG,CACjCoB,IAAAA,EAAM0c,EAAK9d,GACX+iB,EAAMyE,EAAgBpmB,GACtBsmB,EAAYlG,KAAKC,UAAUsB,GAE/B0E,EAAsBrmB,GAAO,CACzB6lB,KAAMS,EAAU1mB,OAChB+lB,MAAOO,GAAOI,EAAWtmB,GACzB4lB,YAAajE,GAId0E,OAAAA,GAjBP,GAsBRE,UAAW,WAOAA,OANEA,WACDC,IAAAA,EAAsC7mB,UAAUC,OAAS,QAAsBgE,IAAjBjE,UAAU,GAAmBA,UAAU,GAAK,GAE9G0lB,GAAsBmB,IAJnB,IAqBXC,GAAqC,oBAAXjU,OAAyB,KAAO,CAC1DkU,aAAc,WAgBHA,OAfEA,SAAaC,GAMX,OALP7B,KACAE,KAIO,CACH4B,KAJOD,IAKPE,IAAK,CACDC,QALS3B,KAMTqB,mBAAoBpB,QAXtB,IAyBd2B,GAA8D,KAoDlE,SAASC,GAAYzF,EACnBF,GAES,MAAA,CACH8E,WAAYvO,OAAO5Y,OAAO,GAAImnB,GAAY,CAkBtCc,OAAQ,WAgBGA,OAfEA,SAAOC,GACRC,IAAAA,EAA4BD,EAE/BnT,IAAI,SAAUqT,GACJA,OAAAA,EAAUC,kBAIpB5U,OAAO,SAAUmP,GACPA,OAAAA,IAGJoF,OAAAA,GAAYzF,EAAcF,EAAiBzU,OAAOua,KAbzD,KAoBZV,iBAAkBA,GAClBM,oBAAqBA,GAErBO,OAAQ,WAKGA,OAJEA,SAAOC,GACZrB,GAASqB,EAAevH,EAAa+F,IAFrC,GAORc,IAAK,WASMA,OAREA,WACA,IAAA,IAAIhB,EAAOlmB,UAAUC,OAAQ4lB,EAAmBjhB,MAAMshB,GAAO2B,EAAO,EAAGA,EAAO3B,EAAM2B,IACrFhC,EAAiBgC,GAAQ7nB,UAAU6nB,GAGhC1B,OAAAA,GAAsBvE,EAAciE,EAAkBnE,IANhE,IAcb,IAAIE,IAAe,EAEfkG,GAAYT,GAAYzF,GAAcZ,GAEtC+G,GAAeD,GAAUtB,WACzBwB,GAAqBF,GAAUhB,iBAC/BmB,GAAwBH,GAAUV,oBAClCF,GAAMY,GAAUZ,IAChBS,GAASG,GAAUH,OAJvB,QAAA,OAAA,GAAA,QAAA,IAAA,GAAA,QAAA,oBAAA,GAAA,QAAA,iBAAA,GAAA,QAAA,WAAA;;ACtmCO,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,YAAA,QAAA,OAAA,QAAA,SAAA,QAAA,MAAA,QAAA,SAAA,QAAA,gBAAA,EAhCP,IAEY,EAIA,EAMA,EAWA,EAIA,EA3BZ,EAAA,QAAA,aAgCO,QAAA,WAAA,EA9BP,SAAY,GACV,EAAA,UAAA,wCADF,CAAY,IAAA,QAAA,WAAA,EAAU,KA8Bf,QAAA,SAAA,EA1BP,SAAY,GACV,EAAA,EAAA,MAAA,IAAA,QACA,EAAA,EAAA,MAAA,IAAA,QACA,EAAA,EAAA,WAAA,IAAA,aAHF,CAAY,IAAA,QAAA,SAAA,EAAQ,KA0Bb,QAAA,MAAA,EApBP,SAAY,GACV,EAAA,EAAA,eAAA,KAAA,iBACA,EAAA,EAAA,mBAAA,KAAA,qBACA,EAAA,EAAA,kBAAA,KAAA,oBACA,EAAA,EAAA,mBAAA,IAAA,qBACA,EAAA,EAAA,iBAAA,GAAA,mBACA,EAAA,EAAA,aAAA,IAAA,eACA,EAAA,EAAA,eAAA,IAAA,iBACA,EAAA,EAAA,mBAAA,IAAA,qBARF,CAAY,IAAA,QAAA,MAAA,EAAK,KAoBV,QAAA,SAAA,EATP,SAAY,GACV,EAAA,aAAA,QADF,CAAY,IAAA,QAAA,SAAA,EAAQ,KASb,QAAA,OAAA,EALP,SAAY,GACV,EAAA,EAAA,eAAA,GAAA,iBACA,EAAA,EAAA,SAAA,GAAA,WAFF,CAAY,IAAA,QAAA,OAAA,EAAM,KAKX,MAAM,EAAc,EAAW,WAAA,OAAO,CAC3C,MAAO,CACL,OAAQ,QAEV,MAAO,CACL,MAAO,QAET,KAAM,CACJ,QAAS,OACT,cAAe,MACf,SAAU,WACV,SAAU,UAEZ,KAAM,CACJ,QAAS,OACT,cAAe,SACf,SAAU,WACV,SAAU,YAjBP,QAAA,YAAA;;ACkC6B,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,kBAAA,EAAA,QAAA,wBAAA,QAAA,qBAAA,QAAA,oBAAA,EAhEpC,IAEY,EAFZ,EAAA,QAAA,UAoBM,SAAU,EAAkB,EAAc,GACxC,MAAA,EAAY,EAAK,oBACjB,EAAe,EAAQ,oBAEzB,IAAA,EAAY,EACV,MAAA,EAAyC,GACxC,OAAM,CACP,IAAA,EAAQ,EAAU,QAAQ,EAAc,GACxC,IAAW,IAAX,EACK,OAAA,EAET,EAAc,KAAK,CAAC,EAAO,EAAQ,EAAQ,SAC3C,EAAY,EAAQ,EAAQ,QAgCI,QAAA,eAAA,EA9DpC,SAAY,GACV,EAAA,EAAA,mBAAA,GAAA,qBACA,EAAA,EAAA,uBAAA,GAAA,yBAFF,CAAY,IAAA,QAAA,eAAA,EAAc,KAoCpB,MAAO,EACX,YAAqB,EAA2B,GAA3B,KAAA,QAAA,EAA2B,KAAA,YAAA,EAExC,KAAA,QAAwD,KAChE,iBAAiB,GAQR,OAPF,KAAK,UACH,KAAA,QAAU,IAAI,IACd,KAAA,QAAQ,aAAa,IAClB,MAAA,EAAQ,EAAkB,EAAM,KAAM,KAAK,aAC5C,KAAA,QAAS,IAAI,EAAwB,IAAjB,EAAM,OAAe,KAAO,MAGlD,KAAK,QAAQ,IAAI,IAAU,MAcF,QAAA,qBAAA,EAA9B,MAAO,EACX,YAAqB,EAAiC,GAAjC,KAAA,WAAA,EAAiC,KAAA,eAAA,EAE9C,KAAA,QAAyC,KACzC,aACF,GAAgB,MAAhB,KAAK,QAAiB,CAClB,MAAA,EAAmC,GACnC,EAAe,IAAI,IACnB,EAAQ,CAAC,EAAwB,KAC/B,MAAA,KAAC,GAAQ,EACX,GAAA,KAAK,eAAe,iBAAiB,EAAK,OAAQ,CAC9C,MAAA,EAAoB,IAAI,EAAJ,KACxB,IAAI,EAAJ,KAAS,EAAM,MAAO,GACtB,IAAI,EAAJ,KAAS,EAAM,IAAM,EAAM,MAAO,IAEpC,EAAa,IAAI,EAAM,EAAQ,QAC/B,EAAQ,KAAK,CAAC,kBAAA,EAAmB,KAAA,IAGnC,EAAM,SAAS,QAAQ,IACrB,EAAM,EAAO,EAAQ,MAInB,EAAS,KAAK,WAAW,YAC3B,EAAO,OAAS,GAClB,EAAO,GAAG,QAAQ,GAAS,EAAM,EAAO,IAGrC,KAAA,QAAU,CAAC,QAAA,EAAS,aAAA,GAEpB,OAAA,KAAK,QAGd,QACS,OAAA,KAAK,aAAa,QAAQ,OAGnC,QAAQ,GACA,MAAA,EAAS,KAAK,aAAa,aAAa,IAAI,GAC3C,YAAW,IAAX,EAAuB,KAAO,EAGvC,GAAG,GACK,MAAA,EAAU,KAAK,aAAa,QAC9B,GAAA,EAAQ,GAAK,GAAS,EAAQ,OAC1B,MAAA,IAAI,eAAe,8BAAkC,EAAQ,mBAE9D,OAAA,EAAQ,IAhDiB,QAAA,wBAAA;;ACkHpC,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,WAAA,QAAA,6BAAA,QAAA,0BAAA,EApLA,IAAA,EAAA,QAAA,aACA,EAAA,QAAA,UACA,EAAA,QAAA,gBACA,EAAA,QAAA,iBACA,EAAA,QAAA,WACA,EAAA,QAAA,yBAEA,EAAA,QAAA,qCACA,EAAA,QAAA,kBACA,EAAA,QAAA,gBACA,EAAA,QAAA,eAEA,SAAS,EAAgB,GACvB,EAAG,kBAGE,MAAM,GAAuB,EAA2C,EAAA,eAAA,MAoK/E,QAAA,qBAAA,EAlKO,MAAM,EAA+B,EAAE,SAAA,MACtC,MAAA,GAAqB,EAA3B,EAAA,yBACM,EAA0B,EAAqB,EAAmB,QAAU,KAC5E,GAAiB,EAAQ,EAAA,SAAA,EAAR,oBACjB,GAAc,EAAQ,EAAA,SAAA,EAAR,iBAEd,GAAgB,EAAQ,EAAA,SAAA,IACvB,GAAY,GAAyC,IAAvB,EAAY,OAGxC,IAAI,EAAJ,qBAAyB,EAAS,GAFhC,KAGR,CAAC,EAAgB,EAAa,IAG/B,OAAA,EAAC,EAAA,GAAA,EAAqB,SAAQ,CAAC,MAAO,GAAgB,IAoJ1D,QAAA,6BAAA,EAzIO,MAAM,GAAa,EACxB,EAAA,MAAA,EAAE,WAAA,EAAY,YAAA,EAAa,WAAA,EAAY,WAAA,MAC/B,MAAA,GAAQ,EAAd,EAAA,YACM,EAAQ,EAAS,GACjB,GAAiB,EAAQ,EAAA,SAAA,EAAR,oBACjB,GAAc,EAAQ,EAAA,SAAA,EAAR,iBACd,EAAiB,EAAgB,gBAAA,IACjC,EAAoB,EAAmB,mBAAA,IAEvC,GAAU,EACb,EAAA,aAAA,IACO,MAAA,EAAS,EAAG,OAA4B,MAC9C,EAAe,IAEjB,CAAC,IAGG,GAAW,EAAgC,EAAA,QAAA,MAE3C,GAAQ,EAAY,EAAA,aAAA,IAAM,GAAkB,GAAQ,CAAC,IAErD,GAAyB,EAC5B,EAAA,aAAA,IACK,EAAG,SACL,IAEA,KAGJ,CAAC,EAAY,IAGT,GAAY,EACf,EAAA,aAAA,IACC,EAAG,kBAGY,WAAX,EAAG,KACL,GAAkB,GAGL,UAAX,EAAG,KACL,EAAuB,GAGX,KAAV,EAAG,MAAe,EAAG,SAAW,EAAG,WACjC,EAAS,SAEX,EAAS,QAAQ,SAMnB,EAAG,mBAGP,CAAC,EAAmB,IAgClB,OA7BM,EAAA,EAAA,WAAA,KACF,MAAA,EAAmB,IAET,KAAV,EAAG,MAAe,EAAG,SAAW,EAAG,WAErC,EAAG,iBAEC,EAAS,QAEX,EAAS,QAAQ,UAIjB,GAAkB,GAClB,sBAAsB,KAChB,EAAS,SACX,EAAS,QAAQ,cAQpB,OADP,OAAO,iBAAiB,UAAW,GAC5B,KACL,OAAO,oBAAoB,UAAW,KAEvC,CAAC,IAEC,GAGH,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,cACxB,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,OAAK,OAChC,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,kBACzB,EAAA,EAAA,GAAA,QAAA,CACE,WAAW,EAAI,EAAA,KAAA,EAAM,OACrB,MAAO,EACP,QAAS,EACT,UAAW,EACX,QAAS,EACT,WAAY,EACZ,IAAK,KAGM,MAAd,IACC,EAAC,EAAA,GAAA,EAAD,SAAS,MACP,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,cACT,MAAf,EAAsB,IAAM,EAAc,EAD7C,IACiD,IAEjD,EAAA,EAAA,GAAA,SAAA,CAAQ,WAAW,EAAI,EAAA,KAAA,EAAM,KAAM,EAAM,QAAS,QAAS,GAAU,OAGrE,EAAA,EAAA,GAAA,SAAA,CAAQ,WAAW,EAAI,EAAA,KAAA,EAAM,KAAM,EAAM,QAAS,QAAS,GAAU,QAKzE,EAAA,EAAA,GAAA,MAAA,CACE,WAAW,EAAI,EAAA,KAAA,EAAM,MACrB,QAAS,EACT,MAAM,KACN,OAAO,KACP,QAAQ,YACR,KAAK,OACL,MAAM,+BAEN,EAAA,EAAA,GAAA,OAAA,CACE,EAAE,mEACF,OAAQ,EAAM,wBAxCM,OAgDhC,QAAA,WAAA,EAAA,MAAM,GAAW,EAAU,EAAA,WAAA,GACzB,EAAW,WAAA,OAAO,CAChB,WAAY,CACV,SAAU,WACV,IAAK,EACL,MAAO,GACP,OAAQ,EAAM,MAAA,eACd,MAAO,IACP,YAAa,EACb,YAAa,EAAM,kBACnB,YAAa,QACb,SAAU,EAAS,SAAA,MACnB,UAAW,aACX,WAAY,EAAM,oBAClB,MAAO,EAAM,kBACb,QAAS,OACT,WAAY,UAEd,eAAgB,CACd,WAAY,EACZ,SAAU,EACV,QAAS,QAEX,MAAO,CACL,MAAO,OACP,OAAQ,OACR,WAAY,OACZ,SAAU,EAAS,SAAA,MACnB,cAAe,EAAM,MAAA,mBACrB,MAAO,EAAM,kBACH,SAAA,CACR,OAAQ,OACR,QAAS,QAEI,cAAA,CACb,MAAO,EAAM,kBACb,WAAY,EAAM,wBAGtB,YAAa,CACX,cAAe,UAEjB,KAAM,CACJ,WAAY,EACZ,cAAe,SACf,OAAQ,OACR,OAAQ,kBACR,SAAU,EAAS,SAAA,OAErB,OAAQ,CACN,QAAS,SACT,WAAY,OACZ,OAAQ,OACR,QAAS,EACC,SAAA,CACR,QAAS;;ACpLhB,aAjDD,SAAS,EAAY,GACZ,OAAA,EAAM,QAAQ,sBAAuB,CAAC,EAAQ,KAC7C,MAAA,EAAS,SAAS,EAAO,IACxB,OAAA,OAAO,aAAa,KASzB,SAAU,EAA0B,GAClC,MAAA,EAAQ,EAAS,MAAM,MACzB,IAAC,EAAM,OAAQ,OAAO,KAItB,GAD4B,KAA5B,EAAM,EAAM,OAAS,IAAW,EAAM,OACrC,EAAM,OAAQ,OAAO,KAEpB,MAAA,EAAM,IAAI,IACV,EAAW,eACX,EAAU,yBAEX,IAAA,MAAM,KAAQ,EAAO,CAElB,MAAA,EAAW,EAAS,KAAK,GAC3B,GAAA,EAAU,CACZ,EAAI,qBAAqB,EAAS,MAAO,EAAY,EAAS,KAC9D,SAII,MAAA,EAAU,EAAQ,KAAK,GACzB,IAAA,EAKG,OAAA,KAJL,EAAI,IAAI,EAAQ,GAAI,EAAY,EAAQ,KAOpC,OAAA,GACD,EAAI,IAAI,EAAM,MAIZ,CAAC,KAAM,EAAI,IAAI,EAAM,OAHnB,KAKZ,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,0BAAA;;ACzCD,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,UAAA,EAdA,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,aACA,EAAA,QAAA,WACA,EAAA,QAAA,kBAMM,SAAU,EAAU,GAClB,MAAA,EAAQ,GAAS,EAAD,EAAA,aACf,OAAA,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,WAAY,MAAO,CAAC,gBAAiB,EAAM,SAG/E,MAAM,GAAW,EAAU,EAAA,WAAA,GACzB,EAAW,WAAA,OAAO,CAChB,UAAW,CACT,SAAU,WACV,KAAM,EACN,QAAS,eACT,cAAe,SACf,YAAa,QACb,oBAAqB,EAAM,mBAC3B,MAAO,EAAS,SAAA,MAAQ,EACxB,OAAQ,EAAS,SAAA,MAAQ;;ACGxB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,wBAAA,EAxBP,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,gBAuBO,MAAM,EAAqB,EAChC,MAAA,EACA,KAAA,EACA,YAAA,EACA,UAAA,EACA,mBAAA,MAEM,MAAC,EAAc,IAAmB,EAAwB,EAAA,UAAA,OACzD,EAAsB,IAA2B,EAAiB,EAAA,UAAA,GAEnE,GAAc,EAA8B,EAAA,QAAA,MAE5C,EAAyB,MAAT,EAAe,QAAU,SACzC,EAAqB,MAAT,EAAe,OAAS,MACpC,EAAiC,MAAT,EAAe,aAAe,YAGtD,EAAS,EACX,EAAM,OAAO,CAAC,EAAG,EAAG,IAAO,EAAI,EAAqB,EAAI,EAAE,KAAO,EAAI,GACrE,EACE,GAAgB,EAAsB,EAAA,QAAA,GAEtC,GAAmB,EACtB,EAAA,aAAA,IACK,EACF,sBAAsB,KACpB,EAAgB,EAAS,wBAAwB,IACpB,MAAzB,EAAc,UAChB,EAAS,SAAS,CAAE,CAAA,GAAY,EAAc,UAC9C,EAAc,QAAU,QAI5B,EAAgB,MAElB,EAAY,QAAU,GAExB,CAAC,EAAiB,EAAe,IAG7B,GAAkC,EAAQ,EAAA,SAAA,KAC1C,GAAuB,MAAvB,EAAY,SAAmC,MAAhB,GAAgD,MAAxB,EAClD,OAAA,KAKH,MAAA,EAAO,EAAuB,EAAe,EAC7C,EAAO,EAAuB,EAAe,EAAe,EAE9D,IAAA,EAAQ,EACR,EAAsB,EAEtB,EAAI,EACD,KAAA,EAAI,EAAM,OAAQ,IAAK,CAIxB,GAFJ,EAAsB,GACtB,GAFa,EAAM,GAEL,OACD,EACX,MAIE,MAAA,EAAoB,EAEnB,KAAA,EAAI,EAAM,OAAQ,IAAK,CAGxB,IADJ,GADa,EAAM,GACL,OACD,EACX,MAMG,MAAA,CACL,kBAAA,EACA,iBAJuB,KAAK,IAAI,EAAG,EAAM,OAAS,GAKlD,oBAAA,IAED,CAAC,EAAc,EAAsB,IAElC,GAAY,EAAQ,EAAA,SAAA,IAAM,EAAM,OAAO,CAAC,EAAG,IAAM,EAAI,EAAE,KAAM,GAAI,CAAC,IAElE,GAAmB,EAAY,EAAA,aAAA,KACR,MAAvB,EAAY,SACd,EAAwB,EAAY,QAAQ,KAE7C,CAAC,KAEM,EAAA,EAAA,WAAA,KACF,MAAA,EAAiB,KACM,MAAvB,EAAY,SACd,EAAgB,EAAY,QAAQ,wBAAwB,KAKzD,OADP,OAAO,iBAAiB,SAAU,GAC3B,KACL,OAAO,oBAAoB,SAAU,KAEtC,CAAC,IAEE,MAAA,GAAe,EAAQ,EAAA,SAAA,IACpB,EACH,EAAY,EAAY,kBAAmB,EAAY,kBACvD,KACH,CAAC,EAAa,IAEX,GAAU,EAAQ,EAAA,SAAA,KAEpB,EAAA,EAAA,GAAA,MAAA,CAAK,MAAO,CAAC,OAAQ,KACnB,EAAA,EAAA,GAAA,MAAA,CAAK,MAAO,CAAC,yBAAyB,MAAA,OAAW,EAAX,EAAa,sBAAuB,SACvE,IAIN,CAAC,EAAa,EAAc,IAG7B,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,UAAW,EAAW,IAAK,EAAkB,SAAU,GACzD,IAzHA,QAAA,mBAAA;;AC6YA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,0BAAA,QAAA,sBAAA,EAxaP,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,aAEA,EAAA,QAAA,gBACA,EAAA,QAAA,WACA,EAAA,QAAA,gBACA,EAAA,QAAA,0BACA,EAAA,QAAA,wBACA,EAAA,QAAA,iBACA,EAAA,QAAA,gBACA,EAAA,QAAA,mBACA,EAAA,QAAA,gBACA,EAAA,QAAA,kBACA,EAAA,QAAA,gBASA,EAAA,QAAA,eAOA,SAAS,EAAY,GACb,MAAA,EAAQ,GAAS,EAAD,EAAA,aAGpB,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,eACxB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,mBAAoB,MAAO,CAAC,SAAU,EAAM,YAS5E,SAAS,EAAS,GACV,MAAA,GAAQ,EAAd,EAAA,YACM,EAAQ,EAAS,IAEjB,gBAAC,GAAmB,EACpB,EACJ,IAAoB,EAAc,cAAA,UAAY,EAAM,eAAiB,EAAM,iBACvE,EACJ,IAAoB,EAAc,cAAA,WAAa,EAAM,eAAiB,EAAM,iBAG5E,OAAA,EAAA,EAAA,GAAA,MAAA,CACE,MAAM,IACN,OAAO,KACP,QAAQ,WACR,KAAK,OACL,MAAM,6BACN,WAAW,EAAI,EAAA,KAAA,EAAM,YAErB,EAAA,EAAA,GAAA,OAAA,CAAM,EAAE,kBAAkB,KAAM,KAChC,EAAA,EAAA,GAAA,OAAA,CAAM,EAAE,kBAAkB,UAAU,8BAA8B,KAAM,KAe9E,SAAS,EACP,EACA,EACA,GAEM,MAAA,EAA0B,GAC5B,IAAA,EAAO,EACN,IAAA,IAAI,KAAS,EAChB,EAAM,KAAK,EAAK,MAAM,EAAM,EAAM,KAClC,EAAM,MAAK,EAAA,EAAA,GAAA,OAAA,CAAM,UAAW,GAAuB,EAAK,MAAM,EAAM,GAAI,EAAM,MAC9E,EAAO,EAAM,GAIR,OAFP,EAAM,KAAK,EAAK,MAAM,KAEf,EAAA,EAAA,GAAA,OAAA,KAAO,GAGhB,MAAM,EAAsB,EAC1B,MAAA,EACA,cAAA,EACA,QAAA,EACA,MAAA,EACA,cAAA,EACA,iBAAA,EACA,oBAAA,MAEM,MAAA,EAAQ,GAAS,EAAD,EAAA,aAEhB,EAAc,EAAM,iBACpB,EAAa,EAAM,gBACnB,EAAa,IAAQ,EAAe,EAAQ,wBAC5C,EAAY,IAAQ,EAAc,EAAQ,wBAE1C,EAAW,IAAU,EAKzB,OAAA,EAAA,EAAA,GAAA,KAAA,CACE,OAAQ,IACR,QAAS,EAAiB,KAAK,KAAM,GACrC,WAAW,EACT,EAAA,KAAA,EAAM,SACN,EAAQ,GAAK,GAAK,EAAM,aACxB,GAAY,EAAM,oBAGpB,EAAA,EAAA,GAAA,KAAA,CAAI,WAAW,EAAI,EAAA,KAAA,EAAM,cACtB,EAAQ,YAAY,GADvB,MACuC,EAAc,EAAA,eAAA,GADrD,KAEE,EAAC,EAAA,GAAA,EAAW,CAAC,KAAM,MAErB,EAAA,EAAA,GAAA,KAAA,CAAI,WAAW,EAAI,EAAA,KAAA,EAAM,cACtB,EAAQ,YAAY,GADvB,MACsC,EAAc,EAAA,eAAA,GADpD,KAEE,EAAC,EAAA,GAAA,EAAW,CAAC,KAAM,MAErB,EAAA,EAAA,GAAA,KAAA,CAAI,MAAO,EAAM,KAAM,WAAW,EAAI,EAAA,KAAA,EAAM,YAC1C,EAAC,EAAA,GAAA,EAAD,UAAU,CAAC,MAAO,EAAoB,KACrC,EACG,EACE,EAAM,KACN,GACA,EAAI,EAAA,KAAA,EAAM,QAAS,GAAY,EAAM,kBAEvC,EAAM,QAiBL,GAAmB,EAC9B,EAAA,MAAA,EACE,QAAA,EACA,WAAA,EACA,cAAA,EACA,cAAA,EACA,iBAAA,EACA,oBAAA,EACA,YAAA,EACA,eAAA,MAEM,MAAA,EAAQ,GAAS,EAAD,EAAA,aAEhB,GAAc,EAClB,EAAA,aAAA,CAAC,EAAkB,KAGb,GAFJ,EAAG,iBAEC,EAAW,OAAS,EAEtB,EAAc,CACZ,MAAA,EACA,UACE,EAAW,YAAc,EAAc,cAAA,UACnC,EAAc,cAAA,WACd,EAAc,cAAA,iBAId,OAAA,GACD,KAAA,EAAU,UAAA,YACb,EAAc,CAAC,MAAA,EAAO,UAAW,EAAc,cAAA,YAC/C,MAEG,KAAA,EAAU,UAAA,KAIV,KAAA,EAAU,UAAA,MACb,EAAc,CAAC,MAAA,EAAO,UAAW,EAAc,cAAA,eAMvD,CAAC,EAAY,IAGT,GAAkB,EAAW,EAAA,YAAA,EAAX,qBAElB,GAAc,EAClB,EAAA,aAAA,CAAC,EAAoB,KACf,IAAC,EAAiB,OAAO,KAEvB,MAAA,EAAsB,GAEvB,IAAA,IAAI,EAAI,EAAY,GAAK,EAAW,IAAK,CACtC,MAAA,EAAQ,EAAgB,QAAQ,GAChC,EAAQ,EAAgB,uBAAuB,GACrD,EAAK,KACH,EAAoB,CAClB,MAAA,EACA,cAAwB,MAAT,EAAgB,KAAO,EACtC,MAAO,EACP,QAAS,EACT,cAAe,EACf,iBAAkB,EAClB,oBAAqB,KAuBpB,OAlBa,IAAhB,EAAK,SACH,EACF,EAAK,MACH,EAAA,EAAA,GAAA,KAAA,MACE,EAAA,EAAA,GAAA,KAAA,CAAI,WAAW,EAAI,EAAA,KAAA,EAAM,aAAzB,gCACgC,EADhC,QAMJ,EAAK,MACH,EAAA,EAAA,GAAA,KAAA,MACE,EAAA,EAAA,GAAA,KAAA,CAAI,WAAW,EAAI,EAAA,KAAA,EAAM,aAAW,yBAMrC,EAAA,EAAA,GAAA,QAAA,CAAO,WAAW,EAAI,EAAA,KAAA,EAAM,YAAa,IAElD,CACE,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EAAM,WACN,EAAM,YAIJ,GAAwB,EAC5B,EAAA,SAAA,IACqB,MAAnB,EACI,GACA,EAAgB,QAAQ,IAAI,IAAM,CAAC,KAAM,EAAM,MAAA,gBACrD,CAAC,IAGG,GAAe,EAAa,EAAA,aAAA,GAAmB,EAAY,EAAU,UAAA,MAAO,GAAK,CACrF,IAEI,GAAc,EAAa,EAAA,aAAA,GAAmB,EAAY,EAAU,UAAA,KAAM,GAAK,CACnF,IAEI,GAAoB,EACvB,EAAA,aAAA,GAAmB,EAAY,EAAU,UAAA,YAAa,GACvD,CAAC,IAID,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAY,YAAA,KAAM,EAAM,oBAC1C,EAAA,EAAA,GAAA,QAAA,CAAO,WAAW,EAAI,EAAA,KAAA,EAAM,aAC1B,EAAA,EAAA,GAAA,QAAA,CAAO,WAAW,EAAI,EAAA,KAAA,EAAM,eAC1B,EAAA,EAAA,GAAA,KAAA,MACE,EAAA,EAAA,GAAA,KAAA,CAAI,WAAW,EAAI,EAAA,KAAA,EAAM,aAAc,QAAS,IAC9C,EAAC,EAAA,GAAA,EAAQ,CACP,gBACE,EAAW,QAAU,EAAU,UAAA,MAAQ,EAAW,UAAY,OAHpE,UAQA,EAAA,EAAA,GAAA,KAAA,CAAI,WAAW,EAAI,EAAA,KAAA,EAAM,aAAc,QAAS,IAC9C,EAAC,EAAA,GAAA,EAAQ,CACP,gBACE,EAAW,QAAU,EAAU,UAAA,KAAO,EAAW,UAAY,OAHnE,SAQA,EAAA,EAAA,GAAA,KAAA,CAAI,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,QAAS,IAC3C,EAAC,EAAA,GAAA,EAAQ,CACP,gBACE,EAAW,QAAU,EAAU,UAAA,YAAc,EAAW,UAAY,OAH1E,mBAWN,EAAC,EAAA,GAAA,EAAD,mBAAmB,CACjB,KAAM,IACN,MAAO,EACP,WAAW,EAAI,EAAA,KAAA,EAAM,YACrB,YAAa,EACb,mBACmB,MAAjB,EAAwB,KAAO,MAAA,OAAe,EAAf,EAAiB,iBAAiB,QAyGtE,QAAA,iBAAA,EAjGP,MAAM,GAAW,EAAU,EAAA,WAAA,GACzB,EAAW,WAAA,OAAO,CAChB,iBAAkB,CAChB,WAAY,EAAM,eAClB,OAAQ,QAEV,WAAY,CACV,UAAW,OACX,UAAW,SACX,SAAU,EACa,sBAAA,CACrB,WAAY,EAAM,gBAES,4BAAA,CAC3B,WAAY,EAAM,iBAClB,aAAc,GACd,oBAAqB,EAAM,iBACjB,SAAA,CACR,WAAY,EAAM,kBAIxB,UAAW,CACT,MAAO,OACP,SAAU,EAAS,SAAA,MACnB,WAAY,EAAM,gBAEpB,YAAa,CACX,0BAA2B,EAAM,mBACjC,UAAW,OACX,MAAO,EAAM,eACb,WAAY,QAEd,SAAU,CACR,SAAU,WACV,IAAK,EACL,YAAa,EAAM,MAAA,aAAe,GAEpC,SAAU,CACR,WAAY,EAAM,eAClB,OAAQ,EAAM,MAAA,cAEhB,aAAc,CACZ,WAAY,EAAM,kBAEpB,iBAAkB,CAChB,WAAY,EAAM,sBAClB,MAAO,EAAM,mBAEf,YAAa,CACX,aAAc,WACd,SAAU,SACV,WAAY,SACZ,SAAU,WACV,UAAW,QACX,aAAc,EAAM,MAAA,aACpB,MAAO,EAAI,EAAM,MAAA,aACjB,SAAU,EAAI,EAAM,MAAA,cAEtB,SAAU,CACR,aAAc,WACd,SAAU,SACV,WAAY,SACZ,MAAO,OACP,SAAU,GAEZ,YAAa,CACX,SAAU,WACV,WAAY,EAAM,MAAA,WAAW,EAAM,aAAa,UAAU,IAAK,QAC/D,OAAQ,EACR,OAAQ,EACR,qBAAsB,EAAI,EAAM,MAAA,kBAChC,MAAO,EAAM,MAAA,cAEf,kBAAmB,CACjB,OAAQ,OACR,SAAU,WACV,WAAY,EAAM,YAClB,MAAO,GAET,QAAS,CACP,0BAA2B,EAAM,kBAEnC,gBAAiB,CACf,YAAa,EAAM,mBAErB,WAAY,CACV,UAAW,SACX,WAAY,WASL,GAA4B,EAAM,EAAA,MAAA,IACvC,MAAA,mBAAC,GAAsB,GACvB,QAAC,EAAD,kBAAU,GAAqB,EACjC,IAAC,EAAS,MAAM,IAAI,MAAM,mBACxB,MAAA,GAAkB,EAAQ,EAAA,SAAA,EAAR,qBAClB,GAAQ,EAAd,EAAA,aACM,aAAC,GAAgB,EACjB,EAAgB,EAAe,EAAa,cAAgB,KAC5D,GAAqB,EAAsB,EAAA,uBAAA,GAC3C,GAAsB,EAA0B,EAAA,2BAAA,CAAC,MAAA,EAAO,mBAAA,IAExD,GAAmB,EAAa,EAAA,aAAA,IACnB,EAAA,iBAAA,iBAAiB,IACjC,IACG,GAAiB,EAAQ,EAAA,SAAA,EAAR,oBACjB,GAAc,EAAQ,EAAA,SAAA,EAAR,iBAGlB,OAAA,EAAC,EAAA,GAAA,EAAgB,CACf,QAAS,EACT,cAAe,EACf,oBAAqB,EACrB,WAAY,EACZ,iBAAkB,EAClB,cAAe,EAAoB,oBAAA,IACnC,eAAgB,EAChB,YAAa,MA1BZ,QAAA,0BAAA;;AC5YgB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,gBAAA,EA1BvB,IAAA,EAAA,QAAA,WACA,EAAA,QAAA,UAyBM,MAAO,EAqFX,YAAoB,GAAA,KAAA,OAAA,EAnFZ,KAAA,OAAuB,GACvB,KAAA,YAAsB,EACtB,KAAA,cAAwB,EAkFxB,MAAA,EAA2B,GAgB5B,KAAA,cAAgB,EAAA,EAYhB,KAAA,YAAc,EAAO,iBAC1B,EAAO,YA5BW,CAAC,EAAoB,KAC/B,MAAA,GAAS,EAAO,EAAA,QAAA,GAChB,EAAyB,CAC7B,KAAA,EACA,OAAA,EACA,SAAU,GACV,MAAO,EACP,IAAK,GAEH,GACF,EAAO,SAAS,KAAK,GAEvB,EAAM,KAAK,IAIM,CAAC,EAAoB,KACtC,QAAQ,OAAO,EAAM,OAAS,GACxB,MAAA,EAAW,EAAM,MAEnB,GADJ,EAAS,IAAM,EACX,EAAS,IAAM,EAAS,OAAU,EAAG,OACnC,MAAA,EAAa,EAAM,OAClB,KAAA,KAAK,OAAO,QAAU,GAAY,KAAK,OAAO,KAAK,IACrD,KAAA,OAAO,GAAY,KAAK,GACxB,KAAA,cAAgB,KAAK,IAAI,KAAK,cAAe,EAAS,IAAM,EAAS,SAMvE,SAAS,KAAK,iBAAgB,KAAK,cAAgB,GA/G1D,iBACS,OAAA,KAAK,YAEd,YACS,OAAA,KAAK,OAEd,uBAAuB,GACd,OAAA,KAAK,OAAO,uBAAuB,GAE5C,mBACS,OAAA,KAAK,cAEd,YAAY,GACH,OAAA,KAAK,OAAO,YAAY,GAGjC,wBAAwB,GAChB,MAAA,EAAW,KAAK,iBA6BhB,EAAU,KAAK,IAAI,EAAG,IAOtB,GAAW,EAAM,EAAA,OAAA,EAAI,KAAK,mBAAoB,EAAW,EAAS,GAEjE,OAAA,EAAM,EAAA,OAAA,EAAe,EAAU,GAMxC,mCAAkC,wBAChC,EADgC,eAEhC,IAKM,MAAA,EAAkB,IAAI,EAAJ,KAAS,KAAK,iBAAkB,KAAK,YAAY,QACnE,EAAQ,KAAK,wBAAwB,EAAwB,KAAK,GAClE,EAAO,EAAwB,KAAK,MAAM,GAC1C,EAAS,EAAK,KAAA,MAClB,EAAwB,OACxB,IAAI,EAAJ,KAAS,EAAG,EAAiB,GAAK,GAClC,EAAK,KAAA,IAAI,EAAK,KAAA,KAAM,EAAgB,MAAM,GAAM,KAAK,IAAI,EAAJ,KAAS,EAAG,MAE5D,OAAA,IAAI,EAAJ,KAAS,EAAQ,EAAwB,KAAK,MAAM,KAlFxC,QAAA,WAAA;;ACkGQ,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,mBAAA,QAAA,2BAAA,EA7H/B,IAAA,EAAA,QAAA,8BACA,EAAA,QAAA,eACA,EAAA,QAAA,gBACA,EAAA,QAAA,gBAEA,EAAA,QAAA,cAEA,EAAA,QAAA,WAEA,MAAM,EAAiB,IASvB,MAAM,EAGJ,YACU,EACA,EACA,GAFA,KAAA,MAAA,EACA,KAAA,OAAA,EACA,KAAA,4BAAA,EALF,KAAA,SAA4B,GAQpC,WACS,OAAA,KAAK,MAEd,YACS,OAAA,KAAK,OAEd,eACS,OAAA,KAAK,MAAM,eAEpB,cACS,OAAA,KAAK,SAEd,YACS,OAAA,KAAK,4BAA8B,EAE5C,4BAA4B,EAAyB,GAC9C,KAAK,OAAO,oBAAoB,IACrC,EAAG,OAIP,MAAM,EAGJ,YAAoB,GACd,GADc,KAAA,SAAA,EAFZ,KAAA,UAAoB,EAGF,IAApB,EAAS,OACL,MAAA,IAAI,MAAM,uBAEd,IAAA,EAAU,EAAA,EACV,GAAY,EAAA,EACZ,EAAS,EAAA,EACT,GAAa,EAAA,EACZ,IAAA,IAAI,KAAS,EAAU,CACrB,KAAA,WAAa,EAAM,eAClB,MAAA,EAAS,EAAM,YACrB,EAAU,KAAK,IAAI,EAAS,EAAO,QACnC,EAAW,KAAK,IAAI,EAAU,EAAO,SACrC,EAAS,KAAK,IAAI,EAAQ,EAAO,OACjC,EAAY,KAAK,IAAI,EAAW,EAAO,UAEpC,KAAA,OAAS,IAAI,EAAJ,KACZ,IAAI,EAAJ,KAAS,EAAS,GAClB,IAAI,EAAJ,KAAS,EAAW,EAAS,EAAY,IAI7C,YACS,OAAA,KAAK,OAEd,eACS,OAAA,KAAK,UAEd,cACS,OAAA,KAAK,SAGd,4BAA4B,EAAyB,GAC/C,GAAC,KAAK,OAAO,oBAAoB,GAChC,IAAA,IAAI,KAAS,KAAK,SACrB,EAAM,4BAA4B,EAAmB,IAiBrD,MAAO,EAQX,YAAoB,GACb,KAAA,WAAa,EAAQ,WACrB,KAAA,UAAY,EAAQ,UACpB,KAAA,MAAQ,EAAQ,MANnB,UACK,SAAG,KAAK,cAAc,KAAK,SAAS,KAAK,YAO3C,mBAAY,EAAsC,GAChD,OAAA,EAAI,YAAY,IAAI,EAAsB,KAQtB,QAAA,sBAAA,EAAzB,MAAO,EAGX,YACU,EACA,EACA,EACA,EACA,EACA,EAAqC,CAAC,UAAU,IALhD,KAAA,GAAA,EACA,KAAA,SAAA,EACA,KAAA,WAAA,EACA,KAAA,uBAAA,EACA,KAAA,kBAAA,EACA,KAAA,QAAA,EARF,KAAA,OAA0B,GA0E1B,KAAA,gBAA2C,KAiB3C,KAAA,qBAAqD,KAwBrD,KAAA,UAAY,IAAI,EAAJ,SAzGZ,MAAA,EAAU,EAAW,YAAY,OAClC,IAAA,IAAI,EAAa,EAAG,EAAa,EAAS,IAAc,CACrD,MAAA,EAAiC,GACjC,EAAI,EAAQ,SAAW,EAAU,EAAI,EAAa,EAEpD,IAAA,EAAU,EAAA,EACV,GAAY,EAAA,EACZ,EAAQ,IAAI,EAAJ,eAAmB,KAAK,IAEhC,EAAY,EAEV,MAAA,EAAQ,EAAW,YAAY,GAEhC,IAAA,IAAI,EAAI,EAAG,EAAI,EAAM,OAAQ,IAAK,CAC/B,MAAA,EAAQ,EAAM,GAChB,EAAM,gBAAkB,IAC1B,EAAU,KACR,IAAI,EACF,EACA,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAS,GAAI,IAAI,EAAJ,KAAS,EAAW,EAAS,IAC5D,IAGJ,EAAU,EAAA,EACV,GAAY,EAAA,EACZ,EAAQ,IAAI,EAAJ,eAAmB,KAAK,KAE5B,MAAA,EAAoB,IAAI,EAAJ,KACxB,IAAI,EAAJ,KAAS,EAAM,MAAO,GACtB,IAAI,EAAJ,KAAS,EAAM,IAAM,EAAM,MAAO,IAEpC,EAAU,KAAK,IAAI,EAAS,EAAkB,QAC9C,EAAW,KAAK,IAAI,EAAU,EAAkB,SAO1C,MAAA,EAAQ,IAAI,EAAJ,OACX,EAAK,EAAI,KAAQ,KACjB,EAAK,EAAa,KAAQ,KAC1B,EAAI,KAAK,WAAW,uBAAuB,EAAM,KAAK,QAAU,KAEnE,EAAM,QAAQ,EAAmB,GACjC,IAGE,EAAM,eAAiB,GACzB,EAAU,KACR,IAAI,EACF,EACA,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAS,GAAI,IAAI,EAAJ,KAAS,EAAW,EAAS,IAC5D,IAOD,KAAA,OAAO,KAAK,IAAI,EAAsB,KAK/C,mBAAmB,EAAe,GAC5B,GAAA,KAAK,gBAAiB,CAClB,MAAA,EAAU,KAAK,gBACjB,EAAQ,OAAS,GAAS,EAAQ,QAAU,GAC9C,EAAQ,OAAO,EAAO,QAGnB,KAAA,gBAAkB,KAAK,GAAG,cAC7B,EAAS,SAAA,cAAc,cACvB,EACA,GAGG,OAAA,KAAK,gBAId,wBAAwB,EAAe,GAC/B,MAAA,EAAU,KAAK,mBAAmB,EAAO,GAUxC,OATH,KAAK,sBACH,KAAK,qBAAqB,SAAW,IAClC,KAAA,qBAAqB,QAAQ,OAC7B,KAAA,qBAAqB,SAAS,IAGlC,KAAK,uBACH,KAAA,qBAAuB,KAAK,GAAG,mBAAmB,IAElD,KAAK,qBAGd,OACM,KAAK,sBACF,KAAA,qBAAqB,OAExB,KAAK,iBACF,KAAA,gBAAgB,OAMzB,wBAAwB,GAChB,MAAA,WAAC,EAAD,UAAa,EAAb,MAAwB,GAAS,EAGjC,EAF0B,KAAK,WAAW,iBAER,KAAK,IAAI,EAAG,GAE9C,EAAU,KAAK,WAAW,YAAY,OACtC,EAAI,KAAK,QAAQ,SAAW,EAAU,EAAI,EAAa,EACtD,OAAA,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAQ,EAAO,GAAI,IAAI,EAAJ,KAAS,EAAO,IAG9D,OAAO,GACC,MAAA,mBAAC,EAAD,qBAAqB,GAAwB,EAE7C,EAA6C,GAK7C,EAAmB,EAAgB,gBAAA,aAAa,EAAoB,GACtE,GAAA,EAAmB,UAErB,OAGE,IAAA,EAAY,EACT,OAAM,CACL,MAAA,EAAM,EAAsB,YAAY,KAAK,UAAW,CAC5D,WAAY,EACZ,UAAA,EACA,MAAO,IAEH,EAAoB,KAAK,wBAAwB,GAEnD,GADmB,EAAiB,cAAc,GACnC,QAAU,KAAK,SAAS,gBACzC,MAEF,IAGI,MAAA,EAAM,KAAK,IAAI,EAAG,KAAK,MAAM,EAAmB,QAChD,EAAS,KAAK,IAAI,KAAK,OAAO,OAAQ,KAAK,KAAK,EAAmB,WAEnE,EAA0B,KAAK,WAAW,iBAC1C,EAA0B,KAAK,IAAI,EAAG,GACtC,EAAO,KAAK,MACf,EAA0B,EAAmB,OAAU,GAEpD,EAAQ,KAAK,KAChB,EAA0B,EAAmB,QAAW,GAGrD,EAAU,KAAK,WAAW,YAAY,OAEvC,IAAA,IAAI,EAAI,EAAK,EAAI,EAAQ,IACvB,IAAA,IAAI,EAAQ,EAAM,GAAS,EAAO,IAAS,CACxC,MAAA,EAAa,KAAK,QAAQ,SAAW,EAAU,EAAI,EAAI,EACvD,EAAM,EAAsB,YAAY,KAAK,UAAW,CAC5D,WAAA,EACA,UAAA,EACA,MAAA,IAEwB,KAAK,wBAAwB,GAChC,oBAAoB,IAC3C,EAAkB,KAAK,GASrB,MAAA,EAAgB,KAAK,SAAS,cAC9B,EAAqB,EAAkB,MAAM,EAAG,GAChD,EAAuB,EAAkB,MAAM,GAGhD,KAAA,SAAS,qBAAqB,EAAoB,CAAC,EAAgB,KAChE,MAAA,EAAoB,KAAK,wBAAwB,GAClD,KAAA,OAAO,EAAI,YAAY,4BAA4B,EAAmB,IACpE,KAAA,uBAAuB,OAAO,CACjC,MAAO,EAAK,WACZ,mBAAoB,EACpB,qBAAsB,QAKtB,MAAA,EAAe,KAAK,wBACxB,EAAqB,QACrB,EAAqB,WAGZ,EAAA,EAAA,YAAA,KAAK,GAAI,EAAc,KAC3B,KAAA,GAAG,MAAM,IAAI,EAAS,SAAA,MAAM,EAAG,EAAG,EAAG,IAEpC,MAAA,EAAe,IAAI,EAAJ,KACnB,EAAK,KAAA,KACL,IAAI,EAAJ,KAAS,KAAK,GAAG,SAAS,MAAO,KAAK,GAAG,SAAS,SAE9C,EAAmB,EAAgB,gBAAA,aAAa,EAAoB,GAGrE,IAAA,IAAI,KAAO,EAAoB,CAC5B,MAAA,EAAqB,KAAK,wBAAwB,GACnD,KAAA,SAAS,eAAe,EAAK,EAAiB,cAAc,IAI9D,IAAA,IAAI,KAAO,EAAsB,CAC9B,MAAA,EAAoB,KAAK,wBAAwB,GACjD,EAAiB,EAAiB,cAAc,GACjD,KAAA,OAAO,EAAI,YAAY,4BAA4B,EAAmB,IACpE,KAAA,uBAAuB,OAAO,CACjC,MAAO,EAAK,WACZ,mBAAoB,EACpB,qBAAsB,SAMxB,MAAA,EAAkB,KAAK,mBAC3B,EAAqB,QACrB,EAAqB,UAGlB,KAAA,kBAAkB,OAAO,CAC5B,gBAAA,EACA,QAAS,IAAI,EAAJ,KAAS,EAAK,KAAA,KAAM,IAAI,EAAJ,KAAS,EAAgB,MAAO,EAAgB,SAC7E,QAAS,EACT,eAAgB,EAAM,kBA1PG,QAAA,mBAAA;;AC1HxB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,wBAAA,EAJP,IAAA,EAAA,QAAA,aACA,EAAA,QAAA,WACA,EAAA,QAAA,kBAEO,MAAM,GAAqB,EAAU,EAAA,WAAA,GAC1C,EAAW,WAAA,OAAO,CAChB,WAAY,CACV,MAAO,EAAM,aAEf,KAAM,CACJ,MAAO,OACP,OAAQ,OACR,SAAU,WACV,KAAM,EACN,IAAK,GAEP,QAAS,CACP,OAAQ,EAAM,MAAA,eACd,gBAAiB,EAAM,MAAA,4BAA4B,EAAM,oBAE3D,YAAa,CACX,KAAM,GAGR,WAAY,CACV,QAAS,OACT,OAAQ,EAAM,MAAA,mBACd,SAAU,SACV,oBAAqB,kBACrB,iBAAkB,iBAClB,aAAc,EAAM,MAAA,4BAA4B,EAAM,mBACtD,SAAU,EAAS,SAAA,MACnB,SAAU,WACV,WAAY,EAAM,eAClB,MAAO,QACP,OAAQ,GAEV,sBAAuB,CACrB,QAAS,GAEX,eAAgB,CACd,OAAQ,EAAM,MAAA,mBACd,cAAe,EAAS,SAAA,MAAQ,MAChC,SAAU,OACa,sBAAA,CACrB,WAAY,EAAM,gBAES,4BAAA,CAC3B,WAAY,EAAM,iBAClB,aAAc,GACd,oBAAqB,EAAM,iBACjB,SAAA,CACR,WAAY,EAAM,kBAIxB,UAAW,CACT,WAAY,UAEd,cAAe,CACb,MAAO,EAAM,kBAEf,WAAY,CACV,QAAS,OACT,oBAAqB,UACrB,8BAA+B,EAAS,SAAA,MAAQ,QAChD,QAAS,UACT,UAAW,SACX,aAAc,GAEhB,iBAAkB,CAChB,WAAY,SAEd,eAAgB,CACd,SAAU,WACV,QAAS,OACT,eAAgB,SAChB,WAAY,UAEd,iBAAkB,CAChB,WAAY,EAAM,sBAClB,MAAO,EAAM,mBAEf,iBAAkB,CAChB,WAAY,EAAM,wBAClB,MAAO,EAAM,mBAEf,WAAY,CACV,SAAU,WACV,IAAK,EACL,KAAM,EACN,WAAY,qBACZ,MAAO,WAxFN,QAAA,mBAAA;;ACqMN,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,uBAAA,EAAA,QAAA,iBAAA,EAAA,QAAA,YAAA,EAAA,QAAA,yBAAA,EAAA,QAAA,cAAA,EAzMD,IAAA,EAAA,QAAA,WAEO,MAAM,EAAW,IAuMvB,QAAA,SAAA,EApMD,MAAM,EAAmB,IAAI,IAE7B,IAAI,GAAwB,EACtB,SAAU,EAAuB,EAA+B,GAS7D,OARH,OAAO,mBAAqB,IAE9B,EAAiB,QACjB,EAAuB,OAAO,kBAE3B,EAAiB,IAAI,IACxB,EAAiB,IAAI,EAAM,EAAI,YAAY,GAAM,OAE5C,EAAiB,IAAI,GAcxB,SAAU,EAAiB,EAAc,GACzC,GAAA,EAAK,QAAU,EACV,MAAA,CACL,cAAe,EACf,cAAe,EAAK,OACpB,aAAc,EAAK,OACnB,aAAc,EACd,eAAgB,EAChB,eAAgB,EAAK,QAIrB,IAAA,EAAe,KAAK,MAAM,EAAS,GACjC,MAAA,EAAe,EAAS,EAAe,EACvC,EAAS,EAAK,UAAU,EAAG,GAC3B,EAAS,EAAK,UAAU,EAAK,OAAS,EAAc,EAAK,QACzD,EAAgB,EAAS,EAAW,EACnC,MAAA,CACL,cAAA,EACA,cAAe,EAAc,OAC7B,aAAc,EAAO,OACrB,aAAc,EAAO,OACrB,eAAgB,EAChB,eAAgB,EAAK,QAKnB,SAAU,EACd,EACA,EACA,GAEI,GAAA,EAAuB,EAAK,IAAS,EAChC,OAAA,EAAiB,EAAM,EAAK,QAE/B,MAAC,IAAM,EACX,EAAA,iBAAA,EACA,EAAK,OACL,GACS,EAAuB,EAAK,EAAiB,EAAM,KAAK,MAAM,IAAI,eAE3E,GAEK,OAAA,EAAiB,EAAM,KAAK,MAAM,IAG3C,IAAK,EAML,SAAS,EAAsB,EAA2B,GACpD,OAAA,EAAQ,EAAO,aACV,EAAmB,UACjB,EAAQ,EAAO,eAAiB,EAAO,aACzC,EAAmB,OAEnB,EAAmB,UAIxB,SAAU,EACd,EACA,GAkBM,MAAA,EAAqD,GACrD,EAAa,EAAY,eAAiB,EAAY,cACxD,IAAA,GAAsB,EAErB,IAAA,IAAK,EAAW,KAAY,EAAQ,CACnC,IAAA,EAAe,EAAsB,EAAa,GAClD,EAAa,EAAsB,EAAa,EAAU,GAEtD,OAAA,GACD,KAAA,EAAmB,UACd,OAAA,GACD,KAAA,EAAmB,UAEtB,EAA+B,KAAK,CAAC,EAAW,IAChD,MAEG,KAAA,EAAmB,OAGtB,EAA+B,KAAK,CAAC,EAAW,EAAY,aAAe,IAC3E,GAAsB,EACtB,MAEG,KAAA,EAAmB,UAGtB,EAA+B,KAAK,CAAC,EAAW,EAAU,IAI9D,MAEG,KAAA,EAAmB,OACd,OAAA,GACD,KAAA,EAAmB,UAEhB,MAAA,IAAI,MAAM,kEAEb,KAAA,EAAmB,OAEjB,IACH,EAA+B,KAAK,CAClC,EAAY,aACZ,EAAY,aAAe,IAE7B,GAAsB,GAExB,MAEG,KAAA,EAAmB,UAElB,EACF,EAA+B,KAAK,CAClC,EAAY,cAAgB,EAAY,aACxC,EAAU,KAGZ,EAA+B,KAAK,CAAC,EAAY,aAAc,EAAU,IACzE,GAAsB,GAK5B,MAEG,KAAA,EAAmB,UACd,OAAA,GACD,KAAA,EAAmB,UAEhB,MAAA,IAAI,MAAM,kEAEb,KAAA,EAAmB,OAEhB,MAAA,IAAI,MAAM,kEAGb,KAAA,EAAmB,UAEtB,EAA+B,KAAK,CAAC,EAAY,EAAY,EAAU,MAQ1E,OAAA,GA1HT,SAAK,GACH,EAAA,EAAA,UAAA,GAAA,YACA,EAAA,EAAA,UAAA,GAAA,YACA,EAAA,EAAA,OAAA,GAAA,SAHF,CAAK,IAAA,EAAkB;;AChD6D,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,2BAAA,EA9BpF,IAyBK,EAzBL,EAAA,QAAA,UACA,EAAA,QAAA,aAEA,EAAA,QAAA,eAEA,EAAA,QAAA,sBACA,EAAA,QAAA,WAEA,EAAA,QAAA,qBACA,EAAA,QAAA,iBAgBA,SAAK,GACH,EAAA,EAAA,kBAAA,GAAA,oBACA,EAAA,EAAA,mBAAA,GAAA,qBAFF,CAAK,IAAA,EAAY,KAKX,MAAO,UAA8B,EAArC,UAAN,cAAoF,SAAA,WAClF,KAAA,UAA4B,KAC5B,KAAA,aAAgB,CAAA,IACT,KAAA,UAAY,GAAW,OAG9B,KAAA,cAA0C,KAC1C,KAAA,WAA8C,KA8H9C,KAAA,eAAiB,MACV,KAAA,kBAuDC,KAAA,cAAgB,MACjB,KAAA,4BACA,KAAA,8BACA,KAAA,cACA,KAAA,mBAGC,KAAA,aAAe,MAChB,KAAA,MAAM,cAAc,iBAanB,KAAA,oBAAqB,EACrB,KAAA,yBAA2B,EAC3B,KAAA,gBAAyC,KACzC,KAAA,0BAA4B,MAC9B,KAAK,kBACF,KAAK,qBACH,KAAA,2BACD,KAAK,0BAA4B,IAC9B,KAAA,gBAAkB,KAClB,KAAA,yBAA2B,IAG/B,KAAA,MAAM,cAAc,gBAEtB,KAAA,oBAAqB,IAyBpB,KAAA,QAAW,CAAA,IAOb,GANJ,EAAG,iBAEE,KAAA,oBAAqB,GAEX,EAAG,SAAW,EAAG,UAEO,QAAzB,KAAK,gBAA2B,CACxC,IAAA,EAAa,EAAI,EAAG,OAAS,IAK7B,EAAG,UACL,EAAa,EAAI,EAAG,OAAS,IAG/B,GAAa,EAAM,EAAA,OAAA,EAAY,GAAK,IAE/B,KAAA,KAAK,OACwB,SAAzB,KAAK,iBACT,KAAA,IAAI,IAAI,EAAJ,KAAS,EAAG,OAAQ,EAAG,SAG7B,KAAA,iBAaC,KAAA,0BAAyC,KACzC,KAAA,8BAA6C,KAC7C,KAAA,aAAoC,KACpC,KAAA,YAAe,CAAA,IACf,MAAA,EAAmB,KAAK,iBAAiB,GAE3C,IACE,KAAK,MAAM,wBAAwB,SAAS,IAGzC,KAAA,aAAe,EAAa,mBAC5B,KAAA,8BAAgC,EAAiB,MACpD,KAAK,MAAM,wBAAwB,SAKhC,KAAA,aAAe,EAAa,kBAG9B,KAAA,0BAA4B,EACjC,OAAO,iBAAiB,YAAa,KAAK,mBAC1C,OAAO,iBAAiB,UAAW,KAAK,iBACnC,KAAA,aAAa,MAId,KAAA,kBAAqB,CAAA,IACvB,IAAC,KAAK,0BAA2B,OACjC,IAAA,EAAmB,KAAK,iBAAiB,GAEzC,GAAC,EAQD,GAPC,KAAA,aAAa,GAGlB,EAAmB,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAG,GAAI,KAAK,mBAAmB,eAClE,GAGE,KAAK,eAAiB,EAAa,kBAAmB,CAClD,MAAA,EAAc,KAAK,0BACrB,IAAA,EAAY,EAEZ,IAAC,IAAgB,EAAW,OAC1B,MAAA,EAAO,KAAK,IAAI,EAAY,EAAG,EAAU,GAGzC,EAFQ,KAAK,IAAI,EAAY,EAAG,EAAU,GAE1B,EAChB,EAAS,KAAK,MAAM,wBAAwB,SAE7C,KAAA,MAAM,2BACT,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAM,EAAU,EAAI,EAAS,GAAI,IAAI,EAAJ,KAAS,EAAO,UAEhE,GAAI,KAAK,eAAiB,EAAa,mBAAoB,CAC5D,IAAC,KAAK,8BAA+B,OAEnC,MAAA,EAAY,EAAiB,MAAM,KAAK,+BACzC,KAAA,MAAM,2BACT,KAAK,MAAM,wBAAwB,WAAW,OAK5C,KAAA,aAAgB,CAAA,IAClB,KAAK,eAAiB,EAAa,oBACrC,SAAS,KAAK,MAAM,OAAS,WAC7B,SAAS,KAAK,MAAM,OAAS,oBACpB,KAAK,eAAiB,EAAa,kBAC5C,SAAS,KAAK,MAAM,OAAS,aACpB,KAAK,MAAM,wBAAwB,SAAS,IACrD,SAAS,KAAK,MAAM,OAAS,OAC7B,SAAS,KAAK,MAAM,OAAS,gBAE7B,SAAS,KAAK,MAAM,OAAS,eAIzB,KAAA,aAAe,MACI,MAArB,KAAK,eACP,SAAS,KAAK,MAAM,OAAS,aAIzB,KAAA,YAAe,CAAA,IACf,MAAA,EAAmB,KAAK,iBAAiB,GAC1C,GACA,KAAA,aAAa,KAGZ,KAAA,gBAAmB,CAAA,IACpB,KAAA,aAAe,KACpB,OAAO,oBAAoB,YAAa,KAAK,mBAC7C,OAAO,oBAAoB,UAAW,KAAK,iBAErC,MAAA,EAAmB,KAAK,iBAAiB,GAC1C,GACA,KAAA,aAAa,KAGZ,KAAA,iBAAoB,CAAA,IACtB,GACG,KAAA,cAAgB,EAChB,KAAA,WAAa,KAAK,cAAc,WAAW,MAC3C,KAAA,iBAEA,KAAA,cAAgB,KAChB,KAAA,WAAa,QA/Xd,mBACC,OAAA,IAAI,EAAJ,KACL,KAAK,cAAgB,KAAK,cAAc,MAAQ,EAChD,KAAK,cAAgB,KAAK,cAAc,OAAS,GAI7C,WACC,OAAA,EAAmB,EAAA,oBAAA,KAAK,MAAM,OAG/B,gBACC,OAAA,IAAI,EAAJ,KAAS,EAAG,EAAM,MAAA,aAAe,OAAO,kBAGzC,kBACC,OAAA,IAAI,EAAJ,KACL,KAAK,MAAM,WAAW,iBACtB,KAAK,MAAM,WAAW,YAAY,QAI9B,iCACA,MAAA,EAAgB,KAAK,gBAEpB,OAAA,EAAgB,gBAAA,aACrB,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAG,GAAI,KAAK,mBAC9B,IAAI,EAAJ,KAAS,EAAe,KAAK,mBAAmB,MAAM,KAIlD,6BACC,OAAA,EAAgB,gBAAA,UAAU,IAAI,EAAJ,KAAS,OAAO,iBAAkB,OAAO,mBAGpE,2BACF,IAAC,KAAK,UAAW,OAAO,IAAI,EAAJ,gBACtB,MAAA,EAAS,KAAK,UAAU,wBACvB,OAAA,EAAgB,gBAAA,gBAAgB,IAAI,EAAJ,MAAU,EAAO,MAAO,EAAO,MAGhE,cACD,KAAK,YAGN,KAAK,mBAAmB,EAAI,GAE3B,KAAA,MAAM,cAAc,aAAa,KAAK,UAAW,KAC/C,KAAA,MAAM,mBAAmB,OAAO,CACnC,mBAAoB,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAG,GAAI,KAAK,mBAClD,qBAAsB,IAAI,EAAJ,KACpB,KAAK,gBACL,KAAK,mBAAmB,MAAM,KAAK,kBAErC,gBAAgB,IAGb,KAAA,MAAM,cAAc,0BAA0B,OAAO,CACxD,wBAAyB,KAAK,MAAM,wBACpC,+BAAgC,KAAK,sCAKnC,iBACA,MAAA,EAAM,KAAK,WACb,IAAC,EAAK,OACJ,MAAA,EAAmB,KAAK,mBAC9B,EAAI,UAAU,EAAG,EAAG,EAAiB,EAAG,EAAiB,GAEnD,MAAA,EAAmB,KAAK,iCAGxB,EAAQ,KAAK,kBAAkB,EAY/B,GAFJ,KAAK,iCAAiC,YAAc,IAAI,EAAJ,iBACpD,MAAM,KAAK,8BAC0B,gBAAgB,IAAI,EAAJ,KAAS,IAAK,IAAI,EAEnE,EAA+B,EAAM,MAAA,aAAe,OAAO,iBAC3D,EAA4B,EAAS,SAAA,MAAQ,OAAO,iBACpD,GAAkB,EAA+B,GAA6B,EAEpF,EAAI,QAAU,OAA+B,OAAkC,EAAW,WAAA,YAC1F,EAAI,aAAe,MAGf,IAAA,EADgB,KAAK,IAAI,GAAI,KAAK,MAAM,KAAK,MAAM,KAGnD,EAAiB,EAAW,EAC9B,GAAY,EACH,EAAiB,EAAW,IACrC,GAAY,GAGR,MAAA,EAAQ,KAAK,MAAM,MAGvB,EAAI,UAAY,EAAM,MAAA,WAAW,EAAM,gBAAgB,UAAU,IAAK,QACtE,EAAI,SAAS,EAAG,EAAG,EAAiB,EAAG,GACvC,EAAI,aAAe,MAEd,IAAA,IAAI,EAAI,KAAK,KAtCP,EAsCmB,GAAY,EAAU,EAAI,EAAO,GAAK,EAAU,CAEtE,MAAA,EAAM,KAAK,MAAM,EAAiB,kBAAkB,IAAI,EAAJ,KAAS,EAAG,IAAI,GACpE,EAAY,KAAK,MAAM,WAAW,YAAY,GAC9C,EAAY,KAAK,MAAK,EAAuB,EAAA,wBAAA,EAAK,IAExD,EAAI,UAAY,EAAM,eACtB,EAAI,SAAS,EAAW,EAAM,EAAY,EAAgB,GAC1D,EAAI,UAAY,EAAM,iBACtB,EAAI,SAAS,EAAK,EAAG,EAAG,EAAiB,IAS/C,0BAA0B,GACpB,KAAK,MAAM,aAAe,EAAU,WACjC,KAAA,eACI,KAAK,MAAM,yBAA2B,EAAU,wBACpD,KAAA,eACI,KAAK,MAAM,gBAAkB,EAAU,gBAC5C,KAAK,MAAM,eACR,KAAA,MAAM,cAAc,yBAAyB,KAAK,eAErD,EAAU,gBACZ,EAAU,cAAc,sBAAsB,KAAK,eACnD,EAAU,cAAc,iBAK9B,oBACE,OAAO,iBAAiB,SAAU,KAAK,gBAClC,KAAA,MAAM,cAAc,sBAAsB,KAAK,eAGtD,uBACE,OAAO,oBAAoB,SAAU,KAAK,gBACrC,KAAA,MAAM,cAAc,yBAAyB,KAAK,eAGjD,8BACF,IAAC,KAAK,cAAe,OACrB,IAAA,MAAC,EAAD,OAAQ,GAAU,KAAK,cAAc,wBAYrC,GAJJ,EAAQ,KAAK,MAAM,GACnB,EAAS,KAAK,MAAM,GAGN,IAAV,GAA0B,IAAX,EAAc,OAE3B,MAAA,EAAc,EAAQ,OAAO,iBAC7B,EAAe,EAAS,OAAO,iBAEjC,IAAgB,KAAK,cAAc,OAAS,IAAiB,KAAK,cAAc,SAG/E,KAAA,cAAc,MAAQ,EACtB,KAAA,cAAc,OAAS,GAyCtB,IAAI,GACL,KAAA,gBAAkB,MACjB,MAAA,EAAgB,KAAK,6BAA6B,gBAAgB,GAClE,EAAc,KAAK,iCAAiC,uBAAuB,GAE5E,GACA,KAAA,MAAM,kBAAkB,EAAgB,gBAAA,gBAAgB,IAGvD,KAAK,GACN,KAAA,gBAAkB,OACjB,MAAA,EAAsB,KAAK,MAAM,wBACjC,EAAoB,EAAoB,OAAO,KAAK,EAAoB,KAAK,MAAM,KACrF,IAAC,EAAmB,OAElB,MAAA,EAAgB,EAAgB,gBAAA,gBAAgB,EAAkB,OAAO,IAC5E,SAAS,IAAI,EAAJ,KAAS,EAAY,IAC9B,aAAa,GAEX,KAAA,MAAM,kBAAkB,GA8BvB,iBAAiB,GACjB,MAAA,EAAoB,KAAK,2BAA2B,kBACxD,IAAI,EAAJ,KAAS,EAAG,QAAS,EAAG,UAEpB,EAAqB,KAAK,6BAA6B,kBAC3D,GAEK,OAAA,KAAK,iCAAiC,yBAAyB,GAiHxE,SACQ,MAAA,EAAQ,KAAK,WAGjB,OAAA,EAAA,EAAA,GAAA,MAAA,CACE,IAAK,KAAK,aACV,QAAS,KAAK,QACd,YAAa,KAAK,YAClB,YAAa,KAAK,YAClB,aAAc,KAAK,aACnB,WAAW,EAAI,EAAA,KAAA,EAAM,QAAS,EAAY,YAAA,QAE1C,EAAA,EAAA,GAAA,SAAA,CAAQ,MAAO,EAAG,OAAQ,EAAG,IAAK,KAAK,iBAAkB,WAAW,EAAI,EAAA,KAAA,EAAM,UAxZF,QAAA,sBAAA;;AC4FnF,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,qBAAA,EA1HD,IAAA,EAAA,QAAA,aACA,EAAA,QAAA,UACA,EAAA,QAAA,sBACA,EAAA,QAAA,gBAEA,EAAA,QAAA,gBAEA,EAAA,QAAA,kBAWA,SAAS,EAAgB,GACjB,MAAA,GAAQ,EAAmB,EAAA,qBAAA,EAAnB,EAAA,aAER,EAAQ,EAAM,UAAU,EAAM,eAC9B,EAAO,EAAM,UAAU,EAAM,cAC7B,EAAa,IAAQ,EAAM,cAAiB,EAAM,WAClD,EAAY,IAAQ,EAAM,aAAgB,EAAM,WAGpD,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,cACxB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,EAAM,eAAgB,EAAM,mBAC9D,EAAM,QAGT,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,EAAM,iBAAe,UAC1D,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,EAAM,iBAAe,SAE1D,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,EAAM,iBAAkB,IAC7D,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,EAAM,iBAAkB,IAE7D,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,EAAM,kBACxC,EAAc,EAAA,eAAA,IACf,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,YAAa,MAAO,CAAC,UAAW,UAE5D,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,EAAM,kBACxC,EAAc,EAAA,eAAA,IACf,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,YAAa,MAAO,CAAC,UAAW,UAUlE,SAAS,EAAe,GAChB,MAAA,GAAQ,EAAmB,EAAA,qBAAA,EAAnB,EAAA,aAER,EAAsB,GACxB,IAAA,EAA4B,EAAM,KAC/B,KAAA,IAAS,EAAK,SAAU,EAAO,EAAK,OAAQ,CAC3C,MAAA,EAAgC,IAChC,MAAC,GAAS,EASZ,GAPJ,EAAI,MAAK,EAAC,EAAA,GAAA,EAAD,UAAU,CAAC,MAAO,EAAM,cAAc,MAE3C,EAAK,QACP,EAAI,MAAK,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,gBAAc,OAEpD,EAAI,KAAK,EAAM,MAEX,EAAM,KAAM,CACV,IAAA,EAAM,EAAM,KACE,MAAd,EAAM,OACR,OAAW,EAAM,OACA,MAAb,EAAM,MACR,OAAW,EAAM,QAGrB,EAAI,MAAK,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,gBAA3B,KAA8C,EAA9C,MAEX,EAAK,MAAK,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,YAAa,IAGjD,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,kBACxB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,wBAAyB,IAWnD,SAAU,EAAqB,GAC7B,MAAA,GAAQ,EAAmB,EAAA,qBAAA,EAAnB,EAAA,cAER,WAAC,EAAD,aAAa,GAAgB,GAC7B,MAAC,GAAS,EAGd,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,cACxB,EAAC,EAAA,GAAA,EAAe,CACd,MAAO,gBACP,UAAW,EAAM,iBACjB,WAAY,EAAW,iBACvB,cAAe,EAAa,iBAC5B,aAAc,EAAa,gBAC3B,UAAW,EAAW,YAAY,KAAK,MAEzC,EAAC,EAAA,GAAA,EAAe,CACd,MAAO,gBACP,UAAW,EAAM,iBACjB,WAAY,EAAW,iBACvB,cAAe,EAAM,iBACrB,aAAc,EAAM,gBACpB,UAAW,EAAW,YAAY,KAAK,MAEzC,EAAC,EAAA,GAAA,EAAc,CAAC,KAAM,EAAc,cAAe,EAAM;;ACjF3B,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,wBAAA,QAAA,6BAAA,EAxB9B,MAAO,EAAb,cACU,KAAA,UAAwB,GAEhC,KAAK,GACE,KAAA,UAAU,KAAK,GAGtB,KAAK,EAA+B,GAC9B,GAA0B,IAA1B,KAAK,UAAU,OAAf,CACJ,EAAI,UAAY,EACX,IAAA,IAAI,KAAQ,KAAK,UACpB,EAAI,SAAS,EAAK,KAAM,EAAK,EAAG,EAAK,GAElC,KAAA,UAAY,KAWe,QAAA,wBAAA,EAA9B,MAAO,EAAb,cACU,KAAA,UAAwB,GAEhC,KAAK,GACE,KAAA,UAAU,KAAK,GAGd,SAAS,GACf,EAAI,YACC,IAAA,IAAI,KAAQ,KAAK,UACpB,EAAI,KAAK,EAAK,EAAG,EAAK,EAAG,EAAK,EAAG,EAAK,GAExC,EAAI,YACC,KAAA,UAAY,GAGnB,KAAK,EAA+B,GACJ,IAA1B,KAAK,UAAU,SACnB,EAAI,UAAY,EACX,KAAA,SAAS,GACd,EAAI,QAGN,OAAO,EAA+B,EAAe,GACrB,IAA1B,KAAK,UAAU,SACnB,EAAI,YAAc,EAClB,EAAI,UAAY,EACX,KAAA,SAAS,GACd,EAAI,WA5B4B,QAAA,wBAAA;;ACVnC,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,kBAAA,EAAA,QAAA,oBAAA,EArBM,MAAM,EAA6C,oBAArB,iBAErC,IAAI,EAKE,SAAU,EAAkB,GAcjC,IAAA,EAAA,EAbO,MAAA,EAAO,EAAK,MAAM,KACpB,IAAC,EACH,OAEI,MAAA,EAAsB,QAAf,EAAA,EAAK,MAAM,YAAI,IAAA,EAAA,EAAI,EAC1B,EAAoB,QAAd,EAAA,EAAK,MAAM,WAAG,IAAA,EAAA,EAAI,EAE9B,EAAO,YAAY,CACjB,QAAS,SACT,KAAA,EACA,KAAA,EACA,IAAA,IAEH,QAAA,eAAA,EAlBG,IACF,EAAS;;ACsDyE,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,2BAAA,EAjEpF,IAAA,EAAA,QAAA,eAKA,EAAA,QAAA,WACA,EAAA,QAAA,qBAMA,EAAA,QAAA,sBACA,EAAA,QAAA,UACA,EAAA,QAAA,aAEA,EAAA,QAAA,oCACA,EAAA,QAAA,gBAEA,EAAA,QAAA,2BA8CM,MAAO,UAA8B,EAArC,UAAN,cAAoF,SAAA,WAC1E,KAAA,UAA4B,KAC5B,KAAA,aAAgB,CAAA,IACjB,KAAA,UAAY,GAAW,OAGtB,KAAA,cAA0C,KAC1C,KAAA,WAA8C,KAE9C,KAAA,aAA4C,KAU5C,KAAA,iBAAoB,CAAA,IACtB,GACG,KAAA,cAAgB,EAChB,KAAA,WAAa,KAAK,cAAc,WAAW,MAC3C,KAAA,iBAEA,KAAA,cAAgB,KAChB,KAAA,WAAa,QAwCd,KAAA,gCAAkC,EAAM,MAAA,aAuVhD,KAAA,eAAiB,MACV,KAAA,4BACA,KAAA,kBA4BC,KAAA,oBAAqB,EACrB,KAAA,yBAA2B,EAC3B,KAAA,gBAAyC,KACzC,KAAA,0BAA4B,MAC9B,KAAK,kBACF,KAAK,qBACH,KAAA,2BACD,KAAK,0BAA4B,IAC9B,KAAA,gBAAkB,KAClB,KAAA,yBAA2B,IAG/B,KAAA,MAAM,cAAc,gBAEtB,KAAA,oBAAqB,IAGpB,KAAA,cAAgB,MACjB,KAAA,8BACA,KAAA,cACA,KAAA,iBACA,KAAA,8BAGC,KAAA,aAAe,MAChB,KAAA,MAAM,cAAc,iBAmCnB,KAAA,YAA2B,KAC3B,KAAA,aAA4B,KAC5B,KAAA,YAAe,CAAA,IAChB,KAAA,aAAe,KAAK,YAAc,IAAI,EAAJ,KAAS,EAAG,QAAS,EAAG,SAC1D,KAAA,eACL,OAAO,iBAAiB,UAAW,KAAK,mBAGlC,KAAA,YAAe,CAAA,IACjB,IAAC,KAAK,YAAa,OACjB,MAAA,EAAkB,IAAI,EAAJ,KAAS,EAAG,QAAS,EAAG,SAC3C,KAAA,IAAI,KAAK,YAAY,MAAM,IAC3B,KAAA,YAAc,EAIf,KAAK,cACF,KAAA,MAAM,YAAY,QAInB,KAAA,WAAc,CAAA,IAChB,GAAA,KAAK,aAAc,CACf,MAAA,EAAgB,KAAK,aAAa,kBAClC,EAAe,IAAI,EAAJ,KACnB,EAAc,OAAO,MAAM,IAAI,EAAJ,KAAS,EAAG,IACvC,EAAc,KAAK,MAAM,KAAK,MAAM,wBAAwB,WAEzD,KAAA,MAAM,2BAA2B,MAIlC,KAAA,QAAW,CAAA,IACX,MAAA,EAAkB,IAAI,EAAJ,KAAS,EAAG,QAAS,EAAG,SAC1C,EAAe,KAAK,aACrB,KAAA,aAAe,KAEhB,GAAgB,EAAgB,MAAM,GAAc,SAAW,IAM/D,KAAK,cACF,KAAA,MAAM,aAAa,KAAK,aAAa,MACrC,KAAA,eAED,EAAkB,gBAAA,EAAG,UACL,EAAA,EAAA,mBAAA,KAAK,aAAa,OAGjC,KAAA,MAAM,aAAa,SAapB,KAAA,gBAAmB,CAAA,IACpB,KAAA,YAAc,KACd,KAAA,eACL,OAAO,oBAAoB,UAAW,KAAK,mBAGrC,KAAA,YAAe,CAAA,IAEjB,GADC,KAAA,eACD,KAAK,YAGP,OAFA,EAAG,sBACE,KAAA,YAAY,GAGd,KAAA,aAAe,KACd,MAAA,EAAwB,IAAI,EAAJ,KAAS,EAAG,QAAS,EAAG,SAChD,EAAyB,KAAK,6BAA6B,kBAC/D,GAEI,EAAmB,KAAK,iCAAiC,yBAC7D,GAGE,IAAC,EAAkB,OAEjB,MAAA,EAAkB,CAAC,EAAwB,EAAQ,KACjD,MAAA,EAAQ,EAAM,IAAM,EAAM,MAC1B,EAAI,KAAK,MAAM,eAAiB,KAAK,kBAAkB,EAAI,EAAI,EAAQ,EACvE,EAAoB,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAM,MAAO,GAAI,IAAI,EAAJ,KAAS,EAAO,IACzE,GAAA,EAAiB,EAAI,EAAkB,OAAQ,OAAO,KACtD,GAAA,EAAiB,EAAI,EAAkB,QAAS,OAAO,KAEvD,EAAkB,SAAS,KACxB,KAAA,aAAe,CAClB,kBAAA,EACA,KAAM,EAAM,OAIX,IAAA,IAAI,KAAS,EAAM,SACtB,EAAgB,EAAO,EAAQ,IAI9B,IAAA,IAAI,KAAS,KAAK,MAAM,WAAW,YAAY,IAAM,GACxD,EAAgB,GAGd,KAAK,aACF,KAAA,MAAM,YAAY,CAAC,KAAM,KAAK,aAAc,KAAM,MAAO,IAEzD,KAAA,MAAM,YAAY,MAGpB,KAAA,iBAGC,KAAA,aAAgB,CAAA,IACjB,KAAA,aAAe,KACf,KAAA,MAAM,YAAY,MAClB,KAAA,iBAGC,KAAA,QAAW,CAAA,IACjB,EAAG,iBACE,KAAA,oBAAqB,EAEpB,MAAA,EAAS,EAAG,SAAW,EAAG,QAE5B,IAAA,EAAS,EAAG,OACZ,EAAS,EAAG,OAMZ,GALA,EAAG,YAAc,EAAG,iBACtB,GAAU,KAAK,gCACf,GAAU,KAAK,iCAGb,GAAmC,QAAzB,KAAK,gBAA2B,CACxC,IAAA,EAAa,EAAI,EAAS,IAK1B,EAAG,UACL,EAAa,EAAI,EAAS,IAG5B,GAAa,EAAM,EAAA,OAAA,EAAY,GAAK,IAE/B,KAAA,KAAK,IAAI,EAAJ,KAAS,EAAG,QAAS,EAAG,SAAU,OACV,SAAzB,KAAK,iBACT,KAAA,IAAI,IAAI,EAAJ,KAAS,EAAQ,IAGvB,KAAA,iBAGP,KAAA,iBAAoB,CAAA,IACd,IAAC,KAAK,UAAW,OACf,MAAA,MAAC,EAAD,OAAQ,GAAU,KAAK,UAAU,wBAExB,MAAX,EAAG,KAA0B,MAAX,EAAG,KAClB,KAAA,KAAK,IAAI,EAAJ,KAAS,EAAQ,EAAG,EAAS,GAAI,IAC3C,EAAG,kBACiB,MAAX,EAAG,KAA0B,MAAX,EAAG,MACzB,KAAA,KAAK,IAAI,EAAJ,KAAS,EAAQ,EAAG,EAAS,GAAI,GAC3C,EAAG,kBAGD,EAAG,SAAW,EAAG,UAAY,EAAG,UAOrB,MAAX,EAAG,IACA,KAAA,KAAK,IAAI,EAAJ,KAAS,EAAQ,EAAG,EAAS,GAAI,KACvB,eAAX,EAAG,KAAoC,SAAZ,EAAG,KAClC,KAAA,IAAI,IAAI,EAAJ,KAAS,IAAK,IACH,cAAX,EAAG,KAAmC,SAAZ,EAAG,KACjC,KAAA,IAAI,IAAI,EAAJ,MAAU,IAAK,IACJ,YAAX,EAAG,KAAiC,SAAZ,EAAG,KAC/B,KAAA,IAAI,IAAI,EAAJ,KAAS,GAAI,MACF,cAAX,EAAG,KAAmC,SAAZ,EAAG,KACjC,KAAA,IAAI,IAAI,EAAJ,KAAS,EAAG,MACD,WAAX,EAAG,MACP,KAAA,MAAM,aAAa,MACnB,KAAA,mBAtqBD,WACC,OAAA,EAAmB,EAAA,oBAAA,KAAK,MAAM,OAG/B,2BAA2B,GAC5B,KAAA,MAAM,2BAA2B,GAchC,kBACC,OAAA,IAAI,EAAJ,KACL,KAAK,MAAM,WAAW,iBACtB,KAAK,MAAM,WAAW,YAAY,QAI9B,mBACC,OAAA,IAAI,EAAJ,KACL,KAAK,cAAgB,KAAK,cAAc,MAAQ,EAChD,KAAK,cAAgB,KAAK,cAAc,OAAS,GAI7C,iBACF,GAAA,KAAK,MAAM,eAAgB,CAIvB,MAAA,EAAyB,KAAK,mBAAmB,EACjD,GACH,KAAK,kBAAkB,EAAI,GAC5B,KAAK,gCACL,OAAO,iBAEL,GAAA,EAA2B,EACtB,OAAA,IAAI,EAAJ,KACL,IAAI,EAAJ,KAAS,EAAG,EAAyB,GACrC,KAAK,oBAKJ,OAAA,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAG,GAAI,KAAK,oBAK/B,iCACC,OAAA,EAAgB,gBAAA,aAAa,KAAK,MAAM,wBAAyB,KAAK,kBAGvE,6BACC,OAAA,EAAgB,gBAAA,UAAU,IAAI,EAAJ,KAAS,OAAO,iBAAkB,OAAO,mBAGpE,8BACF,IAAC,KAAK,cAAe,OACrB,IAAA,MAAC,EAAD,OAAQ,GAAU,KAAK,cAAc,wBAYrC,GAJJ,EAAQ,KAAK,MAAM,GACnB,EAAS,KAAK,MAAM,GAGN,IAAV,GAA0B,IAAX,EAAc,OAE3B,MAAA,EAAc,EAAQ,OAAO,iBAC7B,EAAe,EAAS,OAAO,iBAEjC,IAAgB,KAAK,cAAc,OAAS,IAAiB,KAAK,cAAc,SAG/E,KAAA,cAAc,MAAQ,EACtB,KAAA,cAAc,OAAS,GAGtB,iBACA,MAAA,EAAM,KAAK,WACb,IAAC,EAAK,OACN,GAAA,KAAK,MAAM,wBAAwB,UAAW,OAE5C,MAAA,EAAmB,KAAK,iCAExB,EAA4B,EAAS,SAAA,MAAQ,OAAO,iBACpD,EACJ,KAAK,gCAAkC,OAAO,iBAE1C,EAAmB,KAAK,mBAE9B,EAAI,UAAU,EAAG,EAAG,EAAiB,EAAG,EAAiB,GAEzD,EAAI,QAAU,OAA+B,OAAkC,EAAW,WAAA,YAC1F,EAAI,aAAe,aAEb,MAAA,GAAmB,EAAuB,EAAA,wBAAA,EAAK,IAAM,EAAN,SAAiB,KAChE,GACJ,EAAiB,uBAAuB,IAAI,EAAJ,KAAS,EAAkB,KAAO,IAAI,EAAJ,KAAS,EAAG,IACtF,EAEI,EAAmB,EAAI,OAAO,iBAE9B,EAAa,IAAI,EAAJ,wBACb,EAAkB,IAAI,EAAJ,wBAClB,EAA4B,IAAI,EAAJ,wBAC5B,EAA+B,IAAI,EAAJ,wBAC/B,EAAiC,IAAI,EAAJ,wBACjC,EAAoB,IAAI,EAAJ,wBAEpB,EAA8B,CAAC,EAAwB,EAAQ,KAtIW,IAAA,EAuIxE,MAAA,EAAQ,EAAM,IAAM,EAAM,MAC1B,EAAI,KAAK,MAAM,eAAiB,KAAK,kBAAkB,EAAI,EAAI,EAAQ,EACvE,EAAoB,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAM,MAAO,GAAI,IAAI,EAAJ,KAAS,EAAO,IAEzE,KAAA,EAAQ,GACR,EAAkB,OAAS,KAAK,MAAM,wBAAwB,SAC9D,EAAkB,QAAU,KAAK,MAAM,wBAAwB,QAA/D,CAEA,GAAA,KAAK,MAAM,gBACT,GAAA,EAAkB,SAAW,KAAK,MAAM,wBAAwB,MAAO,YAEvE,GAAA,EAAkB,MAAQ,KAAK,MAAM,wBAAwB,SAAU,OAGzE,GAAA,EAAkB,oBAAoB,KAAK,MAAM,yBAA0B,CACzE,IAAA,EAAsB,EAAiB,cAAc,GAiBrD,GAfA,EAAoB,OAAS,IAC/B,EAAsB,EACnB,WAAW,EAAoB,OAAO,MAAM,IAC5C,SACC,EAAoB,KAAK,MACvB,EAAoB,KAAK,EAAI,EAAoB,UAIrD,EAAoB,QAAU,EAAiB,IACjD,EAAsB,EAAoB,SACxC,EAAoB,KAAK,MAAM,EAAiB,EAAI,EAAoB,UAIxE,EAAoB,QAAU,EAAkB,CAC5C,MAAA,EAAgC,QAAxB,EAAA,KAAK,MAAM,qBAAa,IAAA,OAAA,EAAA,EAAE,iBAAiB,EAAM,KAAK,OAE9D,GAAc,EAClB,EAAA,aAAA,EACA,EAAM,KAAK,MAAM,KACjB,EAAoB,QAAU,EAAI,GAGhC,GAAA,EAAO,CACH,MAAA,GAAiC,EACrC,EAAA,0BAAA,EACA,GAKE,IAAA,EAAe,EACf,EAAO,EAAoB,OAAS,EAElC,MAAA,GAAW,EAA+B,GAA6B,EAAI,EAC5E,IAAA,IAAK,EAAY,KAAa,EAAgC,CACjE,IAAQ,EACN,EAAA,wBAAA,EACA,EAAY,cAAc,UAAU,EAAc,IAE9C,MAAA,GAAiB,EACrB,EAAA,wBAAA,EACA,EAAY,cAAc,UAAU,EAAY,IAElD,EAA0B,KAAK,CAC7B,EAAG,EACH,EAAG,EAAoB,MAAQ,EAC/B,EAAG,EACH,EAAG,EAA+B,EAAI,IAGxC,GAAQ,EACR,EAAe,IAIuB,MAA5B,KAAK,MAAM,eAA0B,EAA0B,EAAlB,GACrD,KAAK,CACT,KAAM,EAAY,cAGlB,EAAG,EAAoB,OAAS,EAChC,EAAG,KAAK,MACN,EAAoB,UACjB,EAA+B,GAA6B,MAKlE,IAAA,IAAI,KAAS,EAAM,SACtB,EAA4B,EAAO,EAAQ,KAIzC,EAAoB,EAAI,OAAO,iBACrC,EAAI,YAAc,KAAK,MAAM,MAAM,wBAC7B,MAAA,GACJ,EAAiB,uBAAuB,IAAI,EAAJ,KAAS,EAAG,KAAO,IAAI,EAAJ,KAAS,EAAG,IACvE,EAEI,EAA6B,CAAC,EAAwB,EAAQ,KAzOY,IAAA,EA0O1E,IAAC,KAAK,MAAM,cAA4C,MAA5B,KAAK,MAAM,cAAuB,OAC5D,MAAA,EAAQ,EAAM,IAAM,EAAM,MAC1B,EAAI,KAAK,MAAM,eAAiB,KAAK,kBAAkB,EAAI,EAAI,EAAQ,EACvE,EAAoB,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,EAAM,MAAO,GAAI,IAAI,EAAJ,KAAS,EAAO,IAEzE,KAAA,EAAQ,GACR,EAAkB,OAAS,KAAK,MAAM,wBAAwB,SAC9D,EAAkB,QAAU,KAAK,MAAM,wBAAwB,QAC/D,EAAkB,MAAQ,KAAK,MAAM,wBAAwB,UAA7D,CAEA,GAAA,EAAkB,oBAAoB,KAAK,MAAM,yBAA0B,CACzE,GAAwB,QAAxB,EAAA,KAAK,MAAM,qBAAa,IAAA,OAAA,EAAA,EAAE,iBAAiB,EAAM,KAAK,OAAQ,CAC1D,MAAA,EAAqB,EAAiB,cAAc,GAC1D,EAAkB,KAAK,CACrB,EAAG,KAAK,MAAM,EAAmB,OAAS,EAAoB,GAC9D,EAAG,KAAK,MAAM,EAAmB,MAAQ,EAAoB,GAC7D,EAAG,KAAK,MAAM,KAAK,IAAI,EAAG,EAAmB,QAAU,IACvD,EAAG,KAAK,MAAM,KAAK,IAAI,EAAG,EAAmB,SAAW,MAIxD,GAA2B,MAA3B,KAAK,MAAM,cAAwB,EAAM,KAAK,QAAU,KAAK,MAAM,aAAa,MAAO,CACrF,IAAA,EACF,EAAM,OAAS,KAAK,MAAM,aACtB,EACA,EAEA,MAAA,EAAqB,EAAiB,cAAc,GAC1D,EAAM,KAAK,CACT,EAAG,KAAK,MAAM,EAAmB,OAAS,EAAI,EAAoB,GAClE,EAAG,KAAK,MAAM,EAAmB,MAAQ,EAAI,EAAoB,GACjE,EAAG,KAAK,MAAM,KAAK,IAAI,EAAG,EAAmB,QAAU,EAAI,IAC3D,EAAG,KAAK,MAAM,KAAK,IAAI,EAAG,EAAmB,SAAW,EAAI,OAI7D,IAAA,IAAI,KAAS,EAAM,SACtB,EAA2B,EAAO,EAAQ,KAIzC,IAAA,IAAI,KAAS,KAAK,MAAM,WAAW,YAAY,IAAM,GACxD,EAA2B,GAGxB,IAAA,IAAI,KAAS,KAAK,MAAM,WAAW,YAAY,IAAM,GACxD,EAA4B,GAGxB,MAAA,EAAQ,KAAK,MAAM,MAYrB,GAVJ,EAAkB,KAAK,EAAK,EAAM,yBAClC,EAA0B,KAAK,EAAK,EAAM,2BAC1C,EAAgB,KAAK,EAAK,EAAM,kBAChC,EAAW,KACT,EAC4B,MAA5B,KAAK,MAAM,cAAwB,EAAM,qBAAuB,EAAM,gBAExE,EAA+B,OAAO,EAAK,EAAM,wBAAyB,GAC1E,EAA6B,OAAO,EAAK,EAAM,sBAAuB,GAElE,KAAK,aAAc,CACjB,IAAA,EAAgB,EAAM,eACtB,KAAK,MAAM,eAAiB,KAAK,aAAa,OAChD,EAAQ,EAAM,uBAGhB,EAAI,UAAY,EAAI,iBACpB,EAAI,YAAc,EAEZ,MAAA,EAAqB,EAAiB,cAAc,KAAK,aAAa,mBAC5E,EAAI,WACF,KAAK,MAAM,EAAmB,QAC9B,KAAK,MAAM,EAAmB,OAC9B,KAAK,MAAM,KAAK,IAAI,EAAG,EAAmB,UAC1C,KAAK,MAAM,KAAK,IAAI,EAAG,EAAmB,YAIzC,KAAA,uBAGC,uBACA,MAAA,EAAM,KAAK,WACb,IAAC,EAAK,OAEJ,MAAA,EACJ,KAAK,gCAAkC,OAAO,iBAC1C,EAAmB,KAAK,mBACxB,EAAmB,KAAK,iCAExB,GAAkB,EADU,EAAS,SAAA,MAAQ,OAAO,kBAC0B,EAE9E,EAAO,KAAK,MAAM,wBAAwB,OAC1C,EAAQ,KAAK,MAAM,wBAAwB,QAO3C,GAFJ,KAAK,iCAAiC,YAAc,IAAI,EAAJ,iBACpD,MAAM,KAAK,8BAC0B,gBAAgB,IAAI,EAAJ,KAAS,IAAK,IAAI,EAErE,IAAA,EADgB,KAAK,IAAI,GAAI,KAAK,MAAM,KAAK,MAAM,KAEnD,EAAiB,EAAW,EAC9B,GAAY,EACH,EAAiB,EAAW,IACrC,GAAY,GAGR,MAAA,EAAQ,KAAK,MAAM,MAEzB,CACQ,MAAA,EAAI,KAAK,MAAM,eAAiB,EAAiB,EAAI,EAA+B,EAE1F,EAAI,UAAY,EAAM,MAAA,WAAW,EAAM,gBAAgB,UAAU,IAAK,QACtE,EAAI,SAAS,EAAG,EAAG,EAAiB,EAAG,GACvC,EAAI,aAAe,MACd,IAAA,IAAI,EAAI,KAAK,KAAK,EAAO,GAAY,EAAU,EAAI,EAAO,GAAK,EAAU,CAEtE,MAAA,EAAM,KAAK,MAAM,EAAiB,kBAAkB,IAAI,EAAJ,KAAS,EAAG,IAAI,GACpE,EAAY,KAAK,MAAM,WAAW,YAAY,GAC9C,GAAY,EAAuB,EAAA,wBAAA,EAAK,GAC9C,EAAI,UAAY,EAAM,eACtB,EAAI,SAAS,EAAW,EAAM,EAAY,EAAgB,EAAI,GAC9D,EAAI,UAAY,EAAM,iBACtB,EAAI,SAAS,EAAK,EAAG,EAAG,EAAiB,KAKvC,4BACF,IAAC,KAAK,UAAW,OACf,MAAA,yBAAC,GAA4B,KAAK,MAClC,EAAS,KAAK,UAAU,yBACxB,MAAC,EAAD,OAAQ,GAAU,EAGpB,GAAA,EAAQ,GAAK,EAAS,EAAG,OAEzB,GAAA,KAAK,MAAM,wBAAwB,UAAW,CAC1C,MAAA,EAA4B,EAAS,KAAK,gCAC5C,KAAK,MAAM,eACR,KAAA,2BACH,IAAI,EAAJ,KACE,IAAI,EAAJ,KAAS,EAAG,KAAK,kBAAkB,EAAI,EAA4B,GACnE,IAAI,EAAJ,KAAS,KAAK,kBAAkB,EAAG,KAIlC,KAAA,2BACH,IAAI,EAAJ,KAAS,IAAI,EAAJ,KAAS,GAAI,GAAI,IAAI,EAAJ,KAAS,KAAK,kBAAkB,EAAG,UAIhE,EAAyB,OAAO,EAAK,KAAA,OACrC,EAAyB,IAAM,GAAS,EAAyB,IAAM,GAInE,KAAA,2BACH,KAAK,MAAM,wBAAwB,SACjC,KAAK,MAAM,wBAAwB,KAAK,eACtC,IAAI,EAAJ,KAAS,EAAQ,EAAyB,EAAG,EAAS,EAAyB,MAMjF,MAAA,EAAU,IAAI,EAAJ,KAAS,EAAO,GAC3B,EAAQ,OAAO,IACb,KAAA,MAAM,4BAA4B,GASnC,cACD,KAAK,YACL,KAAA,4BAED,KAAK,MAAM,wBAAwB,WAElC,KAAA,MAAM,cAAc,aAAa,KAAK,UAAW,KAC/C,KAAA,MAAM,mBAAmB,OAAO,CACnC,qBAAsB,KAAK,iBAC3B,mBAAoB,KAAK,MAAM,wBAC/B,gBAAgB,OA2Cd,IAAI,GACL,KAAA,gBAAkB,MAEjB,MAAA,EAAgB,KAAK,6BAA6B,gBAAgB,GAClE,EAAc,KAAK,iCAAiC,uBAAuB,GAE7E,KAAK,cACF,KAAA,MAAM,YAAY,MAGpB,GACA,KAAA,MAAM,kBAAkB,EAAgB,gBAAA,gBAAgB,IAGvD,KAAK,EAA8B,GACpC,KAAA,gBAAkB,OAEjB,MAAA,EAAiB,KAAK,6BAA6B,kBACvD,GAEI,EAAoB,KAAK,iCAAiC,yBAC9D,GAEE,IAAC,EAAmB,OAElB,MAAA,EAAgB,EAAgB,gBAAA,gBAAgB,EAAkB,OAAO,IAC5E,SAAS,IAAI,EAAJ,KAAS,EAAY,IAC9B,aAAa,GAEX,KAAA,MAAM,kBAAkB,GA0DvB,eACF,KAAK,aACP,SAAS,KAAK,MAAM,OAAS,WAC7B,SAAS,KAAK,MAAM,OAAS,oBAE7B,SAAS,KAAK,MAAM,OAAS,UAsIjC,wBACS,OAAA,EAET,0BAA0B,GACpB,KAAK,MAAM,aAAe,EAAU,YACjC,KAAA,aAAe,KACf,KAAA,gBACI,KAAK,MAAM,gBAAkB,EAAU,cAC3C,KAAA,eACI,KAAK,MAAM,eAAiB,EAAU,aAC1C,KAAA,eACI,KAAK,MAAM,0BAA4B,EAAU,wBACrD,KAAA,eACI,KAAK,MAAM,gBAAkB,EAAU,gBAC5C,KAAK,MAAM,eACR,KAAA,MAAM,cAAc,yBAAyB,KAAK,eAErD,EAAU,gBACZ,EAAU,cAAc,sBAAsB,KAAK,eACnD,EAAU,cAAc,iBAI9B,oBACO,KAAA,MAAM,cAAc,sBAAsB,KAAK,eACpD,OAAO,iBAAiB,SAAU,KAAK,gBACvC,OAAO,iBAAiB,UAAW,KAAK,kBAE1C,uBACO,KAAA,MAAM,cAAc,yBAAyB,KAAK,eACvD,OAAO,oBAAoB,SAAU,KAAK,gBAC1C,OAAO,oBAAoB,UAAW,KAAK,kBAG7C,SACQ,MAAA,EAAQ,KAAK,WAGjB,OAAA,EAAA,EAAA,GAAA,MAAA,CACE,WAAW,EAAI,EAAA,KAAA,EAAM,YAAa,EAAY,YAAA,MAC9C,YAAa,KAAK,YAClB,YAAa,KAAK,YAClB,aAAc,KAAK,aACnB,QAAS,KAAK,QACd,WAAY,KAAK,WACjB,QAAS,KAAK,QACd,IAAK,KAAK,eAEV,EAAA,EAAA,GAAA,SAAA,CAAQ,MAAO,EAAG,OAAQ,EAAG,IAAK,KAAK,iBAAkB,WAAW,EAAI,EAAA,KAAA,EAAM,UAruBF,QAAA,sBAAA;;ACGpF,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,SAAA,EAnEA,IAAA,EAAA,QAAA,WACA,EAAA,QAAA,aACA,EAAA,QAAA,UACA,EAAA,QAAA,kBACA,EAAA,QAAA,gBAQM,SAAU,EAAS,GACjB,MAAA,EAAQ,GAAS,EAAD,EAAA,cAEhB,cAAC,EAAD,OAAgB,GAAU,EAC1B,EAAiB,EAAc,EAC/B,EAAkB,EAAc,EAIhC,GAAiB,EAAa,EAAA,aAAA,IAC9B,IAAC,EAAI,OAEH,MAAA,EAAa,EAAG,wBAGlB,IAAA,EAAY,EAAO,EARC,EAYpB,EAAY,EAAW,MAAQ,EAAiB,IAClD,EAAY,EAAiB,EAAW,MAAQ,GAIhC,IAAK,EAAY,GAEnC,EAAG,MAAM,QAAU,MAGf,IAAA,EAAW,EAAO,EAtBE,EA4BpB,EAAW,EAAW,OAAS,EAAkB,IACnD,EAAW,EAAO,EAAI,EAAW,OAAS,GAI3B,IAAK,EAAW,GAEjC,EAAG,MAAM,OAAS,OAEjB,CAAC,EAAgB,EAAiB,EAAO,EAAG,EAAO,IAGpD,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAAW,IAAK,IACxC,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,cAAe,EAAM,WAKrD,MAAM,EAAmB,EAEnB,GAAW,EAAU,EAAA,WAAA,GACzB,EAAW,WAAA,OAAO,CAChB,SAAU,CACR,SAAU,WACV,WAAY,EAAM,eAClB,OAAQ,kBACR,SAAU,EAAM,MAAA,kBAChB,WATmB,EAUnB,cAVmB,EAWnB,cAAe,OACf,WAAY,OACZ,SAAU,EAAS,SAAA,MACnB,WAAY,EAAW,WAAA,UACvB,OAAQ,EAAO,OAAA,UAEjB,YAAa,CACX,aAAc,WACd,WAAY,SACZ,UAAW,SACX,YArBmB,EAsBnB,aAtBmB,EAuBnB,SAAU,EAAM,MAAA;;ACxBf,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,qBAAA,QAAA,gCAAA,QAAA,6BAAA,EAjEP,IAAA,EAAA,QAAA,iBACA,EAAA,QAAA,gBACA,EAAA,QAAA,iBACA,EAAA,QAAA,yBAKA,EAAA,QAAA,eACA,EAAA,QAAA,UAIO,MAAM,GAA0B,EAA2C,EAAA,eAAA,MAoD3E,QAAA,wBAAA,EAhCA,MAAM,EAAkC,EAC7C,WAAA,EACA,aAAA,EACA,gBAAA,EACA,wBAAA,EACA,2BAAA,EACA,SAAA,MAEM,MAAA,GAAoD,EAAW,EAAA,YAAA,EAAX,sBACpD,GAA0D,EAAQ,EAAA,SAAA,IAC1C,MAAxB,EACK,KAEF,IAAI,EAAJ,wBAA4B,EAAY,GAC9C,CAAC,EAAY,IAGd,OAAA,EAAC,EAAA,GAAA,EAAwB,SAAQ,CAC/B,MAAO,CACL,QAAS,EACT,WAAA,EACA,aAAA,EACA,gBAAA,EACA,wBAAA,EACA,2BAAA,IAGD,IAKA,QAAA,gCAAA,EAAA,MAAM,GAAuB,EAAK,EAAA,MAAA,KACjC,MAAA,GAAiB,EAAW,EAAA,YAAA,GAI5B,EAAkC,MAAlB,EAAyB,KAAO,EAAe,QAC/D,EAAiC,MAAlB,EAAyB,KAAO,EAAe,aAC9D,EAAoC,MAAlB,EAAyB,KAAO,EAAe,gBACjE,EACc,MAAlB,EAAyB,KAAO,EAAe,wBAC3C,EACc,MAAlB,EAAyB,KAAO,EAAe,2BAC3C,EAA+B,MAAlB,EAAyB,KAAO,EAAe,WAE5D,EAA8B,MAAjB,EAAwB,KAAO,EAAc,QAC1D,GAA6B,EAAQ,EAAA,SAAA,IACpB,MAAjB,EAA8B,KACd,MAAhB,EAA6B,KAC1B,EAAc,QAAQ,GAC5B,CAAC,EAAe,IAEb,GAAuB,EAC1B,EAAA,aAAA,IACK,IAAC,EAAiB,OAClB,IAAC,EAAY,OACb,IAAC,EAAyB,OAC1B,IAAC,EAA4B,OAQ3B,MAAA,EAA0B,EAAM,kBAEhC,EAAe,IAAI,EAAJ,KACnB,EAAwB,OAAO,MAAM,IAAI,EAAJ,KAAS,EAAG,IACjD,EAAwB,KAAK,MAAM,EAAwB,WAG7D,EAAgB,EAAM,MACtB,EACE,EAAW,kCAAkC,CAAC,wBAAyB,MAG3E,CAAC,EAAyB,EAA4B,EAAiB,KAGnE,WAAC,EAAD,WAAa,IAAc,EAAQ,EAAA,SAAA,IACrB,MAAd,GAAqC,IAAf,GAAqC,MAAjB,EACrC,CAAC,WAAY,OAAU,WAAY,QAGrC,CACL,WAAY,KACN,KAAC,MAAA,OAAa,EAAb,EAAe,IAAI,OACpB,GAAc,MAAd,GAAqC,IAAf,EAAkB,OAExC,IAAA,EAAuB,MAAf,EAAsB,EAAa,EAAI,EAAc,EAC7D,EAAQ,IAAG,EAAQ,EAAa,GAC9B,MAAA,EAAS,EAAc,GAAG,GAChC,EAAqB,IAGvB,WAAY,KACN,KAAC,MAAA,OAAa,EAAb,EAAe,IAAI,OACpB,GAAc,MAAd,GAAqC,IAAf,EAAkB,OAExC,IAAA,EAAuB,MAAf,EAAsB,EAAI,EAAc,EAChD,GAAS,IAAY,EAAQ,GAC3B,MAAA,EAAS,EAAc,GAAG,GAChC,EAAqB,KAGxB,CAAC,EAAY,EAAa,EAAe,IAG1C,OAAA,EAAC,EAAA,GAAA,EAAD,WAAW,CACT,YAAa,EACb,WAAY,EACZ,WAAY,EACZ,WAAY,MAlFX,QAAA,qBAAA;;AC5DoE,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,wBAAA,EAL3E,IAAA,EAAA,QAAA,UAKM,MAAgB,UAA8B,EAA9C,WAAqE,QAAA,mBAAA;;ACcA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,oBAAA,EAnB3E,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,aAIA,EAAA,QAAA,eACA,EAAA,QAAA,gBACA,EAAA,QAAA,6BAEA,EAAA,QAAA,WACA,EAAA,QAAA,4BACA,EAAA,QAAA,8BACA,EAAA,QAAA,cAEA,EAAA,QAAA,iBACA,EAAA,QAAA,4BACA,EAAA,QAAA,sBACA,EAAA,QAAA,yBAEM,MAAO,UAAuB,EAA9B,mBAAN,cAA2E,SAAA,WAYjE,KAAA,2BAA8B,CAAA,IAC9B,MAAA,EAA8B,EAAM,MAAA,mBAAqB,EAAM,MAAA,aAE/D,EAAkB,KAAK,kBAEvB,EAAQ,KAAK,MAAM,WAAW,wBAAwB,EAAa,KAAK,GACxE,EAAO,EAAa,KAAK,MAAM,GAE/B,EAAS,EAAK,KAAA,MAClB,EAAa,OACb,IAAI,EAAJ,KAAS,GAAI,GACb,EAAK,KAAA,IACH,EAAK,KAAA,KACL,EAAgB,MAAM,GAAM,KAAK,IAAI,EAAJ,KAAS,EAAG,EAA8B,MAI1E,KAAA,MAAM,2BAA2B,IAAI,EAAJ,KAAS,EAAQ,EAAa,KAAK,MAAM,OAGzE,KAAA,4BAA+B,CAAA,IAChC,KAAA,MAAM,4BAA4B,KAGjC,KAAA,kBAAqB,CAAA,IACrB,MAAA,EAAe,EAAU,cAAc,KAAK,MAAM,yBACnD,KAAA,2BAA2B,KAG1B,KAAA,YAAe,CAAA,IAChB,KAAA,MAAM,aAAa,KAG1B,KAAA,YAAe,CAAA,IACR,KAAA,MAAM,gBAAgB,KAoC7B,KAAA,UAAmC,KACnC,KAAA,aAAgB,CAAA,IACT,KAAA,UAAa,GAAgC,OAnF5C,WACC,OAAA,EAAmB,EAAA,oBAAA,KAAK,MAAM,OAG/B,kBACC,OAAA,IAAI,EAAJ,KACL,KAAK,MAAM,WAAW,iBACtB,KAAK,MAAM,WAAW,YAAY,QAyCtC,YAAY,GACJ,MACA,EAAW,IAAM,EADH,KAAK,MAAM,WAAW,iBAEpC,GAAmB,EAAc,EAAA,eAAA,GAChC,SAAG,KAAK,MAAM,WAAW,YAAY,OAAY,KAG1D,gBACM,IAAC,KAAK,UAAW,OAAO,KAEtB,MAAA,MAAC,GAAS,KAAK,MACjB,IAAC,EAAO,OAAO,KACb,MAAA,MAAC,EAAD,OAAQ,EAAR,KAAgB,EAAhB,IAAsB,GAAO,KAAK,UAAU,wBAC5C,EAAS,IAAI,EAAJ,KAAS,EAAM,MAAM,QAAU,EAAM,EAAM,MAAM,QAAU,GACpE,EAAQ,EAAM,KAAK,MAEnB,EAAQ,KAAK,WAGjB,OAAA,EAAC,EAAA,GAAA,EAAD,SAAS,CAAC,cAAe,IAAI,EAAJ,KAAS,EAAO,GAAS,OAAQ,IACxD,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,aACxB,KAAK,YAAY,EAAM,KAAK,mBACvB,IACP,EAAM,KACN,EAAM,MACL,EAAA,EAAA,GAAA,MAAA,KACG,EAAM,KADT,IACgB,EAAM,WAEpB,GAUV,SACQ,MAAA,EAAQ,KAAK,WAGjB,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,KAAM,EAAY,YAAA,MAAO,IAAK,KAAK,eAC3D,EAAC,EAAA,GAAA,EAAD,sBAAsB,CACpB,MAAO,KAAK,MAAM,MAClB,wBAAyB,KAAK,MAAM,wBACpC,kBAAmB,KAAK,kBACxB,WAAY,KAAK,MAAM,WACvB,mBAAoB,KAAK,MAAM,mBAC/B,cAAe,KAAK,MAAM,cAC1B,2BAA4B,KAAK,8BAEnC,EAAC,EAAA,GAAA,EAAqB,qBAAA,SAAQ,KAC3B,IACC,EAAC,EAAA,GAAA,EAAD,SAAS,MACP,EAAC,EAAA,GAAA,EAAD,sBAAsB,CACpB,MAAO,KAAK,MAAM,MAClB,cAAe,KAAK,MAAM,cAC1B,WAAY,KAAK,MAAM,WACvB,mBAAoB,KAAK,MAAM,mBAC/B,gBAAgB,EAChB,YAAa,KAAK,YAClB,aAAc,KAAK,YACnB,aAAc,KAAK,MAAM,aACzB,kBAAmB,KAAK,kBACxB,wBAAyB,KAAK,MAAM,wBACpC,2BAA4B,KAAK,2BACjC,yBAA0B,KAAK,MAAM,yBACrC,4BAA6B,KAAK,4BAClC,cAAe,KAEjB,EAAC,EAAA,GAAA,EAAD,qBAAqB,QAI1B,KAAK,gBACL,KAAK,MAAM,eACV,EAAC,EAAA,GAAA,EAAD,qBAAqB,CACnB,WAAY,KAAK,MAAM,WACvB,oBAAqB,KAAK,MAAM,oBAChC,aAAc,KAAK,MAAM,iBAjIsC,QAAA,eAAA;;ACyJpE,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,qBAAA,EAAA,QAAA,wBAAA,QAAA,uBAAA,QAAA,qBAAA,QAAA,iCAAA,QAAA,6BAAA,EA5KP,IAAA,EAAA,QAAA,UAEA,EAAA,QAAA,qBACA,EAAA,QAAA,6BAEA,EAAA,QAAA,gBACA,EAAA,QAAA,qBACA,EAAA,QAAA,wBAQA,EAAA,QAAA,iBAEA,EAAA,QAAA,4BACA,EAAA,QAAA,kBACA,EAAA,QAAA,8BACA,EAAA,QAAA,gBASM,SAAU,EAAqB,GAC5B,MAAA,CACL,cAAc,EACX,EAAA,aAAA,IACkB,EAAA,iBAAA,yBAAyB,EAAI,IAEhD,CAAC,IAEH,6BAA6B,EAC1B,EAAA,aAAA,IACkB,EAAA,iBAAA,4BAA4B,EAAI,IAEnD,CAAC,IAEH,4BAA4B,EACzB,EAAA,aAAA,IACkB,EAAA,iBAAA,2BAA2B,EAAI,IAElD,CAAC,IAEH,iBAAiB,EACd,EAAA,aAAA,IACkB,EAAA,iBAAA,gBAAgB,EAAI,IAEvC,CAAC,KAeA,MAAM,GAA0B,EACrC,EAAA,0BAAA,EACE,QAAA,EACA,uBAAA,KAKO,IAAI,EAAJ,WAAe,CACpB,eAAgB,EAAQ,eAAe,KAAK,GAC5C,YAAa,EAAQ,YAAY,KAAK,GACtC,YAAa,EAAQ,YAAY,KAAK,GACtC,uBAAA,KA4FC,QAAA,wBAAA,EAvFA,MAAM,EAAoC,IAC/C,EACE,EAAA,0BAAA,EACE,cAAA,EACA,WAAA,KAKO,IAAI,EAAJ,mBACL,EAAc,IACd,EAAY,EAAA,aAAA,GACZ,EACA,EAAc,uBACd,EAAc,4BACd,IAwED,QAAA,iCAAA,EAnEP,MAAM,EAAkC,IAO3B,GAAuB,EAAM,EAAA,MAAA,IAClC,MAAA,mBAAC,EAAD,SAAqB,GAAY,GACjC,QAAC,EAAD,gBAAU,GAAmB,EAE7B,GAAQ,EAAd,EAAA,YAEM,GAAgB,EAAiB,EAAA,kBAAA,CAAC,MAAA,EAAO,OAAQ,IACjD,GAAqB,EAAsB,EAAA,uBAAA,GAC3C,GAAyB,EAA6B,EAAA,8BAAA,GACtD,GAAsB,EAA0B,EAAA,2BAAA,CAAC,MAAA,EAAO,mBAAA,IAExD,EAAa,EAAwB,CAAC,QAAA,EAAS,uBAAA,IAC/C,EAAqB,EAAgC,CACzD,cAAA,EACA,WAAA,IAGI,EAAU,EAAqB,EAAa,aAAA,QAGhD,OAAA,EAAC,EAAA,GAAA,EAAD,gCAAgC,CAC9B,WAAY,EACZ,aAAc,EAAgB,aAC9B,gBAAiB,EAAQ,gBACzB,wBAAyB,EAAgB,wBACzC,2BAA4B,EAAQ,6BAEpC,EAAC,EAAA,GAAA,EAAD,eAAe,OAAA,OAAA,CACb,MAAO,EACP,gBAAgB,EAChB,WAAY,EACZ,mBAAoB,EACpB,cAAe,EACf,oBAAqB,GACjB,EACA,OAyBL,QAAA,qBAAA,EAnBA,MAAM,GAAyB,EACpC,EAAA,0BAAA,EACE,QAAA,EACA,uBAAA,KAKO,IAAI,EAAJ,WAAe,CACpB,eAAgB,EAAQ,sBAAsB,KAAK,GACnD,YAAa,EAAQ,mBAAmB,KAAK,GAC7C,YAAa,EAAQ,YAAY,KAAK,GACtC,uBAAA,KAOC,QAAA,uBAAA,EAFP,MAAM,EAAiC,IAE1B,GAA0B,EAAM,EAAA,MAAA,IACrC,MAAA,mBAAC,EAAD,SAAqB,GAAY,GAEjC,QAAC,EAAD,mBAAU,GAAsB,EAEhC,GAAQ,EAAd,EAAA,YAEM,GAAgB,EAAiB,EAAA,kBAAA,CAAC,MAAA,EAAO,OAAQ,IACjD,GAAqB,EAAsB,EAAA,uBAAA,GAC3C,GAAyB,EAA6B,EAAA,8BAAA,GACtD,GAAsB,EAA0B,EAAA,2BAAA,CAAC,MAAA,EAAO,mBAAA,IAExD,EAAa,EAAuB,CACxC,QAAA,EACA,uBAAA,IAEI,EAAqB,EAA+B,CACxD,cAAA,EACA,WAAA,IAGI,EAAU,EAAqB,EAAa,aAAA,YAGhD,OAAA,EAAC,EAAA,GAAA,EAAD,gCAAgC,CAC9B,WAAY,EACZ,aAAc,EAAmB,aACjC,gBAAiB,EAAQ,gBACzB,wBAAyB,EAAmB,wBAC5C,2BAA4B,EAAQ,6BAEpC,EAAC,EAAA,GAAA,EAAD,eAAe,OAAA,OAAA,CACb,MAAO,EACP,gBAAgB,EAChB,WAAY,EACZ,mBAAoB,EACpB,cAAe,EACf,oBAAqB,GACjB,EACA,OAvCL,QAAA,wBAAA;;ACzEA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,SAAA,QAAA,uBAAA,EAlGP,IAAA,EAAA,QAAA,aACA,EAAA,QAAA,UACA,EAAA,QAAA,WACA,EAAA,QAAA,eACA,EAAA,QAAA,8BACA,EAAA,QAAA,gBACA,EAAA,QAAA,cAEA,EAAA,QAAA,kBACA,EAAA,QAAA,yBAEM,MAAO,UAA0B,EAAjC,mBAAN,cAuFO,SAAA,WA/EG,KAAA,2BAA8B,CAAA,IAC/B,KAAA,MAAM,2BAA2B,KAAK,0BAA0B,MAE/D,KAAA,4BAA+B,CAAA,IAChC,KAAA,MAAM,4BAA4B,KAGjC,KAAA,kBAAqB,CAAA,IACtB,KAAA,2BAA2B,EAAU,cAAc,KAAK,MAAM,4BA+BrE,KAAA,UAAmC,KACnC,KAAA,aAAgB,CAAA,IACT,KAAA,UAAa,GAAgC,OAE5C,KAAA,aACN,CAAA,IAKK,KAAA,MAAM,aAAa,KAxDlB,0BAA0B,GAC1B,MAAA,WAAC,EAAD,eAAa,GAAkB,KAAK,MACnC,OAAA,EAAW,kCAAkC,CAClD,wBAAyB,EACzB,eAAA,IAaI,YAAY,GACZ,MACA,EAAW,IAAM,EADH,KAAK,MAAM,WAAW,iBAEpC,GAAmB,EAAc,EAAA,eAAA,GAChC,SAAG,KAAK,MAAM,WAAW,YAAY,OAAY,KAElD,gBACF,IAAC,KAAK,UAAW,OAAO,KACtB,MAAA,MAAC,GAAS,KAAK,MACjB,IAAC,EAAO,OAAO,KACb,MAAA,MAAC,EAAD,OAAQ,EAAR,KAAgB,EAAhB,IAAsB,GAAO,KAAK,UAAU,wBAC5C,EAAS,IAAI,EAAJ,KAAS,EAAM,MAAM,QAAU,EAAM,EAAM,MAAM,QAAU,GACpE,EAAQ,EAAS,KAAK,MAAM,OAC5B,EAAQ,EAAM,KAAK,MAGvB,OAAA,EAAC,EAAA,GAAA,EAAD,SAAS,CAAC,cAAe,IAAI,EAAJ,KAAS,EAAO,GAAS,OAAQ,IACxD,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,aACxB,KAAK,YAAY,EAAM,KAAK,mBACvB,IACP,EAAM,KACN,EAAM,MACL,EAAA,EAAA,GAAA,MAAA,KACG,EAAM,KADT,IACgB,EAAM,WAEpB,GAgBV,SAEI,OAAA,EAAA,EAAA,GAAA,MAAA,CACE,WAAW,EAAI,EAAA,KAAA,EAAY,YAAA,MAAO,EAAY,YAAA,MAAO,EAAY,YAAA,MACjE,IAAK,KAAK,eAEV,EAAC,EAAA,GAAA,EAAD,sBAAsB,CACpB,MAAO,KAAK,MAAM,MAClB,aAAc,KACd,YAAa,KAAK,aAClB,aAAc,EAJM,KAKpB,wBAAyB,KAAK,MAAM,wBACpC,2BAA4B,KAAK,2BACjC,kBAAmB,KAAK,kBACxB,WAAY,KAAK,MAAM,WACvB,mBAAoB,KAAK,MAAM,mBAC/B,cAAe,KAAK,MAAM,cAC1B,eAAgB,KAAK,MAAM,eAC3B,yBAA0B,KAAK,MAAM,yBACrC,4BAA6B,KAAK,4BAClC,cAAe,OAEhB,KAAK,kBAMP,QAAA,kBAAA,EAAA,MAAM,GAAW,EAAU,EAAA,WAAA,GAChC,EAAW,WAAA,OAAO,CAChB,WAAY,CACV,MAAO,EAAM,gBAHZ,QAAA,SAAA;;AC3CA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,kCAAA,EAxDP,IAAA,EAAA,QAAA,gBAEA,EAAA,QAAA,qBACA,EAAA,QAAA,+BAKA,EAAA,QAAA,wBAMA,EAAA,QAAA,wBACA,EAAA,QAAA,UACA,EAAA,QAAA,iBACA,EAAA,QAAA,kBACA,EAAA,QAAA,8BACA,EAAA,QAAA,gBACA,EAAA,QAAA,eAEA,MAAM,GAA2B,EAC/B,EAAA,0BAAA,EACE,QAAA,EACA,MAAA,EACA,iBAAA,MAMI,IAAA,EAAI,EAAQ,+BAA+B,GACxC,OAAA,EAAmB,EAAE,mCAAqC,IAI/D,GAA8B,EAClC,EAAA,0BAAA,EACE,sBAAA,EACA,uBAAA,KAKO,IAAI,EAAJ,WAAe,CACpB,eAAgB,EAAsB,sBAAsB,KAAK,GACjE,YAAa,EAAsB,mBAAmB,KAAK,GAC3D,YAAa,EAAsB,YAAY,KAAK,GACpD,uBAAA,KAKA,GAAsC,EAAiC,EAAA,kCAAA,CAAC,UAAU,IAE3E,GAA+B,EAAM,EAAA,MAAA,IAC1C,MAAA,mBAAC,GAAsB,EACzB,IAAA,QAAC,EAAD,kBAAU,GAAqB,EAC7B,MAAA,GAAmB,EAAQ,EAAA,SAAA,EAAR,sBACnB,GAAW,EAAQ,EAAA,SAAA,EAAR,cACX,GAAQ,EAAd,EAAA,YAEI,IAAC,EAAS,MAAM,IAAI,MAAM,mBAC1B,IAAC,EAAU,MAAM,IAAI,MAAM,oBACzB,MAAA,aAAC,GAAgB,EACnB,IAAC,EAAc,MAAM,IAAI,MAAM,wBAC7B,MAAA,cAAC,GAAiB,EAElB,GAAqB,EAAsB,EAAA,uBAAA,GAC3C,GAAyB,EAA6B,EAAA,8BAAA,GACtD,GAAsB,EAA0B,EAAA,2BAAA,CAAC,MAAA,EAAO,mBAAA,IACxD,GAAgB,EAAiB,EAAA,kBAAA,CAAC,MAAA,EAAO,OAAQ,IAEjD,EAAa,EAA4B,CAC7C,sBAAuB,EAAyB,CAC9C,QAAA,EACA,MAAO,EACP,iBAAA,IAEF,uBAAA,IAEI,EAAqB,EAAoC,CAAC,cAAA,EAAe,WAAA,IAG7E,OAAA,EAAC,EAAA,GAAA,EAAD,kBAAkB,OAAA,OAAA,CAChB,MAAO,EACP,gBAAgB,EAChB,WAAY,EACZ,mBAAoB,EACpB,cAAe,EACf,oBAAqB,IACjB,EAAqB,EAAA,sBAAA,EAAa,aAAA,2BAClC,EAAa,yBAAwB,CAEzC,gBAAiB,EAAA,UAvChB,QAAA,6BAAA;;ACLA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,0BAAA,EAnDP,IAAA,EAAA,QAAA,gBAEA,EAAA,QAAA,qBACA,EAAA,QAAA,+BAKA,EAAA,QAAA,wBAMA,EAAA,QAAA,wBACA,EAAA,QAAA,UACA,EAAA,QAAA,iBACA,EAAA,QAAA,kBACA,EAAA,QAAA,8BACA,EAAA,QAAA,gBACA,EAAA,QAAA,eAEA,MAAM,GAAmB,EAOvB,EAAA,0BAAA,EAAE,QAAA,EAAS,MAAA,EAAO,iBAAA,MACd,IAAA,EAAI,EAAQ,uBAAuB,GAChC,OAAA,EAAmB,EAAE,mCAAqC,IAG7D,GAAsB,EAM1B,EAAA,0BAAA,EAAE,cAAA,EAAe,uBAAA,KACV,IAAI,EAAJ,WAAe,CACpB,eAAgB,EAAc,sBAAsB,KAAK,GACzD,YAAa,EAAc,mBAAmB,KAAK,GACnD,YAAa,EAAc,YAAY,KAAK,GAC5C,uBAAA,KAIE,GAA8B,EAApC,EAAA,oCAEa,GAAuB,EAAM,EAAA,MAAA,IAClC,MAAA,mBAAC,GAAsB,GACvB,QAAC,EAAD,kBAAU,GAAqB,EAC/B,GAAmB,EAAQ,EAAA,SAAA,EAAR,sBACnB,GAAW,EAAQ,EAAA,SAAA,EAAR,cACX,GAAQ,EAAd,EAAA,YAEI,IAAC,EAAS,MAAM,IAAI,MAAM,mBAC1B,IAAC,EAAU,MAAM,IAAI,MAAM,oBACzB,MAAA,aAAC,GAAgB,EACnB,IAAC,EAAc,MAAM,IAAI,MAAM,wBAC7B,MAAA,cAAC,GAAiB,EAElB,GAAqB,EAAsB,EAAA,uBAAA,GAC3C,GAAyB,EAA6B,EAAA,8BAAA,GACtD,GAAsB,EAA0B,EAAA,2BAAA,CAAC,MAAA,EAAO,mBAAA,IACxD,GAAgB,EAAiB,EAAA,kBAAA,CAAC,MAAA,EAAO,OAAQ,IAEjD,EAAa,EAAoB,CACrC,cAAe,EAAiB,CAAC,QAAA,EAAS,MAAO,EAAe,iBAAA,IAChE,uBAAA,IAEI,EAAqB,EAA4B,CAAC,cAAA,EAAe,WAAA,IAGrE,OAAA,EAAC,EAAA,GAAA,EAAD,kBAAkB,OAAA,OAAA,CAChB,MAAO,EACP,gBAAgB,EAChB,WAAY,EACZ,mBAAoB,EACpB,cAAe,EACf,oBAAqB,IACjB,EAAqB,EAAA,sBAAA,EAAa,aAAA,kBAClC,EAAa,iBAAgB,CAEjC,gBAAiB,EAAA,UAnChB,QAAA,qBAAA;;AC7CA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,wBAAA,EANP,IAAA,EAAA,QAAA,iBACA,EAAA,QAAA,gBACA,EAAA,QAAA,iBACA,EAAA,QAAA,UACA,EAAA,QAAA,mBAEO,MAAM,GAAqB,EAAK,EAAA,MAAA,KAC/B,MAAA,GAAsB,EAAW,EAAA,YAAA,EAAX,qBAEtB,EAAiC,MAAvB,EAA8B,EAAoB,QAAU,KACtE,EACkC,OAAtC,MAAA,OAAmB,EAAnB,EAAqB,eACjB,EAAoB,iBAAiB,EAAoB,eACzD,KACA,EAAwB,MAAX,EAAkB,EAAQ,OAAS,MAEhD,WAAC,EAAD,WAAa,IAAc,EAAQ,EAAA,SAAA,IACxB,MAAX,GAAiC,MAAd,GAAqC,IAAf,GAA2C,MAAvB,EACxD,CAAC,WAAY,OAAU,WAAY,QAGrC,CACL,WAAY,KACN,IAAA,EAAuB,MAAf,EAAsB,EAAa,EAAI,EAAc,EAC7D,EAAQ,IAAG,EAAQ,EAAa,GACpC,EAAoB,iBAAiB,EAAQ,KAE/C,WAAY,KACN,IAAA,EAAuB,MAAf,EAAsB,EAAI,EAAc,EAChD,GAAS,IAAY,EAAQ,GACjC,EAAoB,iBAAiB,EAAQ,MAGhD,CAAC,EAAa,EAAS,EAAY,IAGpC,OAAA,EAAC,EAAA,GAAA,EAAD,WAAW,CACT,YAAa,EACb,WAAY,EACZ,WAAY,EACZ,WAAY,MAlCX,QAAA,mBAAA;;AC6IA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,sBAAA,QAAA,yBAAA,EAlJP,IAAA,EAAA,QAAA,aACA,EAAA,QAAA,wBACA,EAAA,QAAA,UACA,EAAA,QAAA,iBACA,EAAA,QAAA,gBACA,EAAA,QAAA,WACA,EAAA,QAAA,qCACA,EAAA,QAAA,4BACA,EAAA,QAAA,0BAEA,EAAA,QAAA,gBACA,EAAA,QAAA,iBACA,EAAA,QAAA,kBACA,EAAA,QAAA,gBACA,EAAA,QAAA,eACA,EAAA,QAAA,yBAWA,MAAM,UAAqB,EAA3B,mBAAA,cAwHO,SAAA,WAvHG,KAAA,iBAAoB,CAAA,IACrB,KAAA,MAAM,iBAAiB,KAG9B,KAAA,iBAAoB,CAAA,IACH,WAAX,EAAG,KACA,KAAA,iBAAiB,QAI1B,oBACE,OAAO,iBAAiB,UAAW,KAAK,kBAE1C,uBACE,OAAO,oBAAoB,UAAW,KAAK,kBAG7C,SACQ,MAAA,EAAQ,EAAS,KAAK,MAAM,QAE5B,cAAC,GAAiB,KAAK,MACzB,IAAA,EAAsC,KA6BxC,OA3BE,IACF,GACE,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAY,YAAA,MAAO,EAAM,kBAAmB,EAAY,YAAA,QAC1E,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAY,YAAA,KAAM,EAAM,qBAC1C,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,yBACxB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,kBAAgB,aAE5C,EAAC,EAAA,GAAA,EAAD,6BAA6B,CAC3B,SAAU,KAAK,MAAM,SACrB,mBAAoB,KAAK,MAAM,uBAGnC,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,YAC1B,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAY,YAAA,KAAM,EAAM,qBAC1C,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,sBAAuB,EAAM,+BACrD,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,gBAAiB,EAAM,wBAAsB,aAEzE,EAAC,EAAA,GAAA,EAAD,qBAAqB,CACnB,SAAU,KAAK,MAAM,SACrB,mBAAoB,KAAK,MAAM,yBAQvC,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAY,YAAA,KAAM,EAAY,YAAA,SAChD,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,aACxB,EAAC,EAAA,GAAA,EAAD,0BAA0B,CAAC,mBAAoB,KAAK,MAAM,sBAC1D,EAAC,EAAA,GAAA,EAAD,mBAAmB,OAEpB,IAMT,MAAM,GAAW,EAAU,EAAA,WAAA,GACzB,EAAW,WAAA,OAAO,CAChB,UAAW,CACT,SAAU,WACV,KAAM,GAER,kBAAmB,CACjB,KAAM,GAER,sBAAuB,CACrB,QAAS,OACT,cAAe,SACf,eAAgB,WAChB,WAAY,aACZ,SAAU,EAAS,SAAA,MACnB,MAAwB,IAAjB,EAAS,SAAA,MAChB,yBAA0B,EAAM,oBAElC,4BAA6B,CAC3B,eAAgB,cAElB,gBAAiB,CACf,UAAW,iBACX,gBAAiB,YACjB,MAAwB,IAAjB,EAAS,SAAA,MAChB,WAAY,GAEd,sBAAuB,CACrB,UAAW,iBACX,QAAS,OACT,eAAgB,YAElB,kBAAmB,CACjB,KAAM,EACN,cAAe,EAAM,MAAA,4BAA4B,EAAM,oBAEzD,QAAS,CACP,OAAQ,EACR,WAAY,EAAM,qBAkBX,GAAsB,EAA8C,EAAA,eAAA,MAE1E,QAAA,oBAAA,EAAA,MAAM,GAAwB,EAAM,EAAA,MAAA,IACnC,MAAA,mBAAC,EAAD,SAAqB,GAAY,GACjC,kBAAC,EAAD,MAAoB,GAAS,GAC7B,aAAC,GAAgB,EAEjB,GAAQ,EAAd,EAAA,YACM,GAAmB,EAAa,EAAA,aAAA,IACnB,EAAA,iBAAA,iBAAiB,IACjC,IAEG,EAAU,EAAmB,QAC7B,GAAkB,EAAQ,EAAA,SAAA,EAAR,qBAClB,GAAuB,EAAW,EAAA,YAAA,EAAX,sBAEvB,EAAgB,EAAe,EAAa,cAAgB,KAE5D,GAAmB,EAAQ,EAAA,SAAA,KACzB,MAAA,EAAmB,GASjB,OAPR,EAAQ,aAAa,IACf,IAAyB,EAAqB,iBAAiB,IAGnE,EAAQ,KAAK,KAGP,EAAgB,OACjB,KAAA,EAAU,UAAA,aACN,EAAA,EAAA,QAAA,EAAS,GAAK,EAAE,KAAK,eAC5B,MAEG,KAAA,EAAU,UAAA,MACN,EAAA,EAAA,QAAA,EAAS,GAAK,EAAE,iBACvB,MAEG,KAAA,EAAU,UAAA,OACN,EAAA,EAAA,QAAA,EAAS,GAAK,EAAE,kBAQpB,OAJH,EAAgB,YAAc,EAAc,cAAA,YAC9C,EAAQ,UAGH,GACN,CAAC,EAAS,EAAsB,IAE7B,GAAoD,EAAQ,EAAA,SAAA,KAC1D,MAAA,EAAe,IAAI,IACpB,IAAA,IAAI,EAAI,EAAG,EAAI,EAAQ,OAAQ,IAClC,EAAa,IAAI,EAAQ,GAAI,GAEvB,OAAA,IACA,MAAA,EAAQ,EAAa,IAAI,GACxB,OAAS,MAAT,EAAgB,KAAO,IAE/B,CAAC,IAEE,GAAsE,EAAQ,EAAA,SAAA,IAC1E,GACsB,MAAxB,EAAqC,KAClC,EAAqB,iBAAiB,GAE9C,CAAC,IAEE,EAAuC,CAC3C,QAAA,EACA,cAAA,EACA,iBAAA,EACA,iBAAA,EACA,uBAAA,GAIA,OAAA,EAAC,EAAA,GAAA,EAAoB,SAAQ,CAAC,MAAO,IACnC,EAAC,EAAA,GAAA,EAAY,CACX,MAAO,EACP,mBAAoB,EACpB,SAAU,EACV,iBAAkB,EAClB,cAAe,EACf,aAAc,OAjFf,QAAA,sBAAA;;ACvGmB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,cAAA,QAAA,cAAA,QAAA,uBAAA,EA3C1B,IAAA,EAAA,QAAA,WAOM,MAAO,EAAb,cACE,KAAA,KAA6B,OAC7B,OAAO,GACE,OAAA,EAAE,kBAiCa,QAAA,kBAAA,EA7BpB,MAAO,EAGX,YAAmB,GAAA,KAAA,KAAA,EACW,KAAK,WAApB,gBAAT,EAA0C,KAC5B,iBAAT,EAA2C,KAClC,iBAAT,EAA2C,KAC7B,EAGzB,eAAe,GACP,MAAA,EAAI,EAAI,KAAK,WAEf,GAAA,EAAI,IAAM,EAAG,CACT,MAAA,EAAU,KAAK,MAAM,EAAI,IACzB,EAAU,KAAK,MAAM,EAAc,GAAV,GAAc,WACtC,SAAG,MAAW,EAAQ,EAAA,SAAA,EAAS,KAEpC,OAAA,EAAI,GAAK,KAAa,EAAE,QAAQ,MAChC,EAAI,MAAQ,MAAc,EAAI,MAAM,QAAQ,OAC5C,EAAI,MAAQ,MAAc,EAAI,MAAM,QAAQ,WAChC,EAAI,MAAM,QAAQ,OAGpC,OAAO,GACE,SAAG,EAAI,EAAI,IAAM,KAAK,KAAK,eAAe,KAAK,IAAI,OAIpC,QAAA,cAAA,EAApB,MAAO,EAAb,cACE,KAAA,KAA6B,QAE7B,OAAO,GACD,OAAA,EAAI,QAAgB,EAAE,QAAQ,QAClC,GAAK,MACG,QAAgB,EAAE,QAAQ,SAClC,GAAK,MACG,QAAgB,EAAE,QAAQ,YAClC,GAAK,MACO,QAAQ,SAVE,QAAA,cAAA;;AC5C1B,IAAIO,EAAY,KAChB,SAASC,IAKAD,OAJFA,IACHA,EAAYE,KAGPF,EAGT,SAASE,IAEH,IACI,MAAA,IAAI9b,MACV,MAAOuF,GACHwW,IAAAA,GAAW,GAAKxW,EAAIyW,OAAOjL,MAAM,iEACjCgL,GAAAA,EACKE,OAAAA,EAAWF,EAAQ,IAIvB,MAAA,IAGT,SAASE,EAAWC,GACX,OAAC,GAAKA,GAAK3iB,QAAQ,uEAAwE,MAAQ,IAG5GuG,QAAQgc,aAAeD,EACvB/b,QAAQmc,WAAaA;;AC5BrB,IAAIH,EAAeK,QAAQ,gBAAgBL,aAE3C,SAASM,EAAgBC,GAClB/jB,MAAMC,QAAQ8jB,KACjBA,EAAU,CAACA,IAGTC,IAAAA,EAAKD,EAAQA,EAAQ1oB,OAAS,GAE9B,IACK2L,OAAAA,QAAQG,QAAQ0c,QAAQG,IAC/B,MAAO/W,GACHA,GAAa,qBAAbA,EAAIgX,KACC,OAAA,IAAIC,EAAY,SAAU/c,EAASgd,GACxCC,EAAYL,EAAQ5iB,MAAM,GAAI,IAC3B8F,KAAK,WACG4c,OAAAA,QAAQG,KAEhB/c,KAAKE,EAASgd,KAIflX,MAAAA,GAIV,SAASmX,EAAYL,GACZ/c,OAAAA,QAAQqd,IAAIN,EAAQvU,IAAI8U,IAGjC,IAAIC,EAAgB,GACpB,SAASC,EAAqBvpB,EAAMoV,GAClCkU,EAActpB,GAAQoV,EAGxB9I,OAAOC,QAAUA,QAAUsc,EAC3Btc,QAAQid,KAAOL,EACf5c,QAAQkd,SAAWF,EAEnB,IAAIT,EAAU,GACd,SAASO,EAAWK,GACdX,IAAAA,EAMAD,GALA/jB,MAAMC,QAAQ0kB,KAChBX,EAAKW,EAAO,GACZA,EAASA,EAAO,IAGdZ,EAAQY,GACHZ,OAAAA,EAAQY,GAGb1pB,IAAAA,GAAQ0pB,EAAOxJ,UAAUwJ,EAAOC,YAAY,KAAO,EAAGD,EAAOtpB,SAAWspB,GAAQzjB,cAChF2jB,EAAeN,EAActpB,GAC7B4pB,OAAAA,EACKd,EAAQY,GAAUE,EAAarB,IAAiBmB,GACpD1d,KAAK,SAAU8J,GAKPA,OAJHA,GACFxJ,OAAOod,OAAOD,SAASV,EAAIjT,GAGtBA,IACN+T,MAAM,SAASljB,GAGVA,aAFCmiB,EAAQY,GAET/iB,SAXRijB,EAgBN,SAASX,EAAYa,GACdA,KAAAA,SAAWA,EACXlU,KAAAA,QAAU,KAGjBqT,EAAYrhB,UAAUoE,KAAO,SAAU+d,EAAWC,GAEzC,OADc,OAAjB,KAAKpU,UAAkB,KAAKA,QAAU,IAAI7J,QAAQ,KAAK+d,WACpD,KAAKlU,QAAQ5J,KAAK+d,EAAWC,IAGtCf,EAAYrhB,UAAUiiB,MAAQ,SAAUG,GAE/B,OADc,OAAjB,KAAKpU,UAAkB,KAAKA,QAAU,IAAI7J,QAAQ,KAAK+d,WACpD,KAAKlU,QAAQiU,MAAMG;;ACwduB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,uBAAA,QAAA,wBAAA,QAAA,QAAA,QAAA,aAAA,QAAA,MAAA,QAAA,gBAAA,EAziBnD,IAAA,EAAA,QAAA,WACA,EAAA,QAAA,sBAwiBmD,EAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,IAAA,IAAA,EAAA,UAAA,SAAA,EAAA,GAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,KAAA,IAAA,MAAA,GAAA,EAAA,IAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,MAAA,IAAA,MAAA,GAAA,EAAA,IAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,KAAA,EAAA,EAAA,QAAA,EAAA,EAAA,MAAA,aAAA,EAAA,EAAA,IAAA,EAAA,SAAA,GAAA,EAAA,MAAA,KAAA,EAAA,GAAA,GAAA,EAAA,EAAA,MAAA,EAAA,GAAA,KAAA,WAtiBnD,MAAM,EAAoB,QAAO,iBAAP,CAAO,QAAA,QAAA,mBAwB3B,MAAO,EAAb,cACU,KAAA,WAAa,EACb,KAAA,YAAc,EACtB,gBACS,OAAA,KAAK,WAEd,iBACS,OAAA,KAAK,YAEd,iBAAiB,GACV,KAAA,aAAe,EAEtB,gBAAgB,GACT,KAAA,YAAc,EAGrB,oBAAoB,GACb,KAAA,WAAa,EAAM,WACnB,KAAA,YAAc,EAAM,aA4fsB,QAAA,WAAA,EAxf7C,MAAO,UAAc,EAiBzB,YAAoB,GAClB,QACK,KAAA,IAAM,EAAK,IACX,KAAA,KAAO,EAAK,KACZ,KAAA,KAAO,EAAK,KACZ,KAAA,KAAO,EAAK,KACZ,KAAA,IAAM,EAAK,IAQX,mBAAY,EAAsB,GAChC,OAAA,EAAI,YAAY,IAAI,EAAM,KAwdc,QAAA,MAAA,EA9d1C,EAAA,KAAO,IAAI,EAAM,CACtB,IAAK,oBACL,KAAM,sBAQJ,MAAO,UAAqB,EAgBhC,YAAqB,EAAuB,GAC1C,QADmB,KAAA,MAAA,EAAuB,KAAA,OAAA,EAf5C,KAAA,SAA2B,GAOnB,KAAA,QAAS,EALjB,SACS,OAAA,KAAK,QAAU,EAAM,KAK9B,WACS,OAAA,KAAK,OAEd,SACO,KAAA,QAAS,GAuciC,QAAA,aAAA,EAzb7C,MAAO,EA+BX,YAAY,EAAsB,GA9BxB,KAAA,KAAe,GAIf,KAAA,OAAS,IAAI,EAAJ,SAST,KAAA,wBAA0B,IAAI,EAAa,EAAM,KAAM,MACvD,KAAA,oBAAsB,IAAI,EAAa,EAAM,KAAM,MAWnD,KAAA,QAA0B,GAC1B,KAAA,QAAoB,GAEpB,KAAA,eAAiC,IAAI,EAAJ,kBAiCnC,KAAA,mBAAoC,KA9BrC,KAAA,YAAc,EAfd,6BACE,OAAA,KAAK,wBAEP,yBACE,OAAA,KAAK,oBAcd,eACQ,MAAA,EAAU,IAAI,EAAQ,KAAK,aAE1B,OADP,OAAO,OAAO,EAAS,MAChB,EAGT,YAAY,GACH,OAAA,KAAK,eAAe,OAAO,GAEpC,kBAAkB,GACX,KAAA,eAAiB,EAExB,gBACS,OAAA,KAAK,eAAe,KAG7B,UACS,OAAA,KAAK,KAEd,QAAQ,GACD,KAAA,KAAO,EAGd,iBACS,OAAA,KAAK,YAId,wBAOS,OANyB,OAA5B,KAAK,qBACF,KAAA,mBAAqB,KAAK,oBAAoB,SAAS,OAC1D,CAAC,EAAG,IAAM,EAAI,EAAE,iBAChB,IAGG,KAAK,mBAMJ,uBACC,SAAA,EAAM,GACb,EAAK,SAAS,KAAK,CAAC,EAAG,MAAQ,EAAE,iBAAmB,EAAE,mBACtD,EAAK,SAAS,QAAQ,GAExB,CAAM,KAAK,qBAGb,mBACE,EACA,IAES,SAAA,EAAM,EAAoB,GAC7B,EAAK,QAAU,EAAM,MACvB,EAAU,EAAM,GAGd,IAAA,EAAY,EAEhB,EAAK,SAAS,QAAQ,SAAU,GAC9B,EAAM,EAAO,EAAQ,GACrB,GAAa,EAAM,mBAGjB,EAAK,QAAU,EAAM,MACvB,EAAW,EAAM,EAAQ,EAAK,kBAGlC,CAAM,KAAK,oBAAqB,GAGlC,YACE,EACA,GAEI,IAAA,EAA4B,GAC5B,EAAQ,EAER,EAAc,EACb,IAAA,IAAI,KAAY,KAAK,QAAS,CAE7B,IAAA,EAA2B,KAK7B,IAAA,EAAM,EACN,GAAO,EAAI,OAAS,EAAM,OAAoC,IAA5B,EAAU,QAAQ,GACpD,EAAM,EAAI,QAIL,KAAA,EAAU,OAAS,IAAK,EAAO,EAAA,QAAA,IAAc,GAAK,CAEvD,EADa,EAAU,MACN,GAIb,MAAA,EAAyB,GAE7B,IAAA,IAAI,EAA4B,EAChC,GAAQ,EAAK,OAAS,EAAM,MAAQ,GAAQ,EAC5C,EAAO,EAAK,OAEZ,EAAO,KAAK,GAEd,EAAO,UAEF,IAAA,IAAI,KAAQ,EACf,EAAU,EAAM,GAGlB,EAAY,EAAU,OAAO,GAC7B,GAAS,KAAK,QAAQ,KAInB,IAAA,IAAI,EAAI,EAAU,OAAS,EAAG,GAAK,EAAG,IACzC,EAAW,EAAU,GAAI,GAI7B,aAAa,GACN,KAAA,OAAO,QAAQ,GAGtB,mCACQ,MAAA,EAAU,IAAI,EAEd,EAAiC,GACjC,EAAgB,IAAI,IAmBrB,KAAA,YAjBI,SAAU,EAAoB,GACjC,EAAc,IAAI,EAAK,OACzB,EAAM,KAAK,OAEX,EAAc,IAAI,EAAK,OACvB,EAAM,KAAK,GACX,EAAQ,WAAW,EAAK,MAAO,KAG1B,SAAW,EAAoB,GAChC,MAAA,EAAW,EAAM,MACnB,IACF,EAAc,OAAO,EAAS,OAC9B,EAAQ,WAAW,EAAS,MAAO,MAMjC,MAAA,EAAmB,EAAQ,QA4B1B,OA3BP,EAAiB,KAAO,KAAK,KAC7B,EAAiB,eAAiB,KAAK,eAsBlC,KAAA,aAAa,IAChB,EAAiB,OAAO,YAAY,GAAG,oBAAoB,KAGtD,EAGT,+BAA+B,GACvB,MAAA,EAAa,EAAM,YAAY,KAAK,OAAQ,GAC5C,EAAU,IAAI,EAId,EAAwB,IAErB,SAAA,EAAM,GACT,GAAA,EAAK,QAAU,EACjB,EAAM,KAAK,QAEN,IAAA,IAAI,KAAS,EAAK,SACrB,EAAM,GAKZ,CAAM,KAAK,yBAEN,IAAA,IAAI,KAAQ,EAAO,CAChB,MAAA,EAAqB,GACtB,IAAA,IAAI,EAAyB,EAAW,MAAL,GAAa,EAAE,QAAU,EAAM,KAAM,EAAI,EAAE,OACjF,EAAM,KAAK,EAAE,OAEf,EAAQ,uBAAuB,EAAO,EAAK,kBAGvC,MAAA,EAAM,EAAQ,QAGb,OAFP,EAAI,KAAO,KAAK,KAChB,EAAI,eAAiB,KAAK,eACnB,EAGT,uBAAuB,GACf,MAAA,EAAa,EAAM,YAAY,KAAK,OAAQ,GAC5C,EAAU,IAAI,GAiBX,SAAA,EAAU,GACb,GAAA,EAAK,QAAU,GAhBZ,SAAc,GACf,MAAA,EAAqB,IAElB,SAAA,EAAM,GACb,EAAM,KAAK,EAAK,OAChB,EAAQ,uBAAuB,EAAO,EAAK,iBACtC,IAAA,IAAI,KAAS,EAAK,SACrB,EAAM,GAER,EAAM,MAGR,CAAM,GAKJ,CAAc,QAET,IAAA,IAAI,KAAS,EAAK,SACrB,EAAU,GAKhB,CAAU,KAAK,yBAET,MAAA,EAAM,EAAQ,QAGb,OAFP,EAAI,KAAO,KAAK,KAChB,EAAI,eAAiB,KAAK,eACnB,EAIH,WAuJ2C,OAAA,EAAA,UAAA,OAAA,EAAA,YAtJ3C,IAAA,EAAiD,KAEhD,IAAA,IAAI,KAAS,KAAK,OAGjB,EAAM,KAAK,WAAW,SACnB,IACH,SAAqB,GAAmB,aAE1C,EAAM,KAAO,EAAY,EAAM,SAKrC,aAAa,GACN,IAAA,IAAI,KAAS,KAAK,OAAQ,CACvB,MAAA,EAAW,EAAS,GACtB,GAAY,MAAZ,EACF,SAEI,MAAA,KAAC,EAAD,KAAO,EAAP,KAAa,EAAb,IAAmB,GAAO,EACpB,MAAR,IACF,EAAM,KAAO,GAEH,MAAR,IACF,EAAM,KAAO,GAEH,MAAR,IACF,EAAM,KAAO,GAEJ,MAAP,IACF,EAAM,IAAM,KAuH+B,QAAA,QAAA,EAjH7C,MAAO,UAAgC,EAA7C,cAiHmD,SAAA,WA/CzC,KAAA,cAIG,KArEX,cAAc,EAAgB,EAAgB,GACxC,GAAA,MAAM,GAAS,MAAM,IAAI,MAAM,kBAC/B,IAAA,EAAO,EAAiB,KAAK,wBAA0B,KAAK,oBAE5D,EAAgB,IAAI,IAEnB,IAAA,IAAI,KAAS,EAAO,CACjB,MAAA,EAAO,GACT,EAAO,EAAA,QAAA,EAAK,UACZ,EAAK,SAAS,KAAK,GAAK,EAAE,QAAU,GACpC,GAAA,IAAS,EAAK,YAAc,EAAK,OAAS,EAC5C,EAAO,MACF,CACC,MAAA,EAAS,EACf,EAAO,IAAI,EAAa,EAAO,GAC/B,EAAO,SAAS,KAAK,GAEvB,EAAK,iBAAiB,GAQtB,EAAc,IAAI,EAAK,OAIrB,GAFJ,EAAK,gBAAgB,GAEjB,EACG,IAAA,IAAI,KAAS,EAAK,SACrB,EAAM,SAIN,GAAA,EAAgB,CAClB,EAAK,MAAM,gBAAgB,GAEtB,IAAA,IAAI,KAAS,EAChB,EAAM,iBAAiB,GAGrB,KAAS,EAAO,EAAA,QAAA,KAAK,SAClB,KAAA,QAAQ,KAAK,QAAQ,OAAS,IAAM,GAEpC,KAAA,QAAQ,KAAK,GACb,KAAA,QAAQ,KAAK,KAKxB,uBAAuB,EAAoB,GACrC,GAAW,IAAX,EAEF,OAEE,GAAA,EAAS,EACL,MAAA,IAAI,MAAM,sCAGZ,MAAA,EAAS,EAAM,IAAI,GAAM,EAAM,YAAY,KAAK,OAAQ,IACzD,KAAA,cAAc,EAAQ,GAAQ,GAC9B,KAAA,cAAc,EAAQ,GAAQ,GAQrC,0BAA0B,EAAoB,GACxC,GAAA,KAAK,cAAe,CAClB,GAAA,EAAY,KAAK,cAAc,iBAC3B,MAAA,IAAI,MAAM,oCAEZ,MAAA,GAAgB,EAAY,KAAK,cAAc,kBAAoB,EACpE,KAAA,uBACH,KAAK,cAAc,MACnB,EAAe,KAAK,cAAc,gBAE/B,KAAA,cAAgB,CAAC,MAAA,EAAO,eAAgB,EAAc,iBAAkB,QAExE,KAAA,cAAgB,CAAC,MAAA,EAAO,eAAgB,EAAW,iBAAkB,GAI9E,QAmBS,OAlBH,KAAK,gBACH,KAAK,QAAQ,OAAS,EACnB,KAAA,uBACH,KAAK,cAAc,MACnB,KAAK,cAAc,iBAAmB,KAAK,cAAc,iBAKtD,KAAA,uBAAuB,KAAK,cAAc,MAAO,GACjD,KAAA,kBAAkB,IAAI,EAAJ,qBAGtB,KAAA,YAAc,KAAK,IACtB,KAAK,YACL,KAAK,QAAQ,OAAO,CAAC,EAAG,IAAM,EAAI,EAAG,IAElC,KAAA,sBACE,MAOwC,QAAA,wBAAA,EAA7C,MAAO,UAA+B,EAA5C,cAAmD,SAAA,WACzC,KAAA,iBAAmC,CAAC,KAAK,yBACzC,KAAA,kBAAoC,CAAC,KAAK,qBAC1C,KAAA,cAAgB,IAAI,IACpB,KAAA,MAAiB,GAEjB,KAAA,UAAoB,EACpB,mBAAmB,GACnB,MAAA,EAAQ,EAAQ,KAAK,UACtB,IAAA,IAAI,KAAS,KAAK,cAAc,OACnC,EAAM,iBAAiB,GAEnB,MAAA,GAAW,EAAO,EAAA,QAAA,KAAK,OACzB,GACF,EAAS,gBAAgB,GAGrB,kBAAkB,EAAe,GACjC,MAAA,EAAQ,EAAQ,KAAK,UACtB,IAAA,IAAI,KAAQ,EACf,EAAK,iBAAiB,GAElB,MAAA,GAAW,EAAO,EAAA,QAAA,GACpB,GACF,EAAS,gBAAgB,GAIrB,YAAY,EAAc,EAAe,GAC3C,IAAA,EAAQ,EAAiB,KAAK,iBAAmB,KAAK,kBACrD,KAAA,kBAAkB,EAAO,GAE1B,IAAA,GAAU,EAAO,EAAA,QAAA,GAEjB,GAAA,EAAS,CACP,GAAA,EAAgB,CACZ,MAAA,EAAQ,EAAQ,KAAK,UACvB,GAAA,EAAQ,EACL,KAAA,QAAQ,KAAK,GACb,KAAA,QAAQ,KAAK,EAAQ,KAAK,gBAC1B,GAAI,EAAQ,EACX,MAAA,IAAI,2FAC6E,KAAK,8BAA8B,KAKxH,MAAA,EAAO,GACT,EAAO,EAAA,QAAA,EAAQ,UACf,EAAQ,SAAS,KAAK,GAAK,EAAE,QAAU,GACvC,IAAA,EACA,IAAS,EAAK,YAAc,EAAK,OAAS,EAC5C,EAAO,GAEP,EAAO,IAAI,EAAa,EAAO,GAC/B,EAAQ,SAAS,KAAK,IAExB,EAAM,KAAK,IAGf,WAAW,EAAsB,GACzB,MAAA,EAAQ,EAAM,YAAY,KAAK,OAAQ,GACxC,KAAA,mBAAmB,GACnB,KAAA,YAAY,EAAO,GAAO,GAC1B,KAAA,YAAY,EAAO,GAAO,GAE1B,KAAA,MAAM,KAAK,GACV,MAAA,EAAa,KAAK,cAAc,IAAI,IAAU,EAC/C,KAAA,cAAc,IAAI,EAAO,EAAa,GACtC,KAAA,UAAY,EACZ,KAAA,YAAc,KAAK,IAAI,KAAK,YAAa,KAAK,WAG7C,YAAY,EAAc,EAAe,GAC3C,IAAA,EAAQ,EAAiB,KAAK,iBAAmB,KAAK,kBAGtD,GAFC,KAAA,kBAAkB,EAAO,GAE1B,EAAgB,CACZ,MAAA,EAAkB,KAAK,iBAAiB,MAC1C,GAAmB,MAAnB,EACI,MAAA,IAAI,yBAAyB,EAAM,2BAEvC,GAAkB,MAAlB,KAAK,UACD,MAAA,IAAI,2BAA2B,EAAM,oCAIzC,GAFJ,EAAgB,SAEZ,EAAgB,MAAM,MAAQ,EAAM,IAChC,MAAA,IAAI,+BACiB,EAAM,sBAAsB,EAAgB,MAAM,2BAA2B,KAIpG,MAAA,EAAQ,EAAQ,KAAK,UACvB,GAAA,EAAQ,EACL,KAAA,QAAQ,KAAK,GACb,KAAA,QAAQ,KAAK,EAAQ,KAAK,gBAC1B,GAAI,EAAQ,EACX,MAAA,IAAI,2FAC6E,KAClF,8BAA+B,UAIjC,KAAA,kBAAkB,MAI3B,WAAW,EAAsB,GACzB,MAAA,EAAQ,EAAM,YAAY,KAAK,OAAQ,GACxC,KAAA,mBAAmB,GAEnB,KAAA,YAAY,EAAO,GAAO,GAC1B,KAAA,YAAY,EAAO,GAAO,GAE1B,KAAA,MAAM,MACL,MAAA,EAAa,KAAK,cAAc,IAAI,GACxB,MAAd,IACe,IAAf,EACG,KAAA,cAAc,OAAO,GAErB,KAAA,cAAc,IAAI,EAAO,EAAa,GAExC,KAAA,UAAY,EAEZ,KAAA,YAAc,KAAK,IAAI,KAAK,YAAa,KAAK,YAGrD,QAGM,GAAA,KAAK,iBAAiB,OAAS,GAAK,KAAK,kBAAkB,OAAS,EAChE,MAAA,IAAI,MAAM,iEAGX,OADF,KAAA,sBACE,MAvIwC,QAAA,uBAAA;;ACviBnD,aAAM,IAAW,EAAjB,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,gBAAA,EAAA,QAAA,WAAA,EAAA,SAAiB,GA2CH,IAAA,EA4EA,GA5EZ,SAAY,GACV,EAAA,QAAA,UACA,EAAA,QAAA,UAFF,CAAY,EAAA,EAAA,cAAA,EAAA,YAAW,KA4EvB,SAAY,GACV,EAAA,WAAA,IACA,EAAA,YAAA,IAFF,CAAY,EAAA,EAAA,YAAA,EAAA,UAAS,KAvHvB,CAAiB,IAAA,QAAA,WAAA,EAAU;;ACF3B1d,OAAOC,QAAQ,CAAC7G,KAAK,aAAawI,QAAQ,SAAS+b,YAAY,GAAGC,WAAW,qBAAqBC,KAAK,WAAWC,IAAI,CAACC,WAAW,gBAAgBC,QAAQ,CAACC,OAAO,sBAAsBC,QAAQ,6BAA6BC,SAAS,gDAAgDC,KAAK,sCAAsCC,KAAK,8CAA8CC,SAAS,6BAA6BC,UAAU,eAAeplB,KAAK,kBAAkBqlB,MAAM,oDAAoDC,MAAM,CAAC,aAAa,kBAAkB,UAAUC,aAAa,CAAC,yBAAyB,2BAA2BC,OAAO,GAAGC,QAAQ,MAAMC,gBAAgB,CAAe,cAAA,SAAwB,eAAA,QAAsB,cAAA,SAAuB,cAAA,QAAgC,wBAAA,UAA6C,mCAAA,SAAqC,4BAAA,SAASC,MAAM,QAAQC,UAAU,QAAQC,OAAO,QAAiC,yBAAA,QAAoC,4BAAA,QAAQX,KAAK,SAASY,SAAS,QAAQC,MAAM,QAAQC,KAAK,QAAyB,iBAAA,SAASC,OAAO,SAASjB,SAAS,QAAQkB,WAAW,QAAqB,aAAA,QAAkB,UAAA,SAASC,WAAW,QAAiC,yBAAA,SAAqB,YAAA,QAAiC,yBAAA,SAASjB,KAAK,CAACkB,UAAU,CAAe,cAAA,WAAWC,mBAAmB,CAAC,uBAAuBC,UAAU,kBAAkBC,oBAAoB,CAAC,gBAAgB,oBAAoBC,qBAAqB,CAAC,KAAK,MAAM,KAAK,MAAM,SAASC,aAAa,CAACC,KAAK;;ACuL7+C,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,mBAAA,EAAA,QAAA,yBAAA,EAAA,QAAA,WAAA,EAvLD,IAAA,EAAA,QAAA,aASA,EAAA,QAAA,sBACA,EAAA,QAAA,sBAEM,SAAU,EAAmB,GAC3B,MAAA,EAA6B,GAE7B,EAAgB,IAAI,IACjB,SAAA,EAAiB,GACpB,IAAA,EAAQ,EAAc,IAAI,GAC1B,GAAS,MAAT,EAAe,CACX,MAAA,EAAoC,CACxC,KAAM,EAAM,MAEI,MAAd,EAAM,OAAc,EAAgB,KAAO,EAAM,MACnC,MAAd,EAAM,OAAc,EAAgB,KAAO,EAAM,MACpC,MAAb,EAAM,MAAa,EAAgB,IAAM,EAAM,KACnD,EAAQ,EAAO,OACf,EAAc,IAAI,EAAO,GACzB,EAAO,KAAK,GAEP,OAAA,EAGH,MAAA,EAAwB,CAC5B,uBAAwB,QAAQ,sBAAsB,UACtD,KAAM,EAAa,KACnB,mBAAoB,EAAa,YACjC,QAAS,qDACT,OAAQ,CAAC,OAAA,GACT,SAAU,IAGP,IAAA,IAAI,KAAW,EAAa,SAC/B,EAAK,SAAS,KAAK,EAAc,EAAS,IAGrC,OAAA,EAGT,SAAS,EAAc,EAAkB,GACjC,MAAA,EAA4C,CAChD,KAAM,EAAW,WAAA,YAAY,QAC7B,KAAM,EAAQ,UACd,KAAM,EAAQ,gBACd,WAAY,EACZ,SAAU,EAAQ,iBAClB,OAAQ,IAiBH,OADP,EAAQ,YAdU,CAAC,EAAoB,KACrC,EAAe,OAAO,KAAK,CACzB,KAAM,EAAW,WAAA,UAAU,WAC3B,MAAO,EAAiB,EAAK,OAC7B,GAAI,KAGW,CAAC,EAAoB,KACtC,EAAe,OAAO,KAAK,CACzB,KAAM,EAAW,WAAA,UAAU,YAC3B,MAAO,EAAiB,EAAK,OAC7B,GAAI,MAID,EAGT,SAAS,EACP,EACA,GAES,SAAA,EAAoB,GACrB,MAAA,KAAC,EAAD,KAAO,GAAQ,EAEb,OAAA,GACD,IAAA,cACA,IAAA,eACA,IAAA,eACA,IAAA,UACH,EAAE,kBAAkB,IAAI,EAAJ,cAAkB,IACtC,MAEG,IAAA,QACH,EAAE,kBAAkB,IAAI,EAAJ,eACpB,MAEG,IAAA,OACH,EAAE,kBAAkB,IAAI,EAAJ,mBAGxB,EAAE,QAAQ,GAmDJ,OAAA,EAAW,MACZ,KAAA,EAAW,WAAA,YAAY,QACnB,OAlDF,SAAqB,GACtB,MAAA,WAAC,EAAD,SAAa,EAAb,OAAuB,GAAU,EAEjC,EAAU,IAAI,EAAJ,uBAA2B,EAAW,GACtD,EAAoB,GAEd,MAAA,EAA0B,EAAO,IAAI,CAAC,EAAO,IAAM,OAAA,OAAA,CAAE,IAAK,GAAM,IAEjE,IAAA,IAAI,KAAM,EACL,OAAA,EAAG,MACJ,KAAA,EAAW,WAAA,UAAU,WACxB,EAAQ,WAAW,EAAW,EAAG,OAAQ,EAAG,GAAK,GACjD,MAEG,KAAA,EAAW,WAAA,UAAU,YACxB,EAAQ,WAAW,EAAW,EAAG,OAAQ,EAAG,GAAK,GAKhD,OAAA,EAAQ,QA8BN,CAAqB,GACzB,KAAA,EAAW,WAAA,YAAY,QACnB,OA7BF,SAAqB,GACtB,MAAA,WAAC,EAAD,SAAa,EAAb,QAAuB,EAAvB,QAAgC,GAAW,EAC3C,EAAU,IAAI,EAAJ,wBAA4B,EAAW,GACvD,EAAoB,GAEd,MAAA,EAA0B,EAAO,IAAI,CAAC,EAAO,IAAM,OAAA,OAAA,CAAE,IAAK,GAAM,IAElE,GAAA,EAAQ,SAAW,EAAQ,OACvB,MAAA,IAAI,kCACoB,EAAQ,oCAAoC,EAAQ,WAI/E,IAAA,IAAI,EAAI,EAAG,EAAI,EAAQ,OAAQ,IAAK,CACjC,MAAA,EAAQ,EAAQ,GAChB,EAAS,EAAQ,GACvB,EAAQ,uBACN,EAAM,IAAI,GAAK,EAAW,IAC1B,GAIG,OAAA,EAAQ,QAON,CAAqB,IAI5B,SAAU,EAAyB,GAChC,MAAA,CACL,KAAM,EAAW,MAAQ,EAAW,SAAS,GAAG,MAAQ,UACxD,YAAa,EAAW,oBAAsB,EAC9C,SAAU,EAAW,SAAS,IAAI,GAAK,EAAwB,EAAG,EAAW,OAAO,UAIlF,SAAU,EAAW,GACnB,MAAA,EAAO,EAAmB,GAC1B,EAAO,IAAI,KAAK,CAAC,KAAK,UAAU,IAAQ,CAAC,KAAM,cAG/C,MADiB,EAAK,KAAO,EAAK,KAAK,MAAM,KAAK,GAAM,WAC3B,QAAQ,OAAQ,uBAEnD,QAAQ,IAAI,SAAU,GAEhB,MAAA,EAAI,SAAS,cAAc,KACjC,EAAE,SAAW,EACb,EAAE,KAAO,OAAO,IAAI,gBAAgB,GACpC,EAAE,QAAQ,YAAc,CAAC,YAAa,EAAE,SAAU,EAAE,MAAM,KAAK,KAG/D,SAAS,KAAK,YAAY,GAC1B,EAAE,QACF,SAAS,KAAK,YAAY;;AC+D3B,aAxOK,SAAU,EAAkB,EAAc,GACvC,OAAA,EAAgB,EAAM,GAuO9B,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,kBAAA,EAzND,MAAM,EAAiB,IAAI,WAAW,GAChC,EAAiB,IAAI,WAAW,GAChC,EAAiB,IAAI,WAAW,GAChC,EAAiB,IAAI,WAAW,GAChC,EAAiB,IAAI,WAAW,GAChC,EAAiB,IAAI,WAAW,GAEtC,IAAK,EAOL,SAAS,EAAe,GAChB,MAAA,EAAO,EAAK,WAAW,GACzB,OAAA,GAAkB,GAAQ,GAAQ,EAC7B,EAAa,UACX,GAAkB,GAAQ,GAAQ,EACpC,EAAa,UACX,GAAkB,GAAQ,GAAQ,EACpC,EAAa,WAEf,EAAa,YAGtB,SAAS,EAAW,EAAkB,GAChC,GAAA,IAAa,EAAa,OAAO,EAE/B,MAAA,EAAkB,EAAY,WAAW,GAC3C,OAAA,GAAkB,GAAmB,GAAmB,GACnD,EAAS,WAAW,KAAO,EAAkB,EAAiB,EAKzE,SAAS,EAAgB,EAAc,GACjC,GAAkB,GAAlB,EAAQ,OACH,MAAA,CAAC,cAAe,GAAI,MAAO,GAMhC,IAAA,EAAO,EACP,GAAQ,EACR,GAAQ,EAER,EAAW,EAAK,OAChB,EAAa,EAAQ,OAIpB,IAAA,IAAI,EAAQ,EAAG,EAAQ,EAAU,IAAS,CAGzC,GAAA,EAFO,EAAK,GACJ,EAAQ,MAEd,EAAO,IACT,EAAO,KAET,GACY,GAAY,CAGtB,EAAO,EAAQ,EACf,OAKF,IAAS,GAAT,EAEK,OAAA,KAKT,IACK,IAAA,IAAI,EAAQ,EAAO,EAAG,GAAS,EAAM,IAAS,CAG7C,GAAA,EAFS,EAAK,GACJ,EAAQ,OAEpB,EACW,EAkBF,OAAA,EAAkB,EAAM,EAD/B,EAAO,EACuC,GAM9C,MAAA,IAAI,MAAM,gEApGlB,SAAK,GACH,EAAA,EAAA,YAAA,GAAA,cACA,EAAA,EAAA,UAAA,GAAA,YACA,EAAA,EAAA,UAAA,GAAA,YACA,EAAA,EAAA,WAAA,GAAA,aAJF,CAAK,IAAA,EAAY,KAuGjB,MAAM,EAAgB,GAChB,GAAoB,EACpB,GAAwB,EACxB,EAAmB,EAAgB,EACnC,EAAkB,EAAgB,EAClC,EAAmB,EAAmB,EACtC,IAAwB,EAAmB,GAC3C,EAA8B,EAEpC,SAAS,EAAS,EAAyB,GACrC,OAAA,IAAc,EAAa,aAAe,IAAa,EAAa,YAI/D,EAIN,IAAc,EAAa,WAAa,GAAY,EAAa,WACjE,IAAc,EAAa,YAAc,GAAY,EAAa,WAO5D,EAGL,IAAa,EAAa,YACrB,EAEF,EAGT,SAAS,EAAkB,EAAc,EAAiB,EAAc,GAClE,IAAA,EAAO,EACP,EAAQ,EACR,GAAQ,EACR,EAAc,EACd,EAAa,EACb,EAAgB,IAAI,MAAM,EAAQ,QAClC,EAAY,EAAa,YAEzB,EAAO,IACT,EAAY,EAAe,EAAK,EAAO,KAEpC,IAAA,IAAI,EAAM,EAAM,EAAM,EAAM,IAAO,CAClC,IAAA,EAAO,EAAK,GACZ,EAAW,EAAe,GAC1B,GAAA,EAAW,EAAM,EAAQ,IAAQ,CACnC,EAAI,GAAQ,EACZ,GAAS,EACL,IAAA,EAAQ,EAAS,EAAW,GACb,GAAf,EACF,EAAa,GAGT,IAAU,IACZ,EAAa,GAEf,EAAQ,KAAK,IAAI,EAAO,EAAY,IAGpC,GADW,IAAT,EACO,EAAQ,EAER,EAEX,GAAQ,EACR,IACA,SAIE,GAFE,EAEO,EAGA,EAEX,GAAQ,EACR,EAAc,EACd,EAAa,EAEf,EAAY,EAGV,GAAA,IAAS,EAAQ,OACb,MAAA,IAAI,MACR,uFAIA,IAAA,EAAoC,CAAC,CAAC,EAAI,GAAI,EAAI,GAAK,IACtD,IAAA,IAAI,EAAI,EAAG,EAAI,EAAI,OAAQ,IAAK,CAC7B,MAAA,EAAS,EAAI,GACb,EAAW,EAAc,EAAc,OAAS,GAClD,EAAS,KAAO,EAClB,EAAS,GAAK,EAAS,EAEvB,EAAc,KAAK,CAAC,EAAQ,EAAS,IAIlC,MAAA,CACL,MAAA,EACA,cAAA;;AC+GJ,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,iBAAA,EAAA,QAAA,cAAA,EAjWA,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,gBACA,EAAA,QAAA,aACA,EAAA,QAAA,WACA,EAAA,QAAA,qBACA,EAAA,QAAA,gBACA,EAAA,QAAA,kBAgBA,SAAS,EACP,EACA,EACA,GAEM,MAAA,EAA0B,GAC5B,IAAA,EAAO,EACN,IAAA,IAAI,KAAS,EAChB,EAAM,KAAK,EAAK,MAAM,EAAM,EAAM,KAClC,EAAM,MAAK,EAAA,EAAA,GAAA,OAAA,CAAM,UAAW,GAAuB,EAAK,MAAM,EAAM,GAAI,EAAM,MAC9E,EAAO,EAAM,GAIR,OAFP,EAAM,KAAK,EAAK,MAAM,KAEf,EAAA,EAAA,GAAA,OAAA,KAAO,GAGV,SAAU,GAAiB,sBAC/B,EAD+B,uBAE/B,EAF+B,QAG/B,EAH+B,SAI/B,EAJ+B,QAK/B,EAL+B,aAM/B,EAN+B,QAO/B,EAP+B,mBAQ/B,EAR+B,oBAS/B,EAT+B,cAU/B,EAV+B,wBAW/B,IAEM,MAAA,EAAQ,GAAS,EAAD,EAAA,aAEhB,GAAY,EAAY,EAAA,aAAA,KAC5B,IACA,EAAsB,IACrB,CAAC,EAAoB,EAAuB,IAEzC,GAAe,EAClB,EAAA,aAAA,IACC,EAAuB,IAEzB,CAAC,EAAwB,IAGrB,EAAO,EAAQ,UAEf,EAAY,EAAI,KAAK,MAAM,KAAK,MAAM,IAEtC,GAAuB,EAAI,EAAA,KAAA,EAAM,aACjC,GAAc,EAAQ,EAAA,SAAA,KAEnB,OADQ,EAAgB,EAAM,EAAe,IAEnD,CAAC,EAAM,EAAe,IAMvB,OAAA,EAAA,EAAA,GAAA,MAAA,CACE,IAAK,EACL,UAAW,EACX,aAAc,EACd,MAAO,EACP,WAAW,EACT,EAAA,KAAA,EAAM,WACN,EAA0B,GAAM,GAAK,EAAM,eAC3C,GAAY,EAAM,mBAClB,GAAW,EAAM,qBAGnB,EAAA,EAAA,GAAA,OAAA,CACE,WAAW,EAAI,EAAA,KAAA,EAAM,aAAc,GAAY,EAAM,sBACrD,MAAO,CAAC,MAAO,EAAY,OAE1B,EAAsB,EAJzB,KAKQ,IACP,GAaP,SAAS,EAAgB,GACvB,EAAG,kBAUL,SAAS,EAA0B,EAAqB,GAChD,MAAA,EAA8B,GAC/B,IAAA,IAAI,EAAI,EAAG,EAAI,EAAS,OAAQ,IAAK,CAClC,MAAA,EAAU,EAAS,GACnB,GAAQ,EAAkB,EAAA,mBAAA,EAAQ,UAAW,GAC9C,GACL,EAAS,KAAI,OAAA,OAAA,CACX,oBAAqB,EACrB,QAAA,GACG,IAIA,OADA,EAAA,EAAA,QAAA,EAAU,IAAM,EAAE,OAClB,EAGH,SAAU,GAAc,SAC5B,EAD4B,mBAE5B,EAF4B,YAG5B,EAH4B,QAI5B,EAJ4B,sBAK5B,IAEM,MAAA,EAAQ,GAAS,EAAD,EAAA,cAEf,EAAY,IAAiB,EAAS,EAAA,UAAA,IAEvC,GAAqB,EACxB,EAAA,aAAA,IACO,MAAA,EAAS,EAAG,OAA4B,MAC9C,EAAc,IAEhB,CAAC,IAGG,GAAmB,EACtB,EAAA,aAAA,IACK,IACE,EACF,EAAK,SAEL,EAAK,SAIX,CAAC,IAGG,GAAmB,EAAQ,EAAA,SAAA,IACxB,EAA0B,EAAU,GAC1C,CAAC,EAAU,KAEP,EAAqB,IAA0B,EAAwB,EAAA,UAAA,GAExE,GAAkB,EAA8B,EAAA,QAAA,OAC5C,EAAA,EAAA,WAAA,KACJ,IAIF,EAAuB,MAGS,OAA5B,EAAgB,SAClB,EAAgB,QAAQ,eAAe,CACrC,SAAU,OACV,MAAO,UACP,OAAQ,cAIb,CAAC,IAKE,MAAA,GAAgB,EACnB,EAAA,aAAA,IAGC,EAAG,kBAEC,IAAA,EAA+C,KAE3C,OAAA,EAAG,KACJ,IAAA,QACwB,MAAvB,IACF,IACA,EAAsB,IAExB,MAEG,IAAA,SACH,IACA,MAEG,IAAA,YAGC,GAFJ,EAAG,iBACH,EAAgC,EACL,MAAvB,EAA6B,CACzB,MAAA,EAAsB,EAAiB,UAC3C,GAAK,EAAE,sBAAwB,IAEJ,IAAzB,IACF,EAAgC,EAAsB,GAG1D,MAEG,IAAA,UAGC,GAFJ,EAAG,iBACH,EAAgC,EAAiB,OAAS,EAC/B,MAAvB,EAA6B,CACzB,MAAA,EAAsB,EAAiB,UAC3C,GAAK,EAAE,sBAAwB,IAEJ,IAAzB,IACF,EAAgC,EAAsB,IAQ5D,GAAiC,MAAjC,GACA,GAAiC,GACjC,EAAgC,EAAiB,OACjD,CACM,MAAA,EACJ,EAAiB,GAA+B,oBAClD,EAAuB,GACvB,GAAuB,KAG3B,CAAC,EAAoB,EAAuB,EAAqB,KAG5D,EAAqB,IAA0B,EAAS,EAAA,WAAA,IACrD,EAAA,EAAA,WAAA,KAEJ,EAAiB,OAAS,IAC5B,EAAuB,EAAiB,GAAG,qBAC3C,GAAuB,KAExB,CAAC,EAAwB,IAEtB,MAAA,GAAiB,EACpB,EAAA,aAAA,IACK,GAAuB,IACzB,EAAY,eAAe,CACzB,SAAU,OACV,MAAO,UACP,OAAQ,YAEV,GAAuB,KAG3B,CAAC,EAAqB,IAGlB,GAAqB,EACxB,EAAA,aAAA,IACC,EAAgB,QAAU,EAC1B,EAAe,IAEjB,CAAC,EAAiB,IAQlB,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,sBACxB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,UAC1B,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,oBAGxB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,wBACxB,EAAA,EAAA,GAAA,QAAA,CACE,KAAK,OACL,WAAW,EAAI,EAAA,KAAA,EAAM,aACrB,IAAK,EACL,YAAa,YACb,MAAO,EACP,QAAS,EACT,UAAW,EACX,QAAS,EACT,WAAY,MAGhB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,yBACvB,EAAiB,IAAI,EAAE,QAAA,EAAS,cAAA,EAAe,oBAAA,GAAsB,KAChE,IAAA,OAAuC,EACrC,MAAA,EAAW,IAAwB,EACnC,EAAU,IAAwB,EAStC,OARE,GAAY,EACd,EAAM,EACG,EACT,EAAM,EACG,IACT,EAAM,IAGN,EAAC,EAAA,GAAA,EAAgB,CACf,uBAAwB,EACxB,oBAAqB,EACrB,wBAAyB,EACzB,QAAS,GAAuB,EAChC,SAAU,IAAwB,EAClC,QAAS,EACT,aAAc,EAAS,OACvB,QAAS,EACT,cAAe,EACf,sBAAuB,EACvB,mBAAoB,MAIG,IAA5B,EAAiB,QAChB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,aAA1B,4BAAiE,EAAjE,KACE,QAOd,MAAM,EAAgB,GAEhB,GAAW,EAAU,EAAA,WAAA,GACzB,EAAW,WAAA,OAAO,CAChB,qBAAsB,CACpB,QAAS,OACT,cAAe,SACf,QAAS,EACT,WAAY,WAEd,YAAa,CACX,MAAO,EAAM,kBACb,WAAY,EAAM,oBAClB,aAAc,EACd,QAAS,EACC,SAAA,CACR,OAAQ,OACR,QAAS,QAEI,cAAA,CACb,MAAO,EAAM,kBACb,WAAY,EAAM,wBAGtB,MAAO,CACL,MAAO,EACP,OAAQ,EACR,WAAY,wBACZ,YAAa,wBACb,aAAc,mBAEhB,YAAa,CACX,WAAY,EAAM,yBAEpB,QAAS,CACP,OAnCgB,GAoChB,WAAY,EAAM,mBAEpB,WAAY,CACV,OAAQ,EAAM,MAAA,aAAe,EAC7B,OAAQ,wBACR,UAAW,OACX,YAAa,GACb,aAAc,GACd,WAAY,EAAM,kBAClB,SAAU,SACV,WAAY,SACZ,aAAc,WACd,OAAQ,WAEV,kBAAmB,CACjB,oBAAqB,EAAM,yBAE7B,mBAAoB,CAClB,WAAY,EAAM,uBAEpB,eAAgB,CACd,WAAY,EAAM,qBAEpB,uBAAwB,CACtB,8BAA+B,EAAM,MAAA,eAAiB,UACpD,GAAK,EAAM,MAAA,kBAEb,SAAU,OACa,sBAAA,CACrB,WAAY,EAAM,mBAES,4BAAA,CAC3B,WAAY,EAAM,oBAClB,aAAc,GACd,oBAAqB,EAAM,oBACjB,SAAA,CACR,WAAY,EAAM,qBAIxB,iBAAkB,CAChB,MAAO,OACP,cAAe,GACf,WAAY,EAAM,kBAClB,MAAO,EAAM,mBAEf,mBAAoB,CAClB,MAAO,OACP,SAAU,IACV,OAAQ,SACR,SAAU,WACV,OAAQ,EAAO,OAAA,eACf,WAAY,SACZ,QAAS,OACT,cAAe,UAEjB,aAAc,CACZ,UAAW,QACX,QAAS,eACT,MAAO,EAAM,qBAEf,qBAAsB,CACpB,MAAO,EAAM;;AC3OnB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,QAAA,EAtNA,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,gBACA,EAAA,QAAA,aACA,EAAA,QAAA,WACA,EAAA,QAAA,oBAEA,EAAA,QAAA,gBACA,EAAA,QAAA,kBACA,EAAA,QAAA,oBACA,EAAA,QAAA,gBAEA,EAAA,QAAA,6BACA,EAAA,QAAA,eAOA,SAAS,EAAe,EAA2C,GAC1D,OAAA,EAAY,EAAA,aAAA,IAAM,EAAY,GAAW,CAAC,EAAa,IAGhE,SAAS,EAAmB,GACpB,MAAA,EAAQ,GAAS,EAAD,EAAA,aAChB,EAAsB,EAAe,EAAa,aAAA,IAAK,EAAS,SAAA,oBAChE,EAAyB,EAAe,EAAa,aAAA,IAAK,EAAS,SAAA,wBACnE,EAAkB,EAAe,EAAa,aAAA,IAAK,EAAS,SAAA,eAE9D,OAAC,EAAM,oBAGT,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,eACxB,EAAA,EAAA,GAAA,MAAA,CACE,WAAW,EACT,EAAA,KAAA,EAAM,WACN,EAAM,WAAa,EAAS,SAAA,oBAAsB,EAAM,kBAE1D,QAAS,IAET,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,QAAM,MAPnC,eASA,EAAA,EAAA,GAAA,MAAA,CACE,WAAW,EACT,EAAA,KAAA,EAAM,WACN,EAAM,WAAa,EAAS,SAAA,wBAA0B,EAAM,kBAE9D,QAAS,IAET,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,QAAM,MAPnC,eASA,EAAA,EAAA,GAAA,MAAA,CACE,WAAW,EACT,EAAA,KAAA,EAAM,WACN,EAAM,WAAa,EAAS,SAAA,eAAiB,EAAM,kBAErD,QAAS,IAET,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,QAAM,MAPnC,aAtBkC,KAmCxC,MAAM,EAAuB,MAQvB,IAAA,EAAsC,KAElC,OAAA,IACF,IAAA,GAAkB,MAAA,OAAY,EAAZ,EAAc,SAAS,IAAI,GAAK,EAAE,WAAY,KAS7D,OANiB,OAAtB,GACoB,MAAnB,KAA4B,EAA2B,EAAA,4BAAA,EAAmB,MAE3E,EAAoB,GAGf,IApBkB,GAwB7B,SAAS,EAAqB,GACtB,MAAA,EAAQ,GAAS,EAAD,EAAA,cAEhB,mBAAC,EAAD,aAAqB,GAAgB,EACrC,EAAW,EAAqB,IAC/B,EAAoB,IAAyB,EAAS,EAAA,WAAA,GAEvD,GAAoB,EAAY,EAAA,aAAA,KACpC,GAAsB,IACrB,CAAC,IAEE,GAAqB,EAAY,EAAA,aAAA,KACrC,GAAsB,IACrB,CAAC,IA4BA,OA1BM,EAAA,EAAA,WAAA,KACF,MAAA,EAAoB,IACT,MAAX,EAAG,MACL,EAAG,iBACH,GAAsB,KAInB,OADP,OAAO,iBAAiB,WAAY,GAC7B,KACL,OAAO,oBAAoB,WAAY,KAExC,CAAC,KAEM,EAAA,EAAA,WAAA,KACF,MAAA,EAAoB,IACT,MAAX,EAAG,MACL,EAAG,iBACH,GAAsB,KAInB,OADP,OAAO,iBAAiB,WAAY,GAC7B,KACL,OAAO,oBAAoB,WAAY,KAExC,CAAC,IAEA,GAAsB,GAAgB,EACH,IAAjC,EAAa,SAAS,QACjB,EAAC,EAAA,GAAA,EAAD,SAAS,KAAE,EAAmB,QAAQ,YAG3C,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,eAAgB,aAAc,IACtD,EAAA,EAAA,GAAA,OAAA,CAAM,YAAa,GAChB,EAAmB,QAAQ,UAAW,KACvC,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,sBAA3B,IACI,EAAmB,MAAQ,EAD/B,IACmC,EAAa,SAAS,OADzD,OAIF,EAAA,EAAA,GAAA,MAAA,CAAK,MAAO,CAAC,QAAS,EAAqB,QAAU,UACnD,EAAC,EAAA,GAAA,EAAD,cAAc,CACZ,sBAAuB,EAAM,sBAC7B,YAAa,EAAa,YAC1B,SAAU,EACV,mBAAoB,EACpB,QAAS,OAOd,EAAC,EAAA,GAAA,EAAD,SAAS,KAAE,gBAGpB,SAAS,EAAoB,GACrB,MAAA,EAAQ,GAAS,EAAD,EAAA,aAChB,GAAc,EAAQ,EAAA,SAAA,EAAR,iBAEd,GACJ,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,YAAa,QAAS,EAAM,WACpD,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,QAAM,MADnC,UAII,GACJ,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,YAAa,QAAS,EAAM,gBACpD,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,QAAM,MADnC,UAKI,GACJ,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,YAAa,QAAS,EAAgB,gBAAA,yBAC9D,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,QAAM,OACjC,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,+BACxB,EAAoB,EAAA,qBAAA,KAKrB,GACJ,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,cACxB,EAAA,EAAA,GAAA,IAAA,CACE,KAAK,8CACL,WAAW,EAAI,EAAA,KAAA,EAAM,aACrB,OAAO,WAEP,EAAA,EAAA,GAAA,OAAA,CAAM,WAAW,EAAI,EAAA,KAAA,EAAM,QAAM,KALnC,SAWF,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,eACvB,EAAM,oBAAsB,EAC5B,EACA,EACA,GAKD,SAAU,EAAQ,GAChB,MAAA,EAAQ,GAAS,EAAD,EAAA,aAEpB,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,WACxB,EAAC,EAAA,GAAA,EAAkB,OAAA,OAAA,GAAK,KACxB,EAAC,EAAA,GAAA,EAAoB,OAAA,OAAA,GAAK,KAC1B,EAAC,EAAA,GAAA,EAAmB,OAAA,OAAA,GAAK,KAK/B,MAAM,GAAW,EAAU,EAAA,WAAA,GACzB,EAAW,WAAA,OAAO,CAChB,QAAS,CACP,OAAQ,EAAM,MAAA,eACd,WAAY,EACZ,WAAY,EAAM,kBAClB,MAAO,EAAM,kBACb,UAAW,SACX,WAAY,EAAW,WAAA,UACvB,SAAU,EAAS,SAAA,MACnB,cAAe,EAAM,MAAA,uBACrB,WAAY,QAEd,YAAa,CACX,SAAU,WACV,OAAQ,EAAM,MAAA,eACd,SAAU,SACV,IAAK,EACL,KAAM,EACN,YAAa,EACb,UAAW,QAEb,cAAe,CACb,WAAY,EACZ,OAAQ,EAAM,MAAA,gBAEhB,aAAc,CACZ,OAAQ,EAAM,MAAA,eACd,SAAU,SACV,SAAU,WACV,IAAK,EACL,MAAO,EACP,YAAa,EACb,UAAW,SAEb,oBAAqB,CACnB,MAAO,EAAM,qBAEf,WAAY,CACV,WAAY,EAAM,oBAClB,UAAW,EAAM,MAAA,iBACjB,OAAQ,EAAM,MAAA,mBACd,cAAe,EAAM,MAAA,uBACrB,YAAa,EACb,aAAc,EACd,QAAS,eACT,WAAY,EACZ,kBAAmB,EAAS,SAAA,uBAClB,SAAA,CACR,WAAY,EAAM,0BAGtB,iBAAkB,CAChB,WAAY,EAAM,sBACR,SAAA,CACR,WAAY,EAAM,wBAGtB,4BAA6B,CAC3B,QAAS,eACT,UAAW,SACX,SAAU,QAEZ,MAAO,CACL,QAAS,eACT,cAAe,SACf,WAAY,MACZ,YAAa,SAEf,YAAa,CACX,eAAgB,OAChB,MAAO;;AC5DZ,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,wCAAA,EApMD,IAAA,EAAA,QAAA,WAoMC,EAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,IAAA,IAAA,EAAA,UAAA,SAAA,EAAA,GAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,KAAA,IAAA,MAAA,GAAA,EAAA,IAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,MAAA,IAAA,MAAA,GAAA,EAAA,IAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,KAAA,EAAA,EAAA,QAAA,EAAA,EAAA,MAAA,aAAA,EAAA,EAAA,IAAA,EAAA,SAAA,GAAA,EAAA,MAAA,KAAA,EAAA,GAAA,GAAA,EAAA,EAAA,MAAA,EAAA,GAAA,KAAA,WAvMD,MAAM,EAAkB,QAAO,iBAAP,CAAO,QAAA,QAAA,eAKzB,GAAQ,EAER,SAAgB,EACpB,EACA,GA8LD,OAAA,EAAA,UAAA,OAAA,EAAA,YA5LO,MAAA,QAAkB,EAEpB,IAAA,EAAqC,KACrC,EAAgC,KAEhC,IACF,EAAW,KAAK,MAAM,GACtB,EAAW,IAAI,EAAU,kBAAkB,GAC3C,MAAO,GACA,OAAA,KAGH,MAAA,EAA8B,GAEpC,EAAS,YACP,SAAU,GAKR,EAAa,KAAI,OAAA,OAAA,OAAA,OAAA,GACZ,GAAC,CACJ,gBAAiB,EAAE,gBAAkB,EACrC,eAAgB,EAAE,eAAiB,MAGvC,GAIA,EAAU,kBAAkB,iBAGxB,MAAA,EAA8B,EAAkB,QAAQ,WAAY,IAElE,OAAA,IAyJT,IAAA,EAxJO,IAAA,GAAc,EAQd,IAPA,MAAA,OAAQ,EAAR,EAAU,QAAQ,MAAA,OAAQ,EAAR,EAAU,QAAS,EAAM,KAC7C,GAAc,GAEb,KAAgB,QAAV,EAAA,EAAM,YAAI,IAAA,OAAA,EAAA,EAAE,QAAQ,WAAY,MAAK,SAAS,IAAM,KAE3D,GAAc,IAEX,EAEI,OAAA,KAGL,GAAc,MAAd,EAAM,MAA6B,MAAb,EAAM,IAGvB,OAAA,KA6BL,IAAA,GAAe,EAAgB,EAAA,iBAAA,EAAc,GAC3C,EAAE,cAAgB,EAAM,QACxB,EAAE,cAAgB,EAAM,OACxB,EAAE,iBAAmB,EAAM,KAI7B,IAAkB,IAAlB,EAGF,EAAe,EAAa,OAAS,MAChC,CAAA,GAAqB,IAAjB,EAKF,OAAA,KAEP,IAGI,MAAA,EAAgB,EAAa,GAC7B,EAAiF,GAEnF,GAAsB,MAAtB,EAAc,KAChB,EAAkB,KAAO,EAAc,UAClC,GAA4B,MAAxB,EAAc,OAAgB,CAOjC,MAAA,EAAU,MAAA,OAAQ,EAAR,EAAU,iBAAiB,EAAc,QAAQ,GAC7D,GAAA,EAAS,CACL,MACA,EADQ,EAAQ,MAAM,MACT,EAAc,aAAe,GAC5C,GAAA,EAAM,CAIF,MAAA,EAAkB,MAAM,KAAK,EAAK,OAAO,EAAc,eAAiB,IAC1E,IACF,EAAkB,KAAO,EAAgB,MAMzC,OAAA,EAAkB,MACnB,IAAA,cAMH,EAAkB,KAAO,EAAM,KAAO,eACtC,MAGG,IAAA,WAIH,EAAkB,KAAO,EAAM,KAC/B,MAGG,IAAA,QACA,IAAA,SAIH,EAAkB,KAAO,EAAM,KAgC5B,OA3BH,EAAkB,MAAQ,EAAM,KAAK,SAAS,EAAkB,QASlE,EAAkB,KAAO,EAAM,MAGL,MAAxB,EAAc,SAChB,EAAkB,KAAO,EAAc,OACvC,EAAkB,KAAO,EAAc,aACvC,EAAkB,IAAM,EAAc,gBAGpC,IACF,QAAQ,6BAA6B,EAAM,aAAa,EAAkB,SAC1E,QAAQ,IAAI,SAAQ,OAAA,OAAA,GAAM,IAC1B,QAAQ,IAAI,eAAgB,GAC5B,QAAQ,IAAI,mBAAoB,EAAa,EAAe,IAC5D,QAAQ,IAAI,QAAS,GACrB,QAAQ,YAGH;;;;AC0XX,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,YAAA,QAAA,cAAA,EA1lBA,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,aAIA,EAAA,QAAA,WACA,EAAA,QAAA,qBACA,EAAA,QAAA,mBACA,EAAA,QAAA,sBAEA,EAAA,QAAA,+BAEA,EAAA,QAAA,aACA,EAAA,QAAA,wBACA,EAAA,QAAA,kBACA,EAAA,QAAA,oBACA,EAAA,QAAA,gBAGA,EAAA,QAAA,yBAukBA,EAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,IAAA,IAAA,EAAA,UAAA,SAAA,EAAA,GAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,KAAA,IAAA,MAAA,GAAA,EAAA,IAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,MAAA,IAAA,MAAA,GAAA,EAAA,IAAA,SAAA,EAAA,GAAA,IAAA,EAAA,EAAA,KAAA,EAAA,EAAA,QAAA,EAAA,EAAA,MAAA,aAAA,EAAA,EAAA,IAAA,EAAA,SAAA,GAAA,EAAA,MAAA,KAAA,EAAA,GAAA,GAAA,EAAA,EAAA,MAAA,EAAA,GAAA,KAAA,WArkBA,MAAM,EAAe,QAAO,iBAAP,CAAO,QAAA,QAAA,cAU5B,SAAe,EACb,EACA,GAyjBF,OAAA,EAAA,UAAA,OAAA,EAAA,YAvjBS,aAAO,GAAc,2BAA2B,EAAU,KAGnE,SAAe,EACb,EACA,GAkjBF,OAAA,EAAA,UAAA,OAAA,EAAA,YAhjBS,aAAO,GAAc,6BAA6B,EAAU,KAGrE,SAAe,EACb,EACA,GA2iBF,OAAA,EAAA,UAAA,OAAA,EAAA,YAziBS,aAAO,GAAc,8BAA8B,EAAU,KAGtE,SAAe,EAAuB,GAsiBtC,OAAA,EAAA,UAAA,OAAA,EAAA,YAriBS,aAAO,GAAc,uBAAuB,KAErD,SAAe,EAAmC,GAmiBlD,OAAA,EAAA,UAAA,OAAA,EAAA,YAliBS,aAAO,GAAc,mCAAmC,KA7BjE,EAAa,KAAK,QAClB,QAAO,iBAAP,CAAO,QAAA,QAAA,wBAAuB,KAAK,QACnC,QAAO,iBAAP,CAAO,QAAA,QAAA,eAAc,KAAK,QA+B1B,MAAM,EAAoB,QAAQ,8EAO5B,MAAO,UAAiB,EAAxB,mBAAN,cAuhBA,SAAA,WAthBU,KAAA,OAAmC,KAEnC,KAAA,IAAO,CAAA,IACT,aAAkB,kBACf,KAAA,OAAS,EAET,KAAA,OAAS,KAGX,KAAA,MAAM,YAAY,KAAK,UAGtB,KAAA,UAAgC,KAChC,KAAA,aAAgB,CAAA,IAClB,aAAqB,YAClB,KAAA,UAAY,EAEZ,KAAA,UAAY,OAIb,KAAA,YAAc,MAChB,IAAC,KAAK,UAAW,OACjB,IAAC,KAAK,MAAM,cAAe,OAE3B,IAAA,MAAC,EAAD,OAAQ,GAAU,KAAK,UAAU,wBAE/B,MAAA,EAAkB,EAClB,EAAmB,EACnB,EAAgB,EAAQ,OAAO,iBAC/B,EAAiB,EAAS,OAAO,iBAElC,KAAA,MAAM,cAAc,GAAG,OAC1B,EACA,EACA,EACA,KAIJ,KAAA,eAAiB,MACX,KAAK,MAAM,eACR,KAAA,MAAM,cAAc,iBAG7B,0BAA0B,GACpB,KAAK,MAAM,gBAAkB,EAAU,gBACrC,KAAK,MAAM,eACR,KAAA,MAAM,cAAc,yBAAyB,KAAK,aAErD,EAAU,gBACZ,EAAU,cAAc,sBAAsB,KAAK,aACnD,EAAU,cAAc,iBAI9B,oBACE,OAAO,iBAAiB,SAAU,KAAK,gBAEzC,uBACM,KAAK,MAAM,eACR,KAAA,MAAM,cAAc,yBAAyB,KAAK,aAEzD,OAAO,oBAAoB,SAAU,KAAK,gBAE5C,SACQ,MAAA,EAAQ,EAAS,KAAK,MAAM,OAEhC,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,IAAK,KAAK,aAAc,WAAW,EAAI,EAAA,KAAA,EAAM,gBAChD,EAAA,EAAA,GAAA,SAAA,CAAQ,IAAK,KAAK,IAAK,MAAO,EAAG,OAAQ,MAidjD,QAAA,SAAA,EArbM,MAAO,UAAoB,EAA3B,mBAAN,cAqbA,SAAA,WAtTE,KAAA,YAAc,MACP,KAAA,YAAY,IAAW,EAAA,UAAA,OAAA,EAAA,YACpB,MACA,QAAa,MAAM,GAAmB,KAAK,GAAQ,EAAK,QACvD,aAAM,EAFI,yCAE6B,QAIlD,KAAA,OAAU,CAAA,IAIJ,GAHC,KAAA,MAAM,eAAc,GACzB,EAAG,kBAEE,EAAG,aAAc,OAEhB,MAAA,EAAY,EAAG,aAAa,MAAM,GACpC,GAAA,qBAAsB,EAAW,CAC7B,MAAA,EAAwC,EAAU,mBAGpD,GAAA,EAAY,aAAe,EAAY,KAAK,SAAS,UAKvD,OAJA,QAAQ,IAAI,iDACP,KAAA,YAAY,IAAW,EAAA,UAAA,OAAA,EAAA,YACnB,aAAM,EAAmC,MAMlD,IAAA,EAAoB,EAAG,aAAa,MAAM,KAAK,GAC/C,GACG,KAAA,aAAa,KAItB,KAAA,WAAc,CAAA,IACP,KAAA,MAAM,eAAc,GACzB,EAAG,mBAGL,KAAA,YAAe,CAAA,IACR,KAAA,MAAM,eAAc,GACzB,EAAG,mBAGL,KAAA,iBAA0B,CAAA,GAAqB,EAAA,UAAA,OAAA,EAAA,YACzC,GAAW,MAAX,EAAG,IACA,KAAA,MAAM,YAAY,EAAS,SAAA,yBAC3B,GAAe,MAAX,EAAG,IACP,KAAA,MAAM,YAAY,EAAS,SAAA,6BAC3B,GAAe,MAAX,EAAG,IACP,KAAA,MAAM,YAAY,EAAS,SAAA,oBAC3B,GAAe,MAAX,EAAG,IAAa,CACnB,MAAA,iBAAC,GAAoB,KAAK,MAC3B,KAAA,MAAM,qBAAqB,QAC3B,GAAe,MAAX,EAAG,IAAa,CACnB,MAAA,mBAAC,GAAsB,KAAK,MAC9B,GACG,KAAA,MAAM,sBAAsB,EAAmB,MAAQ,QAEzD,GAAe,MAAX,EAAG,IAAa,CACnB,MAAA,mBAAC,GAAsB,KAAK,MAC9B,GACG,KAAA,MAAM,sBAAsB,EAAmB,MAAQ,OAK1D,KAAA,SAAW,MACb,GAAA,KAAK,MAAM,aAAc,CACrB,MAAA,KAAC,EAAD,YAAO,EAAP,SAAoB,GAAY,KAAK,MAAM,aAC3C,EAA6B,CACjC,KAAA,EACA,YAAA,EACA,SAAU,EAAS,IAAI,GAAK,EAAE,WAErB,EAAA,EAAA,YAAA,MAIP,KAAA,cAAgB,MAChB,MAAA,EAAQ,SAAS,cAAc,SACrC,EAAM,KAAO,OACb,EAAM,iBAAiB,SAAU,KAAK,cACtC,EAAM,UAGA,KAAA,gBAAyB,CAAA,GAAqB,EAAA,UAAA,OAAA,EAAA,YAGrC,MAAX,EAAG,MAAgB,EAAG,SAAW,EAAG,UACtC,EAAG,iBACE,KAAA,YACe,MAAX,EAAG,MAAgB,EAAG,SAAW,EAAG,WAC7C,EAAG,iBACE,KAAA,oBAIT,KAAA,gBAAmB,CAAA,IACb,GAA0B,MAA1B,SAAS,eAA6D,UAApC,SAAS,cAAc,SAAsB,OAEnF,EAAG,iBACH,EAAG,kBAEG,MAAA,EAAiB,EAAsB,cACzC,IAAC,EAAe,OACd,MAAA,EAAS,EAAc,QAAQ,QAChC,KAAA,YAAY,IAAW,EAAA,UAAA,OAAA,EAAA,YACnB,aAAM,EAAuB,iBAAkB,QAkD1D,KAAA,aAAgB,CAAA,IACR,MAAA,EAAQ,EAAG,OAA4B,MAAO,KAAK,GACrD,GACG,KAAA,aAAa,KA/RR,YAAY,GAob5B,OAAA,EAAA,UAAA,OAAA,EAAA,YAhbQ,GAHC,KAAA,MAAM,YAAW,SAChB,IAAI,QAAQ,GAAW,WAAW,EAAS,KAE5C,KAAK,MAAM,SAAU,OAE1B,QAAQ,KAAK,UAET,IAAA,EAAoC,KACpC,IACF,QAAqB,IACrB,MAAO,GAGP,OAFA,QAAQ,IAAI,wBAAyB,QAChC,KAAA,MAAM,UAAS,GAKlB,GAAgB,MAAhB,EAGF,OAFA,MAAM,wEACD,KAAA,MAAM,YAAW,GAEjB,GAAqC,IAAjC,EAAa,SAAS,OAG/B,OAFA,MAAM,uDACD,KAAA,MAAM,YAAW,GAIpB,KAAK,MAAM,WAAW,QACxB,EAAY,OAAA,OAAA,OAAA,OAAA,GACP,GAAY,CACf,KAAM,KAAK,MAAM,WAAW,SAGhC,SAAS,SAAW,EAAa,oBAE7B,KAAK,MAAM,WAAW,UACnB,KAAA,MAAM,YAAY,KAAK,MAAM,WAAW,UAG1C,IAAA,IAAI,KAAW,EAAa,eACzB,EAAQ,WAGX,IAAA,IAAI,KAAW,EAAa,SAAU,CACnC,MAAA,EAAQ,KAAK,MAAM,WAAW,OAAS,EAAQ,UACrD,EAAQ,QAAQ,GAGlB,QAAQ,QAAQ,UAEX,KAAA,MAAM,gBAAgB,GACtB,KAAA,MAAM,YAAW,KAGxB,WACS,OAAA,EAAS,KAAK,MAAM,OAG7B,aAAa,GACN,KAAA,YAAY,IAAW,EAAA,UAAA,OAAA,EAAA,YACpB,MAAA,QAAiB,EAAuB,GAC1C,GAAA,EAAU,CACP,IAAA,IAAI,KAAW,EAAS,SACtB,EAAQ,WACX,EAAQ,QAAQ,EAAK,MAGlB,OAAA,EAGL,GAAA,KAAK,MAAM,cAAgB,KAAK,MAAM,mBAAoB,CAKtD,MAAA,EAAS,IAAI,WACb,EAAsB,IAAI,QAAgB,IAC9C,EAAO,iBAAiB,UAAW,KAC7B,GAAyB,iBAAlB,EAAO,OACV,MAAA,IAAI,MAAM,yCAElB,EAAQ,EAAO,YAGnB,EAAO,WAAW,GACZ,MAAA,QAAqB,EAEvB,IAAA,EAAwC,KAEtC,MAAA,GAA2B,EAA+B,EAAA,2BAAA,GAC5D,IACF,QAAQ,IAAI,sCACZ,EAAiB,GAGb,MAAA,QAA4B,EAChC,EAAA,yCAAA,EACA,EAAK,MAOH,IALC,GAAkB,IACrB,QAAQ,IAAI,sCACZ,EAAiB,GAGG,MAAlB,EACK,MAAA,CACL,KAAM,KAAK,MAAM,aAAa,MAAQ,UACtC,YAAa,KAAK,MAAM,aAAa,YACrC,SAAU,KAAK,MAAM,aAAa,SAAS,IAAI,IAKvC,MAAA,EAAI,EAAa,QAAQ,eAExB,OADP,EAAE,aAAa,GACR,KAMR,OAAA,QAoHX,oBACE,OAAO,iBAAiB,UAAW,KAAK,iBACxC,OAAO,iBAAiB,WAAY,KAAK,kBACzC,SAAS,iBAAiB,QAAS,KAAK,iBACnC,KAAA,4BAGP,uBACE,OAAO,oBAAoB,UAAW,KAAK,iBAC3C,OAAO,oBAAoB,WAAY,KAAK,kBAC5C,SAAS,oBAAoB,QAAS,KAAK,iBAGvC,4BAyLR,OAAA,EAAA,UAAA,OAAA,EAAA,YAxLU,MAAA,WAAC,GAAc,KAAK,MAAM,WAC5B,GAAA,EAAY,CACV,IAAC,EAAL,UAIE,YAHA,sDACkD,OAAO,SAAS,0BAI/D,KAAA,YAAY,IAAW,EAAA,UAAA,OAAA,EAAA,YACpB,MAAA,QAA2B,MAAM,GACnC,IAAA,EAAW,IAAI,IAAI,EAAY,OAAO,SAAS,MAAM,SAIlD,OAHH,EAAS,SAAS,OACpB,EAAW,EAAS,MAAM,EAAS,YAAY,KAAO,UAE3C,EAA8B,QAAgB,EAAS,uBAEjE,GAAI,KAAK,MAAM,WAAW,iBAAkB,CAI/C,OAAc,WAAiB,CAC/B,mBAAoB,CAAC,EAAkB,KAChC,KAAA,YAAY,IAAM,EAAyB,EAAU,MAIxD,MAAA,EAAS,SAAS,cAAc,UACtC,EAAO,eAAiB,KAAK,MAAM,WAAW,mBAC9C,SAAS,KAAK,YAAY,MAW9B,gBACQ,MAAA,EAAQ,KAAK,WAGjB,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,oBACxB,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,kBACxB,EAAA,EAAA,GAAA,IAAA,CAAG,WAAW,EAAI,EAAA,KAAA,EAAM,WAAxB,uDACuD,KACrD,EAAA,EAAA,GAAA,IAAA,CACE,WAAW,EAAI,EAAA,KAAA,EAAM,MACrB,KAAK,+DAA6D,cAG/D,IAPP,6DAUC,EACC,WAAA,EAAA,EAAA,GAAA,IAAA,CAAG,WAAW,EAAI,EAAA,KAAA,EAAM,WAAxB,uIAEsD,KACpD,EAAA,EAAA,GAAA,IAAA,CAAG,SAAU,EAAG,WAAW,EAAI,EAAA,KAAA,EAAM,MAAO,QAAS,KAAK,aAAW,cAEhE,IALP,gCASA,EAAA,EAAA,GAAA,IAAA,CAAG,WAAW,EAAI,EAAA,KAAA,EAAM,WAAS,yIAKnC,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,yBACxB,EAAA,EAAA,GAAA,QAAA,CACE,KAAK,OACL,KAAK,OACL,GAAG,OACH,SAAU,KAAK,aACf,WAAW,EAAI,EAAA,KAAA,EAAM,SAEvB,EAAA,EAAA,GAAA,QAAA,CAAO,IAAI,OAAO,WAAW,EAAI,EAAA,KAAA,EAAM,cAAe,SAAU,GAAC,YAKnE,EAAA,EAAA,GAAA,IAAA,CAAG,WAAW,EAAI,EAAA,KAAA,EAAM,WAAxB,UACU,KACR,EAAA,EAAA,GAAA,IAAA,CACE,WAAW,EAAI,EAAA,KAAA,EAAM,MACrB,KAAK,8CACL,OAAO,UAAQ,iBAGZ,IARP,8GAaA,EAAA,EAAA,GAAA,IAAA,CAAG,WAAW,EAAI,EAAA,KAAA,EAAM,WAAxB,oCACoC,KAClC,EAAA,EAAA,GAAA,IAAA,CACE,WAAW,EAAI,EAAA,KAAA,EAAM,MACrB,OAAO,SACP,KAAK,gDAA8C,+BALvD,OAgBR,cACQ,MAAA,EAAQ,KAAK,WAGjB,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,SACxB,EAAA,EAAA,GAAA,MAAA,KAAA,6BACA,EAAA,EAAA,GAAA,MAAA,KAAA,2CAKN,mBACQ,MAAA,EAAQ,KAAK,WACZ,OAAA,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,WAGnC,gBACQ,MAAA,SAAC,EAAD,mBAAW,EAAX,MAA+B,EAA/B,QAAsC,EAAtC,SAA+C,GAAY,KAAK,MAElE,GAAA,EACK,OAAA,KAAK,cAGV,GAAA,EACK,OAAA,KAAK,mBAGV,IAAC,IAAuB,EACnB,OAAA,KAAK,gBAGN,OAAA,GACD,KAAA,EAAS,SAAA,mBACL,OAAA,EAAC,EAAA,GAAA,EAAD,qBAAqB,CAAC,mBAAoB,EAAoB,SAAU,IAE5E,KAAA,EAAS,SAAA,uBAEV,OAAA,EAAC,EAAA,GAAA,EAAD,wBAAwB,CAAC,mBAAoB,EAAoB,SAAU,IAG1E,KAAA,EAAS,SAAA,cACL,OAAA,EAAC,EAAA,GAAA,EAAD,sBAAsB,CAAC,mBAAoB,EAAoB,SAAU,KAKtF,SACQ,MAAA,EAAQ,KAAK,WAEjB,OAAA,EAAA,EAAA,GAAA,MAAA,CACE,OAAQ,KAAK,OACb,WAAY,KAAK,WACjB,YAAa,KAAK,YAClB,WAAW,EAAI,EAAA,KAAA,EAAM,KAAM,KAAK,MAAM,YAAc,EAAM,kBAE1D,EAAC,EAAA,GAAA,EAAQ,CACP,YAAa,KAAK,MAAM,YACxB,cAAe,KAAK,MAAM,cAC1B,MAAO,KAAK,MAAM,SAEpB,EAAC,EAAA,GAAA,EAAD,QAAQ,OAAA,OAAA,CACN,SAAU,KAAK,SACf,cAAe,KAAK,eACf,KAAK,SAEZ,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,mBAAoB,KAAK,iBAClD,KAAK,MAAM,aAAc,EAAA,EAAA,GAAA,MAAA,CAAK,WAAW,EAAI,EAAA,KAAA,EAAM,gBAM5D,QAAA,YAAA,EAAA,MAAM,GAAW,EAAU,EAAA,WAAA,GACzB,EAAW,WAAA,OAAO,CAChB,aAAc,CACZ,SAAU,WACV,MAAO,QACP,OAAQ,QACR,QAAS,EACT,cAAe,QAEjB,MAAO,CACL,QAAS,OACT,cAAe,SACf,WAAY,SACZ,eAAgB,SAChB,OAAQ,QAEV,QAAS,CACP,OAAQ,EACR,cAAe,EACf,WAAY,EAAM,sBAClB,gBAAiB,SACjB,cAAe,CACb,CACE,KAAM,CACJ,UAAW,aAEb,GAAI,CACF,UAAW,eAIjB,wBAAyB,2BACzB,kBAAmB,OAErB,KAAM,CACJ,MAAO,QACP,OAAQ,QACR,SAAU,SACV,QAAS,OACT,cAAe,SACf,SAAU,WACV,WAAY,EAAW,WAAA,UACvB,WAAY,OACZ,MAAO,EAAM,gBAEf,eAAgB,CACd,OAAQ,QAEV,WAAY,CACV,UAAW,aACX,SAAU,WACV,IAAK,EACL,KAAM,EACN,MAAO,OACP,OAAQ,OACR,qBAAsB,EAAM,wBAC5B,cAAe,QAEjB,iBAAkB,CAChB,SAAU,WACV,QAAS,OACT,SAAU,SACV,cAAe,SACf,KAAM,GAER,iBAAkB,CAChB,QAAS,OACT,WAAY,SACZ,eAAgB,SAChB,KAAM,GAER,eAAgB,CACd,SAAU,KAEZ,SAAU,CACR,aAAc,IAEhB,KAAM,CACJ,QAAS,QAEX,sBAAuB,CACrB,QAAS,OACT,WAAY,SACZ,eAAgB,UAElB,aAAc,CACZ,aAAc,GACd,OAAQ,GACR,KAAM,EACN,SAAU,IACV,UAAW,SACX,SAAU,EAAS,SAAA,WACnB,WAAY,OACZ,WAAY,EAAM,sBAClB,MAAO,EAAM,kBACb,kBAAmB,EAAS,SAAA,uBAClB,SAAA,CACR,WAAY,EAAM,0BAGtB,KAAM,CACJ,MAAO,EAAM,sBACb,OAAQ,UACR,eAAgB,OAChB,kBAAmB,EAAS,SAAA,uBAClB,SAAA,CACR,MAAO,EAAM;;ACjrBd,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,0BAAA,EAnBP,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,wBACA,EAAA,QAAA,iBACA,EAAA,QAAA,qCACA,EAAA,QAAA,kBACA,EAAA,QAAA,gBAUA,EAAA,QAAA,eACA,EAAA,QAAA,iBACA,EAAA,QAAA,iBAEO,MAAM,GAAuB,EAAK,EAAA,MAAA,KACjC,MAAA,GAAS,EAAQ,EAAA,SAAA,EAAR,cACT,GAAQ,EAAd,EAAA,YACM,GAAgB,EAAQ,EAAA,SAAA,IAAO,GAAS,EAAiB,EAAA,kBAAA,CAAC,MAAA,EAAO,OAAA,IAAW,KAAO,CACvF,EACA,IAIA,OAAA,EAAC,EAAA,GAAA,EAAD,6BAA6B,MAC3B,EAAC,EAAA,GAAA,EAAD,YAAY,CACV,oBAAoB,EADV,EAAA,yBAEV,cAAe,EACf,YAAa,EAAa,aAAA,IAC1B,WAAY,EAAY,YAAA,IACxB,SAAU,EAAU,UAAA,IACpB,gBAAiB,EAAiB,iBAAA,gBAClC,cAAe,EAAe,eAAA,IAC9B,YAAa,EAAa,aAAA,IAC1B,oBAAqB,EAAqB,qBAAA,IAC1C,sBAAuB,EAAiB,iBAAA,sBACxC,cAAc,EAAQ,EAAA,SAAA,EAAR,kBACd,MAAO,EACP,kBAAkB,EAAQ,EAAA,SAAA,EAAR,sBAClB,UAAU,EAAQ,EAAA,SAAA,EAAR,cACV,YAAY,EAAQ,EAAA,SAAA,EAAR,gBACZ,SAAU,EACV,YAAY,EAAQ,EAAA,SAAA,EAAR,gBACZ,SAAS,EAAQ,EAAA,SAAA,EAAR,aACT,OAAO,EAAQ,EAAA,SAAA,EAAR,gBA7BR,QAAA,qBAAA;;ACJP,aAfA,IAAA,EAAA,QAAA,UACA,EAAA,QAAA,iCACA,EAAA,QAAA,wBAEA,QAAQ,mBAAmB,QAAQ,mBAAmB,WAGlD,OAAO,MACT,OAAO,IAAI,QAAQ,MAEV,EAAA,EAAA,SAAA,EAAA,EAAA,GAAA,MAAA,MAAS,SAAS,KAAM,SAAS,KAAK,uBAAoB,KAEnE,OAAO,IAAI,WAGb,EACE,EAAA,SAAA,EAAC,EAAA,GAAA,EAAD,cAAc,MACZ,EAAC,EAAA,GAAA,EAAD,qBAAqB,OAEvB,SAAS,KACT,SAAS,KAAK,uBAAoB;;ACpBpC7f,OAAOC,QAAU,SAAsBmd,GAC9B,OAAA,IAAI3d,QAAQ,SAAUG,EAASgd,GAChCkD,IAAAA,EAAS3iB,SAAS1J,cAAc,UACpCqsB,EAAOC,OAAQ,EACfD,EAAOpsB,KAAO,kBACdosB,EAAOE,QAAU,QACjBF,EAAO3H,IAAMiF,EACb0C,EAAOG,QAAU,SAAU5lB,GACzBylB,EAAOG,QAAUH,EAAOI,OAAS,KACjCtD,EAAOviB,IAGTylB,EAAOI,OAAS,WACdJ,EAAOG,QAAUH,EAAOI,OAAS,KACjCtgB,KAGFzC,SAASua,qBAAqB,QAAQ,GAAGzf,YAAY6nB","file":"speedscope.179feffa.js","sourceRoot":"../../assets","sourcesContent":["import { _catchError } from './diff/catch-error';\n\n/**\n * The `option` object can potentially contain callback functions\n * that are called during various stages of our renderer. This is the\n * foundation on which all our addons like `preact/debug`, `preact/compat`,\n * and `preact/hooks` are based on. See the `Options` type in `internal.d.ts`\n * for a full list of available option hooks (most editors/IDEs allow you to\n * ctrl+click or cmd+click on mac the type definition below).\n * @type {import('./internal').Options}\n */\nconst options = {\n\t_catchError\n};\n\nexport default options;\n","export const EMPTY_OBJ = {};\nexport const EMPTY_ARR = [];\nexport const IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord/i;\n","import options from './options';\n\n/**\n * Create an virtual node (used for JSX)\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component\n * constructor for this virtual node\n * @param {object | null | undefined} [props] The properties of the virtual node\n * @param {Array<import('.').ComponentChildren>} [children] The children of the virtual node\n * @returns {import('./internal').VNode}\n */\nexport function createElement(type, props, children) {\n\tlet normalizedProps = {},\n\t\ti;\n\tfor (i in props) {\n\t\tif (i !== 'key' && i !== 'ref') normalizedProps[i] = props[i];\n\t}\n\n\tif (arguments.length > 3) {\n\t\tchildren = [children];\n\t\t// https://github.com/preactjs/preact/issues/1916\n\t\tfor (i = 3; i < arguments.length; i++) {\n\t\t\tchildren.push(arguments[i]);\n\t\t}\n\t}\n\tif (children != null) {\n\t\tnormalizedProps.children = children;\n\t}\n\n\t// If a Component VNode, check for and apply defaultProps\n\t// Note: type may be undefined in development, must never error here.\n\tif (typeof type == 'function' && type.defaultProps != null) {\n\t\tfor (i in type.defaultProps) {\n\t\t\tif (normalizedProps[i] === undefined) {\n\t\t\t\tnormalizedProps[i] = type.defaultProps[i];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn createVNode(\n\t\ttype,\n\t\tnormalizedProps,\n\t\tprops && props.key,\n\t\tprops && props.ref,\n\t\tnull\n\t);\n}\n\n/**\n * Create a VNode (used internally by Preact)\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component\n * Constructor for this virtual node\n * @param {object | string | number | null} props The properties of this virtual node.\n * If this virtual node represents a text node, this is the text of the node (string or number).\n * @param {string | number | null} key The key for this virtual node, used when\n * diffing it against its children\n * @param {import('./internal').VNode[\"ref\"]} ref The ref property that will\n * receive a reference to its created child\n * @returns {import('./internal').VNode}\n */\nexport function createVNode(type, props, key, ref, original) {\n\t// V8 seems to be better at detecting type shapes if the object is allocated from the same call site\n\t// Do not inline into createElement and coerceToVNode!\n\tconst vnode = {\n\t\ttype,\n\t\tprops,\n\t\tkey,\n\t\tref,\n\t\t_children: null,\n\t\t_parent: null,\n\t\t_depth: 0,\n\t\t_dom: null,\n\t\t// _nextDom must be initialized to undefined b/c it will eventually\n\t\t// be set to dom.nextSibling which can return `null` and it is important\n\t\t// to be able to distinguish between an uninitialized _nextDom and\n\t\t// a _nextDom that has been set to `null`\n\t\t_nextDom: undefined,\n\t\t_component: null,\n\t\tconstructor: undefined,\n\t\t_original: original\n\t};\n\n\tif (original == null) vnode._original = vnode;\n\tif (options.vnode) options.vnode(vnode);\n\n\treturn vnode;\n}\n\nexport function createRef() {\n\treturn {};\n}\n\nexport function Fragment(props) {\n\treturn props.children;\n}\n\n/**\n * Check if a the argument is a valid Preact VNode.\n * @param {*} vnode\n * @returns {vnode is import('./internal').VNode}\n */\nexport const isValidElement = vnode =>\n\tvnode != null && vnode.constructor === undefined;\n","import { assign } from './util';\nimport { diff, commitRoot } from './diff/index';\nimport options from './options';\nimport { Fragment } from './create-element';\n\n/**\n * Base Component class. Provides `setState()` and `forceUpdate()`, which\n * trigger rendering\n * @param {object} props The initial component props\n * @param {object} context The initial context from parent components'\n * getChildContext\n */\nexport function Component(props, context) {\n\tthis.props = props;\n\tthis.context = context;\n}\n\n/**\n * Update component state and schedule a re-render.\n * @param {object | ((s: object, p: object) => object)} update A hash of state\n * properties to update with new values or a function that given the current\n * state and props returns a new partial state\n * @param {() => void} [callback] A function to be called once component state is\n * updated\n */\nComponent.prototype.setState = function(update, callback) {\n\t// only clone state when copying to nextState the first time.\n\tlet s;\n\tif (this._nextState !== this.state) {\n\t\ts = this._nextState;\n\t} else {\n\t\ts = this._nextState = assign({}, this.state);\n\t}\n\n\tif (typeof update == 'function') {\n\t\tupdate = update(s, this.props);\n\t}\n\n\tif (update) {\n\t\tassign(s, update);\n\t}\n\n\t// Skip update if updater function returned null\n\tif (update == null) return;\n\n\tif (this._vnode) {\n\t\tif (callback) this._renderCallbacks.push(callback);\n\t\tenqueueRender(this);\n\t}\n};\n\n/**\n * Immediately perform a synchronous re-render of the component\n * @param {() => void} [callback] A function to be called after component is\n * re-rendered\n */\nComponent.prototype.forceUpdate = function(callback) {\n\tif (this._vnode) {\n\t\t// Set render mode so that we can differentiate where the render request\n\t\t// is coming from. We need this because forceUpdate should never call\n\t\t// shouldComponentUpdate\n\t\tthis._force = true;\n\t\tif (callback) this._renderCallbacks.push(callback);\n\t\tenqueueRender(this);\n\t}\n};\n\n/**\n * Accepts `props` and `state`, and returns a new Virtual DOM tree to build.\n * Virtual DOM is generally constructed via [JSX](http://jasonformat.com/wtf-is-jsx).\n * @param {object} props Props (eg: JSX attributes) received from parent\n * element/component\n * @param {object} state The component's current state\n * @param {object} context Context object, as returned by the nearest\n * ancestor's `getChildContext()`\n * @returns {import('./index').ComponentChildren | void}\n */\nComponent.prototype.render = Fragment;\n\n/**\n * @param {import('./internal').VNode} vnode\n * @param {number | null} [childIndex]\n */\nexport function getDomSibling(vnode, childIndex) {\n\tif (childIndex == null) {\n\t\t// Use childIndex==null as a signal to resume the search from the vnode's sibling\n\t\treturn vnode._parent\n\t\t\t? getDomSibling(vnode._parent, vnode._parent._children.indexOf(vnode) + 1)\n\t\t\t: null;\n\t}\n\n\tlet sibling;\n\tfor (; childIndex < vnode._children.length; childIndex++) {\n\t\tsibling = vnode._children[childIndex];\n\n\t\tif (sibling != null && sibling._dom != null) {\n\t\t\t// Since updateParentDomPointers keeps _dom pointer correct,\n\t\t\t// we can rely on _dom to tell us if this subtree contains a\n\t\t\t// rendered DOM node, and what the first rendered DOM node is\n\t\t\treturn sibling._dom;\n\t\t}\n\t}\n\n\t// If we get here, we have not found a DOM node in this vnode's children.\n\t// We must resume from this vnode's sibling (in it's parent _children array)\n\t// Only climb up and search the parent if we aren't searching through a DOM\n\t// VNode (meaning we reached the DOM parent of the original vnode that began\n\t// the search)\n\treturn typeof vnode.type == 'function' ? getDomSibling(vnode) : null;\n}\n\n/**\n * Trigger in-place re-rendering of a component.\n * @param {import('./internal').Component} component The component to rerender\n */\nfunction renderComponent(component) {\n\tlet vnode = component._vnode,\n\t\toldDom = vnode._dom,\n\t\tparentDom = component._parentDom;\n\n\tif (parentDom) {\n\t\tlet commitQueue = [];\n\t\tconst oldVNode = assign({}, vnode);\n\t\toldVNode._original = oldVNode;\n\n\t\tlet newDom = diff(\n\t\t\tparentDom,\n\t\t\tvnode,\n\t\t\toldVNode,\n\t\t\tcomponent._globalContext,\n\t\t\tparentDom.ownerSVGElement !== undefined,\n\t\t\tnull,\n\t\t\tcommitQueue,\n\t\t\toldDom == null ? getDomSibling(vnode) : oldDom\n\t\t);\n\t\tcommitRoot(commitQueue, vnode);\n\n\t\tif (newDom != oldDom) {\n\t\t\tupdateParentDomPointers(vnode);\n\t\t}\n\t}\n}\n\n/**\n * @param {import('./internal').VNode} vnode\n */\nfunction updateParentDomPointers(vnode) {\n\tif ((vnode = vnode._parent) != null && vnode._component != null) {\n\t\tvnode._dom = vnode._component.base = null;\n\t\tfor (let i = 0; i < vnode._children.length; i++) {\n\t\t\tlet child = vnode._children[i];\n\t\t\tif (child != null && child._dom != null) {\n\t\t\t\tvnode._dom = vnode._component.base = child._dom;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn updateParentDomPointers(vnode);\n\t}\n}\n\n/**\n * The render queue\n * @type {Array<import('./internal').Component>}\n */\nlet rerenderQueue = [];\nlet rerenderCount = 0;\n\n/**\n * Asynchronously schedule a callback\n * @type {(cb: () => void) => void}\n */\n/* istanbul ignore next */\n// Note the following line isn't tree-shaken by rollup cuz of rollup/rollup#2566\nconst defer =\n\ttypeof Promise == 'function'\n\t\t? Promise.prototype.then.bind(Promise.resolve())\n\t\t: setTimeout;\n\n/*\n * The value of `Component.debounce` must asynchronously invoke the passed in callback. It is\n * important that contributors to Preact can consistently reason about what calls to `setState`, etc.\n * do, and when their effects will be applied. See the links below for some further reading on designing\n * asynchronous APIs.\n * * [Designing APIs for Asynchrony](https://blog.izs.me/2013/08/designing-apis-for-asynchrony)\n * * [Callbacks synchronous and asynchronous](https://blog.ometer.com/2011/07/24/callbacks-synchronous-and-asynchronous/)\n */\n\nlet prevDebounce;\n\n/**\n * Enqueue a rerender of a component\n * @param {import('./internal').Component} c The component to rerender\n */\nexport function enqueueRender(c) {\n\tif (\n\t\t(!c._dirty &&\n\t\t\t(c._dirty = true) &&\n\t\t\trerenderQueue.push(c) &&\n\t\t\t!rerenderCount++) ||\n\t\tprevDebounce !== options.debounceRendering\n\t) {\n\t\tprevDebounce = options.debounceRendering;\n\t\t(prevDebounce || defer)(process);\n\t}\n}\n\n/** Flush the render queue by rerendering all queued components */\nfunction process() {\n\tlet queue;\n\twhile ((rerenderCount = rerenderQueue.length)) {\n\t\tqueue = rerenderQueue.sort((a, b) => a._vnode._depth - b._vnode._depth);\n\t\trerenderQueue = [];\n\t\t// Don't update `renderCount` yet. Keep its value non-zero to prevent unnecessary\n\t\t// process() calls from getting scheduled while `queue` is still being consumed.\n\t\tqueue.some(c => {\n\t\t\tif (c._dirty) renderComponent(c);\n\t\t});\n\t}\n}\n","import { EMPTY_OBJ, EMPTY_ARR } from './constants';\nimport { commitRoot, diff } from './diff/index';\nimport { createElement, Fragment } from './create-element';\nimport options from './options';\n\nconst IS_HYDRATE = EMPTY_OBJ;\n\n/**\n * Render a Preact virtual node into a DOM element\n * @param {import('./index').ComponentChild} vnode The virtual node to render\n * @param {import('./internal').PreactElement} parentDom The DOM element to\n * render into\n * @param {Element | Text} [replaceNode] Optional: Attempt to re-use an\n * existing DOM tree rooted at `replaceNode`\n */\nexport function render(vnode, parentDom, replaceNode) {\n\tif (options._root) options._root(vnode, parentDom);\n\n\t// We abuse the `replaceNode` parameter in `hydrate()` to signal if we\n\t// are in hydration mode or not by passing `IS_HYDRATE` instead of a\n\t// DOM element.\n\tlet isHydrating = replaceNode === IS_HYDRATE;\n\n\t// To be able to support calling `render()` multiple times on the same\n\t// DOM node, we need to obtain a reference to the previous tree. We do\n\t// this by assigning a new `_children` property to DOM nodes which points\n\t// to the last rendered tree. By default this property is not present, which\n\t// means that we are mounting a new tree for the first time.\n\tlet oldVNode = isHydrating\n\t\t? null\n\t\t: (replaceNode && replaceNode._children) || parentDom._children;\n\tvnode = createElement(Fragment, null, [vnode]);\n\n\t// List of effects that need to be called after diffing.\n\tlet commitQueue = [];\n\tdiff(\n\t\tparentDom,\n\t\t// Determine the new vnode tree and store it on the DOM element on\n\t\t// our custom `_children` property.\n\t\t((isHydrating ? parentDom : replaceNode || parentDom)._children = vnode),\n\t\toldVNode || EMPTY_OBJ,\n\t\tEMPTY_OBJ,\n\t\tparentDom.ownerSVGElement !== undefined,\n\t\treplaceNode && !isHydrating\n\t\t\t? [replaceNode]\n\t\t\t: oldVNode\n\t\t\t? null\n\t\t\t: EMPTY_ARR.slice.call(parentDom.childNodes),\n\t\tcommitQueue,\n\t\treplaceNode || EMPTY_OBJ,\n\t\tisHydrating\n\t);\n\n\t// Flush all queued effects\n\tcommitRoot(commitQueue, vnode);\n}\n\n/**\n * Update an existing DOM element with data from a Preact virtual node\n * @param {import('./index').ComponentChild} vnode The virtual node to render\n * @param {import('./internal').PreactElement} parentDom The DOM element to\n * update\n */\nexport function hydrate(vnode, parentDom) {\n\trender(vnode, parentDom, IS_HYDRATE);\n}\n","import { enqueueRender } from './component';\n\nexport let i = 0;\n\nexport function createContext(defaultValue) {\n\tconst ctx = {};\n\n\tconst context = {\n\t\t_id: '__cC' + i++,\n\t\t_defaultValue: defaultValue,\n\t\tConsumer(props, context) {\n\t\t\treturn props.children(context);\n\t\t},\n\t\tProvider(props) {\n\t\t\tif (!this.getChildContext) {\n\t\t\t\tconst subs = [];\n\t\t\t\tthis.getChildContext = () => {\n\t\t\t\t\tctx[context._id] = this;\n\t\t\t\t\treturn ctx;\n\t\t\t\t};\n\n\t\t\t\tthis.shouldComponentUpdate = _props => {\n\t\t\t\t\tif (this.props.value !== _props.value) {\n\t\t\t\t\t\tsubs.some(c => {\n\t\t\t\t\t\t\tc.context = _props.value;\n\t\t\t\t\t\t\tenqueueRender(c);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.sub = c => {\n\t\t\t\t\tsubs.push(c);\n\t\t\t\t\tlet old = c.componentWillUnmount;\n\t\t\t\t\tc.componentWillUnmount = () => {\n\t\t\t\t\t\tsubs.splice(subs.indexOf(c), 1);\n\t\t\t\t\t\told && old.call(c);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn props.children;\n\t\t}\n\t};\n\n\tcontext.Consumer.contextType = context;\n\n\t// Devtools needs access to the context object when it\n\t// encounters a Provider. This is necessary to support\n\t// setting `displayName` on the context object instead\n\t// of on the component itself. See:\n\t// https://reactjs.org/docs/context.html#contextdisplayname\n\tcontext.Provider._contextRef = context;\n\n\treturn context;\n}\n","/**\n * Assign properties from `props` to `obj`\n * @template O, P The obj and props types\n * @param {O} obj The object to copy properties to\n * @param {P} props The object to copy properties from\n * @returns {O & P}\n */\nexport function assign(obj, props) {\n\tfor (let i in props) obj[i] = props[i];\n\treturn /** @type {O & P} */ (obj);\n}\n\n/**\n * Remove a child node from its parent if attached. This is a workaround for\n * IE11 which doesn't support `Element.prototype.remove()`. Using this function\n * is smaller than including a dedicated polyfill.\n * @param {Node} node The node to remove\n */\nexport function removeNode(node) {\n\tlet parentNode = node.parentNode;\n\tif (parentNode) parentNode.removeChild(node);\n}\n","import { diff, unmount, applyRef } from './index';\nimport { createVNode } from '../create-element';\nimport { EMPTY_OBJ, EMPTY_ARR } from '../constants';\nimport { removeNode } from '../util';\nimport { getDomSibling } from '../component';\n\n/**\n * Diff the children of a virtual node\n * @param {import('../internal').PreactElement} parentDom The DOM element whose\n * children are being diffed\n * @param {import('../internal').VNode} newParentVNode The new virtual\n * node whose children should be diff'ed against oldParentVNode\n * @param {import('../internal').VNode} oldParentVNode The old virtual\n * node whose children should be diff'ed against newParentVNode\n * @param {object} globalContext The current context object - modified by getChildContext\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node\n * @param {Array<import('../internal').PreactElement>} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {Node | Text} oldDom The current attached DOM\n * element any new dom elements should be placed around. Likely `null` on first\n * render (except when hydrating). Can be a sibling DOM element when diffing\n * Fragments that have siblings. In most cases, it starts out as `oldChildren[0]._dom`.\n * @param {boolean} isHydrating Whether or not we are in hydration\n */\nexport function diffChildren(\n\tparentDom,\n\tnewParentVNode,\n\toldParentVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\toldDom,\n\tisHydrating\n) {\n\tlet i, j, oldVNode, newDom, sibDom, firstChildDom, refs;\n\n\t// This is a compression of oldParentVNode!=null && oldParentVNode != EMPTY_OBJ && oldParentVNode._children || EMPTY_ARR\n\t// as EMPTY_OBJ._children should be `undefined`.\n\tlet oldChildren = (oldParentVNode && oldParentVNode._children) || EMPTY_ARR;\n\n\tlet oldChildrenLength = oldChildren.length;\n\n\t// Only in very specific places should this logic be invoked (top level `render` and `diffElementNodes`).\n\t// I'm using `EMPTY_OBJ` to signal when `diffChildren` is invoked in these situations. I can't use `null`\n\t// for this purpose, because `null` is a valid value for `oldDom` which can mean to skip to this logic\n\t// (e.g. if mounting a new tree in which the old DOM should be ignored (usually for Fragments).\n\tif (oldDom == EMPTY_OBJ) {\n\t\tif (excessDomChildren != null) {\n\t\t\toldDom = excessDomChildren[0];\n\t\t} else if (oldChildrenLength) {\n\t\t\toldDom = getDomSibling(oldParentVNode, 0);\n\t\t} else {\n\t\t\toldDom = null;\n\t\t}\n\t}\n\n\ti = 0;\n\tnewParentVNode._children = toChildArray(\n\t\tnewParentVNode._children,\n\t\tchildVNode => {\n\t\t\tif (childVNode != null) {\n\t\t\t\tchildVNode._parent = newParentVNode;\n\t\t\t\tchildVNode._depth = newParentVNode._depth + 1;\n\n\t\t\t\t// Check if we find a corresponding element in oldChildren.\n\t\t\t\t// If found, delete the array item by setting to `undefined`.\n\t\t\t\t// We use `undefined`, as `null` is reserved for empty placeholders\n\t\t\t\t// (holes).\n\t\t\t\toldVNode = oldChildren[i];\n\n\t\t\t\tif (\n\t\t\t\t\toldVNode === null ||\n\t\t\t\t\t(oldVNode &&\n\t\t\t\t\t\tchildVNode.key == oldVNode.key &&\n\t\t\t\t\t\tchildVNode.type === oldVNode.type)\n\t\t\t\t) {\n\t\t\t\t\toldChildren[i] = undefined;\n\t\t\t\t} else {\n\t\t\t\t\t// Either oldVNode === undefined or oldChildrenLength > 0,\n\t\t\t\t\t// so after this loop oldVNode == null or oldVNode is a valid value.\n\t\t\t\t\tfor (j = 0; j < oldChildrenLength; j++) {\n\t\t\t\t\t\toldVNode = oldChildren[j];\n\t\t\t\t\t\t// If childVNode is unkeyed, we only match similarly unkeyed nodes, otherwise we match by key.\n\t\t\t\t\t\t// We always match by type (in either case).\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\toldVNode &&\n\t\t\t\t\t\t\tchildVNode.key == oldVNode.key &&\n\t\t\t\t\t\t\tchildVNode.type === oldVNode.type\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\toldChildren[j] = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\toldVNode = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toldVNode = oldVNode || EMPTY_OBJ;\n\n\t\t\t\t// Morph the old element into the new one, but don't append it to the dom yet\n\t\t\t\tnewDom = diff(\n\t\t\t\t\tparentDom,\n\t\t\t\t\tchildVNode,\n\t\t\t\t\toldVNode,\n\t\t\t\t\tglobalContext,\n\t\t\t\t\tisSvg,\n\t\t\t\t\texcessDomChildren,\n\t\t\t\t\tcommitQueue,\n\t\t\t\t\toldDom,\n\t\t\t\t\tisHydrating\n\t\t\t\t);\n\n\t\t\t\tif ((j = childVNode.ref) && oldVNode.ref != j) {\n\t\t\t\t\tif (!refs) refs = [];\n\t\t\t\t\tif (oldVNode.ref) refs.push(oldVNode.ref, null, childVNode);\n\t\t\t\t\trefs.push(j, childVNode._component || newDom, childVNode);\n\t\t\t\t}\n\n\t\t\t\t// Only proceed if the vnode has not been unmounted by `diff()` above.\n\t\t\t\tif (newDom != null) {\n\t\t\t\t\tif (firstChildDom == null) {\n\t\t\t\t\t\tfirstChildDom = newDom;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet nextDom;\n\t\t\t\t\tif (childVNode._nextDom !== undefined) {\n\t\t\t\t\t\t// Only Fragments or components that return Fragment like VNodes will\n\t\t\t\t\t\t// have a non-undefined _nextDom. Continue the diff from the sibling\n\t\t\t\t\t\t// of last DOM child of this child VNode\n\t\t\t\t\t\tnextDom = childVNode._nextDom;\n\n\t\t\t\t\t\t// Eagerly cleanup _nextDom. We don't need to persist the value because\n\t\t\t\t\t\t// it is only used by `diffChildren` to determine where to resume the diff after\n\t\t\t\t\t\t// diffing Components and Fragments. Once we store it the nextDOM local var, we\n\t\t\t\t\t\t// can clean up the property\n\t\t\t\t\t\tchildVNode._nextDom = undefined;\n\t\t\t\t\t} else if (\n\t\t\t\t\t\texcessDomChildren == oldVNode ||\n\t\t\t\t\t\tnewDom != oldDom ||\n\t\t\t\t\t\tnewDom.parentNode == null\n\t\t\t\t\t) {\n\t\t\t\t\t\t// NOTE: excessDomChildren==oldVNode above:\n\t\t\t\t\t\t// This is a compression of excessDomChildren==null && oldVNode==null!\n\t\t\t\t\t\t// The values only have the same type when `null`.\n\n\t\t\t\t\t\touter: if (oldDom == null || oldDom.parentNode !== parentDom) {\n\t\t\t\t\t\t\tparentDom.appendChild(newDom);\n\t\t\t\t\t\t\tnextDom = null;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// `j<oldChildrenLength; j+=2` is an alternative to `j++<oldChildrenLength/2`\n\t\t\t\t\t\t\tfor (\n\t\t\t\t\t\t\t\tsibDom = oldDom, j = 0;\n\t\t\t\t\t\t\t\t(sibDom = sibDom.nextSibling) && j < oldChildrenLength;\n\t\t\t\t\t\t\t\tj += 2\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tif (sibDom == newDom) {\n\t\t\t\t\t\t\t\t\tbreak outer;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tparentDom.insertBefore(newDom, oldDom);\n\t\t\t\t\t\t\tnextDom = oldDom;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Browsers will infer an option's `value` from `textContent` when\n\t\t\t\t\t\t// no value is present. This essentially bypasses our code to set it\n\t\t\t\t\t\t// later in `diff()`. It works fine in all browsers except for IE11\n\t\t\t\t\t\t// where it breaks setting `select.value`. There it will be always set\n\t\t\t\t\t\t// to an empty string. Re-applying an options value will fix that, so\n\t\t\t\t\t\t// there are probably some internal data structures that aren't\n\t\t\t\t\t\t// updated properly.\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// To fix it we make sure to reset the inferred value, so that our own\n\t\t\t\t\t\t// value check in `diff()` won't be skipped.\n\t\t\t\t\t\tif (newParentVNode.type == 'option') {\n\t\t\t\t\t\t\tparentDom.value = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// If we have pre-calculated the nextDOM node, use it. Else calculate it now\n\t\t\t\t\t// Strictly check for `undefined` here cuz `null` is a valid value of `nextDom`.\n\t\t\t\t\t// See more detail in create-element.js:createVNode\n\t\t\t\t\tif (nextDom !== undefined) {\n\t\t\t\t\t\toldDom = nextDom;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toldDom = newDom.nextSibling;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof newParentVNode.type == 'function') {\n\t\t\t\t\t\t// Because the newParentVNode is Fragment-like, we need to set it's\n\t\t\t\t\t\t// _nextDom property to the nextSibling of its last child DOM node.\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// `oldDom` contains the correct value here because if the last child\n\t\t\t\t\t\t// is a Fragment-like, then oldDom has already been set to that child's _nextDom.\n\t\t\t\t\t\t// If the last child is a DOM VNode, then oldDom will be set to that DOM\n\t\t\t\t\t\t// node's nextSibling.\n\n\t\t\t\t\t\tnewParentVNode._nextDom = oldDom;\n\t\t\t\t\t}\n\t\t\t\t} else if (\n\t\t\t\t\toldDom &&\n\t\t\t\t\toldVNode._dom == oldDom &&\n\t\t\t\t\toldDom.parentNode != parentDom\n\t\t\t\t) {\n\t\t\t\t\t// The above condition is to handle null placeholders. See test in placeholder.test.js:\n\t\t\t\t\t// `efficiently replace null placeholders in parent rerenders`\n\t\t\t\t\toldDom = getDomSibling(oldVNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ti++;\n\t\t\treturn childVNode;\n\t\t}\n\t);\n\n\tnewParentVNode._dom = firstChildDom;\n\n\t// Remove children that are not part of any vnode.\n\tif (excessDomChildren != null && typeof newParentVNode.type != 'function') {\n\t\tfor (i = excessDomChildren.length; i--; ) {\n\t\t\tif (excessDomChildren[i] != null) removeNode(excessDomChildren[i]);\n\t\t}\n\t}\n\n\t// Remove remaining oldChildren if there are any.\n\tfor (i = oldChildrenLength; i--; ) {\n\t\tif (oldChildren[i] != null) unmount(oldChildren[i], oldChildren[i]);\n\t}\n\n\t// Set refs only after unmount\n\tif (refs) {\n\t\tfor (i = 0; i < refs.length; i++) {\n\t\t\tapplyRef(refs[i], refs[++i], refs[++i]);\n\t\t}\n\t}\n}\n\n/**\n * Flatten and loop through the children of a virtual node\n * @param {import('../index').ComponentChildren} children The unflattened\n * children of a virtual node\n * @param {(vnode: import('../internal').VNode) => import('../internal').VNode} [callback]\n * A function to invoke for each child before it is added to the flattened list.\n * @param {Array<import('../internal').VNode | string | number>} [flattened] An flat array of children to modify\n * @returns {import('../internal').VNode[]}\n */\nexport function toChildArray(children, callback, flattened) {\n\tif (flattened == null) flattened = [];\n\n\tif (children == null || typeof children == 'boolean') {\n\t\tif (callback) flattened.push(callback(null));\n\t} else if (Array.isArray(children)) {\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\ttoChildArray(children[i], callback, flattened);\n\t\t}\n\t} else if (!callback) {\n\t\tflattened.push(children);\n\t} else if (typeof children == 'string' || typeof children == 'number') {\n\t\tflattened.push(callback(createVNode(null, children, null, null, children)));\n\t} else if (children._dom != null || children._component != null) {\n\t\tflattened.push(\n\t\t\tcallback(\n\t\t\t\tcreateVNode(\n\t\t\t\t\tchildren.type,\n\t\t\t\t\tchildren.props,\n\t\t\t\t\tchildren.key,\n\t\t\t\t\tnull,\n\t\t\t\t\tchildren._original\n\t\t\t\t)\n\t\t\t)\n\t\t);\n\t} else {\n\t\tflattened.push(callback(children));\n\t}\n\n\treturn flattened;\n}\n","import { IS_NON_DIMENSIONAL } from '../constants';\nimport options from '../options';\n\n/**\n * Diff the old and new properties of a VNode and apply changes to the DOM node\n * @param {import('../internal').PreactElement} dom The DOM node to apply\n * changes to\n * @param {object} newProps The new props\n * @param {object} oldProps The old props\n * @param {boolean} isSvg Whether or not this node is an SVG node\n * @param {boolean} hydrate Whether or not we are in hydration mode\n */\nexport function diffProps(dom, newProps, oldProps, isSvg, hydrate) {\n\tlet i;\n\n\tfor (i in oldProps) {\n\t\tif (i !== 'children' && i !== 'key' && !(i in newProps)) {\n\t\t\tsetProperty(dom, i, null, oldProps[i], isSvg);\n\t\t}\n\t}\n\n\tfor (i in newProps) {\n\t\tif (\n\t\t\t(!hydrate || typeof newProps[i] == 'function') &&\n\t\t\ti !== 'children' &&\n\t\t\ti !== 'key' &&\n\t\t\ti !== 'value' &&\n\t\t\ti !== 'checked' &&\n\t\t\toldProps[i] !== newProps[i]\n\t\t) {\n\t\t\tsetProperty(dom, i, newProps[i], oldProps[i], isSvg);\n\t\t}\n\t}\n}\n\nfunction setStyle(style, key, value) {\n\tif (key[0] === '-') {\n\t\tstyle.setProperty(key, value);\n\t} else if (\n\t\ttypeof value == 'number' &&\n\t\tIS_NON_DIMENSIONAL.test(key) === false\n\t) {\n\t\tstyle[key] = value + 'px';\n\t} else if (value == null) {\n\t\tstyle[key] = '';\n\t} else {\n\t\tstyle[key] = value;\n\t}\n}\n\n/**\n * Set a property value on a DOM node\n * @param {import('../internal').PreactElement} dom The DOM node to modify\n * @param {string} name The name of the property to set\n * @param {*} value The value to set the property to\n * @param {*} oldValue The old value the property had\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node or not\n */\nexport function setProperty(dom, name, value, oldValue, isSvg) {\n\tlet s, useCapture, nameLower;\n\n\tif (isSvg) {\n\t\tif (name === 'className') {\n\t\t\tname = 'class';\n\t\t}\n\t} else if (name === 'class') {\n\t\tname = 'className';\n\t}\n\n\tif (name === 'style') {\n\t\ts = dom.style;\n\n\t\tif (typeof value == 'string') {\n\t\t\ts.cssText = value;\n\t\t} else {\n\t\t\tif (typeof oldValue == 'string') {\n\t\t\t\ts.cssText = '';\n\t\t\t\toldValue = null;\n\t\t\t}\n\n\t\t\tif (oldValue) {\n\t\t\t\tfor (let i in oldValue) {\n\t\t\t\t\tif (!(value && i in value)) {\n\t\t\t\t\t\tsetStyle(s, i, '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (value) {\n\t\t\t\tfor (let i in value) {\n\t\t\t\t\tif (!oldValue || value[i] !== oldValue[i]) {\n\t\t\t\t\t\tsetStyle(s, i, value[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t// Benchmark for comparison: https://esbench.com/bench/574c954bdb965b9a00965ac6\n\telse if (name[0] === 'o' && name[1] === 'n') {\n\t\tuseCapture = name !== (name = name.replace(/Capture$/, ''));\n\t\tnameLower = name.toLowerCase();\n\t\tname = (nameLower in dom ? nameLower : name).slice(2);\n\n\t\tif (value) {\n\t\t\tif (!oldValue) dom.addEventListener(name, eventProxy, useCapture);\n\t\t\t(dom._listeners || (dom._listeners = {}))[name] = value;\n\t\t} else {\n\t\t\tdom.removeEventListener(name, eventProxy, useCapture);\n\t\t}\n\t} else if (\n\t\tname !== 'list' &&\n\t\tname !== 'tagName' &&\n\t\t// HTMLButtonElement.form and HTMLInputElement.form are read-only but can be set using\n\t\t// setAttribute\n\t\tname !== 'form' &&\n\t\tname !== 'type' &&\n\t\tname !== 'size' &&\n\t\t!isSvg &&\n\t\tname in dom\n\t) {\n\t\tdom[name] = value == null ? '' : value;\n\t} else if (typeof value != 'function' && name !== 'dangerouslySetInnerHTML') {\n\t\tif (name !== (name = name.replace(/^xlink:?/, ''))) {\n\t\t\tif (value == null || value === false) {\n\t\t\t\tdom.removeAttributeNS(\n\t\t\t\t\t'http://www.w3.org/1999/xlink',\n\t\t\t\t\tname.toLowerCase()\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tdom.setAttributeNS(\n\t\t\t\t\t'http://www.w3.org/1999/xlink',\n\t\t\t\t\tname.toLowerCase(),\n\t\t\t\t\tvalue\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (\n\t\t\tvalue == null ||\n\t\t\t(value === false &&\n\t\t\t\t// ARIA-attributes have a different notion of boolean values.\n\t\t\t\t// The value `false` is different from the attribute not\n\t\t\t\t// existing on the DOM, so we can't remove it. For non-boolean\n\t\t\t\t// ARIA-attributes we could treat false as a removal, but the\n\t\t\t\t// amount of exceptions would cost us too many bytes. On top of\n\t\t\t\t// that other VDOM frameworks also always stringify `false`.\n\t\t\t\t!/^ar/.test(name))\n\t\t) {\n\t\t\tdom.removeAttribute(name);\n\t\t} else {\n\t\t\tdom.setAttribute(name, value);\n\t\t}\n\t}\n}\n\n/**\n * Proxy an event to hooked event handlers\n * @param {Event} e The event object from the browser\n * @private\n */\nfunction eventProxy(e) {\n\tthis._listeners[e.type](options.event ? options.event(e) : e);\n}\n","import { EMPTY_OBJ, EMPTY_ARR } from '../constants';\nimport { Component } from '../component';\nimport { Fragment } from '../create-element';\nimport { diffChildren } from './children';\nimport { diffProps, setProperty } from './props';\nimport { assign, removeNode } from '../util';\nimport options from '../options';\n\n/**\n * Diff two virtual nodes and apply proper changes to the DOM\n * @param {import('../internal').PreactElement} parentDom The parent of the DOM element\n * @param {import('../internal').VNode} newVNode The new virtual node\n * @param {import('../internal').VNode} oldVNode The old virtual node\n * @param {object} globalContext The current context object. Modified by getChildContext\n * @param {boolean} isSvg Whether or not this element is an SVG node\n * @param {Array<import('../internal').PreactElement>} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {Element | Text} oldDom The current attached DOM\n * element any new dom elements should be placed around. Likely `null` on first\n * render (except when hydrating). Can be a sibling DOM element when diffing\n * Fragments that have siblings. In most cases, it starts out as `oldChildren[0]._dom`.\n * @param {boolean} [isHydrating] Whether or not we are in hydration\n */\nexport function diff(\n\tparentDom,\n\tnewVNode,\n\toldVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\toldDom,\n\tisHydrating\n) {\n\tlet tmp,\n\t\tnewType = newVNode.type;\n\n\t// When passing through createElement it assigns the object\n\t// constructor as undefined. This to prevent JSON-injection.\n\tif (newVNode.constructor !== undefined) return null;\n\n\tif ((tmp = options._diff)) tmp(newVNode);\n\n\ttry {\n\t\touter: if (typeof newType == 'function') {\n\t\t\tlet c, isNew, oldProps, oldState, snapshot, clearProcessingException;\n\t\t\tlet newProps = newVNode.props;\n\n\t\t\t// Necessary for createContext api. Setting this property will pass\n\t\t\t// the context value as `this.context` just for this component.\n\t\t\ttmp = newType.contextType;\n\t\t\tlet provider = tmp && globalContext[tmp._id];\n\t\t\tlet componentContext = tmp\n\t\t\t\t? provider\n\t\t\t\t\t? provider.props.value\n\t\t\t\t\t: tmp._defaultValue\n\t\t\t\t: globalContext;\n\n\t\t\t// Get component and set it to `c`\n\t\t\tif (oldVNode._component) {\n\t\t\t\tc = newVNode._component = oldVNode._component;\n\t\t\t\tclearProcessingException = c._processingException = c._pendingError;\n\t\t\t} else {\n\t\t\t\t// Instantiate the new component\n\t\t\t\tif ('prototype' in newType && newType.prototype.render) {\n\t\t\t\t\tnewVNode._component = c = new newType(newProps, componentContext); // eslint-disable-line new-cap\n\t\t\t\t} else {\n\t\t\t\t\tnewVNode._component = c = new Component(newProps, componentContext);\n\t\t\t\t\tc.constructor = newType;\n\t\t\t\t\tc.render = doRender;\n\t\t\t\t}\n\t\t\t\tif (provider) provider.sub(c);\n\n\t\t\t\tc.props = newProps;\n\t\t\t\tif (!c.state) c.state = {};\n\t\t\t\tc.context = componentContext;\n\t\t\t\tc._globalContext = globalContext;\n\t\t\t\tisNew = c._dirty = true;\n\t\t\t\tc._renderCallbacks = [];\n\t\t\t}\n\n\t\t\t// Invoke getDerivedStateFromProps\n\t\t\tif (c._nextState == null) {\n\t\t\t\tc._nextState = c.state;\n\t\t\t}\n\t\t\tif (newType.getDerivedStateFromProps != null) {\n\t\t\t\tif (c._nextState == c.state) {\n\t\t\t\t\tc._nextState = assign({}, c._nextState);\n\t\t\t\t}\n\n\t\t\t\tassign(\n\t\t\t\t\tc._nextState,\n\t\t\t\t\tnewType.getDerivedStateFromProps(newProps, c._nextState)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\toldProps = c.props;\n\t\t\toldState = c.state;\n\n\t\t\t// Invoke pre-render lifecycle methods\n\t\t\tif (isNew) {\n\t\t\t\tif (\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\n\t\t\t\t\tc.componentWillMount != null\n\t\t\t\t) {\n\t\t\t\t\tc.componentWillMount();\n\t\t\t\t}\n\n\t\t\t\tif (c.componentDidMount != null) {\n\t\t\t\t\tc._renderCallbacks.push(c.componentDidMount);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\n\t\t\t\t\tnewProps !== oldProps &&\n\t\t\t\t\tc.componentWillReceiveProps != null\n\t\t\t\t) {\n\t\t\t\t\tc.componentWillReceiveProps(newProps, componentContext);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t(!c._force &&\n\t\t\t\t\t\tc.shouldComponentUpdate != null &&\n\t\t\t\t\t\tc.shouldComponentUpdate(\n\t\t\t\t\t\t\tnewProps,\n\t\t\t\t\t\t\tc._nextState,\n\t\t\t\t\t\t\tcomponentContext\n\t\t\t\t\t\t) === false) ||\n\t\t\t\t\t(newVNode._original === oldVNode._original && !c._processingException)\n\t\t\t\t) {\n\t\t\t\t\tc.props = newProps;\n\t\t\t\t\tc.state = c._nextState;\n\t\t\t\t\t// More info about this here: https://gist.github.com/JoviDeCroock/bec5f2ce93544d2e6070ef8e0036e4e8\n\t\t\t\t\tif (newVNode._original !== oldVNode._original) c._dirty = false;\n\t\t\t\t\tc._vnode = newVNode;\n\t\t\t\t\tnewVNode._dom = oldVNode._dom;\n\t\t\t\t\tnewVNode._children = oldVNode._children;\n\t\t\t\t\tif (c._renderCallbacks.length) {\n\t\t\t\t\t\tcommitQueue.push(c);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (tmp = 0; tmp < newVNode._children.length; tmp++) {\n\t\t\t\t\t\tif (newVNode._children[tmp]) {\n\t\t\t\t\t\t\tnewVNode._children[tmp]._parent = newVNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\n\t\t\t\tif (c.componentWillUpdate != null) {\n\t\t\t\t\tc.componentWillUpdate(newProps, c._nextState, componentContext);\n\t\t\t\t}\n\n\t\t\t\tif (c.componentDidUpdate != null) {\n\t\t\t\t\tc._renderCallbacks.push(() => {\n\t\t\t\t\t\tc.componentDidUpdate(oldProps, oldState, snapshot);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tc.context = componentContext;\n\t\t\tc.props = newProps;\n\t\t\tc.state = c._nextState;\n\n\t\t\tif ((tmp = options._render)) tmp(newVNode);\n\n\t\t\tc._dirty = false;\n\t\t\tc._vnode = newVNode;\n\t\t\tc._parentDom = parentDom;\n\n\t\t\ttmp = c.render(c.props, c.state, c.context);\n\t\t\tlet isTopLevelFragment =\n\t\t\t\ttmp != null && tmp.type == Fragment && tmp.key == null;\n\t\t\tnewVNode._children = isTopLevelFragment\n\t\t\t\t? tmp.props.children\n\t\t\t\t: Array.isArray(tmp)\n\t\t\t\t? tmp\n\t\t\t\t: [tmp];\n\n\t\t\tif (c.getChildContext != null) {\n\t\t\t\tglobalContext = assign(assign({}, globalContext), c.getChildContext());\n\t\t\t}\n\n\t\t\tif (!isNew && c.getSnapshotBeforeUpdate != null) {\n\t\t\t\tsnapshot = c.getSnapshotBeforeUpdate(oldProps, oldState);\n\t\t\t}\n\n\t\t\tdiffChildren(\n\t\t\t\tparentDom,\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tisSvg,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\toldDom,\n\t\t\t\tisHydrating\n\t\t\t);\n\n\t\t\tc.base = newVNode._dom;\n\n\t\t\tif (c._renderCallbacks.length) {\n\t\t\t\tcommitQueue.push(c);\n\t\t\t}\n\n\t\t\tif (clearProcessingException) {\n\t\t\t\tc._pendingError = c._processingException = null;\n\t\t\t}\n\n\t\t\tc._force = false;\n\t\t} else if (\n\t\t\texcessDomChildren == null &&\n\t\t\tnewVNode._original === oldVNode._original\n\t\t) {\n\t\t\tnewVNode._children = oldVNode._children;\n\t\t\tnewVNode._dom = oldVNode._dom;\n\t\t} else {\n\t\t\tnewVNode._dom = diffElementNodes(\n\t\t\t\toldVNode._dom,\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tisSvg,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\tisHydrating\n\t\t\t);\n\t\t}\n\n\t\tif ((tmp = options.diffed)) tmp(newVNode);\n\t} catch (e) {\n\t\tnewVNode._original = null;\n\t\toptions._catchError(e, newVNode, oldVNode);\n\t}\n\n\treturn newVNode._dom;\n}\n\n/**\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {import('../internal').VNode} root\n */\nexport function commitRoot(commitQueue, root) {\n\tif (options._commit) options._commit(root, commitQueue);\n\n\tcommitQueue.some(c => {\n\t\ttry {\n\t\t\tcommitQueue = c._renderCallbacks;\n\t\t\tc._renderCallbacks = [];\n\t\t\tcommitQueue.some(cb => {\n\t\t\t\tcb.call(c);\n\t\t\t});\n\t\t} catch (e) {\n\t\t\toptions._catchError(e, c._vnode);\n\t\t}\n\t});\n}\n\n/**\n * Diff two virtual nodes representing DOM element\n * @param {import('../internal').PreactElement} dom The DOM element representing\n * the virtual nodes being diffed\n * @param {import('../internal').VNode} newVNode The new virtual node\n * @param {import('../internal').VNode} oldVNode The old virtual node\n * @param {object} globalContext The current context object\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node\n * @param {*} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {boolean} isHydrating Whether or not we are in hydration\n * @returns {import('../internal').PreactElement}\n */\nfunction diffElementNodes(\n\tdom,\n\tnewVNode,\n\toldVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\tisHydrating\n) {\n\tlet i;\n\tlet oldProps = oldVNode.props;\n\tlet newProps = newVNode.props;\n\n\t// Tracks entering and exiting SVG namespace when descending through the tree.\n\tisSvg = newVNode.type === 'svg' || isSvg;\n\n\tif (excessDomChildren != null) {\n\t\tfor (i = 0; i < excessDomChildren.length; i++) {\n\t\t\tconst child = excessDomChildren[i];\n\n\t\t\t// if newVNode matches an element in excessDomChildren or the `dom`\n\t\t\t// argument matches an element in excessDomChildren, remove it from\n\t\t\t// excessDomChildren so it isn't later removed in diffChildren\n\t\t\tif (\n\t\t\t\tchild != null &&\n\t\t\t\t((newVNode.type === null\n\t\t\t\t\t? child.nodeType === 3\n\t\t\t\t\t: child.localName === newVNode.type) ||\n\t\t\t\t\tdom == child)\n\t\t\t) {\n\t\t\t\tdom = child;\n\t\t\t\texcessDomChildren[i] = null;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (dom == null) {\n\t\tif (newVNode.type === null) {\n\t\t\treturn document.createTextNode(newProps);\n\t\t}\n\n\t\tdom = isSvg\n\t\t\t? document.createElementNS('http://www.w3.org/2000/svg', newVNode.type)\n\t\t\t: document.createElement(\n\t\t\t\t\tnewVNode.type,\n\t\t\t\t\tnewProps.is && { is: newProps.is }\n\t\t\t  );\n\t\t// we created a new parent, so none of the previously attached children can be reused:\n\t\texcessDomChildren = null;\n\t\t// we are creating a new node, so we can assume this is a new subtree (in case we are hydrating), this deopts the hydrate\n\t\tisHydrating = false;\n\t}\n\n\tif (newVNode.type === null) {\n\t\tif (oldProps !== newProps && dom.data != newProps) {\n\t\t\tdom.data = newProps;\n\t\t}\n\t} else {\n\t\tif (excessDomChildren != null) {\n\t\t\texcessDomChildren = EMPTY_ARR.slice.call(dom.childNodes);\n\t\t}\n\n\t\toldProps = oldVNode.props || EMPTY_OBJ;\n\n\t\tlet oldHtml = oldProps.dangerouslySetInnerHTML;\n\t\tlet newHtml = newProps.dangerouslySetInnerHTML;\n\n\t\t// During hydration, props are not diffed at all (including dangerouslySetInnerHTML)\n\t\t// @TODO we should warn in debug mode when props don't match here.\n\t\tif (!isHydrating) {\n\t\t\tif (oldProps === EMPTY_OBJ) {\n\t\t\t\toldProps = {};\n\t\t\t\tfor (let i = 0; i < dom.attributes.length; i++) {\n\t\t\t\t\toldProps[dom.attributes[i].name] = dom.attributes[i].value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (newHtml || oldHtml) {\n\t\t\t\t// Avoid re-applying the same '__html' if it did not changed between re-render\n\t\t\t\tif (!newHtml || !oldHtml || newHtml.__html != oldHtml.__html) {\n\t\t\t\t\tdom.innerHTML = (newHtml && newHtml.__html) || '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdiffProps(dom, newProps, oldProps, isSvg, isHydrating);\n\n\t\t// If the new vnode didn't have dangerouslySetInnerHTML, diff its children\n\t\tif (newHtml) {\n\t\t\tnewVNode._children = [];\n\t\t} else {\n\t\t\tnewVNode._children = newVNode.props.children;\n\t\t\tdiffChildren(\n\t\t\t\tdom,\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tnewVNode.type === 'foreignObject' ? false : isSvg,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\tEMPTY_OBJ,\n\t\t\t\tisHydrating\n\t\t\t);\n\t\t}\n\n\t\t// (as above, don't diff props during hydration)\n\t\tif (!isHydrating) {\n\t\t\tif (\n\t\t\t\t'value' in newProps &&\n\t\t\t\t(i = newProps.value) !== undefined &&\n\t\t\t\ti !== dom.value\n\t\t\t) {\n\t\t\t\tsetProperty(dom, 'value', i, oldProps.value, false);\n\t\t\t}\n\t\t\tif (\n\t\t\t\t'checked' in newProps &&\n\t\t\t\t(i = newProps.checked) !== undefined &&\n\t\t\t\ti !== dom.checked\n\t\t\t) {\n\t\t\t\tsetProperty(dom, 'checked', i, oldProps.checked, false);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn dom;\n}\n\n/**\n * Invoke or update a ref, depending on whether it is a function or object ref.\n * @param {object|function} ref\n * @param {any} value\n * @param {import('../internal').VNode} vnode\n */\nexport function applyRef(ref, value, vnode) {\n\ttry {\n\t\tif (typeof ref == 'function') ref(value);\n\t\telse ref.current = value;\n\t} catch (e) {\n\t\toptions._catchError(e, vnode);\n\t}\n}\n\n/**\n * Unmount a virtual node from the tree and apply DOM changes\n * @param {import('../internal').VNode} vnode The virtual node to unmount\n * @param {import('../internal').VNode} parentVNode The parent of the VNode that\n * initiated the unmount\n * @param {boolean} [skipRemove] Flag that indicates that a parent node of the\n * current element is already detached from the DOM.\n */\nexport function unmount(vnode, parentVNode, skipRemove) {\n\tlet r;\n\tif (options.unmount) options.unmount(vnode);\n\n\tif ((r = vnode.ref)) {\n\t\tif (!r.current || r.current === vnode._dom) applyRef(r, null, parentVNode);\n\t}\n\n\tlet dom;\n\tif (!skipRemove && typeof vnode.type != 'function') {\n\t\tskipRemove = (dom = vnode._dom) != null;\n\t}\n\n\t// Must be set to `undefined` to properly clean up `_nextDom`\n\t// for which `null` is a valid value. See comment in `create-element.js`\n\tvnode._dom = vnode._nextDom = undefined;\n\n\tif ((r = vnode._component) != null) {\n\t\tif (r.componentWillUnmount) {\n\t\t\ttry {\n\t\t\t\tr.componentWillUnmount();\n\t\t\t} catch (e) {\n\t\t\t\toptions._catchError(e, parentVNode);\n\t\t\t}\n\t\t}\n\n\t\tr.base = r._parentDom = null;\n\t}\n\n\tif ((r = vnode._children)) {\n\t\tfor (let i = 0; i < r.length; i++) {\n\t\t\tif (r[i]) unmount(r[i], parentVNode, skipRemove);\n\t\t}\n\t}\n\n\tif (dom != null) removeNode(dom);\n}\n\n/** The `.render()` method for a PFC backing instance. */\nfunction doRender(props, state, context) {\n\treturn this.constructor(props, context);\n}\n","import { assign } from './util';\nimport { EMPTY_ARR } from './constants';\nimport { createVNode } from './create-element';\n\n/**\n * Clones the given VNode, optionally adding attributes/props and replacing its children.\n * @param {import('./internal').VNode} vnode The virtual DOM element to clone\n * @param {object} props Attributes/props to add when cloning\n * @param {Array<import('./index').ComponentChildren>} rest Any additional arguments will be used as replacement children.\n * @returns {import('./internal').VNode}\n */\nexport function cloneElement(vnode, props) {\n\tprops = assign(assign({}, vnode.props), props);\n\tif (arguments.length > 2) props.children = EMPTY_ARR.slice.call(arguments, 2);\n\tlet normalizedProps = {};\n\tfor (const i in props) {\n\t\tif (i !== 'key' && i !== 'ref') normalizedProps[i] = props[i];\n\t}\n\n\treturn createVNode(\n\t\tvnode.type,\n\t\tnormalizedProps,\n\t\tprops.key || vnode.key,\n\t\tprops.ref || vnode.ref,\n\t\tnull\n\t);\n}\n","import { enqueueRender } from '../component';\n\n/**\n * Find the closest error boundary to a thrown error and call it\n * @param {object} error The thrown value\n * @param {import('../internal').VNode} vnode The vnode that threw\n * the error that was caught (except for unmounting when this parameter\n * is the highest parent that was being unmounted)\n */\nexport function _catchError(error, vnode) {\n\t/** @type {import('../internal').Component} */\n\tlet component, hasCaught;\n\n\tfor (; (vnode = vnode._parent); ) {\n\t\tif ((component = vnode._component) && !component._processingException) {\n\t\t\ttry {\n\t\t\t\tif (\n\t\t\t\t\tcomponent.constructor &&\n\t\t\t\t\tcomponent.constructor.getDerivedStateFromError != null\n\t\t\t\t) {\n\t\t\t\t\thasCaught = true;\n\t\t\t\t\tcomponent.setState(\n\t\t\t\t\t\tcomponent.constructor.getDerivedStateFromError(error)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (component.componentDidCatch != null) {\n\t\t\t\t\thasCaught = true;\n\t\t\t\t\tcomponent.componentDidCatch(error);\n\t\t\t\t}\n\n\t\t\t\tif (hasCaught)\n\t\t\t\t\treturn enqueueRender((component._pendingError = component));\n\t\t\t} catch (e) {\n\t\t\t\terror = e;\n\t\t\t}\n\t\t}\n\t}\n\n\tthrow error;\n}\n","export function lastOf<T>(ts: T[]): T | null {\r\n  return ts[ts.length - 1] || null\r\n}\r\n\r\nexport function sortBy<T>(ts: T[], key: (t: T) => number | string): void {\r\n  function comparator(a: T, b: T) {\r\n    const keyA = key(a)\r\n    const keyB = key(b)\r\n    return keyA < keyB ? -1 : keyA > keyB ? 1 : 0\r\n  }\r\n  ts.sort(comparator)\r\n}\r\n\r\nexport function getOrInsert<K, V>(map: Map<K, V>, k: K, fallback: (k: K) => V): V {\r\n  if (!map.has(k)) map.set(k, fallback(k))\r\n  return map.get(k)!\r\n}\r\n\r\nexport function getOrElse<K, V>(map: Map<K, V>, k: K, fallback: (k: K) => V): V {\r\n  if (!map.has(k)) return fallback(k)\r\n  return map.get(k)!\r\n}\r\n\r\nexport function getOrThrow<K, V>(map: Map<K, V>, k: K): V {\r\n  if (!map.has(k)) {\r\n    throw new Error(`Expected key ${k}`)\r\n  }\r\n  return map.get(k)!\r\n}\r\n\r\n// Intended to be used to de-duplicate objects based on a key property. This\r\n// allows value comparisons to be done efficiently and for the returned objects\r\n// to be used intuitively in Map objects.\r\n//\r\n// Example usage:\r\n//\r\n// export class Frame {\r\n//   private constructor(readonly file: string, readonly name: string) {}\r\n//   get key() { return `${this.file}:${this.name}` }\r\n//   static getOrInsert(set: KeyedSet<Frame>, file: string, name: string) {\r\n//     return set.getOrInsert(set, new Frame(file, name))\r\n//   }\r\n// }\r\n//\r\nexport interface HasKey {\r\n  readonly key: string | number\r\n}\r\nexport class KeyedSet<T extends HasKey> implements Iterable<T> {\r\n  private map = new Map<string | number, T>()\r\n\r\n  getOrInsert(t: T): T {\r\n    const key = t.key\r\n    const existing = this.map.get(key)\r\n    if (existing) return existing\r\n    this.map.set(key, t)\r\n    return t\r\n  }\r\n  forEach(fn: (t: T) => void) {\r\n    this.map.forEach(fn)\r\n  }\r\n  [Symbol.iterator]() {\r\n    return this.map.values()\r\n  }\r\n}\r\n\r\nexport function* itMap<T, U>(it: Iterable<T>, f: (t: T) => U): Iterable<U> {\r\n  for (let t of it) {\r\n    yield f(t)\r\n  }\r\n}\r\n\r\nexport function itForEach<T>(it: Iterable<T>, f: (t: T) => void): void {\r\n  for (let t of it) {\r\n    f(t)\r\n  }\r\n}\r\n\r\nexport function itReduce<T, U>(it: Iterable<T>, f: (a: U, b: T) => U, init: U): U {\r\n  let accum: U = init\r\n  for (let t of it) {\r\n    accum = f(accum, t)\r\n  }\r\n  return accum\r\n}\r\n\r\nexport function zeroPad(s: string, width: number) {\r\n  return new Array(Math.max(width - s.length, 0) + 1).join('0') + s\r\n}\r\n\r\nexport function formatPercent(percent: number) {\r\n  let formattedPercent = `${percent.toFixed(0)}%`\r\n  if (percent === 100) formattedPercent = '100%'\r\n  else if (percent > 99) formattedPercent = '>99%'\r\n  else if (percent < 0.01) formattedPercent = '<0.01%'\r\n  else if (percent < 1) formattedPercent = `${percent.toFixed(2)}%`\r\n  else if (percent < 10) formattedPercent = `${percent.toFixed(1)}%`\r\n  return formattedPercent\r\n}\r\n\r\nexport function fract(x: number) {\r\n  return x - Math.floor(x)\r\n}\r\n\r\nexport function triangle(x: number) {\r\n  return 2.0 * Math.abs(fract(x) - 0.5) - 1.0\r\n}\r\n\r\nexport function findValueBisect(\r\n  lo: number,\r\n  hi: number,\r\n  f: (val: number) => number,\r\n  target: number,\r\n  targetRangeSize = 1,\r\n): [number, number] {\r\n  console.assert(!isNaN(targetRangeSize) && !isNaN(target))\r\n  while (true) {\r\n    if (hi - lo <= targetRangeSize) return [lo, hi]\r\n    const mid = (hi + lo) / 2\r\n    const val = f(mid)\r\n    if (val < target) lo = mid\r\n    else hi = mid\r\n  }\r\n}\r\n\r\n// Similar to Array.prototype.findIndex, except uses a binary search.\r\n//\r\n// This assumes that the condition transitions exactly once from false to true\r\n// in the list, e.g. the following is a valid input:\r\n//\r\n//  ls        = [a, b, c, d]\r\n//  ls.map(f) = [false, false, true, true]\r\n//\r\n// The following is an invalid input:\r\n//\r\n//  ls        = [a, b, c, d]\r\n//  ls.map(f) = [false, true, false, true]\r\nexport function findIndexBisect<T>(ls: T[], f: (val: T) => boolean): number {\r\n  if (ls.length === 0) return -1\r\n\r\n  let lo = 0\r\n  let hi = ls.length - 1\r\n\r\n  while (hi !== lo) {\r\n    const mid = Math.floor((lo + hi) / 2)\r\n\r\n    if (f(ls[mid])) {\r\n      // The desired index is <= mid\r\n      hi = mid\r\n    } else {\r\n      // The desired index is > mid\r\n      lo = mid + 1\r\n    }\r\n  }\r\n\r\n  return f(ls[hi]) ? hi : -1\r\n}\r\n\r\nexport function noop(...args: any[]) {}\r\n\r\nexport function objectsHaveShallowEquality<T extends object>(a: T, b: T): boolean {\r\n  for (let key in a) {\r\n    if (a[key] !== b[key]) return false\r\n  }\r\n  for (let key in b) {\r\n    if (a[key] !== b[key]) return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport function memoizeByShallowEquality<T extends object, U>(cb: (t: T) => U): (t: T) => U {\r\n  let last: {args: T; result: U} | null = null\r\n  return (args: T) => {\r\n    let result: U\r\n    if (last == null) {\r\n      result = cb(args)\r\n      last = {args, result}\r\n      return result\r\n    } else if (objectsHaveShallowEquality(last.args, args)) {\r\n      return last.result\r\n    } else {\r\n      last.args = args\r\n      last.result = cb(args)\r\n      return last.result\r\n    }\r\n  }\r\n}\r\n\r\nexport function memoizeByReference<T, U>(cb: (t: T) => U): (t: T) => U {\r\n  let last: {args: T; result: U} | null = null\r\n  return (args: T) => {\r\n    let result: U\r\n    if (last == null) {\r\n      result = cb(args)\r\n      last = {args, result}\r\n      return result\r\n    } else if (last.args === args) {\r\n      return last.result\r\n    } else {\r\n      last.args = args\r\n      last.result = cb(args)\r\n      return last.result\r\n    }\r\n  }\r\n}\r\n\r\nexport function lazyStatic<T>(cb: () => T): () => T {\r\n  let last: {result: T} | null = null\r\n  return () => {\r\n    if (last == null) {\r\n      last = {result: cb()}\r\n    }\r\n    return last.result\r\n  }\r\n}\r\n\r\nconst base64lookupTable = lazyStatic(\r\n  (): Map<string, number> => {\r\n    const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\r\n    const ret = new Map<string, number>()\r\n    for (let i = 0; i < alphabet.length; i++) {\r\n      ret.set(alphabet.charAt(i), i)\r\n    }\r\n    ret.set('=', -1)\r\n    return ret\r\n  },\r\n)\r\n\r\n// NOTE: There are probably simpler solutions to this problem, but I have this written already, so\r\n// until we run into problems with this, let's just use this.\r\n//\r\n// See: https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem#The_Unicode_Problem\r\nexport function decodeBase64(encoded: string): Uint8Array {\r\n  // Reference: https://www.rfc-editor.org/rfc/rfc4648.txt\r\n\r\n  const lookupTable = base64lookupTable()\r\n\r\n  // 3 byte groups are represented as sequneces of 4 characters.\r\n  //\r\n  // \"The encoding process represents 24-bit groups of input bits as output\r\n  //  strings of 4 encoded characters.\"\r\n  //\r\n  // \"Special processing is performed if fewer than 24 bits are available\r\n  //  at the end of the data being encoded.  A full encoding quantum is\r\n  //  always completed at the end of a quantity.  When fewer than 24 input\r\n  //  bits are available in an input group bits with value zero are added\r\n  //  (on the right) to form an integral number of 6-bit groups.\"\r\n\r\n  if (encoded.length % 4 !== 0) {\r\n    throw new Error(\r\n      `Invalid length for base64 encoded string. Expected length % 4 = 0, got length = ${encoded.length}`,\r\n    )\r\n  }\r\n\r\n  const quartetCount = encoded.length / 4\r\n  let byteCount: number\r\n\r\n  // Special processing is performed if fewer than 24 bits are available\r\n  // at the end of the data being encoded.  A full encoding quantum is\r\n  // always completed at the end of a quantity.  When fewer than 24 input\r\n  // bits are available in an input group, bits with value zero are added\r\n  // (on the right) to form an integral number of 6-bit groups.  Padding\r\n  // at the end of the data is performed using the '=' character.  Since\r\n  // all base 64 input is an integral number of octets, only the following\r\n  // cases can arise:\r\n  //\r\n  // (1) The final quantum of encoding input is an integral multiple of 24\r\n  //     bits; here, the final unit of encoded output will be an integral\r\n  //     multiple of 4 characters with no \"=\" padding.\r\n  //\r\n  // (2) The final quantum of encoding input is exactly 8 bits; here, the\r\n  //     final unit of encoded output will be two characters followed by\r\n  //     two \"=\" padding characters.\r\n  //\r\n  // (3) The final quantum of encoding input is exactly 16 bits; here, the\r\n  //     final unit of encoded output will be three characters followed by\r\n  //     one \"=\" padding character.\r\n  if (encoded.length >= 4) {\r\n    if (encoded.charAt(encoded.length - 1) === '=') {\r\n      if (encoded.charAt(encoded.length - 2) === '=') {\r\n        // Case (2)\r\n        byteCount = quartetCount * 3 - 2\r\n      } else {\r\n        // Case (3)\r\n        byteCount = quartetCount * 3 - 1\r\n      }\r\n    } else {\r\n      // Case (1)\r\n      byteCount = quartetCount * 3\r\n    }\r\n  } else {\r\n    // Case (1)\r\n    byteCount = quartetCount * 3\r\n  }\r\n\r\n  const bytes = new Uint8Array(byteCount)\r\n  let offset = 0\r\n\r\n  for (let i = 0; i < quartetCount; i++) {\r\n    const enc1 = encoded.charAt(i * 4 + 0)\r\n    const enc2 = encoded.charAt(i * 4 + 1)\r\n    const enc3 = encoded.charAt(i * 4 + 2)\r\n    const enc4 = encoded.charAt(i * 4 + 3)\r\n\r\n    const sextet1 = lookupTable.get(enc1)\r\n    const sextet2 = lookupTable.get(enc2)\r\n    const sextet3 = lookupTable.get(enc3)\r\n    const sextet4 = lookupTable.get(enc4)\r\n\r\n    if (sextet1 == null || sextet2 == null || sextet3 == null || sextet4 == null) {\r\n      throw new Error(\r\n        `Invalid quartet at indices ${i * 4} .. ${i * 4 + 3}: ${encoded.substring(\r\n          i * 4,\r\n          i * 4 + 3,\r\n        )}`,\r\n      )\r\n    }\r\n\r\n    bytes[offset++] = (sextet1 << 2) | (sextet2 >> 4)\r\n    if (enc3 !== '=') {\r\n      bytes[offset++] = ((sextet2 & 15) << 4) | (sextet3 >> 2)\r\n    }\r\n    if (enc4 !== '=') {\r\n      bytes[offset++] = ((sextet3 & 7) << 6) | sextet4\r\n    }\r\n  }\r\n\r\n  if (offset !== byteCount) {\r\n    throw new Error(`Expected to decode ${byteCount} bytes, but only decoded ${offset})`)\r\n  }\r\n\r\n  return bytes\r\n}\r\n","class ListNode<V> {\r\n  prev: ListNode<V> | null = null\r\n  next: ListNode<V> | null = null\r\n  constructor(readonly data: V) {}\r\n}\r\n\r\nexport class List<V> {\r\n  private head: ListNode<V> | null = null\r\n  private tail: ListNode<V> | null = null\r\n  private size: number = 0\r\n  constructor() {}\r\n\r\n  getHead(): ListNode<V> | null {\r\n    return this.head\r\n  }\r\n  getTail(): ListNode<V> | null {\r\n    return this.tail\r\n  }\r\n  getSize(): number {\r\n    return this.size\r\n  }\r\n\r\n  append(node: ListNode<V>): void {\r\n    if (!this.tail) {\r\n      this.head = this.tail = node\r\n    } else {\r\n      this.tail.next = node\r\n      node.prev = this.tail\r\n      this.tail = node\r\n    }\r\n    this.size++\r\n  }\r\n\r\n  prepend(node: ListNode<V>): ListNode<V> {\r\n    if (!this.head) {\r\n      this.head = this.tail = node\r\n    } else {\r\n      this.head.prev = node\r\n      node.next = this.head\r\n      this.head = node\r\n    }\r\n    this.size++\r\n    return node\r\n  }\r\n\r\n  pop(): ListNode<V> | null {\r\n    if (!this.tail) {\r\n      return null\r\n    } else {\r\n      const ret = this.tail\r\n      if (ret.prev) {\r\n        this.tail = ret.prev\r\n        this.tail.next = null\r\n      } else {\r\n        this.head = this.tail = null\r\n      }\r\n      this.size--\r\n      ret.prev = null\r\n      return ret\r\n    }\r\n  }\r\n\r\n  dequeue(): ListNode<V> | null {\r\n    if (!this.head) {\r\n      return null\r\n    } else {\r\n      const ret = this.head\r\n      if (ret.next) {\r\n        this.head = ret.next\r\n        this.head.prev = null\r\n      } else {\r\n        this.head = this.tail = null\r\n      }\r\n      this.size--\r\n      ret.next = null\r\n      return ret\r\n    }\r\n  }\r\n\r\n  remove(node: ListNode<V>): void {\r\n    if (node.prev == null) {\r\n      this.dequeue()\r\n    } else if (node.next == null) {\r\n      this.pop()\r\n    } else {\r\n      // Neither first nor last, should be safe to just link\r\n      // neighbours.\r\n      node.next.prev = node.prev\r\n      node.prev.next = node.next\r\n      node.next = null\r\n      node.prev = null\r\n      this.size--\r\n    }\r\n  }\r\n}\r\n\r\ninterface LRUCacheNode<K, V> {\r\n  value: V\r\n  listNode: ListNode<K>\r\n}\r\n\r\nexport class LRUCache<K, V> {\r\n  private list = new List<K>()\r\n  private map = new Map<K, LRUCacheNode<K, V>>()\r\n\r\n  constructor(private capacity: number) {}\r\n\r\n  has(key: K): boolean {\r\n    return this.map.has(key)\r\n  }\r\n\r\n  get(key: K): V | null {\r\n    const node = this.map.get(key)\r\n    if (!node) {\r\n      return null\r\n    }\r\n    // Bring node to the front of the list\r\n    this.list.remove(node.listNode)\r\n    this.list.prepend(node.listNode)\r\n\r\n    return node ? node.value : null\r\n  }\r\n\r\n  getSize() {\r\n    return this.list.getSize()\r\n  }\r\n\r\n  getCapacity() {\r\n    return this.capacity\r\n  }\r\n\r\n  insert(key: K, value: V) {\r\n    const node = this.map.get(key)\r\n    if (node) {\r\n      this.list.remove(node.listNode)\r\n    }\r\n    // Evict old entries when out of capacity\r\n    while (this.list.getSize() >= this.capacity) {\r\n      this.map.delete(this.list.pop()!.data)\r\n    }\r\n    const listNode = this.list.prepend(new ListNode(key))\r\n    this.map.set(key, {value, listNode})\r\n  }\r\n\r\n  getOrInsert(key: K, f: (key: K) => V): V {\r\n    let value = this.get(key)\r\n    if (value == null) {\r\n      value = f(key)\r\n      this.insert(key, value)\r\n    }\r\n    return value\r\n  }\r\n\r\n  removeLRU(): [K, V] | null {\r\n    const oldest = this.list.pop()\r\n    if (!oldest) return null\r\n    const key = oldest.data\r\n    const value = this.map.get(key)!.value\r\n    this.map.delete(key)\r\n    return [key, value]\r\n  }\r\n\r\n  clear() {\r\n    this.list = new List<K>()\r\n    this.map = new Map<K, LRUCacheNode<K, V>>()\r\n  }\r\n}\r\n","export function clamp(x: number, minVal: number, maxVal: number) {\r\n  if (x < minVal) return minVal\r\n  if (x > maxVal) return maxVal\r\n  return x\r\n}\r\n\r\nexport class Vec2 {\r\n  constructor(readonly x: number, readonly y: number) {}\r\n  withX(x: number) {\r\n    return new Vec2(x, this.y)\r\n  }\r\n  withY(y: number) {\r\n    return new Vec2(this.x, y)\r\n  }\r\n\r\n  plus(other: Vec2) {\r\n    return new Vec2(this.x + other.x, this.y + other.y)\r\n  }\r\n  minus(other: Vec2) {\r\n    return new Vec2(this.x - other.x, this.y - other.y)\r\n  }\r\n  times(scalar: number) {\r\n    return new Vec2(this.x * scalar, this.y * scalar)\r\n  }\r\n  timesPointwise(other: Vec2) {\r\n    return new Vec2(this.x * other.x, this.y * other.y)\r\n  }\r\n  dividedByPointwise(other: Vec2) {\r\n    return new Vec2(this.x / other.x, this.y / other.y)\r\n  }\r\n  dot(other: Vec2) {\r\n    return this.x * other.x + this.y * other.y\r\n  }\r\n  equals(other: Vec2) {\r\n    return this.x === other.x && this.y === other.y\r\n  }\r\n  approxEquals(other: Vec2, epsilon = 1e-9) {\r\n    return Math.abs(this.x - other.x) < epsilon && Math.abs(this.y - other.y) < epsilon\r\n  }\r\n\r\n  length2() {\r\n    return this.dot(this)\r\n  }\r\n  length() {\r\n    return Math.sqrt(this.length2())\r\n  }\r\n  abs() {\r\n    return new Vec2(Math.abs(this.x), Math.abs(this.y))\r\n  }\r\n\r\n  static min(a: Vec2, b: Vec2) {\r\n    return new Vec2(Math.min(a.x, b.x), Math.min(a.y, b.y))\r\n  }\r\n\r\n  static max(a: Vec2, b: Vec2) {\r\n    return new Vec2(Math.max(a.x, b.x), Math.max(a.y, b.y))\r\n  }\r\n\r\n  static clamp(v: Vec2, min: Vec2, max: Vec2) {\r\n    return new Vec2(clamp(v.x, min.x, max.x), clamp(v.y, min.y, max.y))\r\n  }\r\n\r\n  static zero = new Vec2(0, 0)\r\n  static unit = new Vec2(1, 1)\r\n\r\n  flatten(): [number, number] {\r\n    return [this.x, this.y]\r\n  }\r\n}\r\n\r\nexport class AffineTransform {\r\n  constructor(\r\n    readonly m00 = 1,\r\n    readonly m01 = 0,\r\n    readonly m02 = 0,\r\n    readonly m10 = 0,\r\n    readonly m11 = 1,\r\n    readonly m12 = 0,\r\n  ) {}\r\n\r\n  withScale(s: Vec2) {\r\n    let {m00, m01, m02, m10, m11, m12} = this\r\n    m00 = s.x\r\n    m11 = s.y\r\n    return new AffineTransform(m00, m01, m02, m10, m11, m12)\r\n  }\r\n  static withScale(s: Vec2) {\r\n    return new AffineTransform().withScale(s)\r\n  }\r\n  scaledBy(s: Vec2) {\r\n    return AffineTransform.withScale(s).times(this)\r\n  }\r\n  getScale() {\r\n    return new Vec2(this.m00, this.m11)\r\n  }\r\n\r\n  withTranslation(t: Vec2) {\r\n    let {m00, m01, m02, m10, m11, m12} = this\r\n    m02 = t.x\r\n    m12 = t.y\r\n    return new AffineTransform(m00, m01, m02, m10, m11, m12)\r\n  }\r\n  static withTranslation(t: Vec2) {\r\n    return new AffineTransform().withTranslation(t)\r\n  }\r\n  getTranslation() {\r\n    return new Vec2(this.m02, this.m12)\r\n  }\r\n  translatedBy(t: Vec2) {\r\n    return AffineTransform.withTranslation(t).times(this)\r\n  }\r\n\r\n  static betweenRects(from: Rect, to: Rect) {\r\n    return AffineTransform.withTranslation(from.origin.times(-1))\r\n      .scaledBy(new Vec2(to.size.x / from.size.x, to.size.y / from.size.y))\r\n      .translatedBy(to.origin)\r\n  }\r\n\r\n  times(other: AffineTransform) {\r\n    const m00 = this.m00 * other.m00 + this.m01 * other.m10\r\n    const m01 = this.m00 * other.m01 + this.m01 * other.m11\r\n    const m02 = this.m00 * other.m02 + this.m01 * other.m12 + this.m02\r\n\r\n    const m10 = this.m10 * other.m00 + this.m11 * other.m10\r\n    const m11 = this.m10 * other.m01 + this.m11 * other.m11\r\n    const m12 = this.m10 * other.m02 + this.m11 * other.m12 + this.m12\r\n    return new AffineTransform(m00, m01, m02, m10, m11, m12)\r\n  }\r\n\r\n  equals(other: AffineTransform) {\r\n    return (\r\n      this.m00 == other.m00 &&\r\n      this.m01 == other.m01 &&\r\n      this.m02 == other.m02 &&\r\n      this.m10 == other.m10 &&\r\n      this.m11 == other.m11 &&\r\n      this.m12 == other.m12\r\n    )\r\n  }\r\n\r\n  approxEquals(other: AffineTransform, epsilon = 1e-9) {\r\n    return (\r\n      Math.abs(this.m00 - other.m00) < epsilon &&\r\n      Math.abs(this.m01 - other.m01) < epsilon &&\r\n      Math.abs(this.m02 - other.m02) < epsilon &&\r\n      Math.abs(this.m10 - other.m10) < epsilon &&\r\n      Math.abs(this.m11 - other.m11) < epsilon &&\r\n      Math.abs(this.m12 - other.m12) < epsilon\r\n    )\r\n  }\r\n\r\n  timesScalar(s: number) {\r\n    const {m00, m01, m02, m10, m11, m12} = this\r\n    return new AffineTransform(s * m00, s * m01, s * m02, s * m10, s * m11, s * m12)\r\n  }\r\n\r\n  det() {\r\n    const {m00, m01, m02, m10, m11, m12} = this\r\n    const m20 = 0\r\n    const m21 = 0\r\n    const m22 = 1\r\n\r\n    return (\r\n      m00 * (m11 * m22 - m12 * m21) - m01 * (m10 * m22 - m12 * m20) + m02 * (m10 * m21 - m11 * m20)\r\n    )\r\n  }\r\n\r\n  adj() {\r\n    const {m00, m01, m02, m10, m11, m12} = this\r\n    const m20 = 0\r\n    const m21 = 0\r\n    const m22 = 1\r\n\r\n    // Adjugate matrix (a) is the transpose of the\r\n    // cofactor matrix (c).\r\n    //\r\n    // 00 01 02\r\n    // 10 11 12\r\n    // 20 21 22\r\n\r\n    const a00 = /* c00 = */ +(m11 * m22 - m12 * m21)\r\n    const a01 = /* c10 = */ -(m01 * m22 - m02 * m21)\r\n    const a02 = /* c20 = */ +(m01 * m12 - m02 * m11)\r\n    const a10 = /* c01 = */ -(m10 * m22 - m12 * m20)\r\n    const a11 = /* c11 = */ +(m00 * m22 - m02 * m20)\r\n    const a12 = /* c21 = */ -(m00 * m12 - m02 * m10)\r\n\r\n    return new AffineTransform(a00, a01, a02, a10, a11, a12)\r\n  }\r\n\r\n  inverted(): AffineTransform | null {\r\n    const det = this.det()\r\n    if (det === 0) return null\r\n    const adj = this.adj()\r\n    return adj.timesScalar(1 / det)\r\n  }\r\n\r\n  transformVector(v: Vec2) {\r\n    return new Vec2(v.x * this.m00 + v.y * this.m01, v.x * this.m10 + v.y * this.m11)\r\n  }\r\n\r\n  inverseTransformVector(v: Vec2): Vec2 | null {\r\n    const inv = this.inverted()\r\n    if (!inv) return null\r\n    return inv.transformVector(v)\r\n  }\r\n\r\n  transformPosition(v: Vec2) {\r\n    return new Vec2(\r\n      v.x * this.m00 + v.y * this.m01 + this.m02,\r\n      v.x * this.m10 + v.y * this.m11 + this.m12,\r\n    )\r\n  }\r\n\r\n  inverseTransformPosition(v: Vec2): Vec2 | null {\r\n    const inv = this.inverted()\r\n    if (!inv) return null\r\n    return inv.transformPosition(v)\r\n  }\r\n\r\n  transformRect(r: Rect) {\r\n    const size = this.transformVector(r.size)\r\n    const origin = this.transformPosition(r.origin)\r\n\r\n    if (size.x < 0 && size.y < 0) {\r\n      return new Rect(origin.plus(size), size.abs())\r\n    } else if (size.x < 0) {\r\n      return new Rect(origin.withX(origin.x + size.x), size.abs())\r\n    } else if (size.y < 0) {\r\n      return new Rect(origin.withY(origin.y + size.y), size.abs())\r\n    }\r\n\r\n    return new Rect(origin, size)\r\n  }\r\n\r\n  inverseTransformRect(r: Rect): Rect | null {\r\n    const inv = this.inverted()\r\n    if (!inv) return null\r\n    return inv.transformRect(r)\r\n  }\r\n\r\n  flatten(): [number, number, number, number, number, number, number, number, number] {\r\n    // Flatten into GLSL format\r\n    // prettier-ignore\r\n    return [\r\n      this.m00, this.m10, 0,\r\n      this.m01, this.m11, 0,\r\n      this.m02, this.m12, 1,\r\n    ]\r\n  }\r\n}\r\n\r\nexport class Rect {\r\n  constructor(readonly origin: Vec2, readonly size: Vec2) {}\r\n\r\n  isEmpty() {\r\n    return this.width() == 0 || this.height() == 0\r\n  }\r\n\r\n  width() {\r\n    return this.size.x\r\n  }\r\n  height() {\r\n    return this.size.y\r\n  }\r\n\r\n  left() {\r\n    return this.origin.x\r\n  }\r\n  right() {\r\n    return this.left() + this.width()\r\n  }\r\n  top() {\r\n    return this.origin.y\r\n  }\r\n  bottom() {\r\n    return this.top() + this.height()\r\n  }\r\n\r\n  topLeft() {\r\n    return this.origin\r\n  }\r\n  topRight() {\r\n    return this.origin.plus(new Vec2(this.width(), 0))\r\n  }\r\n\r\n  bottomRight() {\r\n    return this.origin.plus(this.size)\r\n  }\r\n  bottomLeft() {\r\n    return this.origin.plus(new Vec2(0, this.height()))\r\n  }\r\n\r\n  withOrigin(origin: Vec2) {\r\n    return new Rect(origin, this.size)\r\n  }\r\n  withSize(size: Vec2) {\r\n    return new Rect(this.origin, size)\r\n  }\r\n\r\n  closestPointTo(p: Vec2) {\r\n    return new Vec2(clamp(p.x, this.left(), this.right()), clamp(p.y, this.top(), this.bottom()))\r\n  }\r\n\r\n  distanceFrom(p: Vec2) {\r\n    return p.minus(this.closestPointTo(p)).length()\r\n  }\r\n\r\n  contains(p: Vec2) {\r\n    return this.distanceFrom(p) === 0\r\n  }\r\n\r\n  hasIntersectionWith(other: Rect) {\r\n    const top = Math.max(this.top(), other.top())\r\n    const bottom = Math.max(top, Math.min(this.bottom(), other.bottom()))\r\n    if (bottom - top === 0) return false\r\n\r\n    const left = Math.max(this.left(), other.left())\r\n    const right = Math.max(left, Math.min(this.right(), other.right()))\r\n    if (right - left === 0) return false\r\n    return true\r\n  }\r\n\r\n  intersectWith(other: Rect): Rect {\r\n    const topLeft = Vec2.max(this.topLeft(), other.topLeft())\r\n    const bottomRight = Vec2.max(topLeft, Vec2.min(this.bottomRight(), other.bottomRight()))\r\n\r\n    return new Rect(topLeft, bottomRight.minus(topLeft))\r\n  }\r\n\r\n  equals(other: Rect) {\r\n    return this.origin.equals(other.origin) && this.size.equals(other.size)\r\n  }\r\n\r\n  approxEquals(other: Rect) {\r\n    return this.origin.approxEquals(other.origin) && this.size.approxEquals(other.size)\r\n  }\r\n\r\n  area() {\r\n    return this.size.x * this.size.y\r\n  }\r\n\r\n  static empty = new Rect(Vec2.zero, Vec2.zero)\r\n  static unit = new Rect(Vec2.zero, Vec2.unit)\r\n  static NDC = new Rect(new Vec2(-1, -1), new Vec2(2, 2))\r\n}\r\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","// This is a port of the GPU APIs from https://github.com/evanw/sky from Skew to\r\n// TypeScript.\r\n//\r\n// The MIT License (MIT)\r\n// Original work Copyright (c) 2016 Evan Wallace\r\n// Modified work Copyright (c) 2018 Jamie Wong\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a copy\r\n// of this software and associated documentation files (the \"Software\"), to deal\r\n// in the Software without restriction, including without limitation the rights\r\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n// copies of the Software, and to permit persons to whom the Software is\r\n// furnished to do so, subject to the following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included in\r\n// all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n// SOFTWARE.\r\n\r\n// NOTE: This file intentionally has no dependencies.\r\n\r\n// Dependencies & polyfills for import from skew\r\nconst RELEASE =\r\n  typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'production'\r\n\r\nfunction assert(condition: boolean) {\r\n  if (!RELEASE) {\r\n    if (!condition) throw new Error('Assertion failed.')\r\n  }\r\n}\r\n\r\nfunction appendOne<T>(ts: T[], t: T): void {\r\n  if (ts.indexOf(t) === -1) ts.push(t)\r\n}\r\n\r\nfunction removeOne<T>(ts: T[], t: T): void {\r\n  const index = ts.indexOf(t)\r\n  if (index !== -1) ts.splice(index, 1)\r\n}\r\n\r\nfunction TEXTURE_N(gl: WebGLRenderingContext, index: number) {\r\n  assert(index >= 0 && index <= 31)\r\n  return (gl.TEXTURE0 + index) as GLenum\r\n}\r\n\r\nexport namespace Graphics {\r\n  export class Rect {\r\n    constructor(\r\n      public x: number = 0,\r\n      public y: number = 0,\r\n      public width: number = 0,\r\n      public height: number = 0,\r\n    ) {}\r\n\r\n    set(x: number, y: number, width: number, height: number) {\r\n      this.x = x\r\n      this.y = y\r\n      this.width = width\r\n      this.height = height\r\n    }\r\n\r\n    equals(other: Rect) {\r\n      return (\r\n        this.x === other.x &&\r\n        this.y === other.y &&\r\n        this.width === other.width &&\r\n        this.height === other.height\r\n      )\r\n    }\r\n  }\r\n\r\n  export class Color {\r\n    constructor(\r\n      public redF: number,\r\n      public greenF: number,\r\n      public blueF: number,\r\n      public alphaF: number,\r\n    ) {}\r\n\r\n    equals(other: Color): boolean {\r\n      return (\r\n        this.redF === other.redF &&\r\n        this.greenF === other.greenF &&\r\n        this.blueF === other.blueF &&\r\n        this.alphaF === other.alphaF\r\n      )\r\n    }\r\n\r\n    static TRANSPARENT = new Color(0, 0, 0, 0)\r\n  }\r\n\r\n  // Converted from https://github.com/evanw/sky/blob/c72de77/src/graphics/context.sk\r\n  export enum BlendOperation {\r\n    ZERO = 0,\r\n    ONE = 1,\r\n\r\n    SOURCE_COLOR = 2,\r\n    TARGET_COLOR = 3,\r\n    INVERSE_SOURCE_COLOR = 4,\r\n    INVERSE_TARGET_COLOR = 5,\r\n\r\n    SOURCE_ALPHA = 6,\r\n    TARGET_ALPHA = 7,\r\n    INVERSE_SOURCE_ALPHA = 8,\r\n    INVERSE_TARGET_ALPHA = 9,\r\n\r\n    CONSTANT = 10,\r\n    INVERSE_CONSTANT = 11,\r\n  }\r\n\r\n  export enum Primitive {\r\n    TRIANGLES,\r\n    TRIANGLE_STRIP,\r\n  }\r\n\r\n  export abstract class Context {\r\n    abstract addContextResetHandler(callback: () => void): void\r\n    abstract beginFrame(): void\r\n    abstract clear(color: Color): void\r\n\r\n    abstract createMaterial(\r\n      format: VertexFormat,\r\n      vertexSource: string,\r\n      fragmentSource: string,\r\n    ): Material\r\n    abstract createTexture(\r\n      format: TextureFormat,\r\n      width: number,\r\n      height: number,\r\n      pixels?: Uint8Array,\r\n    ): Texture\r\n    abstract createRenderTarget(texture: Texture): RenderTarget\r\n    abstract createVertexBuffer(byteCount: number): VertexBuffer\r\n    abstract currentRenderTarget: RenderTarget | null\r\n    abstract draw(primitive: Primitive, material: Material, vertices: VertexBuffer): void\r\n    abstract endFrame(): void\r\n    abstract removeContextResetHandler(callback: () => void): void\r\n    abstract resize(\r\n      widthInPixels: number,\r\n      heightInPixels: number,\r\n      widthInAppUnits: number,\r\n      heightInAppUnits: number,\r\n    ): void\r\n    abstract setRenderTarget(renderTarget: RenderTarget | null): void\r\n    abstract setViewport(x: number, y: number, width: number, height: number): void\r\n    abstract viewport: Rect\r\n    abstract widthInPixels: number\r\n    abstract heightInPixels: number\r\n\r\n    abstract renderTargetHeightInPixels: number\r\n    abstract renderTargetWidthInPixels: number\r\n\r\n    abstract setBlendState(source: BlendOperation, target: BlendOperation): void\r\n    setCopyBlendState() {\r\n      this.setBlendState(BlendOperation.ONE, BlendOperation.ZERO)\r\n    }\r\n    setAddBlendState() {\r\n      this.setBlendState(BlendOperation.ONE, BlendOperation.ONE)\r\n    }\r\n    setPremultipliedBlendState() {\r\n      this.setBlendState(BlendOperation.ONE, BlendOperation.INVERSE_SOURCE_ALPHA)\r\n    }\r\n    setUnpremultipliedBlendState() {\r\n      this.setBlendState(BlendOperation.SOURCE_ALPHA, BlendOperation.INVERSE_SOURCE_ALPHA)\r\n    }\r\n\r\n    protected resizeEventHandlers = new Set<() => void>()\r\n    addAfterResizeEventHandler(callback: () => void): void {\r\n      this.resizeEventHandlers.add(callback)\r\n    }\r\n    removeAfterResizeEventHandler(callback: () => void): void {\r\n      this.resizeEventHandlers.delete(callback)\r\n    }\r\n  }\r\n\r\n  export interface Material {\r\n    context: Context\r\n    format: VertexFormat\r\n    fragmentSource: string\r\n    vertexSource: string\r\n    setUniformFloat(name: string, x: number): void\r\n    setUniformInt(name: string, x: number): void\r\n    setUniformVec2(name: string, x: number, y: number): void\r\n    setUniformVec3(name: string, x: number, y: number, z: number): void\r\n    setUniformVec4(name: string, x: number, y: number, z: number, w: number): void\r\n    setUniformMat3(\r\n      name: string,\r\n      m00: number,\r\n      m01: number,\r\n      m02: number,\r\n      m10: number,\r\n      m11: number,\r\n      m12: number,\r\n      m20: number,\r\n      m21: number,\r\n      m22: number,\r\n    ): void\r\n    setUniformSampler(name: string, texture: Texture, index: number): void\r\n  }\r\n\r\n  export enum AttributeType {\r\n    FLOAT,\r\n    BYTE,\r\n  }\r\n\r\n  export function attributeByteLength(type: AttributeType) {\r\n    return type == AttributeType.FLOAT ? 4 : 1\r\n  }\r\n\r\n  export class Attribute {\r\n    constructor(\r\n      readonly name: string,\r\n      readonly type: AttributeType,\r\n      readonly count: number,\r\n      readonly byteOffset: number,\r\n    ) {}\r\n  }\r\n\r\n  export class VertexFormat {\r\n    private _attributes: Attribute[] = []\r\n    private _stride = 0\r\n\r\n    get attributes() {\r\n      return this._attributes\r\n    }\r\n    get stride() {\r\n      return this._stride\r\n    }\r\n\r\n    add(name: string, type: AttributeType, count: number): VertexFormat {\r\n      this.attributes.push(new Attribute(name, type, count, this.stride))\r\n      this._stride += count * attributeByteLength(type)\r\n      return this\r\n    }\r\n  }\r\n\r\n  export abstract class VertexBuffer {\r\n    abstract byteCount: number\r\n    abstract context: Context\r\n    abstract move(sourceByteOffset: number, targetByteOffset: number, byteCount: number): void\r\n    abstract upload(bytes: Uint8Array, byteOffset?: number): void\r\n    uploadFloat32Array(floats: Float32Array) {\r\n      this.upload(new Uint8Array(floats.buffer), 0)\r\n    }\r\n    uploadFloats(floats: number[]) {\r\n      this.uploadFloat32Array(new Float32Array(floats))\r\n    }\r\n    abstract free(): void\r\n  }\r\n\r\n  export enum PixelFilter {\r\n    NEAREST,\r\n    LINEAR,\r\n  }\r\n\r\n  export enum PixelWrap {\r\n    REPEAT,\r\n    CLAMP,\r\n  }\r\n\r\n  export class TextureFormat {\r\n    constructor(\r\n      readonly minFilter: PixelFilter,\r\n      readonly magFilter: PixelFilter,\r\n      readonly wrap: PixelWrap,\r\n    ) {}\r\n\r\n    static LINEAR_CLAMP = new TextureFormat(PixelFilter.LINEAR, PixelFilter.LINEAR, PixelWrap.CLAMP)\r\n    static LINEAR_MIN_NEAREST_MAG_CLAMP = new TextureFormat(\r\n      PixelFilter.LINEAR,\r\n      PixelFilter.NEAREST,\r\n      PixelWrap.CLAMP,\r\n    )\r\n    static NEAREST_CLAMP = new TextureFormat(\r\n      PixelFilter.NEAREST,\r\n      PixelFilter.NEAREST,\r\n      PixelWrap.CLAMP,\r\n    )\r\n  }\r\n\r\n  export interface Texture {\r\n    context: Context\r\n    format: TextureFormat\r\n    width: number\r\n    height: number\r\n    resize(width: number, height: number, pixels?: Uint8Array): void\r\n    setFormat(format: TextureFormat): void\r\n    free(): void\r\n  }\r\n\r\n  export interface RenderTarget {\r\n    context: Context\r\n    texture: Texture\r\n    setColor(texture: Texture): void\r\n    free(): void\r\n  }\r\n}\r\n\r\n// Converted from https://github.com/evanw/sky/blob/c72de77/src/browser/context.sk\r\nexport namespace WebGL {\r\n  export class Context extends Graphics.Context {\r\n    private _attributeCount = 0\r\n    private _blendOperationMap: {[key: number]: GLenum}\r\n    private _blendOperations = 0\r\n    private _contextResetHandlers: (() => void)[] = []\r\n    private _currentClearColor = Graphics.Color.TRANSPARENT\r\n    private _currentRenderTarget: RenderTarget | null = null\r\n    private _defaultViewport = new Graphics.Rect()\r\n    private _forceStateUpdate = true\r\n    private _generation = 1\r\n    private _gl: WebGLRenderingContext\r\n    private _height = 0\r\n    private _oldBlendOperations = 0\r\n    private _oldRenderTarget: RenderTarget | null = null\r\n    private _oldViewport = new Graphics.Rect()\r\n    private _width = 0\r\n\r\n    get widthInPixels() {\r\n      return this._width\r\n    }\r\n    get heightInPixels() {\r\n      return this._height\r\n    }\r\n\r\n    constructor(canvas: HTMLCanvasElement = document.createElement('canvas')) {\r\n      super()\r\n      let gl = canvas.getContext('webgl', {\r\n        alpha: false,\r\n        antialias: false,\r\n        depth: false,\r\n        preserveDrawingBuffer: false,\r\n        stencil: false,\r\n      })\r\n\r\n      if (gl == null) {\r\n        throw new Error('Setup failure')\r\n      }\r\n\r\n      this._gl = gl\r\n      let style = canvas.style\r\n      canvas.width = 0\r\n      canvas.height = 0\r\n      style.width = style.height = '0'\r\n\r\n      canvas.addEventListener('webglcontextlost', (e: Event) => {\r\n        e.preventDefault()\r\n      })\r\n\r\n      canvas.addEventListener('webglcontextrestored', this.handleWebglContextRestored)\r\n\r\n      // Using maps makes these compact in release\r\n      this._blendOperationMap = {\r\n        [Graphics.BlendOperation.ZERO]: this._gl.ZERO,\r\n        [Graphics.BlendOperation.ONE]: this._gl.ONE,\r\n\r\n        [Graphics.BlendOperation.SOURCE_COLOR]: this._gl.SRC_COLOR,\r\n        [Graphics.BlendOperation.TARGET_COLOR]: this._gl.DST_COLOR,\r\n        [Graphics.BlendOperation.INVERSE_SOURCE_COLOR]: this._gl.ONE_MINUS_SRC_COLOR,\r\n        [Graphics.BlendOperation.INVERSE_TARGET_COLOR]: this._gl.ONE_MINUS_DST_COLOR,\r\n\r\n        [Graphics.BlendOperation.SOURCE_ALPHA]: this._gl.SRC_ALPHA,\r\n        [Graphics.BlendOperation.TARGET_ALPHA]: this._gl.DST_ALPHA,\r\n        [Graphics.BlendOperation.INVERSE_SOURCE_ALPHA]: this._gl.ONE_MINUS_SRC_ALPHA,\r\n        [Graphics.BlendOperation.INVERSE_TARGET_ALPHA]: this._gl.ONE_MINUS_DST_ALPHA,\r\n\r\n        [Graphics.BlendOperation.CONSTANT]: this._gl.CONSTANT_COLOR,\r\n        [Graphics.BlendOperation.INVERSE_CONSTANT]: this._gl.ONE_MINUS_CONSTANT_COLOR,\r\n      }\r\n    }\r\n\r\n    private handleWebglContextRestored = () => {\r\n      this._attributeCount = 0\r\n      this._currentClearColor = Graphics.Color.TRANSPARENT\r\n      this._forceStateUpdate = true\r\n      this._generation++\r\n      for (let handler of this._contextResetHandlers) {\r\n        handler()\r\n      }\r\n    }\r\n\r\n    public testContextLoss() {\r\n      this.handleWebglContextRestored()\r\n    }\r\n\r\n    get gl() {\r\n      return this._gl\r\n    }\r\n    get generation() {\r\n      return this._generation\r\n    }\r\n    addContextResetHandler(callback: () => void) {\r\n      appendOne(this._contextResetHandlers, callback)\r\n    }\r\n    removeContextResetHandler(callback: () => void) {\r\n      removeOne(this._contextResetHandlers, callback)\r\n    }\r\n\r\n    get currentRenderTarget() {\r\n      return this._currentRenderTarget\r\n    }\r\n\r\n    beginFrame() {\r\n      this.setRenderTarget(null)\r\n    }\r\n\r\n    endFrame() {}\r\n\r\n    setBlendState(source: Graphics.BlendOperation, target: Graphics.BlendOperation) {\r\n      this._blendOperations = Context._packBlendModes(source, target)\r\n    }\r\n\r\n    setViewport(x: number, y: number, width: number, height: number) {\r\n      ;(this._currentRenderTarget != null\r\n        ? this._currentRenderTarget.viewport\r\n        : this._defaultViewport\r\n      ).set(x, y, width, height)\r\n    }\r\n\r\n    get viewport() {\r\n      return this._currentRenderTarget != null\r\n        ? this._currentRenderTarget.viewport\r\n        : this._defaultViewport\r\n    }\r\n\r\n    get renderTargetWidthInPixels() {\r\n      return this._currentRenderTarget != null\r\n        ? this._currentRenderTarget.viewport.width\r\n        : this._width\r\n    }\r\n\r\n    get renderTargetHeightInPixels() {\r\n      return this._currentRenderTarget != null\r\n        ? this._currentRenderTarget.viewport.height\r\n        : this._height\r\n    }\r\n\r\n    draw(\r\n      primitive: Graphics.Primitive,\r\n      material: Graphics.Material,\r\n      vertices: Graphics.VertexBuffer,\r\n    ) {\r\n      // Update the texture set before preparing the material so uniform samplers can check for that they use different textures\r\n      this._updateRenderTargetAndViewport()\r\n      Material.from(material).prepare()\r\n\r\n      // Update the vertex buffer before updating the format so attributes can bind correctly\r\n      VertexBuffer.from(vertices).prepare()\r\n      this._updateFormat(material.format)\r\n\r\n      // Draw now that everything is ready\r\n      this._updateBlendState()\r\n\r\n      this._gl.drawArrays(\r\n        primitive == Graphics.Primitive.TRIANGLES ? this._gl.TRIANGLES : this._gl.TRIANGLE_STRIP,\r\n        0,\r\n        Math.floor(vertices.byteCount / material.format.stride),\r\n      )\r\n\r\n      // Forced state updates are done once after a context loss\r\n      this._forceStateUpdate = false\r\n    }\r\n\r\n    resize(\r\n      widthInPixels: number,\r\n      heightInPixels: number,\r\n      widthInAppUnits: number,\r\n      heightInAppUnits: number,\r\n    ) {\r\n      let canvas = this._gl.canvas as HTMLCanvasElement\r\n      const bounds = canvas.getBoundingClientRect()\r\n\r\n      if (\r\n        this._width === widthInPixels &&\r\n        this._height === heightInPixels &&\r\n        bounds.width === widthInAppUnits &&\r\n        bounds.height === heightInAppUnits\r\n      ) {\r\n        // Nothing to do here!\r\n        return\r\n      }\r\n\r\n      let style = canvas.style\r\n      canvas.width = widthInPixels\r\n      canvas.height = heightInPixels\r\n      style.width = `${widthInAppUnits}px`\r\n      style.height = `${heightInAppUnits}px`\r\n      this.setViewport(0, 0, widthInPixels, heightInPixels)\r\n      this._width = widthInPixels\r\n      this._height = heightInPixels\r\n\r\n      this.resizeEventHandlers.forEach(cb => cb())\r\n    }\r\n\r\n    clear(color: Graphics.Color) {\r\n      this._updateRenderTargetAndViewport()\r\n      this._updateBlendState()\r\n\r\n      if (!color.equals(this._currentClearColor)) {\r\n        this._gl.clearColor(color.redF, color.greenF, color.blueF, color.alphaF)\r\n        this._currentClearColor = color\r\n      }\r\n\r\n      this._gl.clear(this._gl.COLOR_BUFFER_BIT)\r\n    }\r\n\r\n    setRenderTarget(renderTarget: Graphics.RenderTarget | null) {\r\n      this._currentRenderTarget = RenderTarget.from(renderTarget)\r\n    }\r\n\r\n    createMaterial(\r\n      format: Graphics.VertexFormat,\r\n      vertexSource: string,\r\n      fragmentSource: string,\r\n    ): Graphics.Material {\r\n      let material = new Material(this, format, vertexSource, fragmentSource)\r\n\r\n      // Compiling shaders is really expensive so we want to get that started\r\n      // as early as possible. In Chrome and possibly other browsers, shader\r\n      // compilation can happen asynchronously as long as you don't call\r\n      // useProgram().\r\n      //\r\n      //   https://plus.google.com/+BrandonJonesToji/posts/4ERHkicC5Ny\r\n      //\r\n      material.program\r\n\r\n      return material\r\n    }\r\n\r\n    createVertexBuffer(byteCount: number): Graphics.VertexBuffer {\r\n      assert(byteCount > 0 && byteCount % 4 == 0)\r\n      return new VertexBuffer(this, byteCount)\r\n    }\r\n\r\n    createTexture(\r\n      format: Graphics.TextureFormat,\r\n      width: number,\r\n      height: number,\r\n      pixels?: Uint8Array,\r\n    ): Graphics.Texture {\r\n      return new Texture(this, format, width, height, pixels)\r\n    }\r\n\r\n    createRenderTarget(texture: Graphics.Texture): Graphics.RenderTarget {\r\n      return new RenderTarget(this, Texture.from(texture))\r\n    }\r\n\r\n    private ANGLE_instanced_arrays: ANGLE_instanced_arrays | null = null\r\n    private ANGLE_instanced_arrays_generation: number = -1\r\n    getANGLE_instanced_arrays(): ANGLE_instanced_arrays {\r\n      if (this.ANGLE_instanced_arrays_generation !== this._generation) {\r\n        this.ANGLE_instanced_arrays = null\r\n      }\r\n      if (!this.ANGLE_instanced_arrays) {\r\n        this.ANGLE_instanced_arrays = this.gl.getExtension('ANGLE_instanced_arrays')\r\n        if (!this.ANGLE_instanced_arrays) {\r\n          throw new Error('Failed to get extension ANGLE_instanced_arrays')\r\n        }\r\n      }\r\n      return this.ANGLE_instanced_arrays!\r\n    }\r\n\r\n    _updateRenderTargetAndViewport() {\r\n      let renderTarget = this._currentRenderTarget\r\n      let viewport = renderTarget != null ? renderTarget.viewport : this._defaultViewport\r\n      let gl = this._gl\r\n\r\n      if (this._forceStateUpdate || this._oldRenderTarget != renderTarget) {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, renderTarget ? renderTarget.framebuffer : null)\r\n        this._oldRenderTarget = renderTarget\r\n      }\r\n\r\n      if (this._forceStateUpdate || !this._oldViewport.equals(viewport)) {\r\n        gl.viewport(\r\n          viewport.x,\r\n          this.renderTargetHeightInPixels - viewport.y - viewport.height,\r\n          viewport.width,\r\n          viewport.height,\r\n        )\r\n        this._oldViewport.set(viewport.x, viewport.y, viewport.width, viewport.height)\r\n      }\r\n    }\r\n\r\n    _updateBlendState() {\r\n      if (this._forceStateUpdate || this._oldBlendOperations != this._blendOperations) {\r\n        let gl = this._gl\r\n        let operations = this._blendOperations\r\n        let oldOperations = this._oldBlendOperations\r\n        let source = (operations & 0xf) as Graphics.BlendOperation\r\n        let target = (operations >> 4) as Graphics.BlendOperation\r\n\r\n        assert(source in this._blendOperationMap)\r\n        assert(target in this._blendOperationMap)\r\n\r\n        // Special-case the blend mode that just writes over the target buffer\r\n        if (operations == Context.COPY_BLEND_OPERATIONS) {\r\n          gl.disable(gl.BLEND)\r\n        } else {\r\n          if (this._forceStateUpdate || oldOperations == Context.COPY_BLEND_OPERATIONS) {\r\n            gl.enable(gl.BLEND)\r\n          }\r\n\r\n          // Otherwise, use actual blending\r\n          gl.blendFunc(this._blendOperationMap[source], this._blendOperationMap[target])\r\n        }\r\n\r\n        this._oldBlendOperations = operations\r\n      }\r\n    }\r\n\r\n    _updateFormat(format: Graphics.VertexFormat) {\r\n      // Update the attributes\r\n      let gl = this._gl\r\n      let attributes = format.attributes\r\n      let count = attributes.length\r\n      for (let i = 0; i < count; i++) {\r\n        let attribute = attributes[i]\r\n        let isByte = attribute.type == Graphics.AttributeType.BYTE\r\n        gl.vertexAttribPointer(\r\n          i,\r\n          attribute.count,\r\n          isByte ? gl.UNSIGNED_BYTE : gl.FLOAT,\r\n          isByte,\r\n          format.stride,\r\n          attribute.byteOffset,\r\n        )\r\n      }\r\n\r\n      // Update the attribute count\r\n      while (this._attributeCount < count) {\r\n        gl.enableVertexAttribArray(this._attributeCount)\r\n        this._attributeCount++\r\n      }\r\n      while (this._attributeCount > count) {\r\n        this._attributeCount--\r\n        gl.disableVertexAttribArray(this._attributeCount)\r\n      }\r\n      this._attributeCount = count\r\n    }\r\n\r\n    getWebGLInfo(): {renderer: string | null; vendor: string | null; version: string | null} {\r\n      const ext = this.gl.getExtension('WEBGL_debug_renderer_info')\r\n      const renderer = ext ? this.gl.getParameter(ext.UNMASKED_RENDERER_WEBGL) : null\r\n      const vendor = ext ? this.gl.getParameter(ext.UNMASKED_VENDOR_WEBGL) : null\r\n      const version = this.gl.getParameter(this.gl.VERSION)\r\n      return {renderer, vendor, version}\r\n    }\r\n\r\n    static from(context: Graphics.Context): Context {\r\n      assert(context == null || context instanceof Context)\r\n      return context as Context\r\n    }\r\n\r\n    static _packBlendModes(\r\n      source: Graphics.BlendOperation,\r\n      target: Graphics.BlendOperation,\r\n    ): number {\r\n      return source | (target << 4)\r\n    }\r\n\r\n    static COPY_BLEND_OPERATIONS = Context._packBlendModes(\r\n      Graphics.BlendOperation.ONE,\r\n      Graphics.BlendOperation.ZERO,\r\n    )\r\n  }\r\n\r\n  abstract class Uniform {\r\n    constructor(\r\n      protected readonly _material: Material,\r\n      protected readonly _name: string,\r\n      protected _generation = 0,\r\n      protected _location: WebGLUniformLocation | null = null,\r\n      protected _isDirty = true,\r\n    ) {}\r\n\r\n    // Upload this uniform if it's dirty\r\n    abstract prepare(): void\r\n\r\n    get location(): WebGLUniformLocation {\r\n      let context = Context.from(this._material.context)\r\n      if (this._generation != context.generation) {\r\n        this._location = context.gl.getUniformLocation(this._material.program, this._name)\r\n        this._generation = context.generation\r\n\r\n        // Validate the shader against this uniform\r\n        if (!RELEASE) {\r\n          let program = this._material.program\r\n          let gl = context.gl\r\n          for (let i = 0, ii = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS); i < ii; i++) {\r\n            let info = gl.getActiveUniform(program, i)\r\n            if (info && info.name == this._name) {\r\n              assert(info.size == 1)\r\n              switch (info.type) {\r\n                case gl.FLOAT: {\r\n                  assert(this instanceof UniformFloat)\r\n                  break\r\n                }\r\n                case gl.FLOAT_MAT3: {\r\n                  assert(this instanceof UniformMat3)\r\n                  break\r\n                }\r\n                case gl.FLOAT_VEC2: {\r\n                  assert(this instanceof UniformVec2)\r\n                  break\r\n                }\r\n                case gl.FLOAT_VEC3: {\r\n                  assert(this instanceof UniformVec3)\r\n                  break\r\n                }\r\n                case gl.FLOAT_VEC4: {\r\n                  assert(this instanceof UniformVec4)\r\n                  break\r\n                }\r\n                case gl.INT: {\r\n                  assert(this instanceof UniformInt)\r\n                  break\r\n                }\r\n                case gl.SAMPLER_2D: {\r\n                  assert(this instanceof UniformSampler)\r\n                  break\r\n                }\r\n                default:\r\n                  assert(false)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (!this._location) {\r\n        throw new Error('Failed to get uniform location')\r\n      }\r\n      return this._location\r\n    }\r\n  }\r\n\r\n  class UniformFloat extends Uniform {\r\n    private _x = 0.0\r\n\r\n    set(x: number) {\r\n      if (x != this._x) {\r\n        this._x = x\r\n        this._isDirty = true\r\n      }\r\n    }\r\n\r\n    prepare() {\r\n      let context = Context.from(this._material.context)\r\n      if (this._generation != context.generation || this._isDirty) {\r\n        context.gl.uniform1f(this.location, this._x)\r\n        this._isDirty = false\r\n      }\r\n    }\r\n  }\r\n\r\n  class UniformInt extends Uniform {\r\n    private _x = 0\r\n\r\n    set(x: number) {\r\n      if (x != this._x) {\r\n        this._x = x\r\n        this._isDirty = true\r\n      }\r\n    }\r\n\r\n    prepare() {\r\n      let context = Context.from(this._material.context)\r\n      if (this._generation != context.generation || this._isDirty) {\r\n        context.gl.uniform1i(this.location, this._x)\r\n        this._isDirty = false\r\n      }\r\n    }\r\n  }\r\n\r\n  class UniformVec2 extends Uniform {\r\n    private _x = 0.0\r\n    private _y = 0.0\r\n\r\n    set(x: number, y: number) {\r\n      if (x != this._x || y != this._y) {\r\n        this._x = x\r\n        this._y = y\r\n        this._isDirty = true\r\n      }\r\n    }\r\n\r\n    prepare() {\r\n      let context = Context.from(this._material.context)\r\n      if (this._generation != context.generation || this._isDirty) {\r\n        context.gl.uniform2f(this.location, this._x, this._y)\r\n        this._isDirty = false\r\n      }\r\n    }\r\n  }\r\n\r\n  class UniformVec3 extends Uniform {\r\n    private _x = 0.0\r\n    private _y = 0.0\r\n    private _z = 0.0\r\n\r\n    set(x: number, y: number, z: number) {\r\n      if (x != this._x || y != this._y || z != this._z) {\r\n        this._x = x\r\n        this._y = y\r\n        this._z = z\r\n        this._isDirty = true\r\n      }\r\n    }\r\n\r\n    prepare() {\r\n      let context = Context.from(this._material.context)\r\n      if (this._generation != context.generation || this._isDirty) {\r\n        context.gl.uniform3f(this.location, this._x, this._y, this._z)\r\n        this._isDirty = false\r\n      }\r\n    }\r\n  }\r\n\r\n  class UniformVec4 extends Uniform {\r\n    private _x = 0.0\r\n    private _y = 0.0\r\n    private _z = 0.0\r\n    private _w = 0.0\r\n\r\n    set(x: number, y: number, z: number, w: number) {\r\n      if (x != this._x || y != this._y || z != this._z || w != this._w) {\r\n        this._x = x\r\n        this._y = y\r\n        this._z = z\r\n        this._w = w\r\n        this._isDirty = true\r\n      }\r\n    }\r\n\r\n    prepare() {\r\n      let context = Context.from(this._material.context)\r\n      if (this._generation != context.generation || this._isDirty) {\r\n        context.gl.uniform4f(this.location, this._x, this._y, this._z, this._w)\r\n        this._isDirty = false\r\n      }\r\n    }\r\n  }\r\n\r\n  class UniformMat3 extends Uniform {\r\n    private _values = [1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0]\r\n\r\n    set(\r\n      m00: number,\r\n      m01: number,\r\n      m02: number,\r\n      m10: number,\r\n      m11: number,\r\n      m12: number,\r\n      m20: number,\r\n      m21: number,\r\n      m22: number,\r\n    ) {\r\n      // These values are deliberately transposed because WebGL requires the \"transpose\" argument of uniformMatrix() to be false\r\n      UniformMat3._cachedValues[0] = m00\r\n      UniformMat3._cachedValues[1] = m10\r\n      UniformMat3._cachedValues[2] = m20\r\n      UniformMat3._cachedValues[3] = m01\r\n      UniformMat3._cachedValues[4] = m11\r\n      UniformMat3._cachedValues[5] = m21\r\n      UniformMat3._cachedValues[6] = m02\r\n      UniformMat3._cachedValues[7] = m12\r\n      UniformMat3._cachedValues[8] = m22\r\n\r\n      for (let i = 0; i < 9; i++) {\r\n        if (UniformMat3._cachedValues[i] != this._values[i]) {\r\n          let swap = this._values\r\n          this._values = UniformMat3._cachedValues\r\n          UniformMat3._cachedValues = swap\r\n          this._isDirty = true\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    prepare() {\r\n      let context = Context.from(this._material.context)\r\n      if (this._generation != context.generation || this._isDirty) {\r\n        context.gl.uniformMatrix3fv(this.location, false, this._values)\r\n        this._isDirty = false\r\n      }\r\n    }\r\n\r\n    // Statically allocate this to avoid allocations\r\n    static _cachedValues = [1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0]\r\n  }\r\n\r\n  class UniformSampler extends Uniform {\r\n    private _texture: Texture | null = null\r\n    private _index = -1\r\n\r\n    set(texture: Graphics.Texture, index: number) {\r\n      if (this._texture != texture || this._index != index) {\r\n        this._texture = Texture.from(texture)\r\n        this._index = index\r\n        this._isDirty = true\r\n      }\r\n    }\r\n\r\n    prepare() {\r\n      let context = Context.from(this._material.context)\r\n      let gl = context.gl\r\n      assert(\r\n        this._texture == null ||\r\n          context.currentRenderTarget == null ||\r\n          this._texture != context.currentRenderTarget.texture,\r\n      )\r\n      if (this._generation != context.generation || this._isDirty) {\r\n        gl.uniform1i(this.location, this._index)\r\n        this._isDirty = false\r\n      }\r\n      gl.activeTexture(TEXTURE_N(gl, this._index))\r\n      gl.bindTexture(\r\n        gl.TEXTURE_2D,\r\n        this._texture != null && this._texture.width > 0 && this._texture.height > 0\r\n          ? this._texture.texture\r\n          : null,\r\n      )\r\n    }\r\n  }\r\n\r\n  class Material implements Graphics.Material {\r\n    constructor(\r\n      private readonly _context: Context,\r\n      private readonly _format: Graphics.VertexFormat,\r\n      private readonly _vertexSource: string,\r\n      private readonly _fragmentSource: string,\r\n      private readonly _uniformsMap: {[key: string]: Uniform} = {},\r\n      private readonly _uniformsList: Uniform[] = [],\r\n      private _generation = 0,\r\n      private _program: WebGLProgram | null = null,\r\n    ) {}\r\n\r\n    get context() {\r\n      return this._context\r\n    }\r\n    get format() {\r\n      return this._format\r\n    }\r\n    get vertexSource() {\r\n      return this._vertexSource\r\n    }\r\n    get fragmentSource() {\r\n      return this._fragmentSource\r\n    }\r\n\r\n    setUniformFloat(name: string, x: number) {\r\n      let uniform = this._uniformsMap[name] || null\r\n      if (uniform == null) {\r\n        uniform = new UniformFloat(this, name)\r\n        this._uniformsMap[name] = uniform\r\n        this._uniformsList.push(uniform)\r\n      }\r\n      assert(uniform instanceof UniformFloat)\r\n      ;(uniform as UniformFloat).set(x)\r\n    }\r\n\r\n    setUniformInt(name: string, x: number) {\r\n      let uniform = this._uniformsMap[name] || null\r\n      if (uniform == null) {\r\n        uniform = new UniformInt(this, name)\r\n        this._uniformsMap[name] = uniform\r\n        this._uniformsList.push(uniform)\r\n      }\r\n      assert(uniform instanceof UniformInt)\r\n      ;(uniform as UniformInt).set(x)\r\n    }\r\n\r\n    setUniformVec2(name: string, x: number, y: number) {\r\n      let uniform = this._uniformsMap[name] || null\r\n      if (uniform == null) {\r\n        uniform = new UniformVec2(this, name)\r\n        this._uniformsMap[name] = uniform\r\n        this._uniformsList.push(uniform)\r\n      }\r\n      assert(uniform instanceof UniformVec2)\r\n      ;(uniform as UniformVec2).set(x, y)\r\n    }\r\n\r\n    setUniformVec3(name: string, x: number, y: number, z: number) {\r\n      let uniform = this._uniformsMap[name] || null\r\n      if (uniform == null) {\r\n        uniform = new UniformVec3(this, name)\r\n        this._uniformsMap[name] = uniform\r\n        this._uniformsList.push(uniform)\r\n      }\r\n      assert(uniform instanceof UniformVec3)\r\n      ;(uniform as UniformVec3).set(x, y, z)\r\n    }\r\n\r\n    setUniformVec4(name: string, x: number, y: number, z: number, w: number) {\r\n      let uniform = this._uniformsMap[name] || null\r\n      if (uniform == null) {\r\n        uniform = new UniformVec4(this, name)\r\n        this._uniformsMap[name] = uniform\r\n        this._uniformsList.push(uniform)\r\n      }\r\n      assert(uniform instanceof UniformVec4)\r\n      ;(uniform as UniformVec4).set(x, y, z, w)\r\n    }\r\n\r\n    setUniformMat3(\r\n      name: string,\r\n      m00: number,\r\n      m01: number,\r\n      m02: number,\r\n      m10: number,\r\n      m11: number,\r\n      m12: number,\r\n      m20: number,\r\n      m21: number,\r\n      m22: number,\r\n    ) {\r\n      let uniform = this._uniformsMap[name] || null\r\n      if (uniform == null) {\r\n        uniform = new UniformMat3(this, name)\r\n        this._uniformsMap[name] = uniform\r\n        this._uniformsList.push(uniform)\r\n      }\r\n      assert(uniform instanceof UniformMat3)\r\n      ;(uniform as UniformMat3).set(m00, m01, m02, m10, m11, m12, m20, m21, m22)\r\n    }\r\n\r\n    setUniformSampler(name: string, texture: Graphics.Texture, index: number) {\r\n      let uniform = this._uniformsMap[name] || null\r\n      if (uniform == null) {\r\n        uniform = new UniformSampler(this, name)\r\n        this._uniformsMap[name] = uniform\r\n        this._uniformsList.push(uniform)\r\n      }\r\n      assert(uniform instanceof UniformSampler)\r\n      ;(uniform as UniformSampler).set(texture, index)\r\n    }\r\n\r\n    get program(): WebGLProgram {\r\n      let gl = this._context.gl\r\n      if (this._generation != this._context.generation) {\r\n        this._program = gl.createProgram()!\r\n        this._compileShader(gl, gl.VERTEX_SHADER, this.vertexSource)\r\n        this._compileShader(gl, gl.FRAGMENT_SHADER, this.fragmentSource)\r\n        let attributes = this.format.attributes\r\n        for (let i = 0; i < attributes.length; i++) {\r\n          gl.bindAttribLocation(this._program, i, attributes[i].name)\r\n        }\r\n        gl.linkProgram(this._program)\r\n        if (!gl.getProgramParameter(this._program, gl.LINK_STATUS)) {\r\n          throw new Error(`${gl.getProgramInfoLog(this._program)}`)\r\n        }\r\n        this._generation = this._context.generation\r\n\r\n        // Validate this shader against the format\r\n        if (!RELEASE) {\r\n          for (let attribute of attributes) {\r\n            for (\r\n              let i = 0, ii = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\r\n              i < ii;\r\n              i++\r\n            ) {\r\n              let info = gl.getActiveAttrib(this.program, i)\r\n              if (info && info.name == attribute.name) {\r\n                assert(info.size == 1)\r\n                switch (attribute.count) {\r\n                  case 1: {\r\n                    assert(info.type == gl.FLOAT)\r\n                    break\r\n                  }\r\n                  case 2: {\r\n                    assert(info.type == gl.FLOAT_VEC2)\r\n                    break\r\n                  }\r\n                  case 3: {\r\n                    assert(info.type == gl.FLOAT_VEC3)\r\n                    break\r\n                  }\r\n                  case 4: {\r\n                    assert(info.type == gl.FLOAT_VEC4)\r\n                    break\r\n                  }\r\n                  default: {\r\n                    assert(false)\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return this._program!\r\n    }\r\n\r\n    prepare(): void {\r\n      this._context.gl.useProgram(this.program)\r\n      for (let uniform of this._uniformsList) {\r\n        uniform.prepare()\r\n      }\r\n    }\r\n\r\n    _compileShader(gl: WebGLRenderingContext, type: GLenum, source: string) {\r\n      let shader = gl.createShader(type)\r\n      if (!shader) {\r\n        throw new Error('Failed to create shader')\r\n      }\r\n      gl.shaderSource(shader, source)\r\n      gl.compileShader(shader)\r\n      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n        throw new Error(`${gl.getShaderInfoLog(shader)}`)\r\n      }\r\n      if (!this._program) {\r\n        throw new Error('Tried to attach shader before program was created')\r\n      }\r\n      gl.attachShader(this._program, shader)\r\n    }\r\n\r\n    static from(material: Graphics.Material): Material {\r\n      assert(material == null || material instanceof Material)\r\n      return material as Material\r\n    }\r\n  }\r\n\r\n  class VertexBuffer extends Graphics.VertexBuffer {\r\n    private readonly _context: Context\r\n    private _generation = 0\r\n    private _buffer: WebGLBuffer | null = null\r\n    private _bytes: Uint8Array | null = null\r\n    private _isDirty = true\r\n    private _dirtyMin = VertexBuffer.INT_MAX\r\n    private _dirtyMax = 0\r\n    private _totalMin = VertexBuffer.INT_MAX\r\n    private _totalMax = 0\r\n    private _byteCount = 0\r\n\r\n    constructor(context: Context, byteCount: number) {\r\n      super()\r\n      this._context = context\r\n      this._byteCount = byteCount\r\n      this._bytes = new Uint8Array(byteCount)\r\n    }\r\n\r\n    get context() {\r\n      return this._context\r\n    }\r\n    get byteCount() {\r\n      return this._byteCount\r\n    }\r\n\r\n    move(sourceByteOffset: number, targetByteOffset: number, byteCount: number) {\r\n      assert(byteCount >= 0)\r\n      assert(0 <= sourceByteOffset && sourceByteOffset + byteCount <= this._byteCount)\r\n      assert(0 <= targetByteOffset && targetByteOffset + byteCount <= this._byteCount)\r\n\r\n      if (this._bytes && sourceByteOffset != targetByteOffset && byteCount != 0) {\r\n        this._bytes.set(this._bytes.subarray(sourceByteOffset, this._byteCount), targetByteOffset)\r\n        this._growDirtyRegion(\r\n          Math.min(sourceByteOffset, targetByteOffset),\r\n          Math.max(sourceByteOffset, targetByteOffset) + byteCount,\r\n        )\r\n      }\r\n    }\r\n\r\n    upload(bytes: Uint8Array, byteOffset: number = 0) {\r\n      assert(0 <= byteOffset && byteOffset + bytes.length <= this._byteCount)\r\n      assert(this._bytes != null)\r\n      this._bytes!.set(bytes, byteOffset)\r\n      this._growDirtyRegion(byteOffset, byteOffset + bytes.length)\r\n    }\r\n\r\n    free() {\r\n      if (this._buffer) {\r\n        this._context.gl.deleteBuffer(this._buffer)\r\n      }\r\n\r\n      // Reset the generation to force this to be re-uploaded if it's used again\r\n      // in the future.\r\n      this._generation = 0\r\n    }\r\n\r\n    prepare(): void {\r\n      let gl = this._context.gl\r\n\r\n      if (this._generation !== this._context.generation) {\r\n        this._buffer = gl.createBuffer()\r\n        this._generation = this._context.generation\r\n        this._isDirty = true\r\n      }\r\n\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, this._buffer)\r\n\r\n      if (this._isDirty) {\r\n        gl.bufferData(gl.ARRAY_BUFFER, this._byteCount, gl.DYNAMIC_DRAW)\r\n        this._dirtyMin = this._totalMin\r\n        this._dirtyMax = this._totalMax\r\n        this._isDirty = false\r\n      }\r\n\r\n      if (this._dirtyMin < this._dirtyMax) {\r\n        gl.bufferSubData(\r\n          gl.ARRAY_BUFFER,\r\n          this._dirtyMin,\r\n          this._bytes!.subarray(this._dirtyMin, this._dirtyMax),\r\n        )\r\n        this._dirtyMin = VertexBuffer.INT_MAX\r\n        this._dirtyMax = 0\r\n      }\r\n    }\r\n\r\n    _growDirtyRegion(min: number, max: number) {\r\n      this._dirtyMin = Math.min(this._dirtyMin, min)\r\n      this._dirtyMax = Math.max(this._dirtyMax, max)\r\n      this._totalMin = Math.min(this._totalMin, min)\r\n      this._totalMax = Math.max(this._totalMax, max)\r\n    }\r\n\r\n    static INT_MAX = 0x7fffffff\r\n\r\n    static from(buffer: Graphics.VertexBuffer): VertexBuffer {\r\n      assert(buffer == null || buffer instanceof VertexBuffer)\r\n      return buffer as VertexBuffer\r\n    }\r\n  }\r\n\r\n  class Texture implements Graphics.Texture {\r\n    constructor(\r\n      private readonly _context: Context,\r\n      private _format: Graphics.TextureFormat,\r\n      private _width: number,\r\n      private _height: number,\r\n      private _pixels: Uint8Array | null = null,\r\n      private _texture: WebGLTexture | null = null,\r\n      private _generation = 0,\r\n      private _isFormatDirty = true,\r\n      private _isContentDirty = true,\r\n    ) {}\r\n\r\n    get context() {\r\n      return this._context\r\n    }\r\n    get format() {\r\n      return this._format\r\n    }\r\n    get width() {\r\n      return this._width\r\n    }\r\n    get height() {\r\n      return this._height\r\n    }\r\n\r\n    resize(width: number, height: number, pixels: Uint8Array | null = null) {\r\n      this._width = width\r\n      this._height = height\r\n      this._pixels = pixels\r\n      this._isContentDirty = true\r\n    }\r\n\r\n    setFormat(format: Graphics.TextureFormat) {\r\n      if (this._format != format) {\r\n        this._format = format\r\n        this._isFormatDirty = true\r\n      }\r\n    }\r\n\r\n    get texture(): WebGLTexture {\r\n      let gl = this._context.gl\r\n\r\n      // Create\r\n      if (this._generation != this._context.generation) {\r\n        this._texture = gl.createTexture()\r\n        this._generation = this._context.generation\r\n        this._isFormatDirty = true\r\n        this._isContentDirty = true\r\n      }\r\n\r\n      // Format\r\n      if (this._isFormatDirty) {\r\n        gl.bindTexture(gl.TEXTURE_2D, this._texture)\r\n        gl.texParameteri(\r\n          gl.TEXTURE_2D,\r\n          gl.TEXTURE_MAG_FILTER,\r\n          this.format.magFilter == Graphics.PixelFilter.NEAREST ? gl.NEAREST : gl.LINEAR,\r\n        )\r\n        gl.texParameteri(\r\n          gl.TEXTURE_2D,\r\n          gl.TEXTURE_MIN_FILTER,\r\n          this.format.minFilter == Graphics.PixelFilter.NEAREST ? gl.NEAREST : gl.LINEAR,\r\n        )\r\n        gl.texParameteri(\r\n          gl.TEXTURE_2D,\r\n          gl.TEXTURE_WRAP_S,\r\n          this.format.wrap == Graphics.PixelWrap.REPEAT ? gl.REPEAT : gl.CLAMP_TO_EDGE,\r\n        )\r\n        gl.texParameteri(\r\n          gl.TEXTURE_2D,\r\n          gl.TEXTURE_WRAP_T,\r\n          this.format.wrap == Graphics.PixelWrap.REPEAT ? gl.REPEAT : gl.CLAMP_TO_EDGE,\r\n        )\r\n        this._isFormatDirty = false\r\n      }\r\n\r\n      if (this._isContentDirty) {\r\n        gl.bindTexture(gl.TEXTURE_2D, this._texture)\r\n        gl.texImage2D(\r\n          gl.TEXTURE_2D,\r\n          0,\r\n          gl.RGBA,\r\n          this._width,\r\n          this._height,\r\n          0,\r\n          gl.RGBA,\r\n          gl.UNSIGNED_BYTE,\r\n          this._pixels,\r\n        )\r\n        this._isContentDirty = false\r\n      }\r\n\r\n      return this._texture!\r\n    }\r\n\r\n    free() {\r\n      if (this.texture) {\r\n        this._context.gl.deleteTexture(this.texture)\r\n        this._generation = 0\r\n      }\r\n    }\r\n\r\n    static from(texture: Graphics.Texture): Texture {\r\n      assert(texture == null || texture instanceof Texture)\r\n      return texture as Texture\r\n    }\r\n  }\r\n\r\n  class RenderTarget implements Graphics.RenderTarget {\r\n    constructor(\r\n      private _context: Context,\r\n      private _texture: Texture,\r\n      private _framebuffer: WebGLFramebuffer | null = null,\r\n      private _generation = 0,\r\n      private _isDirty = true,\r\n      private _viewport = new Graphics.Rect(),\r\n    ) {}\r\n\r\n    get context() {\r\n      return this._context\r\n    }\r\n    get texture() {\r\n      return this._texture\r\n    }\r\n    get viewport() {\r\n      return this._viewport\r\n    }\r\n    setColor(texture: Graphics.Texture) {\r\n      if (this._texture != texture) {\r\n        this._texture = Texture.from(texture)\r\n        this._isDirty = true\r\n      }\r\n    }\r\n\r\n    get framebuffer(): WebGLFramebuffer {\r\n      let gl = this._context.gl\r\n      let texture = this._texture.texture\r\n\r\n      // Create\r\n      if (this._generation != this._context.generation) {\r\n        this._framebuffer = gl.createFramebuffer()\r\n        this._generation = this._context.generation\r\n        this._isDirty = true\r\n      }\r\n\r\n      // Update\r\n      if (this._isDirty) {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._framebuffer)\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0)\r\n        assert(gl.checkFramebufferStatus(gl.FRAMEBUFFER) == gl.FRAMEBUFFER_COMPLETE)\r\n        this._isDirty = false\r\n      }\r\n\r\n      return this._framebuffer!\r\n    }\r\n\r\n    free() {\r\n      if (this._framebuffer) {\r\n        this._context.gl.deleteFramebuffer(this._framebuffer)\r\n        this._generation = 0\r\n      }\r\n    }\r\n\r\n    static from(renderTarget: Graphics.RenderTarget | null): RenderTarget | null {\r\n      assert(renderTarget == null || renderTarget instanceof RenderTarget)\r\n      return renderTarget as RenderTarget | null\r\n    }\r\n  }\r\n}\r\n","import {Graphics} from './graphics'\r\nimport {AffineTransform, Vec2} from '../lib/math'\r\n\r\nexport function setUniformAffineTransform(\r\n  material: Graphics.Material,\r\n  name: string,\r\n  transform: AffineTransform,\r\n) {\r\n  let {m00, m01, m02, m10, m11, m12} = transform\r\n  material.setUniformMat3(name, m00, m01, m02, m10, m11, m12, 0, 0, 1)\r\n}\r\nexport function setUniformVec2(material: Graphics.Material, name: string, vec: Vec2) {\r\n  material.setUniformVec2(name, vec.x, vec.y)\r\n}\r\n\r\nexport function renderInto(gl: Graphics.Context, target: Graphics.RenderTarget, cb: () => void) {\r\n  gl.setRenderTarget(target)\r\n  gl.setViewport(0, 0, target.texture.width, target.texture.height)\r\n  cb()\r\n  gl.setRenderTarget(null)\r\n}\r\n","import {Rect, Vec2, AffineTransform} from '../lib/math'\r\nimport {Color} from '../lib/color'\r\nimport {Graphics} from './graphics'\r\nimport {setUniformAffineTransform} from './utils'\r\n\r\nconst vertexFormat = new Graphics.VertexFormat()\r\nvertexFormat.add('configSpacePos', Graphics.AttributeType.FLOAT, 2)\r\nvertexFormat.add('color', Graphics.AttributeType.FLOAT, 3)\r\n\r\nconst vert = `\r\n  uniform mat3 configSpaceToNDC;\r\n\r\n  attribute vec2 configSpacePos;\r\n  attribute vec3 color;\r\n  varying vec3 vColor;\r\n\r\n  void main() {\r\n    vColor = color;\r\n    vec2 position = (configSpaceToNDC * vec3(configSpacePos, 1)).xy;\r\n    gl_Position = vec4(position, 1, 1);\r\n  }\r\n`\r\n\r\nconst frag = `\r\n  precision mediump float;\r\n  varying vec3 vColor;\r\n\r\n  void main() {\r\n    gl_FragColor = vec4(vColor.rgb, 1);\r\n  }\r\n`\r\n\r\nexport class RectangleBatch {\r\n  private rects: Rect[] = []\r\n  private colors: Color[] = []\r\n  constructor(private gl: Graphics.Context) {}\r\n\r\n  getRectCount() {\r\n    return this.rects.length\r\n  }\r\n\r\n  private buffer: Graphics.VertexBuffer | null = null\r\n  getBuffer(): Graphics.VertexBuffer {\r\n    if (this.buffer) {\r\n      return this.buffer\r\n    }\r\n\r\n    const corners = [\r\n      [0, 0],\r\n      [1, 0],\r\n      [0, 1],\r\n      [1, 0],\r\n      [0, 1],\r\n      [1, 1],\r\n    ]\r\n\r\n    const bytes = new Uint8Array(vertexFormat.stride * corners.length * this.rects.length)\r\n    const floats = new Float32Array(bytes.buffer)\r\n    let idx = 0\r\n\r\n    for (let i = 0; i < this.rects.length; i++) {\r\n      const rect = this.rects[i]\r\n      const color = this.colors[i]\r\n\r\n      // TODO(jlfwong): In the conversion from regl to graphics.ts, I lost the\r\n      // ability to do instanced drawing. This is a pretty significant hit to\r\n      // the performance here since I need 6x the memory to allocate these\r\n      // things. Adding instanced drawing to graphics.ts is non-trivial, so I'm\r\n      // just going to try this for now.\r\n      for (let corner of corners) {\r\n        floats[idx++] = rect.origin.x + corner[0] * rect.size.x\r\n        floats[idx++] = rect.origin.y + corner[1] * rect.size.y\r\n\r\n        floats[idx++] = color.r\r\n        floats[idx++] = color.g\r\n        floats[idx++] = color.b\r\n      }\r\n    }\r\n\r\n    if (idx !== floats.length) {\r\n      throw new Error(\"Buffer expected to be full but wasn't\")\r\n    }\r\n\r\n    this.buffer = this.gl.createVertexBuffer(bytes.length)\r\n    this.buffer.upload(bytes)\r\n    return this.buffer\r\n  }\r\n\r\n  addRect(rect: Rect, color: Color) {\r\n    this.rects.push(rect)\r\n    this.colors.push(color)\r\n\r\n    if (this.buffer) {\r\n      this.buffer.free()\r\n      this.buffer = null\r\n    }\r\n  }\r\n\r\n  free() {\r\n    if (this.buffer) {\r\n      this.buffer.free()\r\n      this.buffer = null\r\n    }\r\n  }\r\n}\r\n\r\nexport interface RectangleBatchRendererProps {\r\n  batch: RectangleBatch\r\n  configSpaceSrcRect: Rect\r\n  physicalSpaceDstRect: Rect\r\n}\r\n\r\nexport class RectangleBatchRenderer {\r\n  material: Graphics.Material\r\n  constructor(private gl: Graphics.Context) {\r\n    this.material = gl.createMaterial(vertexFormat, vert, frag)\r\n  }\r\n\r\n  render(props: RectangleBatchRendererProps) {\r\n    setUniformAffineTransform(\r\n      this.material,\r\n      'configSpaceToNDC',\r\n      (() => {\r\n        const configToPhysical = AffineTransform.betweenRects(\r\n          props.configSpaceSrcRect,\r\n          props.physicalSpaceDstRect,\r\n        )\r\n\r\n        const viewportSize = new Vec2(this.gl.viewport.width, this.gl.viewport.height)\r\n\r\n        const physicalToNDC = AffineTransform.withTranslation(new Vec2(-1, 1)).times(\r\n          AffineTransform.withScale(new Vec2(2, -2).dividedByPointwise(viewportSize)),\r\n        )\r\n\r\n        return physicalToNDC.times(configToPhysical)\r\n      })(),\r\n    )\r\n\r\n    this.gl.setUnpremultipliedBlendState()\r\n    this.gl.draw(Graphics.Primitive.TRIANGLES, this.material, props.batch.getBuffer())\r\n  }\r\n}\r\n","import {clamp} from './math'\r\n\r\nexport class Color {\r\n  constructor(\r\n    readonly r: number = 0,\r\n    readonly g: number = 0,\r\n    readonly b: number = 0,\r\n    readonly a: number = 1,\r\n  ) {}\r\n\r\n  static fromLumaChromaHue(L: number, C: number, H: number) {\r\n    // 0 <= L <= 1\r\n    // 0 <= C <= 1\r\n    // 0 <= H <= 360\r\n    // https://en.wikipedia.org/wiki/HSL_and_HSV#From_luma/chroma/hue\r\n\r\n    const hPrime = H / 60\r\n    const X = C * (1 - Math.abs((hPrime % 2) - 1))\r\n    const [R1, G1, B1] =\r\n      hPrime < 1\r\n        ? [C, X, 0]\r\n        : hPrime < 2\r\n        ? [X, C, 0]\r\n        : hPrime < 3\r\n        ? [0, C, X]\r\n        : hPrime < 4\r\n        ? [0, X, C]\r\n        : hPrime < 5\r\n        ? [X, 0, C]\r\n        : [C, 0, X]\r\n\r\n    const m = L - (0.3 * R1 + 0.59 * G1 + 0.11 * B1)\r\n\r\n    return new Color(clamp(R1 + m, 0, 1), clamp(G1 + m, 0, 1), clamp(B1 + m, 0, 1), 1.0)\r\n  }\r\n\r\n  static fromCSSHex(hex: string) {\r\n    if (hex.length !== 7 || hex[0] !== '#') {\r\n      throw new Error(`Invalid color input ${hex}`)\r\n    }\r\n    const r = parseInt(hex.substr(1, 2), 16) / 255\r\n    const g = parseInt(hex.substr(3, 2), 16) / 255\r\n    const b = parseInt(hex.substr(5, 2), 16) / 255\r\n    if (r < 0 || r > 1 || g < 0 || g > 1 || b < 0 || b > 1) {\r\n      throw new Error(`Invalid color input ${hex}`)\r\n    }\r\n    return new Color(r, g, b)\r\n  }\r\n\r\n  withAlpha(a: number): Color {\r\n    return new Color(this.r, this.g, this.b, a)\r\n  }\r\n\r\n  toCSS(): string {\r\n    return `rgba(${(255 * this.r).toFixed()}, ${(255 * this.g).toFixed()}, ${(\r\n      255 * this.b\r\n    ).toFixed()}, ${this.a.toFixed(2)})`\r\n  }\r\n}\r\n","import {LRUCache} from '../lib/lru-cache'\r\nimport {RectangleBatch, RectangleBatchRenderer} from './rectangle-batch-renderer'\r\nimport {Rect, Vec2} from '../lib/math'\r\nimport {Color} from '../lib/color'\r\nimport {Graphics} from './graphics'\r\nimport {TextureRenderer} from './texture-renderer'\r\nimport {renderInto} from './utils'\r\n\r\nexport class RowAtlas<K> {\r\n  private texture: Graphics.Texture\r\n  private renderTarget: Graphics.RenderTarget\r\n  private rowCache: LRUCache<K, number>\r\n  private clearLineBatch: RectangleBatch\r\n\r\n  constructor(\r\n    private gl: Graphics.Context,\r\n    private rectangleBatchRenderer: RectangleBatchRenderer,\r\n    private textureRenderer: TextureRenderer,\r\n  ) {\r\n    this.texture = gl.createTexture(Graphics.TextureFormat.NEAREST_CLAMP, 4096, 4096)\r\n    this.renderTarget = gl.createRenderTarget(this.texture)\r\n    this.rowCache = new LRUCache(this.texture.height)\r\n    this.clearLineBatch = new RectangleBatch(gl)\r\n    this.clearLineBatch.addRect(Rect.unit, new Color(0, 0, 0, 0))\r\n\r\n    // All of the cached data is stored GPU-side, and we don't retain a copy of\r\n    // it client-side. This means when we get a context loss event, the data is\r\n    // totally gone. So let's clear our CPU-side cache to reflect that fact.\r\n    gl.addContextResetHandler(() => {\r\n      this.rowCache.clear()\r\n    })\r\n  }\r\n\r\n  has(key: K) {\r\n    return this.rowCache.has(key)\r\n  }\r\n  getResolution() {\r\n    return this.texture.width\r\n  }\r\n  getCapacity() {\r\n    return this.texture.height\r\n  }\r\n\r\n  private allocateLine(key: K): number {\r\n    if (this.rowCache.getSize() < this.rowCache.getCapacity()) {\r\n      // Not in cache, but cache isn't full\r\n      const row = this.rowCache.getSize()\r\n      this.rowCache.insert(key, row)\r\n      return row\r\n    } else {\r\n      // Not in cache, and cache is full. Evict something.\r\n      const [, row] = this.rowCache.removeLRU()!\r\n      this.rowCache.insert(key, row)\r\n      return row\r\n    }\r\n  }\r\n\r\n  writeToAtlasIfNeeded(keys: K[], render: (textureDstRect: Rect, key: K) => void) {\r\n    renderInto(this.gl, this.renderTarget, () => {\r\n      for (let key of keys) {\r\n        let row = this.rowCache.get(key)\r\n        if (row != null) {\r\n          // Already cached!\r\n          continue\r\n        }\r\n        // Not cached -- we'll have to actually render\r\n        row = this.allocateLine(key)\r\n\r\n        const textureRect = new Rect(new Vec2(0, row), new Vec2(this.texture.width, 1))\r\n        this.rectangleBatchRenderer.render({\r\n          batch: this.clearLineBatch,\r\n          configSpaceSrcRect: Rect.unit,\r\n          physicalSpaceDstRect: textureRect,\r\n        })\r\n        render(textureRect, key)\r\n      }\r\n    })\r\n  }\r\n\r\n  renderViaAtlas(key: K, dstRect: Rect): boolean {\r\n    let row = this.rowCache.get(key)\r\n    if (row == null) {\r\n      return false\r\n    }\r\n\r\n    const textureRect = new Rect(new Vec2(0, row), new Vec2(this.texture.width, 1))\r\n\r\n    // At this point, we have the row in cache, and we can\r\n    // paint directly from it into the framebuffer.\r\n    this.textureRenderer.render({\r\n      texture: this.texture,\r\n      srcRect: textureRect,\r\n      dstRect: dstRect,\r\n    })\r\n    return true\r\n  }\r\n}\r\n","import {Vec2, Rect, AffineTransform} from '../lib/math'\r\nimport {Graphics} from './graphics'\r\nimport {setUniformAffineTransform} from './utils'\r\n\r\nexport interface TextureRendererProps {\r\n  texture: Graphics.Texture\r\n  srcRect: Rect\r\n  dstRect: Rect\r\n}\r\n\r\nconst vert = `\r\n  uniform mat3 uvTransform;\r\n  uniform mat3 positionTransform;\r\n\r\n  attribute vec2 position;\r\n  attribute vec2 uv;\r\n  varying vec2 vUv;\r\n\r\n  void main() {\r\n    vUv = (uvTransform * vec3(uv, 1)).xy;\r\n    gl_Position = vec4((positionTransform * vec3(position, 1)).xy, 0, 1);\r\n  }\r\n`\r\n\r\nconst frag = `\r\n  precision mediump float;\r\n\r\n  varying vec2 vUv;\r\n  uniform sampler2D texture;\r\n\r\n  void main() {\r\n   gl_FragColor = texture2D(texture, vUv);\r\n  }\r\n`\r\n\r\nexport interface TextureRendererProps {\r\n  texture: Graphics.Texture\r\n  srcRect: Rect\r\n  dstRect: Rect\r\n}\r\n\r\nexport class TextureRenderer {\r\n  private buffer: Graphics.VertexBuffer\r\n  private material: Graphics.Material\r\n\r\n  constructor(private gl: Graphics.Context) {\r\n    const vertexFormat = new Graphics.VertexFormat()\r\n    vertexFormat.add('position', Graphics.AttributeType.FLOAT, 2)\r\n    vertexFormat.add('uv', Graphics.AttributeType.FLOAT, 2)\r\n\r\n    const vertices = [\r\n      {pos: [-1, 1], uv: [0, 1]},\r\n      {pos: [1, 1], uv: [1, 1]},\r\n      {pos: [-1, -1], uv: [0, 0]},\r\n      {pos: [1, -1], uv: [1, 0]},\r\n    ]\r\n    const floats: number[] = []\r\n    for (let v of vertices) {\r\n      floats.push(v.pos[0])\r\n      floats.push(v.pos[1])\r\n      floats.push(v.uv[0])\r\n      floats.push(v.uv[1])\r\n    }\r\n\r\n    this.buffer = gl.createVertexBuffer(vertexFormat.stride * vertices.length)\r\n    this.buffer.upload(new Uint8Array(new Float32Array(floats).buffer))\r\n    this.material = gl.createMaterial(vertexFormat, vert, frag)\r\n  }\r\n\r\n  render(props: TextureRendererProps) {\r\n    this.material.setUniformSampler('texture', props.texture, 0)\r\n    setUniformAffineTransform(\r\n      this.material,\r\n      'uvTransform',\r\n      (() => {\r\n        const {srcRect, texture} = props\r\n        const physicalToUV = AffineTransform.withTranslation(new Vec2(0, 1))\r\n          .times(AffineTransform.withScale(new Vec2(1, -1)))\r\n          .times(\r\n            AffineTransform.betweenRects(\r\n              new Rect(Vec2.zero, new Vec2(texture.width, texture.height)),\r\n              Rect.unit,\r\n            ),\r\n          )\r\n        const uvRect = physicalToUV.transformRect(srcRect)\r\n        return AffineTransform.betweenRects(Rect.unit, uvRect)\r\n      })(),\r\n    )\r\n    setUniformAffineTransform(\r\n      this.material,\r\n      'positionTransform',\r\n      (() => {\r\n        const {dstRect} = props\r\n\r\n        const {viewport} = this.gl\r\n        const viewportSize = new Vec2(viewport.width, viewport.height)\r\n\r\n        const physicalToNDC = AffineTransform.withScale(new Vec2(1, -1)).times(\r\n          AffineTransform.betweenRects(new Rect(Vec2.zero, viewportSize), Rect.NDC),\r\n        )\r\n        const ndcRect = physicalToNDC.transformRect(dstRect)\r\n        return AffineTransform.betweenRects(Rect.NDC, ndcRect)\r\n      })(),\r\n    )\r\n\r\n    this.gl.setUnpremultipliedBlendState()\r\n    this.gl.draw(Graphics.Primitive.TRIANGLE_STRIP, this.material, this.buffer)\r\n  }\r\n}\r\n","import {Color} from '../lib/color'\r\nimport {AffineTransform, Rect} from '../lib/math'\r\nimport {Theme} from '../views/themes/theme'\r\nimport {Graphics} from './graphics'\r\nimport {setUniformAffineTransform, setUniformVec2} from './utils'\r\n\r\nexport interface ViewportRectangleRendererProps {\r\n  configSpaceToPhysicalViewSpace: AffineTransform\r\n  configSpaceViewportRect: Rect\r\n}\r\n\r\nconst vertexFormat = new Graphics.VertexFormat()\r\nvertexFormat.add('position', Graphics.AttributeType.FLOAT, 2)\r\n\r\nconst vert = `\r\n  attribute vec2 position;\r\n\r\n  void main() {\r\n    gl_Position = vec4(position, 0, 1);\r\n  }\r\n`\r\n\r\nconst frag = (theme: Theme) => {\r\n  const {r, g, b} = Color.fromCSSHex(theme.fgSecondaryColor)\r\n  const rgb = `${r.toFixed(1)}, ${g.toFixed(1)}, ${b.toFixed(1)}`\r\n  return `\r\n    precision mediump float;\r\n\r\n    uniform mat3 configSpaceToPhysicalViewSpace;\r\n    uniform vec2 physicalSize;\r\n    uniform vec2 physicalOrigin;\r\n    uniform vec2 configSpaceViewportOrigin;\r\n    uniform vec2 configSpaceViewportSize;\r\n    uniform float framebufferHeight;\r\n\r\n    void main() {\r\n      vec2 origin = (configSpaceToPhysicalViewSpace * vec3(configSpaceViewportOrigin, 1.0)).xy;\r\n      vec2 size = (configSpaceToPhysicalViewSpace * vec3(configSpaceViewportSize, 0.0)).xy;\r\n\r\n      vec2 halfSize = physicalSize / 2.0;\r\n\r\n      float borderWidth = 2.0;\r\n\r\n      origin = floor(origin * halfSize) / halfSize + borderWidth * vec2(1.0, 1.0);\r\n      size = floor(size * halfSize) / halfSize - 2.0 * borderWidth * vec2(1.0, 1.0);\r\n\r\n      vec2 coord = gl_FragCoord.xy;\r\n      coord.x = coord.x - physicalOrigin.x;\r\n      coord.y = framebufferHeight - coord.y - physicalOrigin.y;\r\n      vec2 clamped = clamp(coord, origin, origin + size);\r\n      vec2 gap = clamped - coord;\r\n      float maxdist = max(abs(gap.x), abs(gap.y));\r\n\r\n      // TOOD(jlfwong): Could probably optimize this to use mix somehow.\r\n      if (maxdist == 0.0) {\r\n        // Inside viewport rectangle\r\n        gl_FragColor = vec4(0, 0, 0, 0);\r\n      } else if (maxdist < borderWidth) {\r\n        // Inside viewport rectangle at border\r\n        gl_FragColor = vec4(${rgb}, 0.8);\r\n      } else {\r\n        // Outside viewport rectangle\r\n        gl_FragColor = vec4(${rgb}, 0.5);\r\n      }\r\n    }\r\n  `\r\n}\r\n\r\nexport class ViewportRectangleRenderer {\r\n  private material: Graphics.Material\r\n  private buffer: Graphics.VertexBuffer\r\n\r\n  constructor(private gl: Graphics.Context, theme: Theme) {\r\n    const vertices = [\r\n      [-1, 1],\r\n      [1, 1],\r\n      [-1, -1],\r\n      [1, -1],\r\n    ]\r\n    const floats: number[] = []\r\n    for (let v of vertices) {\r\n      floats.push(v[0])\r\n      floats.push(v[1])\r\n    }\r\n    this.buffer = gl.createVertexBuffer(vertexFormat.stride * vertices.length)\r\n    this.buffer.upload(new Uint8Array(new Float32Array(floats).buffer))\r\n    this.material = gl.createMaterial(vertexFormat, vert, frag(theme))\r\n  }\r\n\r\n  render(props: ViewportRectangleRendererProps) {\r\n    setUniformAffineTransform(\r\n      this.material,\r\n      'configSpaceToPhysicalViewSpace',\r\n      props.configSpaceToPhysicalViewSpace,\r\n    )\r\n\r\n    // TODO(jlfwong): Pack these into a Vec4 instead\r\n    setUniformVec2(this.material, 'configSpaceViewportOrigin', props.configSpaceViewportRect.origin)\r\n    setUniformVec2(this.material, 'configSpaceViewportSize', props.configSpaceViewportRect.size)\r\n    // TODO(jlfwong): Pack these into a Vec4 instead\r\n\r\n    const viewport = this.gl.viewport\r\n    this.material.setUniformVec2('physicalOrigin', viewport.x, viewport.y)\r\n    this.material.setUniformVec2('physicalSize', viewport.width, viewport.height)\r\n\r\n    this.material.setUniformFloat('framebufferHeight', this.gl.renderTargetHeightInPixels)\r\n\r\n    this.gl.setBlendState(\r\n      Graphics.BlendOperation.SOURCE_ALPHA,\r\n      Graphics.BlendOperation.INVERSE_SOURCE_ALPHA,\r\n    )\r\n    this.gl.draw(Graphics.Primitive.TRIANGLE_STRIP, this.material, this.buffer)\r\n  }\r\n}\r\n","import {Vec2, Rect, AffineTransform} from '../lib/math'\r\nimport {Theme} from '../views/themes/theme'\r\nimport {Graphics} from './graphics'\r\nimport {setUniformAffineTransform} from './utils'\r\n\r\nconst vertexFormat = new Graphics.VertexFormat()\r\nvertexFormat.add('position', Graphics.AttributeType.FLOAT, 2)\r\nvertexFormat.add('uv', Graphics.AttributeType.FLOAT, 2)\r\n\r\nconst vert = `\r\n  uniform mat3 uvTransform;\r\n  uniform mat3 positionTransform;\r\n\r\n  attribute vec2 position;\r\n  attribute vec2 uv;\r\n  varying vec2 vUv;\r\n\r\n  void main() {\r\n    vUv = (uvTransform * vec3(uv, 1)).xy;\r\n    gl_Position = vec4((positionTransform * vec3(position, 1)).xy, 0, 1);\r\n  }\r\n`\r\n\r\nconst frag = (colorForBucket: string) => `\r\n  precision mediump float;\r\n\r\n  uniform vec2 uvSpacePixelSize;\r\n  uniform float renderOutlines;\r\n\r\n  varying vec2 vUv;\r\n  uniform sampler2D colorTexture;\r\n\r\n  // https://en.wikipedia.org/wiki/HSL_and_HSV#From_luma/chroma/hue\r\n  vec3 hcl2rgb(float H, float C, float L) {\r\n    float hPrime = H / 60.0;\r\n    float X = C * (1.0 - abs(mod(hPrime, 2.0) - 1.0));\r\n    vec3 RGB =\r\n      hPrime < 1.0 ? vec3(C, X, 0) :\r\n      hPrime < 2.0 ? vec3(X, C, 0) :\r\n      hPrime < 3.0 ? vec3(0, C, X) :\r\n      hPrime < 4.0 ? vec3(0, X, C) :\r\n      hPrime < 5.0 ? vec3(X, 0, C) :\r\n      vec3(C, 0, X);\r\n\r\n    float m = L - dot(RGB, vec3(0.30, 0.59, 0.11));\r\n    return RGB + vec3(m, m, m);\r\n  }\r\n\r\n  float triangle(float x) {\r\n    return 2.0 * abs(fract(x) - 0.5) - 1.0;\r\n  }\r\n\r\n  ${colorForBucket}\r\n\r\n  void main() {\r\n    vec4 here = texture2D(colorTexture, vUv);\r\n\r\n    if (here.z == 0.0) {\r\n      // Background color\r\n      gl_FragColor = vec4(0, 0, 0, 0);\r\n      return;\r\n    }\r\n\r\n    // Sample the 4 surrounding pixels in the depth texture to determine\r\n    // if we should draw a boundary here or not.\r\n    vec4 N = texture2D(colorTexture, vUv + vec2(0, uvSpacePixelSize.y));\r\n    vec4 E = texture2D(colorTexture, vUv + vec2(uvSpacePixelSize.x, 0));\r\n    vec4 S = texture2D(colorTexture, vUv + vec2(0, -uvSpacePixelSize.y));\r\n    vec4 W = texture2D(colorTexture, vUv + vec2(-uvSpacePixelSize.x, 0));\r\n\r\n    // NOTE: For outline checks, we intentionally check both the right\r\n    // and the left to determine if we're an edge. If a rectangle is a single\r\n    // pixel wide, we don't want to render it as an outline, so this method\r\n    // of checking ensures that we don't outline single physical-space\r\n    // pixel width rectangles.\r\n    if (\r\n      renderOutlines > 0.0 &&\r\n      (\r\n        here.y == N.y && here.y != S.y || // Top edge\r\n        here.y == S.y && here.y != N.y || // Bottom edge\r\n        here.x == E.x && here.x != W.x || // Left edge\r\n        here.x == W.x && here.x != E.x\r\n      )\r\n    ) {\r\n      // We're on an edge! Draw transparent.\r\n      gl_FragColor = vec4(0, 0, 0, 0);\r\n    } else {\r\n      // Not on an edge. Draw the appropriate color.\r\n      gl_FragColor = vec4(colorForBucket(here.z), here.a);\r\n    }\r\n  }\r\n`\r\n\r\nexport interface FlamechartColorPassRenderProps {\r\n  rectInfoTexture: Graphics.Texture\r\n  renderOutlines: boolean\r\n  srcRect: Rect\r\n  dstRect: Rect\r\n}\r\n\r\nexport class FlamechartColorPassRenderer {\r\n  private material: Graphics.Material\r\n  private buffer: Graphics.VertexBuffer\r\n\r\n  constructor(private gl: Graphics.Context, theme: Theme) {\r\n    const vertices = [\r\n      {pos: [-1, 1], uv: [0, 1]},\r\n      {pos: [1, 1], uv: [1, 1]},\r\n      {pos: [-1, -1], uv: [0, 0]},\r\n      {pos: [1, -1], uv: [1, 0]},\r\n    ]\r\n    const floats: number[] = []\r\n    for (let v of vertices) {\r\n      floats.push(v.pos[0])\r\n      floats.push(v.pos[1])\r\n      floats.push(v.uv[0])\r\n      floats.push(v.uv[1])\r\n    }\r\n\r\n    this.buffer = gl.createVertexBuffer(vertexFormat.stride * vertices.length)\r\n    this.buffer.uploadFloats(floats)\r\n    this.material = gl.createMaterial(vertexFormat, vert, frag(theme.colorForBucketGLSL))\r\n  }\r\n\r\n  render(props: FlamechartColorPassRenderProps) {\r\n    const {srcRect, rectInfoTexture} = props\r\n    const physicalToUV = AffineTransform.withTranslation(new Vec2(0, 1))\r\n      .times(AffineTransform.withScale(new Vec2(1, -1)))\r\n      .times(\r\n        AffineTransform.betweenRects(\r\n          new Rect(Vec2.zero, new Vec2(rectInfoTexture.width, rectInfoTexture.height)),\r\n          Rect.unit,\r\n        ),\r\n      )\r\n    const uvRect = physicalToUV.transformRect(srcRect)\r\n    const uvTransform = AffineTransform.betweenRects(Rect.unit, uvRect)\r\n\r\n    const {dstRect} = props\r\n    const viewportSize = new Vec2(this.gl.viewport.width, this.gl.viewport.height)\r\n\r\n    const physicalToNDC = AffineTransform.withScale(new Vec2(1, -1)).times(\r\n      AffineTransform.betweenRects(new Rect(Vec2.zero, viewportSize), Rect.NDC),\r\n    )\r\n    const ndcRect = physicalToNDC.transformRect(dstRect)\r\n    const positionTransform = AffineTransform.betweenRects(Rect.NDC, ndcRect)\r\n\r\n    const uvSpacePixelSize = Vec2.unit.dividedByPointwise(\r\n      new Vec2(props.rectInfoTexture.width, props.rectInfoTexture.height),\r\n    )\r\n\r\n    this.material.setUniformSampler('colorTexture', props.rectInfoTexture, 0)\r\n    setUniformAffineTransform(this.material, 'uvTransform', uvTransform)\r\n    this.material.setUniformFloat('renderOutlines', props.renderOutlines ? 1.0 : 0.0)\r\n    this.material.setUniformVec2('uvSpacePixelSize', uvSpacePixelSize.x, uvSpacePixelSize.y)\r\n    setUniformAffineTransform(this.material, 'positionTransform', positionTransform)\r\n\r\n    this.gl.setUnpremultipliedBlendState()\r\n    this.gl.draw(Graphics.Primitive.TRIANGLE_STRIP, this.material, this.buffer)\r\n  }\r\n}\r\n","import {Graphics, WebGL} from './graphics'\r\nimport {RectangleBatchRenderer} from './rectangle-batch-renderer'\r\nimport {TextureRenderer} from './texture-renderer'\r\nimport {Rect, Vec2} from '../lib/math'\r\nimport {ViewportRectangleRenderer} from './overlay-rectangle-renderer'\r\nimport {FlamechartColorPassRenderer} from './flamechart-color-pass-renderer'\r\nimport {Color} from '../lib/color'\r\nimport {Theme} from '../views/themes/theme'\r\n\r\ntype FrameCallback = () => void\r\n\r\nexport class CanvasContext {\r\n  public readonly gl: WebGL.Context\r\n  public readonly rectangleBatchRenderer: RectangleBatchRenderer\r\n  public readonly textureRenderer: TextureRenderer\r\n  public readonly viewportRectangleRenderer: ViewportRectangleRenderer\r\n  public readonly flamechartColorPassRenderer: FlamechartColorPassRenderer\r\n  public readonly theme: Theme\r\n\r\n  constructor(canvas: HTMLCanvasElement, theme: Theme) {\r\n    this.gl = new WebGL.Context(canvas)\r\n    this.rectangleBatchRenderer = new RectangleBatchRenderer(this.gl)\r\n    this.textureRenderer = new TextureRenderer(this.gl)\r\n    this.viewportRectangleRenderer = new ViewportRectangleRenderer(this.gl, theme)\r\n    this.flamechartColorPassRenderer = new FlamechartColorPassRenderer(this.gl, theme)\r\n    this.theme = theme\r\n\r\n    // Whenever the canvas is resized, draw immediately. This prevents\r\n    // flickering during resizing.\r\n    this.gl.addAfterResizeEventHandler(this.onBeforeFrame)\r\n\r\n    const webGLInfo = this.gl.getWebGLInfo()\r\n    if (webGLInfo) {\r\n      console.log(\r\n        `WebGL initialized. renderer: ${webGLInfo.renderer}, vendor: ${webGLInfo.vendor}, version: ${webGLInfo.version}`,\r\n      )\r\n    }\r\n    ;(window as any)['testContextLoss'] = () => {\r\n      this.gl.testContextLoss()\r\n    }\r\n  }\r\n\r\n  private animationFrameRequest: number | null = null\r\n  private beforeFrameHandlers = new Set<FrameCallback>()\r\n  addBeforeFrameHandler(callback: FrameCallback) {\r\n    this.beforeFrameHandlers.add(callback)\r\n  }\r\n  removeBeforeFrameHandler(callback: FrameCallback) {\r\n    this.beforeFrameHandlers.delete(callback)\r\n  }\r\n  requestFrame() {\r\n    if (!this.animationFrameRequest) {\r\n      this.animationFrameRequest = requestAnimationFrame(this.onBeforeFrame)\r\n    }\r\n  }\r\n  private onBeforeFrame = () => {\r\n    this.animationFrameRequest = null\r\n    this.gl.setViewport(0, 0, this.gl.renderTargetWidthInPixels, this.gl.renderTargetHeightInPixels)\r\n    const color = Color.fromCSSHex(this.theme.bgPrimaryColor)\r\n    this.gl.clear(new Graphics.Color(color.r, color.g, color.b, color.a))\r\n\r\n    for (const handler of this.beforeFrameHandlers) {\r\n      handler()\r\n    }\r\n  }\r\n\r\n  setViewport(physicalBounds: Rect, cb: () => void): void {\r\n    const {origin, size} = physicalBounds\r\n    let viewportBefore = this.gl.viewport\r\n    this.gl.setViewport(origin.x, origin.y, size.x, size.y)\r\n\r\n    cb()\r\n\r\n    let {x, y, width, height} = viewportBefore\r\n    this.gl.setViewport(x, y, width, height)\r\n  }\r\n\r\n  renderBehind(el: Element, cb: () => void) {\r\n    const bounds = el.getBoundingClientRect()\r\n    const physicalBounds = new Rect(\r\n      new Vec2(bounds.left * window.devicePixelRatio, bounds.top * window.devicePixelRatio),\r\n      new Vec2(bounds.width * window.devicePixelRatio, bounds.height * window.devicePixelRatio),\r\n    )\r\n\r\n    this.setViewport(physicalBounds, cb)\r\n  }\r\n}\r\n","import {Frame, Profile} from '../lib/profile'\r\nimport {memoizeByReference, memoizeByShallowEquality} from '../lib/utils'\r\nimport {RowAtlas} from '../gl/row-atlas'\r\nimport {CanvasContext} from '../gl/canvas-context'\r\nimport {FlamechartRowAtlasKey} from '../gl/flamechart-renderer'\r\nimport {Theme} from '../views/themes/theme'\r\n\r\nexport const createGetColorBucketForFrame = memoizeByReference(\r\n  (frameToColorBucket: Map<number | string, number>) => {\r\n    return (frame: Frame): number => {\r\n      return frameToColorBucket.get(frame.key) || 0\r\n    }\r\n  },\r\n)\r\n\r\nexport const createGetCSSColorForFrame = memoizeByShallowEquality(\r\n  ({\r\n    theme,\r\n    frameToColorBucket,\r\n  }: {\r\n    theme: Theme\r\n    frameToColorBucket: Map<number | string, number>\r\n  }) => {\r\n    const getColorBucketForFrame = createGetColorBucketForFrame(frameToColorBucket)\r\n    return (frame: Frame): string => {\r\n      const t = getColorBucketForFrame(frame) / 255\r\n      return theme.colorForBucket(t).toCSS()\r\n    }\r\n  },\r\n)\r\n\r\nexport const getCanvasContext = memoizeByShallowEquality(\r\n  ({theme, canvas}: {theme: Theme; canvas: HTMLCanvasElement}) => {\r\n    return new CanvasContext(canvas, theme)\r\n  },\r\n)\r\n\r\nexport const getRowAtlas = memoizeByReference((canvasContext: CanvasContext) => {\r\n  return new RowAtlas<FlamechartRowAtlasKey>(\r\n    canvasContext.gl,\r\n    canvasContext.rectangleBatchRenderer,\r\n    canvasContext.textureRenderer,\r\n  )\r\n})\r\n\r\nexport const getProfileToView = memoizeByShallowEquality(\r\n  ({profile, flattenRecursion}: {profile: Profile; flattenRecursion: boolean}): Profile => {\r\n    return flattenRecursion ? profile.getProfileWithRecursionFlattened() : profile\r\n  },\r\n)\r\nexport const getFrameToColorBucket = memoizeByReference(\r\n  (profile: Profile): Map<string | number, number> => {\r\n    const frames: Frame[] = []\r\n    profile.forEachFrame(f => frames.push(f))\r\n    function key(f: Frame) {\r\n      return (f.file || '') + f.name\r\n    }\r\n    function compare(a: Frame, b: Frame) {\r\n      return key(a) > key(b) ? 1 : -1\r\n    }\r\n    frames.sort(compare)\r\n    const frameToColorBucket = new Map<string | number, number>()\r\n    for (let i = 0; i < frames.length; i++) {\r\n      frameToColorBucket.set(frames[i].key, Math.floor((255 * i) / frames.length))\r\n    }\r\n\r\n    return frameToColorBucket\r\n  },\r\n)\r\n","import { options } from 'preact';\n\n/** @type {number} */\nlet currentIndex;\n\n/** @type {import('./internal').Component} */\nlet currentComponent;\n\n/** @type {number} */\nlet currentHook = 0;\n\n/** @type {Array<import('./internal').Component>} */\nlet afterPaintEffects = [];\n\nlet oldBeforeRender = options._render;\nlet oldAfterDiff = options.diffed;\nlet oldCommit = options._commit;\nlet oldBeforeUnmount = options.unmount;\n\nconst RAF_TIMEOUT = 100;\nlet prevRaf;\n\noptions._render = vnode => {\n\tif (oldBeforeRender) oldBeforeRender(vnode);\n\n\tcurrentComponent = vnode._component;\n\tcurrentIndex = 0;\n\n\tif (currentComponent.__hooks) {\n\t\tcurrentComponent.__hooks._pendingEffects.forEach(invokeCleanup);\n\t\tcurrentComponent.__hooks._pendingEffects.forEach(invokeEffect);\n\t\tcurrentComponent.__hooks._pendingEffects = [];\n\t}\n};\n\noptions.diffed = vnode => {\n\tif (oldAfterDiff) oldAfterDiff(vnode);\n\n\tconst c = vnode._component;\n\tif (!c) return;\n\n\tconst hooks = c.__hooks;\n\tif (hooks) {\n\t\tif (hooks._pendingEffects.length) {\n\t\t\tafterPaint(afterPaintEffects.push(c));\n\t\t}\n\t}\n};\n\noptions._commit = (vnode, commitQueue) => {\n\tcommitQueue.some(component => {\n\t\ttry {\n\t\t\tcomponent._renderCallbacks.forEach(invokeCleanup);\n\t\t\tcomponent._renderCallbacks = component._renderCallbacks.filter(cb =>\n\t\t\t\tcb._value ? invokeEffect(cb) : true\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tcommitQueue.some(c => {\n\t\t\t\tif (c._renderCallbacks) c._renderCallbacks = [];\n\t\t\t});\n\t\t\tcommitQueue = [];\n\t\t\toptions._catchError(e, component._vnode);\n\t\t}\n\t});\n\n\tif (oldCommit) oldCommit(vnode, commitQueue);\n};\n\noptions.unmount = vnode => {\n\tif (oldBeforeUnmount) oldBeforeUnmount(vnode);\n\n\tconst c = vnode._component;\n\tif (!c) return;\n\n\tconst hooks = c.__hooks;\n\tif (hooks) {\n\t\ttry {\n\t\t\thooks._list.forEach(hook => hook._cleanup && hook._cleanup());\n\t\t} catch (e) {\n\t\t\toptions._catchError(e, c._vnode);\n\t\t}\n\t}\n};\n\n/**\n * Get a hook's state from the currentComponent\n * @param {number} index The index of the hook to get\n * @param {number} type The index of the hook to get\n * @returns {import('./internal').HookState}\n */\nfunction getHookState(index, type) {\n\tif (options._hook) {\n\t\toptions._hook(currentComponent, index, currentHook || type);\n\t}\n\tcurrentHook = 0;\n\n\t// Largely inspired by:\n\t// * https://github.com/michael-klein/funcy.js/blob/f6be73468e6ec46b0ff5aa3cc4c9baf72a29025a/src/hooks/core_hooks.mjs\n\t// * https://github.com/michael-klein/funcy.js/blob/650beaa58c43c33a74820a3c98b3c7079cf2e333/src/renderer.mjs\n\t// Other implementations to look at:\n\t// * https://codesandbox.io/s/mnox05qp8\n\tconst hooks =\n\t\tcurrentComponent.__hooks ||\n\t\t(currentComponent.__hooks = {\n\t\t\t_list: [],\n\t\t\t_pendingEffects: []\n\t\t});\n\n\tif (index >= hooks._list.length) {\n\t\thooks._list.push({});\n\t}\n\treturn hooks._list[index];\n}\n\n/**\n * @param {import('./index').StateUpdater<any>} initialState\n */\nexport function useState(initialState) {\n\tcurrentHook = 1;\n\treturn useReducer(invokeOrReturn, initialState);\n}\n\n/**\n * @param {import('./index').Reducer<any, any>} reducer\n * @param {import('./index').StateUpdater<any>} initialState\n * @param {(initialState: any) => void} [init]\n * @returns {[ any, (state: any) => void ]}\n */\nexport function useReducer(reducer, initialState, init) {\n\t/** @type {import('./internal').ReducerHookState} */\n\tconst hookState = getHookState(currentIndex++, 2);\n\tif (!hookState._component) {\n\t\thookState._component = currentComponent;\n\n\t\thookState._value = [\n\t\t\t!init ? invokeOrReturn(undefined, initialState) : init(initialState),\n\n\t\t\taction => {\n\t\t\t\tconst nextValue = reducer(hookState._value[0], action);\n\t\t\t\tif (hookState._value[0] !== nextValue) {\n\t\t\t\t\thookState._value[0] = nextValue;\n\t\t\t\t\thookState._component.setState({});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t}\n\n\treturn hookState._value;\n}\n\n/**\n * @param {import('./internal').Effect} callback\n * @param {any[]} args\n */\nexport function useEffect(callback, args) {\n\t/** @type {import('./internal').EffectHookState} */\n\tconst state = getHookState(currentIndex++, 3);\n\tif (!options._skipEffects && argsChanged(state._args, args)) {\n\t\tstate._value = callback;\n\t\tstate._args = args;\n\n\t\tcurrentComponent.__hooks._pendingEffects.push(state);\n\t}\n}\n\n/**\n * @param {import('./internal').Effect} callback\n * @param {any[]} args\n */\nexport function useLayoutEffect(callback, args) {\n\t/** @type {import('./internal').EffectHookState} */\n\tconst state = getHookState(currentIndex++, 4);\n\tif (!options._skipEffects && argsChanged(state._args, args)) {\n\t\tstate._value = callback;\n\t\tstate._args = args;\n\n\t\tcurrentComponent._renderCallbacks.push(state);\n\t}\n}\n\nexport function useRef(initialValue) {\n\tcurrentHook = 5;\n\treturn useMemo(() => ({ current: initialValue }), []);\n}\n\n/**\n * @param {object} ref\n * @param {() => object} createHandle\n * @param {any[]} args\n */\nexport function useImperativeHandle(ref, createHandle, args) {\n\tcurrentHook = 6;\n\tuseLayoutEffect(\n\t\t() => {\n\t\t\tif (typeof ref == 'function') ref(createHandle());\n\t\t\telse if (ref) ref.current = createHandle();\n\t\t},\n\t\targs == null ? args : args.concat(ref)\n\t);\n}\n\n/**\n * @param {() => any} factory\n * @param {any[]} args\n */\nexport function useMemo(factory, args) {\n\t/** @type {import('./internal').MemoHookState} */\n\tconst state = getHookState(currentIndex++, 7);\n\tif (argsChanged(state._args, args)) {\n\t\tstate._args = args;\n\t\tstate._factory = factory;\n\t\treturn (state._value = factory());\n\t}\n\n\treturn state._value;\n}\n\n/**\n * @param {() => void} callback\n * @param {any[]} args\n */\nexport function useCallback(callback, args) {\n\tcurrentHook = 8;\n\treturn useMemo(() => callback, args);\n}\n\n/**\n * @param {import('./internal').PreactContext} context\n */\nexport function useContext(context) {\n\tconst provider = currentComponent.context[context._id];\n\t// We could skip this call here, but than we'd not call\n\t// `options._hook`. We need to do that in order to make\n\t// the devtools aware of this hook.\n\tconst state = getHookState(currentIndex++, 9);\n\t// The devtools needs access to the context object to\n\t// be able to pull of the default value when no provider\n\t// is present in the tree.\n\tstate._context = context;\n\tif (!provider) return context._defaultValue;\n\t// This is probably not safe to convert to \"!\"\n\tif (state._value == null) {\n\t\tstate._value = true;\n\t\tprovider.sub(currentComponent);\n\t}\n\treturn provider.props.value;\n}\n\n/**\n * Display a custom label for a custom hook for the devtools panel\n * @type {<T>(value: T, cb?: (value: T) => string | number) => void}\n */\nexport function useDebugValue(value, formatter) {\n\tif (options.useDebugValue) {\n\t\toptions.useDebugValue(formatter ? formatter(value) : value);\n\t}\n}\n\nexport function useErrorBoundary(cb) {\n\tconst state = getHookState(currentIndex++, 10);\n\tconst errState = useState();\n\tstate._value = cb;\n\tif (!currentComponent.componentDidCatch) {\n\t\tcurrentComponent.componentDidCatch = err => {\n\t\t\tif (state._value) state._value(err);\n\t\t\terrState[1](err);\n\t\t};\n\t}\n\treturn [\n\t\terrState[0],\n\t\t() => {\n\t\t\terrState[1](undefined);\n\t\t}\n\t];\n}\n\n/**\n * After paint effects consumer.\n */\nfunction flushAfterPaintEffects() {\n\tafterPaintEffects.some(component => {\n\t\tif (component._parentDom) {\n\t\t\ttry {\n\t\t\t\tcomponent.__hooks._pendingEffects.forEach(invokeCleanup);\n\t\t\t\tcomponent.__hooks._pendingEffects.forEach(invokeEffect);\n\t\t\t\tcomponent.__hooks._pendingEffects = [];\n\t\t\t} catch (e) {\n\t\t\t\tcomponent.__hooks._pendingEffects = [];\n\t\t\t\toptions._catchError(e, component._vnode);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t});\n\tafterPaintEffects = [];\n}\n\n/**\n * Schedule a callback to be invoked after the browser has a chance to paint a new frame.\n * Do this by combining requestAnimationFrame (rAF) + setTimeout to invoke a callback after\n * the next browser frame.\n *\n * Also, schedule a timeout in parallel to the the rAF to ensure the callback is invoked\n * even if RAF doesn't fire (for example if the browser tab is not visible)\n *\n * @param {() => void} callback\n */\nfunction afterNextFrame(callback) {\n\tconst done = () => {\n\t\tclearTimeout(timeout);\n\t\tcancelAnimationFrame(raf);\n\t\tsetTimeout(callback);\n\t};\n\tconst timeout = setTimeout(done, RAF_TIMEOUT);\n\n\tlet raf;\n\tif (typeof window != 'undefined') {\n\t\traf = requestAnimationFrame(done);\n\t}\n}\n\n// Note: if someone used options.debounceRendering = requestAnimationFrame,\n// then effects will ALWAYS run on the NEXT frame instead of the current one, incurring a ~16ms delay.\n// Perhaps this is not such a big deal.\n/**\n * Schedule afterPaintEffects flush after the browser paints\n * @param {number} newQueueLength\n */\nfunction afterPaint(newQueueLength) {\n\tif (newQueueLength === 1 || prevRaf !== options.requestAnimationFrame) {\n\t\tprevRaf = options.requestAnimationFrame;\n\t\t(prevRaf || afterNextFrame)(flushAfterPaintEffects);\n\t}\n}\n\n/**\n * @param {import('./internal').EffectHookState} hook\n */\nfunction invokeCleanup(hook) {\n\tif (hook._cleanup) hook._cleanup();\n}\n\n/**\n * Invoke a Hook's effect\n * @param {import('./internal').EffectHookState} hook\n */\nfunction invokeEffect(hook) {\n\tconst result = hook._value();\n\tif (typeof result == 'function') hook._cleanup = result;\n}\n\n/**\n * @param {any[]} oldArgs\n * @param {any[]} newArgs\n */\nfunction argsChanged(oldArgs, newArgs) {\n\treturn !oldArgs || newArgs.some((arg, index) => arg !== oldArgs[index]);\n}\n\nfunction invokeOrReturn(arg, f) {\n\treturn typeof f == 'function' ? f(arg) : f;\n}\n","import { Component } from 'preact';\nimport { shallowDiffers } from './util';\n\n/**\n * Component class with a predefined `shouldComponentUpdate` implementation\n */\nexport class PureComponent extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\t// Some third-party libraries check if this property is present\n\t\tthis.isPureReactComponent = true;\n\t}\n\n\tshouldComponentUpdate(props, state) {\n\t\treturn (\n\t\t\tshallowDiffers(this.props, props) || shallowDiffers(this.state, state)\n\t\t);\n\t}\n}\n","import { createElement } from 'preact';\nimport { shallowDiffers, assign } from './util';\n\n/**\n * Memoize a component, so that it only updates when the props actually have\n * changed. This was previously known as `React.pure`.\n * @param {import('./internal').FunctionalComponent} c functional component\n * @param {(prev: object, next: object) => boolean} [comparer] Custom equality function\n * @returns {import('./internal').FunctionalComponent}\n */\nexport function memo(c, comparer) {\n\tfunction shouldUpdate(nextProps) {\n\t\tlet ref = this.props.ref;\n\t\tlet updateRef = ref == nextProps.ref;\n\t\tif (!updateRef && ref) {\n\t\t\tref.call ? ref(null) : (ref.current = null);\n\t\t}\n\n\t\tif (!comparer) {\n\t\t\treturn shallowDiffers(this.props, nextProps);\n\t\t}\n\n\t\treturn !comparer(this.props, nextProps) || !updateRef;\n\t}\n\n\tfunction Memoed(props) {\n\t\tthis.shouldComponentUpdate = shouldUpdate;\n\t\treturn createElement(c, assign({}, props));\n\t}\n\tMemoed.prototype.isReactComponent = true;\n\tMemoed.displayName = 'Memo(' + (c.displayName || c.name) + ')';\n\tMemoed._forwarded = true;\n\treturn Memoed;\n}\n","import { options } from 'preact';\nimport { assign } from './util';\n\nlet oldDiffHook = options._diff;\noptions._diff = vnode => {\n\tif (vnode.type && vnode.type._forwarded && vnode.ref) {\n\t\tvnode.props.ref = vnode.ref;\n\t\tvnode.ref = null;\n\t}\n\tif (oldDiffHook) oldDiffHook(vnode);\n};\n\n/**\n * Pass ref down to a child. This is mainly used in libraries with HOCs that\n * wrap components. Using `forwardRef` there is an easy way to get a reference\n * of the wrapped component instead of one of the wrapper itself.\n * @param {import('./index').ForwardFn} fn\n * @returns {import('./internal').FunctionalComponent}\n */\nexport function forwardRef(fn) {\n\tfunction Forwarded(props) {\n\t\tlet clone = assign({}, props);\n\t\tdelete clone.ref;\n\t\treturn fn(clone, props.ref);\n\t}\n\tForwarded.prototype.isReactComponent = Forwarded._forwarded = true;\n\tForwarded.displayName = 'ForwardRef(' + (fn.displayName || fn.name) + ')';\n\treturn Forwarded;\n}\n","import { toChildArray } from 'preact';\n\nconst mapFn = (children, fn) => {\n\tif (!children) return null;\n\treturn toChildArray(children).reduce(\n\t\t(acc, value, index) => acc.concat(fn(value, index)),\n\t\t[]\n\t);\n};\n\n// This API is completely unnecessary for Preact, so it's basically passthrough.\nexport const Children = {\n\tmap: mapFn,\n\tforEach: mapFn,\n\tcount(children) {\n\t\treturn children ? toChildArray(children).length : 0;\n\t},\n\tonly(children) {\n\t\tchildren = toChildArray(children);\n\t\tif (children.length !== 1) {\n\t\t\tthrow new Error('Children.only() expects only one child.');\n\t\t}\n\t\treturn children[0];\n\t},\n\ttoArray: toChildArray\n};\n","import { Component, createElement, options } from 'preact';\nimport { assign } from './util';\n\nconst oldCatchError = options._catchError;\noptions._catchError = function(error, newVNode, oldVNode) {\n\tif (error.then) {\n\t\t/** @type {import('./internal').Component} */\n\t\tlet component;\n\t\tlet vnode = newVNode;\n\n\t\tfor (; (vnode = vnode._parent); ) {\n\t\t\tif ((component = vnode._component) && component._childDidSuspend) {\n\t\t\t\t// Don't call oldCatchError if we found a Suspense\n\t\t\t\treturn component._childDidSuspend(error, newVNode._component);\n\t\t\t}\n\t\t}\n\t}\n\toldCatchError(error, newVNode, oldVNode);\n};\n\nfunction detachedClone(vnode) {\n\tif (vnode) {\n\t\tvnode = assign({}, vnode);\n\t\tvnode._component = null;\n\t\tvnode._children = vnode._children && vnode._children.map(detachedClone);\n\t}\n\treturn vnode;\n}\n\n// having custom inheritance instead of a class here saves a lot of bytes\nexport function Suspense() {\n\t// we do not call super here to golf some bytes...\n\tthis._pendingSuspensionCount = 0;\n\tthis._suspenders = null;\n\tthis._detachOnNextRender = null;\n}\n\n// Things we do here to save some bytes but are not proper JS inheritance:\n// - call `new Component()` as the prototype\n// - do not set `Suspense.prototype.constructor` to `Suspense`\nSuspense.prototype = new Component();\n\n/**\n * @param {Promise} promise The thrown promise\n * @param {Component<any, any>} suspendingComponent The suspending component\n */\nSuspense.prototype._childDidSuspend = function(promise, suspendingComponent) {\n\t/** @type {import('./internal').SuspenseComponent} */\n\tconst c = this;\n\n\tif (c._suspenders == null) {\n\t\tc._suspenders = [];\n\t}\n\tc._suspenders.push(suspendingComponent);\n\n\tconst resolve = suspended(c._vnode);\n\n\tlet resolved = false;\n\tconst onResolved = () => {\n\t\tif (resolved) return;\n\n\t\tresolved = true;\n\n\t\tif (resolve) {\n\t\t\tresolve(onSuspensionComplete);\n\t\t} else {\n\t\t\tonSuspensionComplete();\n\t\t}\n\t};\n\n\tsuspendingComponent._suspendedComponentWillUnmount =\n\t\tsuspendingComponent.componentWillUnmount;\n\tsuspendingComponent.componentWillUnmount = () => {\n\t\tonResolved();\n\n\t\tif (suspendingComponent._suspendedComponentWillUnmount) {\n\t\t\tsuspendingComponent._suspendedComponentWillUnmount();\n\t\t}\n\t};\n\n\tconst onSuspensionComplete = () => {\n\t\tif (!--c._pendingSuspensionCount) {\n\t\t\tc._vnode._children[0] = c.state._suspended;\n\t\t\tc.setState({ _suspended: (c._detachOnNextRender = null) });\n\n\t\t\tlet suspended;\n\t\t\twhile ((suspended = c._suspenders.pop())) {\n\t\t\t\tsuspended.forceUpdate();\n\t\t\t}\n\t\t}\n\t};\n\n\tif (!c._pendingSuspensionCount++) {\n\t\tc.setState({ _suspended: (c._detachOnNextRender = c._vnode._children[0]) });\n\t}\n\tpromise.then(onResolved, onResolved);\n};\n\nSuspense.prototype.render = function(props, state) {\n\tif (this._detachOnNextRender) {\n\t\tthis._vnode._children[0] = detachedClone(this._detachOnNextRender);\n\t\tthis._detachOnNextRender = null;\n\t}\n\n\treturn [\n\t\tcreateElement(Component, null, state._suspended ? null : props.children),\n\t\tstate._suspended && props.fallback\n\t];\n};\n\n/**\n * Checks and calls the parent component's _suspended method, passing in the\n * suspended vnode. This is a way for a parent (e.g. SuspenseList) to get notified\n * that one of its children/descendants suspended.\n *\n * The parent MAY return a callback. The callback will get called when the\n * suspension resolves, notifying the parent of the fact.\n * Moreover, the callback gets function `unsuspend` as a parameter. The resolved\n * child descendant will not actually get unsuspended until `unsuspend` gets called.\n * This is a way for the parent to delay unsuspending.\n *\n * If the parent does not return a callback then the resolved vnode\n * gets unsuspended immediately when it resolves.\n *\n * @param {import('../src/internal').VNode} vnode\n * @returns {((unsuspend: () => void) => void)?}\n */\nexport function suspended(vnode) {\n\tlet component = vnode._parent._component;\n\treturn component && component._suspended && component._suspended(vnode);\n}\n\nexport function lazy(loader) {\n\tlet prom;\n\tlet component;\n\tlet error;\n\n\tfunction Lazy(props) {\n\t\tif (!prom) {\n\t\t\tprom = loader();\n\t\t\tprom.then(\n\t\t\t\texports => {\n\t\t\t\t\tcomponent = exports.default || exports;\n\t\t\t\t},\n\t\t\t\te => {\n\t\t\t\t\terror = e;\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tif (error) {\n\t\t\tthrow error;\n\t\t}\n\n\t\tif (!component) {\n\t\t\tthrow prom;\n\t\t}\n\n\t\treturn createElement(component, props);\n\t}\n\n\tLazy.displayName = 'Lazy';\n\tLazy._forwarded = true;\n\treturn Lazy;\n}\n","import { Component, toChildArray } from 'preact';\nimport { suspended } from './suspense.js';\n\n// Indexes to linked list nodes (nodes are stored as arrays to save bytes).\nconst SUSPENDED_COUNT = 0;\nconst RESOLVED_COUNT = 1;\nconst NEXT_NODE = 2;\n\n// Having custom inheritance instead of a class here saves a lot of bytes.\nexport function SuspenseList() {\n\tthis._next = null;\n\tthis._map = null;\n}\n\n// Mark one of child's earlier suspensions as resolved.\n// Some pending callbacks may become callable due to this\n// (e.g. the last suspended descendant gets resolved when\n// revealOrder === 'together'). Process those callbacks as well.\nconst resolve = (list, child, node) => {\n\tif (++node[RESOLVED_COUNT] === node[SUSPENDED_COUNT]) {\n\t\t// The number a child (or any of its descendants) has been suspended\n\t\t// matches the number of times it's been resolved. Therefore we\n\t\t// mark the child as completely resolved by deleting it from ._map.\n\t\t// This is used to figure out when *all* children have been completely\n\t\t// resolved when revealOrder is 'together'.\n\t\tlist._map.delete(child);\n\t}\n\n\t// If revealOrder is falsy then we can do an early exit, as the\n\t// callbacks won't get queued in the node anyway.\n\t// If revealOrder is 'together' then also do an early exit\n\t// if all suspended descendants have not yet been resolved.\n\tif (\n\t\t!list.props.revealOrder ||\n\t\t(list.props.revealOrder[0] === 't' && list._map.size)\n\t) {\n\t\treturn;\n\t}\n\n\t// Walk the currently suspended children in order, calling their\n\t// stored callbacks on the way. Stop if we encounter a child that\n\t// has not been completely resolved yet.\n\tnode = list._next;\n\twhile (node) {\n\t\twhile (node.length > 3) {\n\t\t\tnode.pop()();\n\t\t}\n\t\tif (node[RESOLVED_COUNT] < node[SUSPENDED_COUNT]) {\n\t\t\tbreak;\n\t\t}\n\t\tlist._next = node = node[NEXT_NODE];\n\t}\n};\n\n// Things we do here to save some bytes but are not proper JS inheritance:\n// - call `new Component()` as the prototype\n// - do not set `Suspense.prototype.constructor` to `Suspense`\nSuspenseList.prototype = new Component();\n\nSuspenseList.prototype._suspended = function(child) {\n\tconst list = this;\n\tconst delegated = suspended(list._vnode);\n\n\tlet node = list._map.get(child);\n\tnode[SUSPENDED_COUNT]++;\n\n\treturn unsuspend => {\n\t\tconst wrappedUnsuspend = () => {\n\t\t\tif (!list.props.revealOrder) {\n\t\t\t\t// Special case the undefined (falsy) revealOrder, as there\n\t\t\t\t// is no need to coordinate a specific order or unsuspends.\n\t\t\t\tunsuspend();\n\t\t\t} else {\n\t\t\t\tnode.push(unsuspend);\n\t\t\t\tresolve(list, child, node);\n\t\t\t}\n\t\t};\n\t\tif (delegated) {\n\t\t\tdelegated(wrappedUnsuspend);\n\t\t} else {\n\t\t\twrappedUnsuspend();\n\t\t}\n\t};\n};\n\nSuspenseList.prototype.render = function(props) {\n\tthis._next = null;\n\tthis._map = new Map();\n\n\tconst children = toChildArray(props.children);\n\tif (props.revealOrder && props.revealOrder[0] === 'b') {\n\t\t// If order === 'backwards' (or, well, anything starting with a 'b')\n\t\t// then flip the child list around so that the last child will be\n\t\t// the first in the linked list.\n\t\tchildren.reverse();\n\t}\n\t// Build the linked list. Iterate through the children in reverse order\n\t// so that `_next` points to the first linked list node to be resolved.\n\tfor (let i = children.length; i--; ) {\n\t\t// Create a new linked list node as an array of form:\n\t\t// \t[suspended_count, resolved_count, next_node]\n\t\t// where suspended_count and resolved_count are numeric counters for\n\t\t// keeping track how many times a node has been suspended and resolved.\n\t\t//\n\t\t// Note that suspended_count starts from 1 instead of 0, so we can block\n\t\t// processing callbacks until componentDidMount has been called. In a sense\n\t\t// node is suspended at least until componentDidMount gets called!\n\t\t//\n\t\t// Pending callbacks are added to the end of the node:\n\t\t// \t[suspended_count, resolved_count, next_node, callback_0, callback_1, ...]\n\t\tthis._map.set(children[i], (this._next = [1, 0, this._next]));\n\t}\n\treturn props.children;\n};\n\nSuspenseList.prototype.componentDidUpdate = SuspenseList.prototype.componentDidMount = function() {\n\t// Iterate through all children after mounting for two reasons:\n\t// 1. As each node[SUSPENDED_COUNT] starts from 1, this iteration increases\n\t//    each node[RELEASED_COUNT] by 1, therefore balancing the counters.\n\t//    The nodes can now be completely consumed from the linked list.\n\t// 2. Handle nodes that might have gotten resolved between render and\n\t//    componentDidMount.\n\tconst list = this;\n\tlist._map.forEach((node, child) => {\n\t\tresolve(list, child, node);\n\t});\n};\n","import { createElement, hydrate, render, _unmount } from 'preact';\n\nclass ContextProvider {\n\tgetChildContext() {\n\t\treturn this.props.context;\n\t}\n\trender(props) {\n\t\treturn props.children;\n\t}\n}\n\n/**\n * Portal component\n * @param {object | null | undefined} props\n */\nfunction Portal(props) {\n\tlet _this = this;\n\tlet container = props.container;\n\tlet wrap = createElement(\n\t\tContextProvider,\n\t\t{ context: _this.context },\n\t\tprops.vnode\n\t);\n\n\t// When we change container we should clear our old container and\n\t// indicate a new mount.\n\tif (_this._container && _this._container !== container) {\n\t\tif (_this._temp.parentNode) _this._container.removeChild(_this._temp);\n\t\t_unmount(_this._wrap);\n\t\t_this._hasMounted = false;\n\t}\n\n\t// When props.vnode is undefined/false/null we are dealing with some kind of\n\t// conditional vnode. This should not trigger a render.\n\tif (props.vnode) {\n\t\tif (!_this._hasMounted) {\n\t\t\t// Create a placeholder that we can use to insert into.\n\t\t\t_this._temp = document.createTextNode('');\n\t\t\t// Hydrate existing nodes to keep the dom intact, when rendering\n\t\t\t// wrap into the container.\n\t\t\thydrate('', container);\n\t\t\t// Append to the container (this matches React's behavior)\n\t\t\tcontainer.appendChild(_this._temp);\n\t\t\t// At this point we have mounted and should set our container.\n\t\t\t_this._hasMounted = true;\n\t\t\t_this._container = container;\n\t\t\t// Render our wrapping element into temp.\n\t\t\trender(wrap, container, _this._temp);\n\t\t\t_this._children = _this._temp._children;\n\t\t} else {\n\t\t\t// When we have mounted and the vnode is present it means the\n\t\t\t// props have changed or a parent is triggering a rerender.\n\t\t\t// This implies we only need to call render. But we need to keep\n\t\t\t// the old tree around, otherwise will treat the vnodes as new and\n\t\t\t// will wrongly call `componentDidMount` on them\n\t\t\tcontainer._children = _this._children;\n\t\t\trender(wrap, container);\n\t\t\t_this._children = container._children;\n\t\t}\n\t}\n\t// When we come from a conditional render, on a mounted\n\t// portal we should clear the DOM.\n\telse if (_this._hasMounted) {\n\t\tif (_this._temp.parentNode) _this._container.removeChild(_this._temp);\n\t\t_unmount(_this._wrap);\n\t}\n\t// Set the wrapping element for future unmounting.\n\t_this._wrap = wrap;\n\n\t_this.componentWillUnmount = () => {\n\t\tif (_this._temp.parentNode) _this._container.removeChild(_this._temp);\n\t\t_unmount(_this._wrap);\n\t};\n\n\treturn null;\n}\n\n/**\n * Create a `Portal` to continue rendering the vnode tree at a different DOM node\n * @param {import('./internal').VNode} vnode The vnode to render\n * @param {import('./internal').PreactElement} container The DOM node to continue rendering in to.\n */\nexport function createPortal(vnode, container) {\n\treturn createElement(Portal, { vnode, container });\n}\n","/**\n * Normalize event handlers like react does. Most famously it uses `onChange` for any input element.\n * @param {import('./internal').VNode} vnode The vnode to normalize events on\n */\nexport function applyEventNormalization({ type, props }) {\n\tif (!props || typeof type != 'string') return;\n\tlet newProps = {};\n\n\tfor (let i in props) {\n\t\tif (/^on(Ani|Tra|Tou)/.test(i)) {\n\t\t\tprops[i.toLowerCase()] = props[i];\n\t\t\tdelete props[i];\n\t\t}\n\t\tnewProps[i.toLowerCase()] = i;\n\t}\n\tif (newProps.ondoubleclick) {\n\t\tprops.ondblclick = props[newProps.ondoubleclick];\n\t\tdelete props[newProps.ondoubleclick];\n\t}\n\tif (newProps.onbeforeinput) {\n\t\tprops.onbeforeinput = props[newProps.onbeforeinput];\n\t\tdelete props[newProps.onbeforeinput];\n\t}\n\t// for *textual inputs* (incl textarea), normalize `onChange` -> `onInput`:\n\tif (\n\t\tnewProps.onchange &&\n\t\t(type === 'textarea' ||\n\t\t\t(type.toLowerCase() === 'input' && !/^fil|che|ra/i.test(props.type)))\n\t) {\n\t\tlet normalized = newProps.oninput || 'oninput';\n\t\tif (!props[normalized]) {\n\t\t\tprops[normalized] = props[newProps.onchange];\n\t\t\tdelete props[newProps.onchange];\n\t\t}\n\t}\n}\n","// This is a very small application state management library.\r\n//\r\n// All it provides is a way of specifying state \"atoms\" (basically a value with\r\n// a setter and a way to be notified when the value updates), and a single\r\n// preact hook to manage the subscribe/unsubscribe process for you.\r\n//\r\n// At the moment, atoms are intended to be globally defined, but the system\r\n// could easily be adapted to pass down the atoms via context rather than being\r\n// globally available.\r\n//\r\n// To support complex data-types, you can either have simple functions that call\r\n// the public setter, or subclass Atom. So, for example, here are a few\r\n// different ways of making a list atom with convenient helpers:\r\n//\r\n// # Simple functions being passed atom\r\n//\r\n//     const myListAtom = new Atom<number[]>([], \"myList\")\r\n//     function push<T>(atom: Atom<T[]>, t: T) {\r\n//       const next = [...atom.get(), t]\r\n//       atom.set(next)\r\n//     }\r\n//     function removeLast<T>(atom: Atom<T[]>, t: T) {\r\n//       const next = [...atom.get()]\r\n//       next.pop()\r\n//       atom.set(next)\r\n//     }\r\n//\r\n//\r\n// # Simple functions operating on global atoms\r\n//\r\n//     const myListAtom = new Atom<number[]>([], \"myLisT\")\r\n//     function push(t: number) {\r\n//       myListAtom.set([...myListAtom.get(), t])\r\n//     }\r\n//     function removeLast() {\r\n//       const next = [...myListAtom.get()]\r\n//       myListAtom.set(next)\r\n//     }\r\n//\r\n//\r\n// # Subclassing\r\n//\r\n//     class ListAtom<T> extends Atom<T[]> {\r\n//        push(t: T) {\r\n//          const next = [...this.state, t]\r\n//          this.set(next)\r\n//        }\r\n//        removeLast() {\r\n//          const next = [...this.state]\r\n//          next.pop()\r\n//          this.set(next)\r\n//        }\r\n//     }\r\n//     const myListAtom = new ListAtom<number>([], \"myList\")\r\n//\r\n// This library is inspired by https://recoiljs.org/\r\n\r\nimport {useLayoutEffect, useState} from 'preact/hooks'\r\n\r\ntype AtomListener = () => void\r\n\r\nlet AtomDev: {[key: string]: Atom<any>} | null = null\r\nlet hotReloadStash: Map<string, any> | null = null\r\n\r\ndeclare const module: any\r\nif (process.env.NODE_ENV === 'development') {\r\n  ;(window as any)['Atom'] = AtomDev = {}\r\n\r\n  module.hot.dispose(() => {\r\n    if (AtomDev) {\r\n      hotReloadStash = new Map()\r\n      for (let key in AtomDev) {\r\n        hotReloadStash.set(key, AtomDev[key].get())\r\n      }\r\n    }\r\n\r\n    ;(window as any)['Atom_hotReloadStash'] = hotReloadStash\r\n  })\r\n\r\n  hotReloadStash = (window as any)['Atom_hotReloadStash'] || null\r\n}\r\n\r\nexport class Atom<T> {\r\n  private observers: AtomListener[] = []\r\n  constructor(protected state: T, debugKey: string) {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      if (hotReloadStash?.has(debugKey)) {\r\n        // If we have a stored value from a previous hot reload, use that\r\n        // instead of whatever was passed to the constructor.\r\n        this.state = hotReloadStash.get(debugKey)\r\n      }\r\n\r\n      if (AtomDev) {\r\n        if (debugKey in AtomDev) {\r\n          console.warn(`[Atom] Multiple atoms tried to register with the key ${debugKey}`)\r\n        }\r\n        AtomDev[debugKey] = this\r\n      }\r\n    }\r\n\r\n    // We do the bind here rather than in the definition to facilitate\r\n    // inheritance (we want the value defined on both the prototype and the\r\n    // instance).\r\n    this.set = this.set.bind(this)\r\n    this.get = this.get.bind(this)\r\n  }\r\n\r\n  set(t: T) {\r\n    if (this.state === t) {\r\n      // No-op if the value didn't actually change\r\n      return\r\n    }\r\n    this.state = t\r\n    this.observers.forEach(fn => fn())\r\n  }\r\n\r\n  get(): T {\r\n    return this.state\r\n  }\r\n\r\n  subscribe(listener: AtomListener) {\r\n    this.observers.push(listener)\r\n  }\r\n\r\n  unsubscribe(listener: AtomListener) {\r\n    const index = this.observers.indexOf(listener)\r\n    if (index !== -1) {\r\n      this.observers.splice(index, 1)\r\n    }\r\n  }\r\n}\r\n\r\nexport function useAtom<T>(atom: Atom<T>): T {\r\n  const [value, setValue] = useState(atom.get())\r\n\r\n  useLayoutEffect(() => {\r\n    // We need to setValue here because it's possible something has changed the\r\n    // value in the store between the atom.get() call above and layout. In most\r\n    // cases this should no-op.\r\n    setValue(atom.get())\r\n\r\n    function listener() {\r\n      setValue(atom.get())\r\n    }\r\n\r\n    atom.subscribe(listener)\r\n    return () => {\r\n      atom.unsubscribe(listener)\r\n    }\r\n  }, [atom])\r\n\r\n  return value\r\n}\r\n","export const enum ViewMode {\r\n  CHRONO_FLAME_CHART,\r\n  LEFT_HEAVY_FLAME_GRAPH,\r\n  SANDWICH_VIEW,\r\n}\r\n","import {ViewMode} from '../lib/view-mode'\r\n\r\nexport interface HashParams {\r\n  profileURL?: string\r\n  title?: string\r\n  localProfilePath?: string\r\n  viewMode?: ViewMode\r\n}\r\n\r\nfunction getViewMode(value: string): ViewMode | null {\r\n  switch (value) {\r\n    case 'time-ordered':\r\n      return ViewMode.CHRONO_FLAME_CHART\r\n    case 'left-heavy':\r\n      return ViewMode.LEFT_HEAVY_FLAME_GRAPH\r\n    case 'sandwich':\r\n      return ViewMode.SANDWICH_VIEW\r\n    default:\r\n      return null\r\n  }\r\n}\r\n\r\nexport function getHashParams(hashContents = window.location.hash): HashParams {\r\n  try {\r\n    if (!hashContents.startsWith('#')) {\r\n      return {}\r\n    }\r\n    const components = hashContents.substr(1).split('&')\r\n    const result: HashParams = {}\r\n    for (const component of components) {\r\n      let [key, value] = component.split('=')\r\n      value = decodeURIComponent(value)\r\n      if (key === 'profileURL') {\r\n        result.profileURL = value\r\n      } else if (key === 'title') {\r\n        result.title = value\r\n      } else if (key === 'localProfilePath') {\r\n        result.localProfilePath = value\r\n      } else if (key === 'view') {\r\n        const mode = getViewMode(value)\r\n        if (mode !== null) {\r\n          result.viewMode = mode\r\n        } else {\r\n          console.error(`Ignoring invalid view specifier: ${value}`)\r\n        }\r\n      }\r\n    }\r\n    return result\r\n  } catch (e) {\r\n    console.error(`Error when loading hash fragment.`)\r\n    console.error(e)\r\n    return {}\r\n  }\r\n}\r\n","import {Atom} from '../lib/atom'\r\nimport {clamp, Rect, Vec2} from '../lib/math'\r\nimport {CallTreeNode, Frame, Profile, ProfileGroup} from '../lib/profile'\r\nimport {objectsHaveShallowEquality} from '../lib/utils'\r\n\r\nexport interface FlamechartViewState {\r\n  hover: {\r\n    node: CallTreeNode\r\n    event: MouseEvent\r\n  } | null\r\n  selectedNode: CallTreeNode | null\r\n  logicalSpaceViewportSize: Vec2\r\n  configSpaceViewportRect: Rect\r\n}\r\n\r\nexport interface CallerCalleeState {\r\n  selectedFrame: Frame\r\n  invertedCallerFlamegraph: FlamechartViewState\r\n  calleeFlamegraph: FlamechartViewState\r\n}\r\n\r\nexport interface SandwichViewState {\r\n  callerCallee: CallerCalleeState | null\r\n}\r\n\r\nexport interface ProfileState {\r\n  profile: Profile\r\n  chronoViewState: FlamechartViewState\r\n  leftHeavyViewState: FlamechartViewState\r\n  sandwichViewState: SandwichViewState\r\n}\r\n\r\nexport type ProfileGroupState = {\r\n  name: string\r\n\r\n  // The index within the list of profiles currently being viewed\r\n  indexToView: number\r\n\r\n  profiles: ProfileState[]\r\n} | null\r\n\r\nexport enum FlamechartID {\r\n  LEFT_HEAVY = 'LEFT_HEAVY',\r\n  CHRONO = 'CHRONO',\r\n  SANDWICH_INVERTED_CALLERS = 'SANDWICH_INVERTED_CALLERS',\r\n  SANDWICH_CALLEES = 'SANDWICH_CALLEES',\r\n}\r\n\r\nlet initialFlameChartViewState: FlamechartViewState = {\r\n  hover: null,\r\n  selectedNode: null,\r\n  configSpaceViewportRect: Rect.empty,\r\n  logicalSpaceViewportSize: Vec2.zero,\r\n}\r\n\r\nexport class ProfileGroupAtom extends Atom<ProfileGroupState> {\r\n  set(newState: ProfileGroupState) {\r\n    const oldState = this.state\r\n    if (oldState != null && newState != null && objectsHaveShallowEquality(oldState, newState)) {\r\n      return\r\n    }\r\n    super.set(newState)\r\n  }\r\n\r\n  getActiveProfile(): ProfileState | null {\r\n    if (this.state == null) return null\r\n    return this.state.profiles[this.state?.indexToView] || null\r\n  }\r\n\r\n  setProfileGroup = (group: ProfileGroup) => {\r\n    this.set({\r\n      name: group.name,\r\n      indexToView: group.indexToView,\r\n      profiles: group.profiles.map(p => ({\r\n        profile: p,\r\n        chronoViewState: initialFlameChartViewState,\r\n        leftHeavyViewState: initialFlameChartViewState,\r\n        sandwichViewState: {callerCallee: null},\r\n      })),\r\n    })\r\n  }\r\n\r\n  setProfileIndexToView = (indexToView: number) => {\r\n    if (this.state == null) return\r\n\r\n    indexToView = clamp(indexToView, 0, this.state.profiles.length - 1)\r\n\r\n    this.set({\r\n      ...this.state,\r\n      indexToView,\r\n    })\r\n  }\r\n\r\n  private updateActiveProfileState(fn: (profileState: ProfileState) => ProfileState) {\r\n    if (this.state == null) return\r\n    const {indexToView, profiles} = this.state\r\n    this.set({\r\n      ...this.state,\r\n      profiles: profiles.map((p, i) => {\r\n        if (i != indexToView) return p\r\n        return fn(p)\r\n      }),\r\n    })\r\n  }\r\n\r\n  private updateActiveSandwichViewState(\r\n    fn: (sandwichViewState: SandwichViewState) => SandwichViewState,\r\n  ) {\r\n    this.updateActiveProfileState(p => ({\r\n      ...p,\r\n      sandwichViewState: fn(p.sandwichViewState),\r\n    }))\r\n  }\r\n\r\n  setSelectedFrame = (frame: Frame | null) => {\r\n    if (this.state == null) return\r\n\r\n    const profile = this.getActiveProfile()\r\n    if (profile == null) {\r\n      return\r\n    }\r\n\r\n    this.updateActiveSandwichViewState(sandwichViewState => {\r\n      if (frame == null) {\r\n        return {callerCallee: null}\r\n      }\r\n      return {\r\n        callerCallee: {\r\n          invertedCallerFlamegraph: initialFlameChartViewState,\r\n          calleeFlamegraph: initialFlameChartViewState,\r\n          selectedFrame: frame,\r\n        },\r\n      }\r\n    })\r\n  }\r\n\r\n  private updateFlamechartState(\r\n    id: FlamechartID,\r\n    fn: (flamechartViewState: FlamechartViewState) => FlamechartViewState,\r\n  ) {\r\n    switch (id) {\r\n      case FlamechartID.CHRONO: {\r\n        this.updateActiveProfileState(p => ({\r\n          ...p,\r\n          chronoViewState: fn(p.chronoViewState),\r\n        }))\r\n        break\r\n      }\r\n\r\n      case FlamechartID.LEFT_HEAVY: {\r\n        this.updateActiveProfileState(p => ({\r\n          ...p,\r\n          leftHeavyViewState: fn(p.leftHeavyViewState),\r\n        }))\r\n        break\r\n      }\r\n\r\n      case FlamechartID.SANDWICH_CALLEES: {\r\n        this.updateActiveSandwichViewState(s => ({\r\n          ...s,\r\n          callerCallee:\r\n            s.callerCallee == null\r\n              ? null\r\n              : {\r\n                  ...s.callerCallee,\r\n                  calleeFlamegraph: fn(s.callerCallee.calleeFlamegraph),\r\n                },\r\n        }))\r\n        break\r\n      }\r\n\r\n      case FlamechartID.SANDWICH_INVERTED_CALLERS: {\r\n        this.updateActiveSandwichViewState(s => ({\r\n          ...s,\r\n          callerCallee:\r\n            s.callerCallee == null\r\n              ? null\r\n              : {\r\n                  ...s.callerCallee,\r\n                  invertedCallerFlamegraph: fn(s.callerCallee.invertedCallerFlamegraph),\r\n                },\r\n        }))\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  setFlamechartHoveredNode(\r\n    id: FlamechartID,\r\n    hover: {node: CallTreeNode; event: MouseEvent} | null,\r\n  ) {\r\n    this.updateFlamechartState(id, f => ({\r\n      ...f,\r\n      hover,\r\n    }))\r\n  }\r\n\r\n  setSelectedNode(id: FlamechartID, selectedNode: CallTreeNode | null) {\r\n    this.updateFlamechartState(id, f => ({\r\n      ...f,\r\n      selectedNode,\r\n    }))\r\n  }\r\n\r\n  setConfigSpaceViewportRect(id: FlamechartID, configSpaceViewportRect: Rect) {\r\n    this.updateFlamechartState(id, f => ({\r\n      ...f,\r\n      configSpaceViewportRect,\r\n    }))\r\n  }\r\n\r\n  setLogicalSpaceViewportSize(id: FlamechartID, logicalSpaceViewportSize: Vec2) {\r\n    this.updateFlamechartState(id, f => ({\r\n      ...f,\r\n      logicalSpaceViewportSize,\r\n    }))\r\n  }\r\n\r\n  clearHoverNode() {\r\n    // TODO(jlfwong): This causes 4 separate observer events. This is probably\r\n    // fine, since I hope that Preact/React are smart about batching re-renders?\r\n    this.setFlamechartHoveredNode(FlamechartID.CHRONO, null)\r\n    this.setFlamechartHoveredNode(FlamechartID.LEFT_HEAVY, null)\r\n    this.setFlamechartHoveredNode(FlamechartID.SANDWICH_CALLEES, null)\r\n    this.setFlamechartHoveredNode(FlamechartID.SANDWICH_INVERTED_CALLERS, null)\r\n  }\r\n}\r\n","import {Atom} from '../lib/atom'\r\nimport {ViewMode} from '../lib/view-mode'\r\nimport {getHashParams, HashParams} from '../lib/hash-params'\r\nimport {ProfileGroupAtom} from './profile-group'\r\n\r\n// True if recursion should be flattened when viewing flamegraphs\r\nexport const flattenRecursionAtom = new Atom<boolean>(false, 'flattenRecursion')\r\n\r\n// The query used in top-level views\r\n//\r\n// An empty string indicates that the search is open by no filter is applied.\r\n// searchIsActive is stored separately, because we may choose to persist the\r\n// query even when the search input is closed.\r\nexport const searchIsActiveAtom = new Atom<boolean>(false, 'searchIsActive')\r\nexport const searchQueryAtom = new Atom<string>('', 'searchQueryAtom')\r\n\r\n// Which top-level view should be displayed\r\nexport const viewModeAtom = new Atom<ViewMode>(ViewMode.CHRONO_FLAME_CHART, 'viewMode')\r\n\r\n// The top-level profile group from which most other data will be derived\r\nexport const profileGroupAtom = new ProfileGroupAtom(null, 'profileGroup')\r\n\r\nviewModeAtom.subscribe(() => {\r\n  // If we switch views, the hover information is no longer relevant\r\n  profileGroupAtom.clearHoverNode()\r\n})\r\n\r\n// Parameters defined by the URL encoded k=v pairs after the # in the URL\r\nconst hashParams = getHashParams()\r\nexport const hashParamsAtom = new Atom<HashParams>(hashParams, 'hashParams')\r\n\r\n// The <canvas> element used for WebGL\r\nexport const glCanvasAtom = new Atom<HTMLCanvasElement | null>(null, 'glCanvas')\r\n\r\n// True when a file drag is currently active. Used to indicate that the\r\n// application is a valid drop target.\r\nexport const dragActiveAtom = new Atom<boolean>(false, 'dragActive')\r\n\r\n// True when the application is currently in a loading state. Used to\r\n// display a loading progress bar.\r\n\r\n// Speedscope is usable both from a local HTML file being served\r\n// from a file:// URL, and via websites. In the case of file:// URLs,\r\n// however, XHR will be unavailable to fetching files in adjacent directories.\r\nconst protocol = window.location.protocol\r\nexport const canUseXHR = protocol === 'http:' || protocol === 'https:'\r\nconst isImmediatelyLoading = canUseXHR && hashParams.profileURL != null\r\nexport const loadingAtom = new Atom<boolean>(isImmediatelyLoading, 'loading')\r\n\r\n// True when the application is an error state, e.g. because the profile\r\n// imported was invalid.\r\nexport const errorAtom = new Atom<boolean>(false, 'error')\r\n\r\nexport enum SortField {\r\n  SYMBOL_NAME,\r\n  SELF,\r\n  TOTAL,\r\n}\r\n\r\nexport enum SortDirection {\r\n  ASCENDING,\r\n  DESCENDING,\r\n}\r\n\r\nexport interface SortMethod {\r\n  field: SortField\r\n  direction: SortDirection\r\n}\r\n\r\n// The table sorting method using for the sandwich view, specifying the column\r\n// to sort by, and the direction to sort that clumn.\r\nexport const tableSortMethodAtom = new Atom<SortMethod>(\r\n  {\r\n    field: SortField.SELF,\r\n    direction: SortDirection.DESCENDING,\r\n  },\r\n  'tableSortMethod',\r\n)\r\n","import {Profile} from '../lib/profile'\r\nimport {getProfileToView} from './getters'\r\nimport {flattenRecursionAtom, profileGroupAtom} from '.'\r\nimport {FlamechartViewState, SandwichViewState} from './profile-group'\r\nimport {useAtom} from '../lib/atom'\r\n\r\nexport interface ApplicationState {}\r\n\r\nexport interface ActiveProfileState {\r\n  profile: Profile\r\n  index: number\r\n  chronoViewState: FlamechartViewState\r\n  leftHeavyViewState: FlamechartViewState\r\n  sandwichViewState: SandwichViewState\r\n}\r\n\r\nexport function useActiveProfileState(): ActiveProfileState | null {\r\n  const flattenRecursion = useAtom(flattenRecursionAtom)\r\n  const profileGroupState = useAtom(profileGroupAtom)\r\n\r\n  if (!profileGroupState) return null\r\n  if (profileGroupState.indexToView >= profileGroupState.profiles.length) return null\r\n\r\n  const index = profileGroupState.indexToView\r\n  const profileState = profileGroupState.profiles[index]\r\n  return {\r\n    ...profileGroupState.profiles[profileGroupState.indexToView],\r\n    profile: getProfileToView({\r\n      profile: profileState.profile,\r\n      flattenRecursion,\r\n    }),\r\n    index: profileGroupState.indexToView,\r\n  }\r\n}\r\n","import {Atom} from '../lib/atom'\r\n\r\nexport const enum ColorScheme {\r\n  // Default: respect prefers-color-schema\r\n  SYSTEM,\r\n\r\n  // Use dark theme\r\n  DARK,\r\n\r\n  // use light theme\r\n  LIGHT,\r\n}\r\n\r\nconst localStorageKey = 'speedscope-color-scheme'\r\n\r\nfunction getStoredPreference(): ColorScheme {\r\n  const storedPreference = window.localStorage && window.localStorage[localStorageKey]\r\n  if (storedPreference === 'DARK') {\r\n    return ColorScheme.DARK\r\n  } else if (storedPreference === 'LIGHT') {\r\n    return ColorScheme.LIGHT\r\n  } else {\r\n    return ColorScheme.SYSTEM\r\n  }\r\n}\r\n\r\nfunction matchMediaDarkColorScheme(): MediaQueryList {\r\n  return matchMedia('(prefers-color-scheme: dark)')\r\n}\r\n\r\nfunction nextColorScheme(scheme: ColorScheme): ColorScheme {\r\n  const systemPrefersDarkMode = matchMediaDarkColorScheme().matches\r\n\r\n  // We'll use a different cycling order for changing the color scheme depending\r\n  // on what the *current* system preference is. This should guarantee that when\r\n  // a user interacts with the color scheme toggle for the first time, it always\r\n  // changes the color scheme.\r\n  if (systemPrefersDarkMode) {\r\n    switch (scheme) {\r\n      case ColorScheme.SYSTEM: {\r\n        return ColorScheme.LIGHT\r\n      }\r\n      case ColorScheme.LIGHT: {\r\n        return ColorScheme.DARK\r\n      }\r\n      case ColorScheme.DARK: {\r\n        return ColorScheme.SYSTEM\r\n      }\r\n    }\r\n  } else {\r\n    switch (scheme) {\r\n      case ColorScheme.SYSTEM: {\r\n        return ColorScheme.DARK\r\n      }\r\n      case ColorScheme.DARK: {\r\n        return ColorScheme.LIGHT\r\n      }\r\n      case ColorScheme.LIGHT: {\r\n        return ColorScheme.SYSTEM\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass ColorSchemeAtom extends Atom<ColorScheme> {\r\n  cycleToNextColorScheme = () => {\r\n    this.set(nextColorScheme(this.get()))\r\n  }\r\n}\r\n\r\nexport const colorSchemeAtom = new ColorSchemeAtom(getStoredPreference(), 'colorScheme')\r\n\r\ncolorSchemeAtom.subscribe(() => {\r\n  const value = colorSchemeAtom.get()\r\n\r\n  switch (value) {\r\n    case ColorScheme.DARK: {\r\n      window.localStorage[localStorageKey] = 'DARK'\r\n      break\r\n    }\r\n    case ColorScheme.LIGHT: {\r\n      window.localStorage[localStorageKey] = 'LIGHT'\r\n      break\r\n    }\r\n    case ColorScheme.SYSTEM: {\r\n      delete window.localStorage[localStorageKey]\r\n      break\r\n    }\r\n    default: {\r\n      const _exhaustiveCheck: never = value\r\n      return _exhaustiveCheck\r\n    }\r\n  }\r\n  return value\r\n})\r\n","import {Color} from '../../lib/color'\r\nimport {triangle} from '../../lib/utils'\r\nimport {Theme} from './theme'\r\n\r\n// These colors are intentionally not exported from this file, because these\r\n// colors are theme specific, and we want all color values to come from the\r\n// active theme.\r\nenum Colors {\r\n  LIGHTER_GRAY = '#D0D0D0',\r\n  LIGHT_GRAY = '#BDBDBD',\r\n  GRAY = '#666666',\r\n  DARK_GRAY = '#222222',\r\n  DARKER_GRAY = '#0C0C0C',\r\n  OFF_BLACK = '#060606',\r\n  BLACK = '#000000',\r\n  BLUE = '#00769B',\r\n  PALE_BLUE = '#004E75',\r\n  GREEN = '#0F8A42',\r\n  LIGHT_BROWN = '#D6AE24',\r\n  BROWN = '#A66F1C',\r\n}\r\n\r\nconst C_0 = 0.2\r\nconst C_d = 0.1\r\nconst L_0 = 0.2\r\nconst L_d = 0.1\r\n\r\nconst colorForBucket = (t: number) => {\r\n  const x = triangle(30.0 * t)\r\n  const H = 360.0 * (0.9 * t)\r\n  const C = C_0 + C_d * x\r\n  const L = L_0 - L_d * x\r\n  return Color.fromLumaChromaHue(L, C, H)\r\n}\r\nconst colorForBucketGLSL = `\r\n  vec3 colorForBucket(float t) {\r\n    float x = triangle(30.0 * t);\r\n    float H = 360.0 * (0.9 * t);\r\n    float C = ${C_0.toFixed(1)} + ${C_d.toFixed(1)} * x;\r\n    float L = ${L_0.toFixed(1)} - ${L_d.toFixed(1)} * x;\r\n    return hcl2rgb(H, C, L);\r\n  }\r\n`\r\n\r\nexport const darkTheme: Theme = {\r\n  fgPrimaryColor: Colors.LIGHTER_GRAY,\r\n  fgSecondaryColor: Colors.GRAY,\r\n\r\n  bgPrimaryColor: Colors.OFF_BLACK,\r\n  bgSecondaryColor: Colors.DARKER_GRAY,\r\n\r\n  altFgPrimaryColor: Colors.LIGHTER_GRAY,\r\n  altFgSecondaryColor: Colors.GRAY,\r\n\r\n  altBgPrimaryColor: Colors.BLACK,\r\n  altBgSecondaryColor: Colors.DARKER_GRAY,\r\n\r\n  selectionPrimaryColor: Colors.BLUE,\r\n  selectionSecondaryColor: Colors.PALE_BLUE,\r\n\r\n  weightColor: Colors.GREEN,\r\n\r\n  searchMatchTextColor: Colors.DARKER_GRAY,\r\n  searchMatchPrimaryColor: Colors.BROWN,\r\n  searchMatchSecondaryColor: Colors.LIGHT_BROWN,\r\n\r\n  colorForBucket,\r\n  colorForBucketGLSL,\r\n}\r\n","import {Color} from '../../lib/color'\r\nimport {triangle} from '../../lib/utils'\r\nimport {Theme} from './theme'\r\n\r\n// These colors are intentionally not exported from this file, because these\r\n// colors are theme specific, and we want all color values to come from the\r\n// active theme.\r\nenum Colors {\r\n  WHITE = '#FFFFFF',\r\n  OFF_WHITE = '#F6F6F6',\r\n  LIGHT_GRAY = '#BDBDBD',\r\n  GRAY = '#666666',\r\n  DARK_GRAY = '#222222',\r\n  OFF_BLACK = '#111111',\r\n  BLACK = '#000000',\r\n  DARK_BLUE = '#2F80ED',\r\n  PALE_DARK_BLUE = '#8EB7ED',\r\n  GREEN = '#6FCF97',\r\n  YELLOW = '#FEDC62',\r\n  ORANGE = '#FFAC02',\r\n}\r\n\r\nconst C_0 = 0.25\r\nconst C_d = 0.2\r\nconst L_0 = 0.8\r\nconst L_d = 0.15\r\n\r\nconst colorForBucket = (t: number) => {\r\n  const x = triangle(30.0 * t)\r\n  const H = 360.0 * (0.9 * t)\r\n  const C = C_0 + C_d * x\r\n  const L = L_0 - L_d * x\r\n  return Color.fromLumaChromaHue(L, C, H)\r\n}\r\nconst colorForBucketGLSL = `\r\n  vec3 colorForBucket(float t) {\r\n    float x = triangle(30.0 * t);\r\n    float H = 360.0 * (0.9 * t);\r\n    float C = ${C_0.toFixed(1)} + ${C_d.toFixed(1)} * x;\r\n    float L = ${L_0.toFixed(1)} - ${L_d.toFixed(1)} * x;\r\n    return hcl2rgb(H, C, L);\r\n  }\r\n`\r\n\r\nexport const lightTheme: Theme = {\r\n  fgPrimaryColor: Colors.BLACK,\r\n  fgSecondaryColor: Colors.LIGHT_GRAY,\r\n\r\n  bgPrimaryColor: Colors.WHITE,\r\n  bgSecondaryColor: Colors.OFF_WHITE,\r\n\r\n  altFgPrimaryColor: Colors.WHITE,\r\n  altFgSecondaryColor: Colors.LIGHT_GRAY,\r\n\r\n  altBgPrimaryColor: Colors.BLACK,\r\n  altBgSecondaryColor: Colors.DARK_GRAY,\r\n\r\n  selectionPrimaryColor: Colors.DARK_BLUE,\r\n  selectionSecondaryColor: Colors.PALE_DARK_BLUE,\r\n\r\n  weightColor: Colors.GREEN,\r\n\r\n  searchMatchTextColor: Colors.BLACK,\r\n  searchMatchPrimaryColor: Colors.ORANGE,\r\n  searchMatchSecondaryColor: Colors.YELLOW,\r\n\r\n  colorForBucket,\r\n  colorForBucketGLSL,\r\n}\r\n","import {h, ComponentChildren, createContext} from 'preact'\r\nimport {useCallback, useContext, useEffect, useState} from 'preact/hooks'\r\nimport {ColorScheme, colorSchemeAtom} from '../../app-state/color-scheme'\r\nimport {useAtom} from '../../lib/atom'\r\nimport {Color} from '../../lib/color'\r\nimport {memoizeByReference} from '../../lib/utils'\r\nimport {darkTheme} from './dark-theme'\r\nimport {lightTheme} from './light-theme'\r\n\r\nexport interface Theme {\r\n  fgPrimaryColor: string\r\n  fgSecondaryColor: string\r\n  bgPrimaryColor: string\r\n  bgSecondaryColor: string\r\n\r\n  altFgPrimaryColor: string\r\n  altFgSecondaryColor: string\r\n  altBgPrimaryColor: string\r\n  altBgSecondaryColor: string\r\n\r\n  selectionPrimaryColor: string\r\n  selectionSecondaryColor: string\r\n\r\n  weightColor: string\r\n\r\n  searchMatchTextColor: string\r\n  searchMatchPrimaryColor: string\r\n  searchMatchSecondaryColor: string\r\n\r\n  colorForBucket: (t: number) => Color\r\n  colorForBucketGLSL: string\r\n}\r\n\r\nexport const ThemeContext = createContext<Theme>(lightTheme)\r\n\r\nexport function useTheme(): Theme {\r\n  return useContext(ThemeContext)\r\n}\r\n\r\nexport function withTheme<T>(cb: (theme: Theme) => T) {\r\n  return memoizeByReference(cb)\r\n}\r\n\r\nfunction matchMediaDarkColorScheme(): MediaQueryList {\r\n  return matchMedia('(prefers-color-scheme: dark)')\r\n}\r\n\r\nexport function colorSchemeToString(scheme: ColorScheme): string {\r\n  switch (scheme) {\r\n    case ColorScheme.SYSTEM: {\r\n      return 'System'\r\n    }\r\n    case ColorScheme.DARK: {\r\n      return 'Dark'\r\n    }\r\n    case ColorScheme.LIGHT: {\r\n      return 'Light'\r\n    }\r\n  }\r\n}\r\n\r\nfunction getTheme(colorScheme: ColorScheme, systemPrefersDarkMode: boolean) {\r\n  switch (colorScheme) {\r\n    case ColorScheme.SYSTEM: {\r\n      return systemPrefersDarkMode ? darkTheme : lightTheme\r\n    }\r\n    case ColorScheme.DARK: {\r\n      return darkTheme\r\n    }\r\n    case ColorScheme.LIGHT: {\r\n      return lightTheme\r\n    }\r\n  }\r\n}\r\n\r\nexport function ThemeProvider(props: {children: ComponentChildren}) {\r\n  const [systemPrefersDarkMode, setSystemPrefersDarkMode] = useState(\r\n    () => matchMediaDarkColorScheme().matches,\r\n  )\r\n\r\n  const matchMediaListener = useCallback(\r\n    (event: MediaQueryListEvent) => {\r\n      setSystemPrefersDarkMode(event.matches)\r\n    },\r\n    [setSystemPrefersDarkMode],\r\n  )\r\n\r\n  useEffect(() => {\r\n    const media = matchMediaDarkColorScheme()\r\n    media.addEventListener('change', matchMediaListener)\r\n    return () => {\r\n      media.removeEventListener('change', matchMediaListener)\r\n    }\r\n  }, [matchMediaListener])\r\n\r\n  const colorScheme = useAtom(colorSchemeAtom)\r\n  const theme = getTheme(colorScheme, systemPrefersDarkMode)\r\n  return <ThemeContext.Provider value={theme} children={props.children} />\r\n}\r\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isPrefixedValue;\nvar regex = /-webkit-|-moz-|-ms-/;\n\nfunction isPrefixedValue(value) {\n  return typeof value === 'string' && regex.test(value);\n}\nmodule.exports = exports['default'];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = calc;\n\nvar _isPrefixedValue = require(\"css-in-js-utils/lib/isPrefixedValue\");\n\nvar _isPrefixedValue2 = _interopRequireDefault(_isPrefixedValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar prefixes = [\"-webkit-\", \"-moz-\", \"\"];\nfunction calc(property, value) {\n  if (typeof value === \"string\" && !(0, _isPrefixedValue2.default)(value) && value.indexOf(\"calc(\") > -1) {\n    return prefixes.map(function (prefix) {\n      return value.replace(/calc\\(/g, prefix + \"calc(\");\n    });\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = crossFade;\n\nvar _isPrefixedValue = require(\"css-in-js-utils/lib/isPrefixedValue\");\n\nvar _isPrefixedValue2 = _interopRequireDefault(_isPrefixedValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// http://caniuse.com/#search=cross-fade\nvar prefixes = [\"-webkit-\", \"\"];\nfunction crossFade(property, value) {\n  if (typeof value === \"string\" && !(0, _isPrefixedValue2.default)(value) && value.indexOf(\"cross-fade(\") > -1) {\n    return prefixes.map(function (prefix) {\n      return value.replace(/cross-fade\\(/g, prefix + \"cross-fade(\");\n    });\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = cursor;\nvar prefixes = [\"-webkit-\", \"-moz-\", \"\"];\n\nvar values = {\n  \"zoom-in\": true,\n  \"zoom-out\": true,\n  grab: true,\n  grabbing: true\n};\n\nfunction cursor(property, value) {\n  if (property === \"cursor\" && values.hasOwnProperty(value)) {\n    return prefixes.map(function (prefix) {\n      return prefix + value;\n    });\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = filter;\n\nvar _isPrefixedValue = require(\"css-in-js-utils/lib/isPrefixedValue\");\n\nvar _isPrefixedValue2 = _interopRequireDefault(_isPrefixedValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// http://caniuse.com/#feat=css-filter-function\nvar prefixes = [\"-webkit-\", \"\"];\nfunction filter(property, value) {\n  if (typeof value === \"string\" && !(0, _isPrefixedValue2.default)(value) && value.indexOf(\"filter(\") > -1) {\n    return prefixes.map(function (prefix) {\n      return value.replace(/filter\\(/g, prefix + \"filter(\");\n    });\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = flex;\nvar values = {\n  flex: [\"-webkit-box\", \"-moz-box\", \"-ms-flexbox\", \"-webkit-flex\", \"flex\"],\n  \"inline-flex\": [\"-webkit-inline-box\", \"-moz-inline-box\", \"-ms-inline-flexbox\", \"-webkit-inline-flex\", \"inline-flex\"]\n};\n\nfunction flex(property, value) {\n  if (property === \"display\" && values.hasOwnProperty(value)) {\n    return values[value];\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = flexboxIE;\nvar alternativeValues = {\n  \"space-around\": \"distribute\",\n  \"space-between\": \"justify\",\n  \"flex-start\": \"start\",\n  \"flex-end\": \"end\"\n};\nvar alternativeProps = {\n  alignContent: \"msFlexLinePack\",\n  alignSelf: \"msFlexItemAlign\",\n  alignItems: \"msFlexAlign\",\n  justifyContent: \"msFlexPack\",\n  order: \"msFlexOrder\",\n  flexGrow: \"msFlexPositive\",\n  flexShrink: \"msFlexNegative\",\n  flexBasis: \"msFlexPreferredSize\"\n};\n\nfunction flexboxIE(property, value, style) {\n  if (alternativeProps.hasOwnProperty(property)) {\n    style[alternativeProps[property]] = alternativeValues[value] || value;\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = flexboxOld;\nvar alternativeValues = {\n  \"space-around\": \"justify\",\n  \"space-between\": \"justify\",\n  \"flex-start\": \"start\",\n  \"flex-end\": \"end\",\n  \"wrap-reverse\": \"multiple\",\n  wrap: \"multiple\"\n};\n\nvar alternativeProps = {\n  alignItems: \"WebkitBoxAlign\",\n  justifyContent: \"WebkitBoxPack\",\n  flexWrap: \"WebkitBoxLines\"\n};\n\nfunction flexboxOld(property, value, style) {\n  if (property === \"flexDirection\" && typeof value === \"string\") {\n    if (value.indexOf(\"column\") > -1) {\n      style.WebkitBoxOrient = \"vertical\";\n    } else {\n      style.WebkitBoxOrient = \"horizontal\";\n    }\n    if (value.indexOf(\"reverse\") > -1) {\n      style.WebkitBoxDirection = \"reverse\";\n    } else {\n      style.WebkitBoxDirection = \"normal\";\n    }\n  }\n  if (alternativeProps.hasOwnProperty(property)) {\n    style[alternativeProps[property]] = alternativeValues[value] || value;\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = gradient;\n\nvar _isPrefixedValue = require(\"css-in-js-utils/lib/isPrefixedValue\");\n\nvar _isPrefixedValue2 = _interopRequireDefault(_isPrefixedValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar prefixes = [\"-webkit-\", \"-moz-\", \"\"];\n\nvar values = /linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;\n\nfunction gradient(property, value) {\n  if (typeof value === \"string\" && !(0, _isPrefixedValue2.default)(value) && values.test(value)) {\n    return prefixes.map(function (prefix) {\n      return prefix + value;\n    });\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = imageSet;\n\nvar _isPrefixedValue = require(\"css-in-js-utils/lib/isPrefixedValue\");\n\nvar _isPrefixedValue2 = _interopRequireDefault(_isPrefixedValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// http://caniuse.com/#feat=css-image-set\nvar prefixes = [\"-webkit-\", \"\"];\nfunction imageSet(property, value) {\n  if (typeof value === \"string\" && !(0, _isPrefixedValue2.default)(value) && value.indexOf(\"image-set(\") > -1) {\n    return prefixes.map(function (prefix) {\n      return value.replace(/image-set\\(/g, prefix + \"image-set(\");\n    });\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = position;\nfunction position(property, value) {\n  if (property === \"position\" && value === \"sticky\") {\n    return [\"-webkit-sticky\", \"sticky\"];\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = sizing;\nvar prefixes = [\"-webkit-\", \"-moz-\", \"\"];\n\nvar properties = {\n  maxHeight: true,\n  maxWidth: true,\n  width: true,\n  height: true,\n  columnWidth: true,\n  minWidth: true,\n  minHeight: true\n};\nvar values = {\n  \"min-content\": true,\n  \"max-content\": true,\n  \"fill-available\": true,\n  \"fit-content\": true,\n  \"contain-floats\": true\n};\n\nfunction sizing(property, value) {\n  if (properties.hasOwnProperty(property) && values.hasOwnProperty(value)) {\n    return prefixes.map(function (prefix) {\n      return prefix + value;\n    });\n  }\n}\nmodule.exports = exports[\"default\"];","'use strict';\n\nvar uppercasePattern = /[A-Z]/g;\nvar msPattern = /^ms-/;\nvar cache = {};\n\nfunction hyphenateStyleName(string) {\n    return string in cache\n    ? cache[string]\n    : cache[string] = string\n      .replace(uppercasePattern, '-$&')\n      .toLowerCase()\n      .replace(msPattern, '-ms-');\n}\n\nmodule.exports = hyphenateStyleName;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = hyphenateProperty;\n\nvar _hyphenateStyleName = require('hyphenate-style-name');\n\nvar _hyphenateStyleName2 = _interopRequireDefault(_hyphenateStyleName);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction hyphenateProperty(property) {\n  return (0, _hyphenateStyleName2.default)(property);\n}\nmodule.exports = exports['default'];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = capitalizeString;\nfunction capitalizeString(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = transition;\n\nvar _hyphenateProperty = require(\"css-in-js-utils/lib/hyphenateProperty\");\n\nvar _hyphenateProperty2 = _interopRequireDefault(_hyphenateProperty);\n\nvar _isPrefixedValue = require(\"css-in-js-utils/lib/isPrefixedValue\");\n\nvar _isPrefixedValue2 = _interopRequireDefault(_isPrefixedValue);\n\nvar _capitalizeString = require(\"../../utils/capitalizeString\");\n\nvar _capitalizeString2 = _interopRequireDefault(_capitalizeString);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar properties = {\n  transition: true,\n  transitionProperty: true,\n  WebkitTransition: true,\n  WebkitTransitionProperty: true,\n  MozTransition: true,\n  MozTransitionProperty: true\n};\n\n\nvar prefixMapping = {\n  Webkit: \"-webkit-\",\n  Moz: \"-moz-\",\n  ms: \"-ms-\"\n};\n\nfunction prefixValue(value, propertyPrefixMap) {\n  if ((0, _isPrefixedValue2.default)(value)) {\n    return value;\n  }\n\n  // only split multi values, not cubic beziers\n  var multipleValues = value.split(/,(?![^()]*(?:\\([^()]*\\))?\\))/g);\n\n  for (var i = 0, len = multipleValues.length; i < len; ++i) {\n    var singleValue = multipleValues[i];\n    var values = [singleValue];\n    for (var property in propertyPrefixMap) {\n      var dashCaseProperty = (0, _hyphenateProperty2.default)(property);\n\n      if (singleValue.indexOf(dashCaseProperty) > -1 && dashCaseProperty !== \"order\") {\n        var prefixes = propertyPrefixMap[property];\n        for (var j = 0, pLen = prefixes.length; j < pLen; ++j) {\n          // join all prefixes and create a new value\n          values.unshift(singleValue.replace(dashCaseProperty, prefixMapping[prefixes[j]] + dashCaseProperty));\n        }\n      }\n    }\n\n    multipleValues[i] = values.join(\",\");\n  }\n\n  return multipleValues.join(\",\");\n}\n\nfunction transition(property, value, style, propertyPrefixMap) {\n  // also check for already prefixed transitions\n  if (typeof value === \"string\" && properties.hasOwnProperty(property)) {\n    var outputValue = prefixValue(value, propertyPrefixMap);\n    // if the property is already prefixed\n    var webkitOutput = outputValue.split(/,(?![^()]*(?:\\([^()]*\\))?\\))/g).filter(function (val) {\n      return !/-moz-|-ms-/.test(val);\n    }).join(\",\");\n\n    if (property.indexOf(\"Webkit\") > -1) {\n      return webkitOutput;\n    }\n\n    var mozOutput = outputValue.split(/,(?![^()]*(?:\\([^()]*\\))?\\))/g).filter(function (val) {\n      return !/-webkit-|-ms-/.test(val);\n    }).join(\",\");\n\n    if (property.indexOf(\"Moz\") > -1) {\n      return mozOutput;\n    }\n\n    style[\"Webkit\" + (0, _capitalizeString2.default)(property)] = webkitOutput;\n    style[\"Moz\" + (0, _capitalizeString2.default)(property)] = mozOutput;\n    return outputValue;\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nfunction hash(str) {\n  var hash = 5381,\n      i    = str.length;\n\n  while(i) {\n    hash = (hash * 33) ^ str.charCodeAt(--i);\n  }\n\n  /* JavaScript does bitwise operations (like XOR, above) on 32-bit signed\n   * integers. Since we want the results to be always positive, convert the\n   * signed int to an unsigned by doing an unsigned bitshift. */\n  return hash >>> 0;\n}\n\nmodule.exports = hash;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = prefixProperty;\n\nvar _capitalizeString = require(\"./capitalizeString\");\n\nvar _capitalizeString2 = _interopRequireDefault(_capitalizeString);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction prefixProperty(prefixProperties, property, style) {\n  if (prefixProperties.hasOwnProperty(property)) {\n    var newStyle = {};\n    var requiredPrefixes = prefixProperties[property];\n    var capitalizedProperty = (0, _capitalizeString2.default)(property);\n    var keys = Object.keys(style);\n    for (var i = 0; i < keys.length; i++) {\n      var styleProperty = keys[i];\n      if (styleProperty === property) {\n        for (var j = 0; j < requiredPrefixes.length; j++) {\n          newStyle[requiredPrefixes[j] + capitalizedProperty] = style[property];\n        }\n      }\n      newStyle[styleProperty] = style[styleProperty];\n    }\n    return newStyle;\n  }\n  return style;\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = prefixValue;\nfunction prefixValue(plugins, property, value, style, metaData) {\n  for (var i = 0, len = plugins.length; i < len; ++i) {\n    var processedValue = plugins[i](property, value, style, metaData);\n\n    // we can stop processing if a value is returned\n    // as all plugin criteria are unique\n    if (processedValue) {\n      return processedValue;\n    }\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = addNewValuesOnly;\nfunction addIfNew(list, value) {\n  if (list.indexOf(value) === -1) {\n    list.push(value);\n  }\n}\n\nfunction addNewValuesOnly(list, values) {\n  if (Array.isArray(values)) {\n    for (var i = 0, len = values.length; i < len; ++i) {\n      addIfNew(list, values[i]);\n    }\n  } else {\n    addIfNew(list, values);\n  }\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isObject;\nfunction isObject(value) {\n  return value instanceof Object && !Array.isArray(value);\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = createPrefixer;\n\nvar _prefixProperty = require(\"../utils/prefixProperty\");\n\nvar _prefixProperty2 = _interopRequireDefault(_prefixProperty);\n\nvar _prefixValue = require(\"../utils/prefixValue\");\n\nvar _prefixValue2 = _interopRequireDefault(_prefixValue);\n\nvar _addNewValuesOnly = require(\"../utils/addNewValuesOnly\");\n\nvar _addNewValuesOnly2 = _interopRequireDefault(_addNewValuesOnly);\n\nvar _isObject = require(\"../utils/isObject\");\n\nvar _isObject2 = _interopRequireDefault(_isObject);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction createPrefixer(_ref) {\n  var prefixMap = _ref.prefixMap,\n      plugins = _ref.plugins;\n\n  function prefixAll(style) {\n    for (var property in style) {\n      var value = style[property];\n\n      // handle nested objects\n      if ((0, _isObject2.default)(value)) {\n        style[property] = prefixAll(value);\n        // handle array values\n      } else if (Array.isArray(value)) {\n        var combinedValue = [];\n\n        for (var i = 0, len = value.length; i < len; ++i) {\n          var processedValue = (0, _prefixValue2.default)(plugins, property, value[i], style, prefixMap);\n          (0, _addNewValuesOnly2.default)(combinedValue, processedValue || value[i]);\n        }\n\n        // only modify the value if it was touched\n        // by any plugin to prevent unnecessary mutations\n        if (combinedValue.length > 0) {\n          style[property] = combinedValue;\n        }\n      } else {\n        var _processedValue = (0, _prefixValue2.default)(plugins, property, value, style, prefixMap);\n\n        // only modify the value if it was touched\n        // by any plugin to prevent unnecessary mutations\n        if (_processedValue) {\n          style[property] = _processedValue;\n        }\n\n        style = (0, _prefixProperty2.default)(prefixMap, property, style);\n      }\n    }\n\n    return style;\n  }\n\n  return prefixAll;\n}\nmodule.exports = exports[\"default\"];","\"use strict\";\n\n// Use the fastest means possible to execute a task in its own turn, with\n// priority over other events including IO, animation, reflow, and redraw\n// events in browsers.\n//\n// An exception thrown by a task will permanently interrupt the processing of\n// subsequent tasks. The higher level `asap` function ensures that if an\n// exception is thrown by a task, that the task queue will continue flushing as\n// soon as possible, but if you use `rawAsap` directly, you are responsible to\n// either ensure that no exceptions are thrown from your task, or to manually\n// call `rawAsap.requestFlush` if an exception is thrown.\nmodule.exports = rawAsap;\nfunction rawAsap(task) {\n    if (!queue.length) {\n        requestFlush();\n        flushing = true;\n    }\n    // Equivalent to push, but avoids a function call.\n    queue[queue.length] = task;\n}\n\nvar queue = [];\n// Once a flush has been requested, no further calls to `requestFlush` are\n// necessary until the next `flush` completes.\nvar flushing = false;\n// `requestFlush` is an implementation-specific method that attempts to kick\n// off a `flush` event as quickly as possible. `flush` will attempt to exhaust\n// the event queue before yielding to the browser's own event loop.\nvar requestFlush;\n// The position of the next task to execute in the task queue. This is\n// preserved between calls to `flush` so that it can be resumed if\n// a task throws an exception.\nvar index = 0;\n// If a task schedules additional tasks recursively, the task queue can grow\n// unbounded. To prevent memory exhaustion, the task queue will periodically\n// truncate already-completed tasks.\nvar capacity = 1024;\n\n// The flush function processes all tasks that have been scheduled with\n// `rawAsap` unless and until one of those tasks throws an exception.\n// If a task throws an exception, `flush` ensures that its state will remain\n// consistent and will resume where it left off when called again.\n// However, `flush` does not make any arrangements to be called again if an\n// exception is thrown.\nfunction flush() {\n    while (index < queue.length) {\n        var currentIndex = index;\n        // Advance the index before calling the task. This ensures that we will\n        // begin flushing on the next task the task throws an error.\n        index = index + 1;\n        queue[currentIndex].call();\n        // Prevent leaking memory for long chains of recursive calls to `asap`.\n        // If we call `asap` within tasks scheduled by `asap`, the queue will\n        // grow, but to avoid an O(n) walk for every task we execute, we don't\n        // shift tasks off the queue after they have been executed.\n        // Instead, we periodically shift 1024 tasks off the queue.\n        if (index > capacity) {\n            // Manually shift all values starting at the index back to the\n            // beginning of the queue.\n            for (var scan = 0, newLength = queue.length - index; scan < newLength; scan++) {\n                queue[scan] = queue[scan + index];\n            }\n            queue.length -= index;\n            index = 0;\n        }\n    }\n    queue.length = 0;\n    index = 0;\n    flushing = false;\n}\n\n// `requestFlush` is implemented using a strategy based on data collected from\n// every available SauceLabs Selenium web driver worker at time of writing.\n// https://docs.google.com/spreadsheets/d/1mG-5UYGup5qxGdEMWkhP6BWCz053NUb2E1QoUTU16uA/edit#gid=783724593\n\n// Safari 6 and 6.1 for desktop, iPad, and iPhone are the only browsers that\n// have WebKitMutationObserver but not un-prefixed MutationObserver.\n// Must use `global` or `self` instead of `window` to work in both frames and web\n// workers. `global` is a provision of Browserify, Mr, Mrs, or Mop.\n\n/* globals self */\nvar scope = typeof global !== \"undefined\" ? global : self;\nvar BrowserMutationObserver = scope.MutationObserver || scope.WebKitMutationObserver;\n\n// MutationObservers are desirable because they have high priority and work\n// reliably everywhere they are implemented.\n// They are implemented in all modern browsers.\n//\n// - Android 4-4.3\n// - Chrome 26-34\n// - Firefox 14-29\n// - Internet Explorer 11\n// - iPad Safari 6-7.1\n// - iPhone Safari 7-7.1\n// - Safari 6-7\nif (typeof BrowserMutationObserver === \"function\") {\n    requestFlush = makeRequestCallFromMutationObserver(flush);\n\n// MessageChannels are desirable because they give direct access to the HTML\n// task queue, are implemented in Internet Explorer 10, Safari 5.0-1, and Opera\n// 11-12, and in web workers in many engines.\n// Although message channels yield to any queued rendering and IO tasks, they\n// would be better than imposing the 4ms delay of timers.\n// However, they do not work reliably in Internet Explorer or Safari.\n\n// Internet Explorer 10 is the only browser that has setImmediate but does\n// not have MutationObservers.\n// Although setImmediate yields to the browser's renderer, it would be\n// preferrable to falling back to setTimeout since it does not have\n// the minimum 4ms penalty.\n// Unfortunately there appears to be a bug in Internet Explorer 10 Mobile (and\n// Desktop to a lesser extent) that renders both setImmediate and\n// MessageChannel useless for the purposes of ASAP.\n// https://github.com/kriskowal/q/issues/396\n\n// Timers are implemented universally.\n// We fall back to timers in workers in most engines, and in foreground\n// contexts in the following browsers.\n// However, note that even this simple case requires nuances to operate in a\n// broad spectrum of browsers.\n//\n// - Firefox 3-13\n// - Internet Explorer 6-9\n// - iPad Safari 4.3\n// - Lynx 2.8.7\n} else {\n    requestFlush = makeRequestCallFromTimer(flush);\n}\n\n// `requestFlush` requests that the high priority event queue be flushed as\n// soon as possible.\n// This is useful to prevent an error thrown in a task from stalling the event\n// queue if the exception handled by Node.jss\n// `process.on(\"uncaughtException\")` or by a domain.\nrawAsap.requestFlush = requestFlush;\n\n// To request a high priority event, we induce a mutation observer by toggling\n// the text of a text node between \"1\" and \"-1\".\nfunction makeRequestCallFromMutationObserver(callback) {\n    var toggle = 1;\n    var observer = new BrowserMutationObserver(callback);\n    var node = document.createTextNode(\"\");\n    observer.observe(node, {characterData: true});\n    return function requestCall() {\n        toggle = -toggle;\n        node.data = toggle;\n    };\n}\n\n// The message channel technique was discovered by Malte Ubl and was the\n// original foundation for this library.\n// http://www.nonblocking.io/2011/06/windownexttick.html\n\n// Safari 6.0.5 (at least) intermittently fails to create message ports on a\n// page's first load. Thankfully, this version of Safari supports\n// MutationObservers, so we don't need to fall back in that case.\n\n// function makeRequestCallFromMessageChannel(callback) {\n//     var channel = new MessageChannel();\n//     channel.port1.onmessage = callback;\n//     return function requestCall() {\n//         channel.port2.postMessage(0);\n//     };\n// }\n\n// For reasons explained above, we are also unable to use `setImmediate`\n// under any circumstances.\n// Even if we were, there is another bug in Internet Explorer 10.\n// It is not sufficient to assign `setImmediate` to `requestFlush` because\n// `setImmediate` must be called *by name* and therefore must be wrapped in a\n// closure.\n// Never forget.\n\n// function makeRequestCallFromSetImmediate(callback) {\n//     return function requestCall() {\n//         setImmediate(callback);\n//     };\n// }\n\n// Safari 6.0 has a problem where timers will get lost while the user is\n// scrolling. This problem does not impact ASAP because Safari 6.0 supports\n// mutation observers, so that implementation is used instead.\n// However, if we ever elect to use timers in Safari, the prevalent work-around\n// is to add a scroll event listener that calls for a flush.\n\n// `setTimeout` does not call the passed callback if the delay is less than\n// approximately 7 in web workers in Firefox 8 through 18, and sometimes not\n// even then.\n\nfunction makeRequestCallFromTimer(callback) {\n    return function requestCall() {\n        // We dispatch a timeout with a specified delay of 0 for engines that\n        // can reliably accommodate that request. This will usually be snapped\n        // to a 4 milisecond delay, but once we're flushing, there's no delay\n        // between events.\n        var timeoutHandle = setTimeout(handleTimer, 0);\n        // However, since this timer gets frequently dropped in Firefox\n        // workers, we enlist an interval handle that will try to fire\n        // an event 20 times per second until it succeeds.\n        var intervalHandle = setInterval(handleTimer, 50);\n\n        function handleTimer() {\n            // Whichever timer succeeds will cancel both timers and\n            // execute the callback.\n            clearTimeout(timeoutHandle);\n            clearInterval(intervalHandle);\n            callback();\n        }\n    };\n}\n\n// This is for `asap.js` only.\n// Its name will be periodically randomized to break any code that depends on\n// its existence.\nrawAsap.makeRequestCallFromTimer = makeRequestCallFromTimer;\n\n// ASAP was originally a nextTick shim included in Q. This was factored out\n// into this ASAP package. It was later adapted to RSVP which made further\n// amendments. These decisions, particularly to marginalize MessageChannel and\n// to capture the MutationObserver implementation in a closure, were integrated\n// back into ASAP proper.\n// https://github.com/tildeio/rsvp.js/blob/cddf7232546a9cf858524b75cde6f9edf72620a7/lib/rsvp/asap.js\n","\"use strict\";\n\n// rawAsap provides everything we need except exception management.\nvar rawAsap = require(\"./raw\");\n// RawTasks are recycled to reduce GC churn.\nvar freeTasks = [];\n// We queue errors to ensure they are thrown in right order (FIFO).\n// Array-as-queue is good enough here, since we are just dealing with exceptions.\nvar pendingErrors = [];\nvar requestErrorThrow = rawAsap.makeRequestCallFromTimer(throwFirstError);\n\nfunction throwFirstError() {\n    if (pendingErrors.length) {\n        throw pendingErrors.shift();\n    }\n}\n\n/**\n * Calls a task as soon as possible after returning, in its own event, with priority\n * over other events like animation, reflow, and repaint. An error thrown from an\n * event will not interrupt, nor even substantially slow down the processing of\n * other events, but will be rather postponed to a lower priority event.\n * @param {{call}} task A callable object, typically a function that takes no\n * arguments.\n */\nmodule.exports = asap;\nfunction asap(task) {\n    var rawTask;\n    if (freeTasks.length) {\n        rawTask = freeTasks.pop();\n    } else {\n        rawTask = new RawTask();\n    }\n    rawTask.task = task;\n    rawAsap(rawTask);\n}\n\n// We wrap tasks with recyclable task objects.  A task object implements\n// `call`, just like a function.\nfunction RawTask() {\n    this.task = null;\n}\n\n// The sole purpose of wrapping the task is to catch the exception and recycle\n// the task object after its single use.\nRawTask.prototype.call = function () {\n    try {\n        this.task.call();\n    } catch (error) {\n        if (asap.onerror) {\n            // This hook exists purely for testing purposes.\n            // Its name will be periodically randomized to break any code that\n            // depends on its existence.\n            asap.onerror(error);\n        } else {\n            // In a web browser, exceptions are not fatal. However, to avoid\n            // slowing down the queue of pending tasks, we rethrow the error in a\n            // lower priority turn.\n            pendingErrors.push(error);\n            requestErrorThrow();\n        }\n    } finally {\n        this.task = null;\n        freeTasks[freeTasks.length] = this;\n    }\n};\n","import calc from 'inline-style-prefixer/static/plugins/calc';\nimport crossFade from 'inline-style-prefixer/static/plugins/crossFade';\nimport cursor from 'inline-style-prefixer/static/plugins/cursor';\nimport filter from 'inline-style-prefixer/static/plugins/filter';\nimport flex from 'inline-style-prefixer/static/plugins/flex';\nimport flexboxIE from 'inline-style-prefixer/static/plugins/flexboxIE';\nimport flexboxOld from 'inline-style-prefixer/static/plugins/flexboxOld';\nimport gradient from 'inline-style-prefixer/static/plugins/gradient';\nimport imageSet from 'inline-style-prefixer/static/plugins/imageSet';\nimport position from 'inline-style-prefixer/static/plugins/position';\nimport sizing from 'inline-style-prefixer/static/plugins/sizing';\nimport transition from 'inline-style-prefixer/static/plugins/transition';\nimport stringHash from 'string-hash';\nimport createPrefixer from 'inline-style-prefixer/static/createPrefixer';\nimport asap from 'asap';\n\nvar w = [\"Webkit\"];\nvar m = [\"Moz\"];\nvar ms = [\"ms\"];\nvar wm = [\"Webkit\", \"Moz\"];\nvar wms = [\"Webkit\", \"ms\"];\nvar wmms = [\"Webkit\", \"Moz\", \"ms\"];\n\nvar staticPrefixData = {\n  plugins: [calc, crossFade, cursor, filter, flex, flexboxIE, flexboxOld, gradient, imageSet, position, sizing, transition],\n  prefixMap: { \"transform\": wms, \"transformOrigin\": wms, \"transformOriginX\": wms, \"transformOriginY\": wms, \"backfaceVisibility\": w, \"perspective\": w, \"perspectiveOrigin\": w, \"transformStyle\": w, \"transformOriginZ\": w, \"animation\": w, \"animationDelay\": w, \"animationDirection\": w, \"animationFillMode\": w, \"animationDuration\": w, \"animationIterationCount\": w, \"animationName\": w, \"animationPlayState\": w, \"animationTimingFunction\": w, \"appearance\": wm, \"userSelect\": wmms, \"fontKerning\": w, \"textEmphasisPosition\": w, \"textEmphasis\": w, \"textEmphasisStyle\": w, \"textEmphasisColor\": w, \"boxDecorationBreak\": w, \"clipPath\": w, \"maskImage\": w, \"maskMode\": w, \"maskRepeat\": w, \"maskPosition\": w, \"maskClip\": w, \"maskOrigin\": w, \"maskSize\": w, \"maskComposite\": w, \"mask\": w, \"maskBorderSource\": w, \"maskBorderMode\": w, \"maskBorderSlice\": w, \"maskBorderWidth\": w, \"maskBorderOutset\": w, \"maskBorderRepeat\": w, \"maskBorder\": w, \"maskType\": w, \"textDecorationStyle\": wm, \"textDecorationSkip\": wm, \"textDecorationLine\": wm, \"textDecorationColor\": wm, \"filter\": w, \"fontFeatureSettings\": wm, \"breakAfter\": wmms, \"breakBefore\": wmms, \"breakInside\": wmms, \"columnCount\": wm, \"columnFill\": wm, \"columnGap\": wm, \"columnRule\": wm, \"columnRuleColor\": wm, \"columnRuleStyle\": wm, \"columnRuleWidth\": wm, \"columns\": wm, \"columnSpan\": wm, \"columnWidth\": wm, \"writingMode\": wms, \"flex\": wms, \"flexBasis\": w, \"flexDirection\": wms, \"flexGrow\": w, \"flexFlow\": wms, \"flexShrink\": w, \"flexWrap\": wms, \"alignContent\": w, \"alignItems\": w, \"alignSelf\": w, \"justifyContent\": w, \"order\": w, \"transitionDelay\": w, \"transitionDuration\": w, \"transitionProperty\": w, \"transitionTimingFunction\": w, \"backdropFilter\": w, \"scrollSnapType\": wms, \"scrollSnapPointsX\": wms, \"scrollSnapPointsY\": wms, \"scrollSnapDestination\": wms, \"scrollSnapCoordinate\": wms, \"shapeImageThreshold\": w, \"shapeImageMargin\": w, \"shapeImageOutside\": w, \"hyphens\": wmms, \"flowInto\": wms, \"flowFrom\": wms, \"regionFragment\": wms, \"boxSizing\": m, \"textAlignLast\": m, \"tabSize\": m, \"wrapFlow\": ms, \"wrapThrough\": ms, \"wrapMargin\": ms, \"touchAction\": ms, \"gridTemplateColumns\": ms, \"gridTemplateRows\": ms, \"gridTemplateAreas\": ms, \"gridTemplate\": ms, \"gridAutoColumns\": ms, \"gridAutoRows\": ms, \"gridAutoFlow\": ms, \"grid\": ms, \"gridRowStart\": ms, \"gridColumnStart\": ms, \"gridRowEnd\": ms, \"gridRow\": ms, \"gridColumn\": ms, \"gridColumnEnd\": ms, \"gridColumnGap\": ms, \"gridRowGap\": ms, \"gridArea\": ms, \"gridGap\": ms, \"textSizeAdjust\": wms, \"borderImage\": w, \"borderImageOutset\": w, \"borderImageRepeat\": w, \"borderImageSlice\": w, \"borderImageSource\": w, \"borderImageWidth\": w }\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MAP_EXISTS = typeof Map !== 'undefined';\n\nvar OrderedElements = function () {\n    /* ::\n    elements: {[string]: any};\n    keyOrder: string[];\n    */\n\n    function OrderedElements() {\n        _classCallCheck(this, OrderedElements);\n\n        this.elements = {};\n        this.keyOrder = [];\n    }\n\n    _createClass(OrderedElements, [{\n        key: 'forEach',\n        value: function () {\n            function forEach(callback /* : (string, any) => void */) {\n                for (var i = 0; i < this.keyOrder.length; i++) {\n                    // (value, key) to match Map's API\n                    callback(this.elements[this.keyOrder[i]], this.keyOrder[i]);\n                }\n            }\n\n            return forEach;\n        }()\n    }, {\n        key: 'set',\n        value: function () {\n            function set(key /* : string */, value /* : any */, shouldReorder /* : ?boolean */) {\n                if (!this.elements.hasOwnProperty(key)) {\n                    this.keyOrder.push(key);\n                } else if (shouldReorder) {\n                    var index = this.keyOrder.indexOf(key);\n                    this.keyOrder.splice(index, 1);\n                    this.keyOrder.push(key);\n                }\n\n                if (value == null) {\n                    this.elements[key] = value;\n                    return;\n                }\n\n                if (MAP_EXISTS && value instanceof Map || value instanceof OrderedElements) {\n                    // We have found a nested Map, so we need to recurse so that all\n                    // of the nested objects and Maps are merged properly.\n                    var nested = this.elements.hasOwnProperty(key) ? this.elements[key] : new OrderedElements();\n                    value.forEach(function (value, key) {\n                        nested.set(key, value, shouldReorder);\n                    });\n                    this.elements[key] = nested;\n                    return;\n                }\n\n                if (!Array.isArray(value) && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {\n                    // We have found a nested object, so we need to recurse so that all\n                    // of the nested objects and Maps are merged properly.\n                    var _nested = this.elements.hasOwnProperty(key) ? this.elements[key] : new OrderedElements();\n                    var keys = Object.keys(value);\n                    for (var i = 0; i < keys.length; i += 1) {\n                        _nested.set(keys[i], value[keys[i]], shouldReorder);\n                    }\n                    this.elements[key] = _nested;\n                    return;\n                }\n\n                this.elements[key] = value;\n            }\n\n            return set;\n        }()\n    }, {\n        key: 'get',\n        value: function () {\n            function get(key /* : string */) /* : any */{\n                return this.elements[key];\n            }\n\n            return get;\n        }()\n    }, {\n        key: 'has',\n        value: function () {\n            function has(key /* : string */) /* : boolean */{\n                return this.elements.hasOwnProperty(key);\n            }\n\n            return has;\n        }()\n    }, {\n        key: 'addStyleType',\n        value: function () {\n            function addStyleType(styleType /* : any */) /* : void */{\n                var _this = this;\n\n                if (MAP_EXISTS && styleType instanceof Map || styleType instanceof OrderedElements) {\n                    styleType.forEach(function (value, key) {\n                        _this.set(key, value, true);\n                    });\n                } else {\n                    var keys = Object.keys(styleType);\n                    for (var i = 0; i < keys.length; i++) {\n                        this.set(keys[i], styleType[keys[i]], true);\n                    }\n                }\n            }\n\n            return addStyleType;\n        }()\n    }]);\n\n    return OrderedElements;\n}();\n\n/* ::\ntype ObjectMap = { [id:string]: any };\n*/\n\nvar UPPERCASE_RE = /([A-Z])/g;\nvar UPPERCASE_RE_TO_KEBAB = function UPPERCASE_RE_TO_KEBAB(match /* : string */) {\n    return (/* : string */'-' + String(match.toLowerCase())\n    );\n};\n\nvar kebabifyStyleName = function kebabifyStyleName(string /* : string */) /* : string */{\n    var result = string.replace(UPPERCASE_RE, UPPERCASE_RE_TO_KEBAB);\n    if (result[0] === 'm' && result[1] === 's' && result[2] === '-') {\n        return '-' + String(result);\n    }\n    return result;\n};\n\n/**\n * CSS properties which accept numbers but are not in units of \"px\".\n * Taken from React's CSSProperty.js\n */\nvar isUnitlessNumber = {\n    animationIterationCount: true,\n    borderImageOutset: true,\n    borderImageSlice: true,\n    borderImageWidth: true,\n    boxFlex: true,\n    boxFlexGroup: true,\n    boxOrdinalGroup: true,\n    columnCount: true,\n    flex: true,\n    flexGrow: true,\n    flexPositive: true,\n    flexShrink: true,\n    flexNegative: true,\n    flexOrder: true,\n    gridRow: true,\n    gridColumn: true,\n    fontWeight: true,\n    lineClamp: true,\n    lineHeight: true,\n    opacity: true,\n    order: true,\n    orphans: true,\n    tabSize: true,\n    widows: true,\n    zIndex: true,\n    zoom: true,\n\n    // SVG-related properties\n    fillOpacity: true,\n    floodOpacity: true,\n    stopOpacity: true,\n    strokeDasharray: true,\n    strokeDashoffset: true,\n    strokeMiterlimit: true,\n    strokeOpacity: true,\n    strokeWidth: true\n};\n\n/**\n * Taken from React's CSSProperty.js\n *\n * @param {string} prefix vendor-specific prefix, eg: Webkit\n * @param {string} key style name, eg: transitionDuration\n * @return {string} style name prefixed with `prefix`, properly camelCased, eg:\n * WebkitTransitionDuration\n */\nfunction prefixKey(prefix, key) {\n    return prefix + key.charAt(0).toUpperCase() + key.substring(1);\n}\n\n/**\n * Support style names that may come passed in prefixed by adding permutations\n * of vendor prefixes.\n * Taken from React's CSSProperty.js\n */\nvar prefixes = ['Webkit', 'ms', 'Moz', 'O'];\n\n// Using Object.keys here, or else the vanilla for-in loop makes IE8 go into an\n// infinite loop, because it iterates over the newly added props too.\n// Taken from React's CSSProperty.js\nObject.keys(isUnitlessNumber).forEach(function (prop) {\n    prefixes.forEach(function (prefix) {\n        isUnitlessNumber[prefixKey(prefix, prop)] = isUnitlessNumber[prop];\n    });\n});\n\nvar stringifyValue = function stringifyValue(key /* : string */\n, prop /* : any */\n) /* : string */{\n    if (typeof prop === \"number\") {\n        if (isUnitlessNumber[key]) {\n            return \"\" + prop;\n        } else {\n            return prop + \"px\";\n        }\n    } else {\n        return '' + prop;\n    }\n};\n\nvar stringifyAndImportantifyValue = function stringifyAndImportantifyValue(key /* : string */\n, prop /* : any */\n) {\n    return (/* : string */importantify(stringifyValue(key, prop))\n    );\n};\n\n// Turn a string into a hash string of base-36 values (using letters and numbers)\n// eslint-disable-next-line no-unused-vars\nvar hashString = function hashString(string /* : string */, key /* : ?string */) {\n    return (/* string */stringHash(string).toString(36)\n    );\n};\n\n// Hash a javascript object using JSON.stringify. This is very fast, about 3\n// microseconds on my computer for a sample object:\n// http://jsperf.com/test-hashfnv32a-hash/5\n//\n// Note that this uses JSON.stringify to stringify the objects so in order for\n// this to produce consistent hashes browsers need to have a consistent\n// ordering of objects. Ben Alpert says that Facebook depends on this, so we\n// can probably depend on this too.\nvar hashObject = function hashObject(object /* : ObjectMap */) {\n    return (/* : string */hashString(JSON.stringify(object))\n    );\n};\n\n// Given a single style value string like the \"b\" from \"a: b;\", adds !important\n// to generate \"b !important\".\nvar importantify = function importantify(string /* : string */) {\n    return (/* : string */\n        // Bracket string character access is very fast, and in the default case we\n        // normally don't expect there to be \"!important\" at the end of the string\n        // so we can use this simple check to take an optimized path. If there\n        // happens to be a \"!\" in this position, we follow up with a more thorough\n        // check.\n        string[string.length - 10] === '!' && string.slice(-11) === ' !important' ? string : String(string) + ' !important'\n    );\n};\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar prefixAll = createPrefixer(staticPrefixData);\n\n/* ::\nimport type { SheetDefinition } from './index.js';\ntype StringHandlers = { [id:string]: Function };\ntype SelectorCallback = (selector: string) => string[];\nexport type SelectorHandler = (\n    selector: string,\n    baseSelector: string,\n    callback: SelectorCallback\n) => string[] | string | null;\n*/\n\n/**\n * `selectorHandlers` are functions which handle special selectors which act\n * differently than normal style definitions. These functions look at the\n * current selector and can generate CSS for the styles in their subtree by\n * calling the callback with a new selector.\n *\n * For example, when generating styles with a base selector of '.foo' and the\n * following styles object:\n *\n *   {\n *     ':nth-child(2n)': {\n *       ':hover': {\n *         color: 'red'\n *       }\n *     }\n *   }\n *\n * when we reach the ':hover' style, we would call our selector handlers like\n *\n *   handler(':hover', '.foo:nth-child(2n)', callback)\n *\n * Since our `pseudoSelectors` handles ':hover' styles, that handler would call\n * the callback like\n *\n *   callback('.foo:nth-child(2n):hover')\n *\n * to generate its subtree `{ color: 'red' }` styles with a\n * '.foo:nth-child(2n):hover' selector. The callback would return an array of CSS\n * rules like\n *\n *   ['.foo:nth-child(2n):hover{color:red !important;}']\n *\n * and the handler would then return that resulting CSS.\n *\n * `defaultSelectorHandlers` is the list of default handlers used in a call to\n * `generateCSS`.\n *\n * @name SelectorHandler\n * @function\n * @param {string} selector: The currently inspected selector. ':hover' in the\n *     example above.\n * @param {string} baseSelector: The selector of the parent styles.\n *     '.foo:nth-child(2n)' in the example above.\n * @param {function} generateSubtreeStyles: A function which can be called to\n *     generate CSS for the subtree of styles corresponding to the selector.\n *     Accepts a new baseSelector to use for generating those styles.\n * @returns {string[] | string | null} The generated CSS for this selector, or\n *     null if we don't handle this selector.\n */\nvar defaultSelectorHandlers /* : SelectorHandler[] */ = [\n// Handle pseudo-selectors, like :hover and :nth-child(3n)\nfunction () {\n    function pseudoSelectors(selector, baseSelector, generateSubtreeStyles) {\n        if (selector[0] !== \":\") {\n            return null;\n        }\n        return generateSubtreeStyles(baseSelector + selector);\n    }\n\n    return pseudoSelectors;\n}(),\n\n// Handle media queries (or font-faces)\nfunction () {\n    function mediaQueries(selector, baseSelector, generateSubtreeStyles) {\n        if (selector[0] !== \"@\") {\n            return null;\n        }\n        // Generate the styles normally, and then wrap them in the media query.\n        var generated = generateSubtreeStyles(baseSelector);\n        return [String(selector) + '{' + String(generated.join('')) + '}'];\n    }\n\n    return mediaQueries;\n}()];\n\n/**\n * Generate CSS for a selector and some styles.\n *\n * This function handles the media queries and pseudo selectors that can be used\n * in aphrodite styles.\n *\n * @param {string} selector: A base CSS selector for the styles to be generated\n *     with.\n * @param {Object} styleTypes: A list of properties of the return type of\n *     StyleSheet.create, e.g. [styles.red, styles.blue].\n * @param {Array.<SelectorHandler>} selectorHandlers: A list of selector\n *     handlers to use for handling special selectors. See\n *     `defaultSelectorHandlers`.\n * @param stringHandlers: See `generateCSSRuleset`\n * @param useImportant: See `generateCSSRuleset`\n *\n * To actually generate the CSS special-construct-less styles are passed to\n * `generateCSSRuleset`.\n *\n * For instance, a call to\n *\n *     generateCSS(\".foo\", [{\n *       color: \"red\",\n *       \"@media screen\": {\n *         height: 20,\n *         \":hover\": {\n *           backgroundColor: \"black\"\n *         }\n *       },\n *       \":active\": {\n *         fontWeight: \"bold\"\n *       }\n *     }], defaultSelectorHandlers);\n *\n * with the default `selectorHandlers` will make 5 calls to\n * `generateCSSRuleset`:\n *\n *     generateCSSRuleset(\".foo\", { color: \"red\" }, ...)\n *     generateCSSRuleset(\".foo:active\", { fontWeight: \"bold\" }, ...)\n *     // These 2 will be wrapped in @media screen {}\n *     generateCSSRuleset(\".foo\", { height: 20 }, ...)\n *     generateCSSRuleset(\".foo:hover\", { backgroundColor: \"black\" }, ...)\n */\nvar generateCSS = function generateCSS(selector /* : string */\n, styleTypes /* : SheetDefinition[] */\n, selectorHandlers /* : SelectorHandler[] */\n, stringHandlers /* : StringHandlers */\n, useImportant /* : boolean */\n) /* : string[] */{\n    var merged = new OrderedElements();\n\n    for (var i = 0; i < styleTypes.length; i++) {\n        merged.addStyleType(styleTypes[i]);\n    }\n\n    var plainDeclarations = new OrderedElements();\n    var generatedStyles = [];\n\n    // TODO(emily): benchmark this to see if a plain for loop would be faster.\n    merged.forEach(function (val, key) {\n        // For each key, see if one of the selector handlers will handle these\n        // styles.\n        var foundHandler = selectorHandlers.some(function (handler) {\n            var result = handler(key, selector, function (newSelector) {\n                return generateCSS(newSelector, [val], selectorHandlers, stringHandlers, useImportant);\n            });\n            if (result != null) {\n                // If the handler returned something, add it to the generated\n                // CSS and stop looking for another handler.\n                if (Array.isArray(result)) {\n                    generatedStyles.push.apply(generatedStyles, _toConsumableArray(result));\n                } else {\n                    // eslint-disable-next-line\n                    console.warn('WARNING: Selector handlers should return an array of rules.' + 'Returning a string containing multiple rules is deprecated.', handler);\n                    generatedStyles.push('@media all {' + String(result) + '}');\n                }\n                return true;\n            }\n        });\n        // If none of the handlers handled it, add it to the list of plain\n        // style declarations.\n        if (!foundHandler) {\n            plainDeclarations.set(key, val, true);\n        }\n    });\n    var generatedRuleset = generateCSSRuleset(selector, plainDeclarations, stringHandlers, useImportant, selectorHandlers);\n\n    if (generatedRuleset) {\n        generatedStyles.unshift(generatedRuleset);\n    }\n\n    return generatedStyles;\n};\n\n/**\n * Helper method of generateCSSRuleset to facilitate custom handling of certain\n * CSS properties. Used for e.g. font families.\n *\n * See generateCSSRuleset for usage and documentation of paramater types.\n */\nvar runStringHandlers = function runStringHandlers(declarations /* : OrderedElements */\n, stringHandlers /* : StringHandlers */\n, selectorHandlers /* : SelectorHandler[] */\n) /* : void */{\n    if (!stringHandlers) {\n        return;\n    }\n\n    var stringHandlerKeys = Object.keys(stringHandlers);\n    for (var i = 0; i < stringHandlerKeys.length; i++) {\n        var key = stringHandlerKeys[i];\n        if (declarations.has(key)) {\n            // A declaration exists for this particular string handler, so we\n            // need to let the string handler interpret the declaration first\n            // before proceeding.\n            //\n            // TODO(emily): Pass in a callback which generates CSS, similar to\n            // how our selector handlers work, instead of passing in\n            // `selectorHandlers` and have them make calls to `generateCSS`\n            // themselves. Right now, this is impractical because our string\n            // handlers are very specialized and do complex things.\n            declarations.set(key, stringHandlers[key](declarations.get(key), selectorHandlers),\n\n            // Preserve order here, since we are really replacing an\n            // unprocessed style with a processed style, not overriding an\n            // earlier style\n            false);\n        }\n    }\n};\n\nvar transformRule = function transformRule(key /* : string */\n, value /* : string */\n, transformValue /* : function */\n) {\n    return (/* : string */String(kebabifyStyleName(key)) + ':' + String(transformValue(key, value)) + ';'\n    );\n};\n\nvar arrayToObjectKeysReducer = function arrayToObjectKeysReducer(acc, val) {\n    acc[val] = true;\n    return acc;\n};\n\n/**\n * Generate a CSS ruleset with the selector and containing the declarations.\n *\n * This function assumes that the given declarations don't contain any special\n * children (such as media queries, pseudo-selectors, or descendant styles).\n *\n * Note that this method does not deal with nesting used for e.g.\n * psuedo-selectors or media queries. That responsibility is left to  the\n * `generateCSS` function.\n *\n * @param {string} selector: the selector associated with the ruleset\n * @param {Object} declarations: a map from camelCased CSS property name to CSS\n *     property value.\n * @param {Object.<string, function>} stringHandlers: a map from camelCased CSS\n *     property name to a function which will map the given value to the value\n *     that is output.\n * @param {bool} useImportant: A boolean saying whether to append \"!important\"\n *     to each of the CSS declarations.\n * @returns {string} A string of raw CSS.\n *\n * Examples:\n *\n *    generateCSSRuleset(\".blah\", { color: \"red\" })\n *    -> \".blah{color: red !important;}\"\n *    generateCSSRuleset(\".blah\", { color: \"red\" }, {}, false)\n *    -> \".blah{color: red}\"\n *    generateCSSRuleset(\".blah\", { color: \"red\" }, {color: c => c.toUpperCase})\n *    -> \".blah{color: RED}\"\n *    generateCSSRuleset(\".blah:hover\", { color: \"red\" })\n *    -> \".blah:hover{color: red}\"\n */\nvar generateCSSRuleset = function generateCSSRuleset(selector /* : string */\n, declarations /* : OrderedElements */\n, stringHandlers /* : StringHandlers */\n, useImportant /* : boolean */\n, selectorHandlers /* : SelectorHandler[] */\n) /* : string */{\n    // Mutates declarations\n    runStringHandlers(declarations, stringHandlers, selectorHandlers);\n\n    var originalElements = Object.keys(declarations.elements).reduce(arrayToObjectKeysReducer, Object.create(null));\n\n    // NOTE(emily): This mutates handledDeclarations.elements.\n    var prefixedElements = prefixAll(declarations.elements);\n\n    var elementNames = Object.keys(prefixedElements);\n    if (elementNames.length !== declarations.keyOrder.length) {\n        // There are some prefixed values, so we need to figure out how to sort\n        // them.\n        //\n        // Loop through prefixedElements, looking for anything that is not in\n        // sortOrder, which means it was added by prefixAll. This means that we\n        // need to figure out where it should appear in the sortOrder.\n        for (var i = 0; i < elementNames.length; i++) {\n            if (!originalElements[elementNames[i]]) {\n                // This element is not in the sortOrder, which means it is a prefixed\n                // value that was added by prefixAll. Let's try to figure out where it\n                // goes.\n                var originalStyle = void 0;\n                if (elementNames[i][0] === 'W') {\n                    // This is a Webkit-prefixed style, like \"WebkitTransition\". Let's\n                    // find its original style's sort order.\n                    originalStyle = elementNames[i][6].toLowerCase() + elementNames[i].slice(7);\n                } else if (elementNames[i][1] === 'o') {\n                    // This is a Moz-prefixed style, like \"MozTransition\". We check\n                    // the second character to avoid colliding with Ms-prefixed\n                    // styles. Let's find its original style's sort order.\n                    originalStyle = elementNames[i][3].toLowerCase() + elementNames[i].slice(4);\n                } else {\n                    // if (elementNames[i][1] === 's') {\n                    // This is a Ms-prefixed style, like \"MsTransition\".\n                    originalStyle = elementNames[i][2].toLowerCase() + elementNames[i].slice(3);\n                }\n\n                if (originalStyle && originalElements[originalStyle]) {\n                    var originalIndex = declarations.keyOrder.indexOf(originalStyle);\n                    declarations.keyOrder.splice(originalIndex, 0, elementNames[i]);\n                } else {\n                    // We don't know what the original style was, so sort it to\n                    // top. This can happen for styles that are added that don't\n                    // have the same base name as the original style.\n                    declarations.keyOrder.unshift(elementNames[i]);\n                }\n            }\n        }\n    }\n\n    var transformValue = useImportant === false ? stringifyValue : stringifyAndImportantifyValue;\n\n    var rules = [];\n    for (var _i = 0; _i < declarations.keyOrder.length; _i++) {\n        var key = declarations.keyOrder[_i];\n        var value = prefixedElements[key];\n        if (Array.isArray(value)) {\n            // inline-style-prefixer returns an array when there should be\n            // multiple rules for the same key. Here we flatten to multiple\n            // pairs with the same key.\n            for (var j = 0; j < value.length; j++) {\n                rules.push(transformRule(key, value[j], transformValue));\n            }\n        } else {\n            rules.push(transformRule(key, value, transformValue));\n        }\n    }\n\n    if (rules.length) {\n        return String(selector) + '{' + String(rules.join(\"\")) + '}';\n    } else {\n        return \"\";\n    }\n};\n\nvar _typeof$1 = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _toConsumableArray$1(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n/* ::\nimport type { SheetDefinition, SheetDefinitions } from './index.js';\nimport type { MaybeSheetDefinition } from './exports.js';\nimport type { SelectorHandler } from './generate.js';\n*/\n\n// The current <style> tag we are inserting into, or null if we haven't\n// inserted anything yet. We could find this each time using\n// `document.querySelector(\"style[data-aphrodite\"])`, but holding onto it is\n// faster.\nvar styleTag /* : ?HTMLStyleElement */ = null;\n\n// Inject a set of rules into a <style> tag in the head of the document. This\n// will automatically create a style tag and then continue to use it for\n// multiple injections. It will also use a style tag with the `data-aphrodite`\n// tag on it if that exists in the DOM. This could be used for e.g. reusing the\n// same style tag that server-side rendering inserts.\nvar injectStyleTag = function injectStyleTag(cssRules /* : string[] */) {\n    if (styleTag == null) {\n        // Try to find a style tag with the `data-aphrodite` attribute first.\n        styleTag = document.querySelector(\"style[data-aphrodite]\") /* : any */;\n\n        // If that doesn't work, generate a new style tag.\n        if (styleTag == null) {\n            // Taken from\n            // http://stackoverflow.com/questions/524696/how-to-create-a-style-tag-with-javascript\n            var head = document.head || document.getElementsByTagName('head')[0];\n            styleTag = document.createElement('style');\n\n            styleTag.type = 'text/css';\n            styleTag.setAttribute(\"data-aphrodite\", \"\");\n            head.appendChild(styleTag);\n        }\n    }\n\n    var sheet = styleTag.styleSheet || styleTag.sheet /* : any */;\n\n    if (sheet.insertRule) {\n        var numRules = sheet.cssRules.length;\n        cssRules.forEach(function (rule) {\n            try {\n                sheet.insertRule(rule, numRules);\n                numRules += 1;\n            } catch (e) {\n                // The selector for this rule wasn't compatible with the browser\n            }\n        });\n    } else {\n        styleTag.innerText = (styleTag.innerText || '') + cssRules.join('');\n    }\n};\n\n// Custom handlers for stringifying CSS values that have side effects\n// (such as fontFamily, which can cause @font-face rules to be injected)\nvar stringHandlers = {\n    // With fontFamily we look for objects that are passed in and interpret\n    // them as @font-face rules that we need to inject. The value of fontFamily\n    // can either be a string (as normal), an object (a single font face), or\n    // an array of objects and strings.\n    fontFamily: function () {\n        function fontFamily(val) {\n            if (Array.isArray(val)) {\n                return val.map(fontFamily).join(\",\");\n            } else if ((typeof val === 'undefined' ? 'undefined' : _typeof$1(val)) === \"object\") {\n                injectStyleOnce(val.src, \"@font-face\", [val], false);\n                return '\"' + String(val.fontFamily) + '\"';\n            } else {\n                return val;\n            }\n        }\n\n        return fontFamily;\n    }(),\n\n    // With animationName we look for an object that contains keyframes and\n    // inject them as an `@keyframes` block, returning a uniquely generated\n    // name. The keyframes object should look like\n    //  animationName: {\n    //    from: {\n    //      left: 0,\n    //      top: 0,\n    //    },\n    //    '50%': {\n    //      left: 15,\n    //      top: 5,\n    //    },\n    //    to: {\n    //      left: 20,\n    //      top: 20,\n    //    }\n    //  }\n    // TODO(emily): `stringHandlers` doesn't let us rename the key, so I have\n    // to use `animationName` here. Improve that so we can call this\n    // `animation` instead of `animationName`.\n    animationName: function () {\n        function animationName(val, selectorHandlers) {\n            if (Array.isArray(val)) {\n                return val.map(function (v) {\n                    return animationName(v, selectorHandlers);\n                }).join(\",\");\n            } else if ((typeof val === 'undefined' ? 'undefined' : _typeof$1(val)) === \"object\") {\n                // Generate a unique name based on the hash of the object. We can't\n                // just use the hash because the name can't start with a number.\n                // TODO(emily): this probably makes debugging hard, allow a custom\n                // name?\n                var name = 'keyframe_' + String(hashObject(val));\n\n                // Since keyframes need 3 layers of nesting, we use `generateCSS` to\n                // build the inner layers and wrap it in `@keyframes` ourselves.\n                var finalVal = '@keyframes ' + name + '{';\n\n                // TODO see if we can find a way where checking for OrderedElements\n                // here is not necessary. Alternatively, perhaps we should have a\n                // utility method that can iterate over either a plain object, an\n                // instance of OrderedElements, or a Map, and then use that here and\n                // elsewhere.\n                if (val instanceof OrderedElements) {\n                    val.forEach(function (valVal, valKey) {\n                        finalVal += generateCSS(valKey, [valVal], selectorHandlers, stringHandlers, false).join('');\n                    });\n                } else {\n                    Object.keys(val).forEach(function (key) {\n                        finalVal += generateCSS(key, [val[key]], selectorHandlers, stringHandlers, false).join('');\n                    });\n                }\n                finalVal += '}';\n\n                injectGeneratedCSSOnce(name, [finalVal]);\n\n                return name;\n            } else {\n                return val;\n            }\n        }\n\n        return animationName;\n    }()\n};\n\n// This is a map from Aphrodite's generated class names to `true` (acting as a\n// set of class names)\nvar alreadyInjected = {};\n\n// This is the buffer of styles which have not yet been flushed.\nvar injectionBuffer /* : string[] */ = [];\n\n// A flag to tell if we are already buffering styles. This could happen either\n// because we scheduled a flush call already, so newly added styles will\n// already be flushed, or because we are statically buffering on the server.\nvar isBuffering = false;\n\nvar injectGeneratedCSSOnce = function injectGeneratedCSSOnce(key, generatedCSS) {\n    var _injectionBuffer;\n\n    if (alreadyInjected[key]) {\n        return;\n    }\n\n    if (!isBuffering) {\n        // We should never be automatically buffering on the server (or any\n        // place without a document), so guard against that.\n        if (typeof document === \"undefined\") {\n            throw new Error(\"Cannot automatically buffer without a document\");\n        }\n\n        // If we're not already buffering, schedule a call to flush the\n        // current styles.\n        isBuffering = true;\n        asap(flushToStyleTag);\n    }\n\n    (_injectionBuffer = injectionBuffer).push.apply(_injectionBuffer, _toConsumableArray$1(generatedCSS));\n    alreadyInjected[key] = true;\n};\n\nvar injectStyleOnce = function injectStyleOnce(key /* : string */\n, selector /* : string */\n, definitions /* : SheetDefinition[] */\n, useImportant /* : boolean */\n) {\n    var selectorHandlers /* : SelectorHandler[] */ = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];\n\n    if (alreadyInjected[key]) {\n        return;\n    }\n\n    var generated = generateCSS(selector, definitions, selectorHandlers, stringHandlers, useImportant);\n\n    injectGeneratedCSSOnce(key, generated);\n};\n\nvar reset = function reset() {\n    injectionBuffer = [];\n    alreadyInjected = {};\n    isBuffering = false;\n    styleTag = null;\n};\n\nvar getBufferedStyles = function getBufferedStyles() {\n    return injectionBuffer;\n};\n\nvar startBuffering = function startBuffering() {\n    if (isBuffering) {\n        throw new Error(\"Cannot buffer while already buffering\");\n    }\n    isBuffering = true;\n};\n\nvar flushToArray = function flushToArray() {\n    isBuffering = false;\n    var ret = injectionBuffer;\n    injectionBuffer = [];\n    return ret;\n};\n\nvar flushToString = function flushToString() {\n    return flushToArray().join('');\n};\n\nvar flushToStyleTag = function flushToStyleTag() {\n    var cssRules = flushToArray();\n    if (cssRules.length > 0) {\n        injectStyleTag(cssRules);\n    }\n};\n\nvar getRenderedClassNames = function getRenderedClassNames() {\n    return Object.keys(alreadyInjected);\n};\n\nvar addRenderedClassNames = function addRenderedClassNames(classNames /* : string[] */) {\n    classNames.forEach(function (className) {\n        alreadyInjected[className] = true;\n    });\n};\n\nvar processStyleDefinitions = function processStyleDefinitions(styleDefinitions /* : any[] */\n, classNameBits /* : string[] */\n, definitionBits /* : Object[] */\n, length /* : number */\n) /* : number */{\n    for (var i = 0; i < styleDefinitions.length; i += 1) {\n        // Filter out falsy values from the input, to allow for\n        // `css(a, test && c)`\n        if (styleDefinitions[i]) {\n            if (Array.isArray(styleDefinitions[i])) {\n                // We've encountered an array, so let's recurse\n                length += processStyleDefinitions(styleDefinitions[i], classNameBits, definitionBits, length);\n            } else {\n                classNameBits.push(styleDefinitions[i]._name);\n                definitionBits.push(styleDefinitions[i]._definition);\n                length += styleDefinitions[i]._len;\n            }\n        }\n    }\n    return length;\n};\n\n/**\n * Inject styles associated with the passed style definition objects, and return\n * an associated CSS class name.\n *\n * @param {boolean} useImportant If true, will append !important to generated\n *     CSS output. e.g. {color: red} -> \"color: red !important\".\n * @param {(Object|Object[])[]} styleDefinitions style definition objects, or\n *     arbitrarily nested arrays of them, as returned as properties of the\n *     return value of StyleSheet.create().\n */\nvar injectAndGetClassName = function injectAndGetClassName(useImportant /* : boolean */\n, styleDefinitions /* : MaybeSheetDefinition[] */\n, selectorHandlers /* : SelectorHandler[] */\n) /* : string */{\n    var classNameBits = [];\n    var definitionBits = [];\n\n    // Mutates classNameBits and definitionBits and returns a length which we\n    // will append to the hash to decrease the chance of hash collisions.\n    var length = processStyleDefinitions(styleDefinitions, classNameBits, definitionBits, 0);\n\n    // Break if there aren't any valid styles.\n    if (classNameBits.length === 0) {\n        return \"\";\n    }\n\n    var className = void 0;\n    if (process.env.NODE_ENV === 'production') {\n        className = classNameBits.length === 1 ? '_' + String(classNameBits[0]) : '_' + String(hashString(classNameBits.join())) + String((length % 36).toString(36));\n    } else {\n        className = classNameBits.join(\"-o_O-\");\n    }\n\n    injectStyleOnce(className, '.' + String(className), definitionBits, useImportant, selectorHandlers);\n\n    return className;\n};\n\n/* ::\nimport type { SelectorHandler } from './generate.js';\nexport type SheetDefinition = { [id:string]: any };\nexport type SheetDefinitions = SheetDefinition | SheetDefinition[];\ntype RenderFunction = () => string;\ntype Extension = {\n    selectorHandler: SelectorHandler\n};\nexport type MaybeSheetDefinition = SheetDefinition | false | null | void\n*/\n\nvar unminifiedHashFn = function unminifiedHashFn(str /* : string */, key /* : string */) {\n    return String(key) + '_' + String(hashString(str));\n};\n\n// StyleSheet.create is in a hot path so we want to keep as much logic out of it\n// as possible. So, we figure out which hash function to use once, and only\n// switch it out via minify() as necessary.\n//\n// This is in an exported function to make it easier to test.\nvar initialHashFn = function initialHashFn() {\n    return process.env.NODE_ENV === 'production' ? hashString : unminifiedHashFn;\n};\n\nvar hashFn = initialHashFn();\n\nvar StyleSheet = {\n    create: function () {\n        function create(sheetDefinition /* : SheetDefinition */) /* : Object */{\n            var mappedSheetDefinition = {};\n            var keys = Object.keys(sheetDefinition);\n\n            for (var i = 0; i < keys.length; i += 1) {\n                var key = keys[i];\n                var val = sheetDefinition[key];\n                var stringVal = JSON.stringify(val);\n\n                mappedSheetDefinition[key] = {\n                    _len: stringVal.length,\n                    _name: hashFn(stringVal, key),\n                    _definition: val\n                };\n            }\n\n            return mappedSheetDefinition;\n        }\n\n        return create;\n    }(),\n    rehydrate: function () {\n        function rehydrate() {\n            var renderedClassNames /* : string[] */ = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n            addRenderedClassNames(renderedClassNames);\n        }\n\n        return rehydrate;\n    }()\n};\n\n/**\n * Utilities for using Aphrodite server-side.\n *\n * This can be minified out in client-only bundles by replacing `typeof window`\n * with `\"object\"`, e.g. via Webpack's DefinePlugin:\n *\n *   new webpack.DefinePlugin({\n *     \"typeof window\": JSON.stringify(\"object\")\n *   })\n */\nvar StyleSheetServer = typeof window !== 'undefined' ? null : {\n    renderStatic: function () {\n        function renderStatic(renderFunc /* : RenderFunction */) {\n            reset();\n            startBuffering();\n            var html = renderFunc();\n            var cssContent = flushToString();\n\n            return {\n                html: html,\n                css: {\n                    content: cssContent,\n                    renderedClassNames: getRenderedClassNames()\n                }\n            };\n        }\n\n        return renderStatic;\n    }()\n};\n\n/**\n * Utilities for using Aphrodite in tests.\n *\n * Not meant to be used in production.\n */\nvar StyleSheetTestUtils = process.env.NODE_ENV === 'production' ? null : {\n    /**\n    * Prevent styles from being injected into the DOM.\n    *\n    * This is useful in situations where you'd like to test rendering UI\n    * components which use Aphrodite without any of the side-effects of\n    * Aphrodite happening. Particularly useful for testing the output of\n    * components when you have no DOM, e.g. testing in Node without a fake DOM.\n    *\n    * Should be paired with a subsequent call to\n    * clearBufferAndResumeStyleInjection.\n    */\n    suppressStyleInjection: function () {\n        function suppressStyleInjection() {\n            reset();\n            startBuffering();\n        }\n\n        return suppressStyleInjection;\n    }(),\n\n\n    /**\n    * Opposite method of preventStyleInject.\n    */\n    clearBufferAndResumeStyleInjection: function () {\n        function clearBufferAndResumeStyleInjection() {\n            reset();\n        }\n\n        return clearBufferAndResumeStyleInjection;\n    }(),\n\n\n    /**\n    * Returns a string of buffered styles which have not been flushed\n    *\n    * @returns {string}  Buffer of styles which have not yet been flushed.\n    */\n    getBufferedStyles: function () {\n        function getBufferedStyles$$1() {\n            return getBufferedStyles();\n        }\n\n        return getBufferedStyles$$1;\n    }()\n};\n\n/**\n * Generate the Aphrodite API exports, with given `selectorHandlers` and\n * `useImportant` state.\n */\nfunction makeExports(useImportant /* : boolean */\n, selectorHandlers /* : SelectorHandler[] */\n) {\n    return {\n        StyleSheet: Object.assign({}, StyleSheet, {\n\n            /**\n             * Returns a version of the exports of Aphrodite (i.e. an object\n             * with `css` and `StyleSheet` properties) which have some\n             * extensions included.\n             *\n             * @param {Array.<Object>} extensions: An array of extensions to\n             *     add to this instance of Aphrodite. Each object should have a\n             *     single property on it, defining which kind of extension to\n             *     add.\n             * @param {SelectorHandler} [extensions[].selectorHandler]: A\n             *     selector handler extension. See `defaultSelectorHandlers` in\n             *     generate.js.\n             *\n             * @returns {Object} An object containing the exports of the new\n             *     instance of Aphrodite.\n             */\n            extend: function () {\n                function extend(extensions /* : Extension[] */) {\n                    var extensionSelectorHandlers = extensions\n                    // Pull out extensions with a selectorHandler property\n                    .map(function (extension) {\n                        return extension.selectorHandler;\n                    })\n                    // Remove nulls (i.e. extensions without a selectorHandler\n                    // property).\n                    .filter(function (handler) {\n                        return handler;\n                    });\n\n                    return makeExports(useImportant, selectorHandlers.concat(extensionSelectorHandlers));\n                }\n\n                return extend;\n            }()\n        }),\n\n        StyleSheetServer: StyleSheetServer,\n        StyleSheetTestUtils: StyleSheetTestUtils,\n\n        minify: function () {\n            function minify(shouldMinify /* : boolean */) {\n                hashFn = shouldMinify ? hashString : unminifiedHashFn;\n            }\n\n            return minify;\n        }(),\n        css: function () {\n            function css() /* : MaybeSheetDefinition[] */{\n                for (var _len = arguments.length, styleDefinitions = Array(_len), _key = 0; _key < _len; _key++) {\n                    styleDefinitions[_key] = arguments[_key];\n                }\n\n                return injectAndGetClassName(useImportant, styleDefinitions, selectorHandlers);\n            }\n\n            return css;\n        }()\n    };\n}\n\nvar useImportant = true; // Add !important to all style definitions\n\nvar Aphrodite = makeExports(useImportant, defaultSelectorHandlers);\n\nvar StyleSheet$1 = Aphrodite.StyleSheet,\n    StyleSheetServer$1 = Aphrodite.StyleSheetServer,\n    StyleSheetTestUtils$1 = Aphrodite.StyleSheetTestUtils,\n    css = Aphrodite.css,\n    minify = Aphrodite.minify;\n\nexport { StyleSheet$1 as StyleSheet, StyleSheetServer$1 as StyleSheetServer, StyleSheetTestUtils$1 as StyleSheetTestUtils, css, minify, flushToStyleTag };\n","import {StyleSheet} from 'aphrodite'\r\n\r\nexport enum FontFamily {\r\n  MONOSPACE = '\"Source Code Pro\", Courier, monospace',\r\n}\r\n\r\nexport enum FontSize {\r\n  LABEL = 10,\r\n  TITLE = 12,\r\n  BIG_BUTTON = 36,\r\n}\r\n\r\nexport enum Sizes {\r\n  MINIMAP_HEIGHT = 100,\r\n  DETAIL_VIEW_HEIGHT = 150,\r\n  TOOLTIP_WIDTH_MAX = 900,\r\n  TOOLTIP_HEIGHT_MAX = 80,\r\n  SEPARATOR_HEIGHT = 2,\r\n  FRAME_HEIGHT = 20,\r\n  TOOLBAR_HEIGHT = 20,\r\n  TOOLBAR_TAB_HEIGHT = TOOLBAR_HEIGHT - SEPARATOR_HEIGHT,\r\n}\r\n\r\nexport enum Duration {\r\n  HOVER_CHANGE = '0.07s',\r\n}\r\n\r\nexport enum ZIndex {\r\n  PROFILE_SELECT = 1,\r\n  HOVERTIP = 2,\r\n}\r\n\r\nexport const commonStyle = StyleSheet.create({\r\n  fillY: {\r\n    height: '100%',\r\n  },\r\n  fillX: {\r\n    width: '100%',\r\n  },\r\n  hbox: {\r\n    display: 'flex',\r\n    flexDirection: 'row',\r\n    position: 'relative',\r\n    overflow: 'hidden',\r\n  },\r\n  vbox: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    position: 'relative',\r\n    overflow: 'hidden',\r\n  },\r\n})\r\n","import {Profile, Frame, CallTreeNode} from './profile'\r\nimport {Flamechart, FlamechartFrame} from './flamechart'\r\nimport {Rect, Vec2} from './math'\r\n\r\nexport enum FlamechartType {\r\n  CHRONO_FLAME_CHART,\r\n  LEFT_HEAVY_FLAME_GRAPH,\r\n}\r\n\r\n// In previous versions of speedscope, searching for strings within the profile\r\n// was done using fuzzy finding. As it turns out, this was surprising behavior\r\n// to most people, so we've switched to a more traditional substring search that\r\n// more closely mimics browser behavior.\r\n//\r\n// This is case insensitive for both the needle & the haystack. This means\r\n// searching for \"hello\" will match \"Hello\" and \"HELLO\", and searching for\r\n// \"HELLO\" will match both \"hello\" and \"Hello\". This matches Chrome's behavior\r\n// as far as I can tell.\r\n//\r\n// See https://github.com/jlfwong/speedscope/issues/352\r\n//\r\n// Return ranges for all matches in order to highlight them.\r\nexport function exactMatchStrings(text: string, pattern: string): [number, number][] {\r\n  const lowerText = text.toLocaleLowerCase()\r\n  const lowerPattern = pattern.toLocaleLowerCase()\r\n\r\n  let lastIndex = 0\r\n  const matchedRanges: Array<[number, number]> = []\r\n  while (true) {\r\n    let index = lowerText.indexOf(lowerPattern, lastIndex)\r\n    if (index === -1) {\r\n      return matchedRanges\r\n    }\r\n    matchedRanges.push([index, index + pattern.length])\r\n    lastIndex = index + pattern.length\r\n  }\r\n}\r\n\r\n// A utility class for storing cached search results to avoid recomputation when\r\n// the search results & profile did not change.\r\nexport class ProfileSearchResults {\r\n  constructor(readonly profile: Profile, readonly searchQuery: string) {}\r\n\r\n  private matches: Map<Frame, [number, number][] | null> | null = null\r\n  getMatchForFrame(frame: Frame): [number, number][] | null {\r\n    if (!this.matches) {\r\n      this.matches = new Map()\r\n      this.profile.forEachFrame(frame => {\r\n        const match = exactMatchStrings(frame.name, this.searchQuery)\r\n        this.matches!.set(frame, match.length === 0 ? null : match)\r\n      })\r\n    }\r\n    return this.matches.get(frame) || null\r\n  }\r\n}\r\n\r\nexport interface FlamechartSearchMatch {\r\n  configSpaceBounds: Rect\r\n  node: CallTreeNode\r\n}\r\n\r\ninterface CachedFlamechartResult {\r\n  matches: FlamechartSearchMatch[]\r\n  indexForNode: Map<CallTreeNode, number>\r\n}\r\n\r\nexport class FlamechartSearchResults {\r\n  constructor(readonly flamechart: Flamechart, readonly profileResults: ProfileSearchResults) {}\r\n\r\n  private matches: CachedFlamechartResult | null = null\r\n  private getResults(): CachedFlamechartResult {\r\n    if (this.matches == null) {\r\n      const matches: FlamechartSearchMatch[] = []\r\n      const indexForNode = new Map<CallTreeNode, number>()\r\n      const visit = (frame: FlamechartFrame, depth: number) => {\r\n        const {node} = frame\r\n        if (this.profileResults.getMatchForFrame(node.frame)) {\r\n          const configSpaceBounds = new Rect(\r\n            new Vec2(frame.start, depth),\r\n            new Vec2(frame.end - frame.start, 1),\r\n          )\r\n          indexForNode.set(node, matches.length)\r\n          matches.push({configSpaceBounds, node})\r\n        }\r\n\r\n        frame.children.forEach(child => {\r\n          visit(child, depth + 1)\r\n        })\r\n      }\r\n\r\n      const layers = this.flamechart.getLayers()\r\n      if (layers.length > 0) {\r\n        layers[0].forEach(frame => visit(frame, 0))\r\n      }\r\n\r\n      this.matches = {matches, indexForNode}\r\n    }\r\n    return this.matches\r\n  }\r\n\r\n  count(): number {\r\n    return this.getResults().matches.length\r\n  }\r\n\r\n  indexOf(node: CallTreeNode): number | null {\r\n    const result = this.getResults().indexForNode.get(node)\r\n    return result === undefined ? null : result\r\n  }\r\n\r\n  at(index: number): FlamechartSearchMatch {\r\n    const matches = this.getResults().matches\r\n    if (index < 0 || index >= matches.length) {\r\n      throw new Error(`Index ${index} out of bounds in list of ${matches.length} matches.`)\r\n    }\r\n    return matches[index]\r\n  }\r\n}\r\n","import {StyleSheet, css} from 'aphrodite'\r\nimport {h, createContext, ComponentChildren, Fragment} from 'preact'\r\nimport {useCallback, useRef, useEffect, useMemo} from 'preact/hooks'\r\nimport {memo} from 'preact/compat'\r\nimport {Sizes, FontSize} from './style'\r\nimport {ProfileSearchResults} from '../lib/profile-search'\r\nimport {Profile} from '../lib/profile'\r\nimport {useActiveProfileState} from '../app-state/active-profile-state'\r\nimport {useTheme, withTheme} from './themes/theme'\r\nimport {searchIsActiveAtom, searchQueryAtom} from '../app-state'\r\nimport {useAtom} from '../lib/atom'\r\n\r\nfunction stopPropagation(ev: Event) {\r\n  ev.stopPropagation()\r\n}\r\n\r\nexport const ProfileSearchContext = createContext<ProfileSearchResults | null>(null)\r\n\r\nexport const ProfileSearchContextProvider = ({children}: {children: ComponentChildren}) => {\r\n  const activeProfileState = useActiveProfileState()\r\n  const profile: Profile | null = activeProfileState ? activeProfileState.profile : null\r\n  const searchIsActive = useAtom(searchIsActiveAtom)\r\n  const searchQuery = useAtom(searchQueryAtom)\r\n\r\n  const searchResults = useMemo(() => {\r\n    if (!profile || !searchIsActive || searchQuery.length === 0) {\r\n      return null\r\n    }\r\n    return new ProfileSearchResults(profile, searchQuery)\r\n  }, [searchIsActive, searchQuery, profile])\r\n\r\n  return (\r\n    <ProfileSearchContext.Provider value={searchResults}>{children}</ProfileSearchContext.Provider>\r\n  )\r\n}\r\n\r\ninterface SearchViewProps {\r\n  resultIndex: number | null\r\n  numResults: number | null\r\n  selectNext: () => void\r\n  selectPrev: () => void\r\n}\r\n\r\nexport const SearchView = memo(\r\n  ({numResults, resultIndex, selectNext, selectPrev}: SearchViewProps) => {\r\n    const theme = useTheme()\r\n    const style = getStyle(theme)\r\n    const searchIsActive = useAtom(searchIsActiveAtom)\r\n    const searchQuery = useAtom(searchQueryAtom)\r\n    const setSearchQuery = searchQueryAtom.set\r\n    const setSearchIsActive = searchIsActiveAtom.set\r\n\r\n    const onInput = useCallback(\r\n      (ev: Event) => {\r\n        const value = (ev.target as HTMLInputElement).value\r\n        setSearchQuery(value)\r\n      },\r\n      [setSearchQuery],\r\n    )\r\n\r\n    const inputRef = useRef<HTMLInputElement | null>(null)\r\n\r\n    const close = useCallback(() => setSearchIsActive(false), [setSearchIsActive])\r\n\r\n    const selectPrevOrNextResult = useCallback(\r\n      (ev: KeyboardEvent) => {\r\n        if (ev.shiftKey) {\r\n          selectPrev()\r\n        } else {\r\n          selectNext()\r\n        }\r\n      },\r\n      [selectPrev, selectNext],\r\n    )\r\n\r\n    const onKeyDown = useCallback(\r\n      (ev: KeyboardEvent) => {\r\n        ev.stopPropagation()\r\n\r\n        // Hitting Esc should close the search box\r\n        if (ev.key === 'Escape') {\r\n          setSearchIsActive(false)\r\n        }\r\n\r\n        if (ev.key === 'Enter') {\r\n          selectPrevOrNextResult(ev)\r\n        }\r\n\r\n        if (ev.key == 'f' && (ev.metaKey || ev.ctrlKey)) {\r\n          if (inputRef.current) {\r\n            // If the input is already focused, select all\r\n            inputRef.current.select()\r\n          }\r\n\r\n          // It seems like when an input is focused, the browser find menu pops\r\n          // up without this line. It seems like it's not sufficient to only\r\n          // preventDefault in the window keydown handler.\r\n          ev.preventDefault()\r\n        }\r\n      },\r\n      [setSearchIsActive, selectPrevOrNextResult],\r\n    )\r\n\r\n    useEffect(() => {\r\n      const onWindowKeyDown = (ev: KeyboardEvent) => {\r\n        // Cmd+F or Ctrl+F open the search box\r\n        if (ev.key == 'f' && (ev.metaKey || ev.ctrlKey)) {\r\n          // Prevent the browser's search menu from appearing\r\n          ev.preventDefault()\r\n\r\n          if (inputRef.current) {\r\n            // If the search box is already open, then re-select it immediately.\r\n            inputRef.current.select()\r\n          } else {\r\n            // Otherwise, focus the search, then focus the input on the next\r\n            // frame, when the search box should have mounted.\r\n            setSearchIsActive(true)\r\n            requestAnimationFrame(() => {\r\n              if (inputRef.current) {\r\n                inputRef.current.select()\r\n              }\r\n            })\r\n          }\r\n        }\r\n      }\r\n\r\n      window.addEventListener('keydown', onWindowKeyDown)\r\n      return () => {\r\n        window.removeEventListener('keydown', onWindowKeyDown)\r\n      }\r\n    }, [setSearchIsActive])\r\n\r\n    if (!searchIsActive) return null\r\n\r\n    return (\r\n      <div className={css(style.searchView)}>\r\n        <span className={css(style.icon)}></span>\r\n        <span className={css(style.inputContainer)}>\r\n          <input\r\n            className={css(style.input)}\r\n            value={searchQuery}\r\n            onInput={onInput}\r\n            onKeyDown={onKeyDown}\r\n            onKeyUp={stopPropagation}\r\n            onKeyPress={stopPropagation}\r\n            ref={inputRef}\r\n          />\r\n        </span>\r\n        {numResults != null && (\r\n          <Fragment>\r\n            <span className={css(style.resultCount)}>\r\n              {resultIndex == null ? '?' : resultIndex + 1}/{numResults}\r\n            </span>\r\n            <button className={css(style.icon, style.button)} onClick={selectPrev}>\r\n              \r\n            </button>\r\n            <button className={css(style.icon, style.button)} onClick={selectNext}>\r\n              \r\n            </button>\r\n          </Fragment>\r\n        )}\r\n        <svg\r\n          className={css(style.icon)}\r\n          onClick={close}\r\n          width=\"16\"\r\n          height=\"16\"\r\n          viewBox=\"0 0 16 16\"\r\n          fill=\"none\"\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n        >\r\n          <path\r\n            d=\"M4.99999 4.16217L11.6427 10.8048M11.6427 4.16217L4.99999 10.8048\"\r\n            stroke={theme.altFgSecondaryColor}\r\n          />\r\n        </svg>\r\n      </div>\r\n    )\r\n  },\r\n)\r\n\r\nconst getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    searchView: {\r\n      position: 'absolute',\r\n      top: 0,\r\n      right: 10,\r\n      height: Sizes.TOOLBAR_HEIGHT,\r\n      width: 16 * 13,\r\n      borderWidth: 2,\r\n      borderColor: theme.altFgPrimaryColor,\r\n      borderStyle: 'solid',\r\n      fontSize: FontSize.LABEL,\r\n      boxSizing: 'border-box',\r\n      background: theme.altBgSecondaryColor,\r\n      color: theme.altFgPrimaryColor,\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n    },\r\n    inputContainer: {\r\n      flexShrink: 1,\r\n      flexGrow: 1,\r\n      display: 'flex',\r\n    },\r\n    input: {\r\n      width: '100%',\r\n      border: 'none',\r\n      background: 'none',\r\n      fontSize: FontSize.LABEL,\r\n      lineHeight: `${Sizes.TOOLBAR_HEIGHT}px`,\r\n      color: theme.altFgPrimaryColor,\r\n      ':focus': {\r\n        border: 'none',\r\n        outline: 'none',\r\n      },\r\n      '::selection': {\r\n        color: theme.altFgPrimaryColor,\r\n        background: theme.selectionPrimaryColor,\r\n      },\r\n    },\r\n    resultCount: {\r\n      verticalAlign: 'middle',\r\n    },\r\n    icon: {\r\n      flexShrink: 0,\r\n      verticalAlign: 'middle',\r\n      height: '100%',\r\n      margin: '0px 2px 0px 2px',\r\n      fontSize: FontSize.LABEL,\r\n    },\r\n    button: {\r\n      display: 'inline',\r\n      background: 'none',\r\n      border: 'none',\r\n      padding: 0,\r\n      ':focus': {\r\n        outline: 'none',\r\n      },\r\n    },\r\n  }),\r\n)\r\n","// Returns `input` with hex escapes expanded (e.g. `\\20` becomes ` `.)\r\n//\r\n\r\nimport {Frame, SymbolRemapper} from './profile'\r\n\r\n// NOTE: This will fail to ignore escaped backslahes (e.g. `\\\\20`).\r\nfunction unescapeHex(input: string): string {\r\n  return input.replace(/\\\\([a-fA-F0-9]{2})/g, (_match, group) => {\r\n    const scalar = parseInt(group, 16)\r\n    return String.fromCharCode(scalar)\r\n  })\r\n}\r\n\r\n// This imports symbol maps generated by emscripten using the \"--emit-symbol-map\" flag.\r\n// It allows you to visualize a profile captured in a release build as long as you also\r\n// have the associated symbol map. To do this, first drop the profile into speedscope\r\n// and then drop the symbol map. After the second drop, the symbols will be remapped to\r\n// their original names.\r\nexport function importEmscriptenSymbolMap(contents: string): SymbolRemapper | null {\r\n  const lines = contents.split('\\n')\r\n  if (!lines.length) return null\r\n\r\n  // Remove a trailing blank line if there is one\r\n  if (lines[lines.length - 1] === '') lines.pop()\r\n  if (!lines.length) return null\r\n\r\n  const map = new Map<string, string>()\r\n  const intRegex = /^(\\d+):(.+)$/\r\n  const idRegex = /^([\\$\\w]+):([\\$\\w-]+)$/\r\n\r\n  for (const line of lines) {\r\n    // Match lines like \"103:__ZN8tinyxml210XMLCommentD0Ev\"\r\n    const intMatch = intRegex.exec(line)\r\n    if (intMatch) {\r\n      map.set(`wasm-function[${intMatch[1]}]`, unescapeHex(intMatch[2]))\r\n      continue\r\n    }\r\n\r\n    // Match lines like \"u6:__ZN8tinyxml210XMLCommentD0Ev\"\r\n    const idMatch = idRegex.exec(line)\r\n    if (idMatch) {\r\n      map.set(idMatch[1], unescapeHex(idMatch[2]))\r\n      continue\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  return (frame: Frame) => {\r\n    if (!map.has(frame.name)) {\r\n      return null\r\n    }\r\n\r\n    return {name: map.get(frame.name)}\r\n  }\r\n}\r\n","import {h} from 'preact'\r\nimport {StyleSheet, css} from 'aphrodite'\r\nimport {FontSize} from './style'\r\nimport {useTheme, withTheme} from './themes/theme'\r\n\r\ninterface ColorChitProps {\r\n  color: string\r\n}\r\n\r\nexport function ColorChit(props: ColorChitProps) {\r\n  const style = getStyle(useTheme())\r\n  return <span className={css(style.stackChit)} style={{backgroundColor: props.color}} />\r\n}\r\n\r\nconst getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    stackChit: {\r\n      position: 'relative',\r\n      top: -1,\r\n      display: 'inline-block',\r\n      verticalAlign: 'middle',\r\n      marginRight: '0.5em',\r\n      border: `1px solid ${theme.fgSecondaryColor}`,\r\n      width: FontSize.LABEL - 2,\r\n      height: FontSize.LABEL - 2,\r\n    },\r\n  }),\r\n)\r\n","// A simple implementation of an efficient scrolling list view which\r\n// renders only items within the viewport + a couple extra items.\r\n\r\nimport {h, JSX} from 'preact'\r\nimport {useState, useCallback, useRef, useMemo, useEffect} from 'preact/hooks'\r\n\r\nexport interface ListItem {\r\n  size: number\r\n}\r\n\r\ninterface RangeResult {\r\n  firstVisibleIndex: number\r\n  lastVisibleIndex: number\r\n  invisiblePrefixSize: number\r\n}\r\n\r\ninterface ScrollableListViewProps {\r\n  items: ListItem[]\r\n  axis: 'x' | 'y'\r\n  renderItems: (\r\n    firstVisibleIndex: number,\r\n    lastVisibleIndex: number,\r\n  ) => JSX.Element | JSX.Element[] | null\r\n  className?: string\r\n  initialIndexInView?: number | null\r\n}\r\n\r\nexport const ScrollableListView = ({\r\n  items,\r\n  axis,\r\n  renderItems,\r\n  className,\r\n  initialIndexInView,\r\n}: ScrollableListViewProps) => {\r\n  const [viewportSize, setViewportSize] = useState<number | null>(null)\r\n  const [viewportScrollOffset, setViewportScrollOffset] = useState<number>(0)\r\n\r\n  const viewportRef = useRef<HTMLDivElement | null>(null)\r\n\r\n  const widthOrHeight = axis === 'x' ? 'width' : 'height'\r\n  const leftOrTop = axis === 'x' ? 'left' : 'top'\r\n  const scrollLeftOrScrollTop = axis === 'x' ? 'scrollLeft' : 'scrollTop'\r\n\r\n  // This is kind of a weird hack, but I'm not sure what the better of doing something like this is.\r\n  const offset = initialIndexInView\r\n    ? items.reduce((a, b, i) => (i < initialIndexInView ? a + b.size : a), 0)\r\n    : 0\r\n  const initialScroll = useRef<number | null>(offset)\r\n\r\n  const viewportCallback = useCallback(\r\n    (viewport: HTMLDivElement | null) => {\r\n      if (viewport) {\r\n        requestAnimationFrame(() => {\r\n          setViewportSize(viewport.getBoundingClientRect()[widthOrHeight])\r\n          if (initialScroll.current != null) {\r\n            viewport.scrollTo({[leftOrTop]: initialScroll.current})\r\n            initialScroll.current = null\r\n          }\r\n        })\r\n      } else {\r\n        setViewportSize(null)\r\n      }\r\n      viewportRef.current = viewport\r\n    },\r\n    [setViewportSize, widthOrHeight, leftOrTop],\r\n  )\r\n\r\n  const rangeResult: RangeResult | null = useMemo(() => {\r\n    if (viewportRef.current == null || viewportSize == null || viewportScrollOffset == null) {\r\n      return null\r\n    }\r\n\r\n    // We render items up to a quarter viewport height outside of the\r\n    // viewport both above and below to prevent flickering.\r\n    const minY = viewportScrollOffset - viewportSize / 4\r\n    const maxY = viewportScrollOffset + viewportSize + viewportSize / 4\r\n\r\n    let total = 0\r\n    let invisiblePrefixSize = 0\r\n\r\n    let i = 0\r\n    for (; i < items.length; i++) {\r\n      const item = items[i]\r\n      invisiblePrefixSize = total\r\n      total += item.size\r\n      if (total >= minY) {\r\n        break\r\n      }\r\n    }\r\n\r\n    const firstVisibleIndex = i\r\n\r\n    for (; i < items.length; i++) {\r\n      const item = items[i]\r\n      total += item.size\r\n      if (total >= maxY) {\r\n        break\r\n      }\r\n    }\r\n\r\n    const lastVisibleIndex = Math.min(i, items.length - 1)\r\n\r\n    return {\r\n      firstVisibleIndex,\r\n      lastVisibleIndex,\r\n      invisiblePrefixSize,\r\n    }\r\n  }, [viewportSize, viewportScrollOffset, items])\r\n\r\n  const totalSize = useMemo(() => items.reduce((a, b) => a + b.size, 0), [items])\r\n\r\n  const onViewportScroll = useCallback(() => {\r\n    if (viewportRef.current != null) {\r\n      setViewportScrollOffset(viewportRef.current[scrollLeftOrScrollTop])\r\n    }\r\n  }, [scrollLeftOrScrollTop])\r\n\r\n  useEffect(() => {\r\n    const resizeListener = () => {\r\n      if (viewportRef.current != null) {\r\n        setViewportSize(viewportRef.current.getBoundingClientRect()[widthOrHeight])\r\n      }\r\n    }\r\n\r\n    window.addEventListener('resize', resizeListener)\r\n    return () => {\r\n      window.removeEventListener('resize', resizeListener)\r\n    }\r\n  }, [widthOrHeight])\r\n\r\n  const visibleItems = useMemo(() => {\r\n    return rangeResult\r\n      ? renderItems(rangeResult.firstVisibleIndex, rangeResult.lastVisibleIndex)\r\n      : null\r\n  }, [renderItems, rangeResult])\r\n\r\n  const content = useMemo(() => {\r\n    return (\r\n      <div style={{height: totalSize}}>\r\n        <div style={{transform: `translateY(${rangeResult?.invisiblePrefixSize || 0}px)`}}>\r\n          {visibleItems}\r\n        </div>\r\n      </div>\r\n    )\r\n  }, [rangeResult, visibleItems, totalSize])\r\n\r\n  return (\r\n    <div className={className} ref={viewportCallback} onScroll={onViewportScroll}>\r\n      {content}\r\n    </div>\r\n  )\r\n}\r\n","import {h, JSX, ComponentChild} from 'preact'\r\nimport {StyleSheet, css} from 'aphrodite'\r\nimport {Profile, Frame} from '../lib/profile'\r\nimport {formatPercent} from '../lib/utils'\r\nimport {FontSize, Sizes, commonStyle} from './style'\r\nimport {ColorChit} from './color-chit'\r\nimport {ListItem, ScrollableListView} from './scrollable-list-view'\r\nimport {createGetCSSColorForFrame, getFrameToColorBucket} from '../app-state/getters'\r\nimport {memo} from 'preact/compat'\r\nimport {useCallback, useMemo, useContext} from 'preact/hooks'\r\nimport {SandwichViewContext} from './sandwich-view'\r\nimport {Color} from '../lib/color'\r\nimport {useTheme, withTheme} from './themes/theme'\r\nimport {\r\n  SortDirection,\r\n  SortMethod,\r\n  SortField,\r\n  profileGroupAtom,\r\n  tableSortMethodAtom,\r\n  searchIsActiveAtom,\r\n  searchQueryAtom,\r\n} from '../app-state'\r\nimport {useAtom} from '../lib/atom'\r\nimport {ActiveProfileState} from '../app-state/active-profile-state'\r\n\r\ninterface HBarProps {\r\n  perc: number\r\n}\r\n\r\nfunction HBarDisplay(props: HBarProps) {\r\n  const style = getStyle(useTheme())\r\n\r\n  return (\r\n    <div className={css(style.hBarDisplay)}>\r\n      <div className={css(style.hBarDisplayFilled)} style={{width: `${props.perc}%`}} />\r\n    </div>\r\n  )\r\n}\r\n\r\ninterface SortIconProps {\r\n  activeDirection: SortDirection | null\r\n}\r\n\r\nfunction SortIcon(props: SortIconProps) {\r\n  const theme = useTheme()\r\n  const style = getStyle(theme)\r\n\r\n  const {activeDirection} = props\r\n  const upFill =\r\n    activeDirection === SortDirection.ASCENDING ? theme.fgPrimaryColor : theme.fgSecondaryColor\r\n  const downFill =\r\n    activeDirection === SortDirection.DESCENDING ? theme.fgPrimaryColor : theme.fgSecondaryColor\r\n\r\n  return (\r\n    <svg\r\n      width=\"8\"\r\n      height=\"10\"\r\n      viewBox=\"0 0 8 10\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={css(style.sortIcon)}\r\n    >\r\n      <path d=\"M0 4L4 0L8 4H0Z\" fill={upFill} />\r\n      <path d=\"M0 4L4 0L8 4H0Z\" transform=\"translate(0 10) scale(1 -1)\" fill={downFill} />\r\n    </svg>\r\n  )\r\n}\r\n\r\ninterface ProfileTableRowViewProps {\r\n  frame: Frame\r\n  matchedRanges: [number, number][] | null\r\n  index: number\r\n  profile: Profile\r\n  selectedFrame: Frame | null\r\n  setSelectedFrame: (f: Frame) => void\r\n  getCSSColorForFrame: (frame: Frame) => string\r\n}\r\n\r\nfunction highlightRanges(\r\n  text: string,\r\n  ranges: [number, number][],\r\n  highlightedClassName: string,\r\n): JSX.Element {\r\n  const spans: ComponentChild[] = []\r\n  let last = 0\r\n  for (let range of ranges) {\r\n    spans.push(text.slice(last, range[0]))\r\n    spans.push(<span className={highlightedClassName}>{text.slice(range[0], range[1])}</span>)\r\n    last = range[1]\r\n  }\r\n  spans.push(text.slice(last))\r\n\r\n  return <span>{spans}</span>\r\n}\r\n\r\nconst ProfileTableRowView = ({\r\n  frame,\r\n  matchedRanges,\r\n  profile,\r\n  index,\r\n  selectedFrame,\r\n  setSelectedFrame,\r\n  getCSSColorForFrame,\r\n}: ProfileTableRowViewProps) => {\r\n  const style = getStyle(useTheme())\r\n\r\n  const totalWeight = frame.getTotalWeight()\r\n  const selfWeight = frame.getSelfWeight()\r\n  const totalPerc = (100.0 * totalWeight) / profile.getTotalNonIdleWeight()\r\n  const selfPerc = (100.0 * selfWeight) / profile.getTotalNonIdleWeight()\r\n\r\n  const selected = frame === selectedFrame\r\n\r\n  // We intentionally use index rather than frame.key here as the tr key\r\n  // in order to re-use rows when sorting rather than creating all new elements.\r\n  return (\r\n    <tr\r\n      key={`${index}`}\r\n      onClick={setSelectedFrame.bind(null, frame)}\r\n      className={css(\r\n        style.tableRow,\r\n        index % 2 == 0 && style.tableRowEven,\r\n        selected && style.tableRowSelected,\r\n      )}\r\n    >\r\n      <td className={css(style.numericCell)}>\r\n        {profile.formatValue(totalWeight)} ({formatPercent(totalPerc)})\r\n        <HBarDisplay perc={totalPerc} />\r\n      </td>\r\n      <td className={css(style.numericCell)}>\r\n        {profile.formatValue(selfWeight)} ({formatPercent(selfPerc)})\r\n        <HBarDisplay perc={selfPerc} />\r\n      </td>\r\n      <td title={frame.file} className={css(style.textCell)}>\r\n        <ColorChit color={getCSSColorForFrame(frame)} />\r\n        {matchedRanges\r\n          ? highlightRanges(\r\n              frame.name,\r\n              matchedRanges,\r\n              css(style.matched, selected && style.matchedSelected),\r\n            )\r\n          : frame.name}\r\n      </td>\r\n    </tr>\r\n  )\r\n}\r\n\r\ninterface ProfileTableViewProps {\r\n  profile: Profile\r\n  selectedFrame: Frame | null\r\n  getCSSColorForFrame: (frame: Frame) => string\r\n  sortMethod: SortMethod\r\n  setSelectedFrame: (frame: Frame | null) => void\r\n  setSortMethod: (sortMethod: SortMethod) => void\r\n  searchQuery: string\r\n  searchIsActive: boolean\r\n}\r\n\r\nexport const ProfileTableView = memo(\r\n  ({\r\n    profile,\r\n    sortMethod,\r\n    setSortMethod,\r\n    selectedFrame,\r\n    setSelectedFrame,\r\n    getCSSColorForFrame,\r\n    searchQuery,\r\n    searchIsActive,\r\n  }: ProfileTableViewProps) => {\r\n    const style = getStyle(useTheme())\r\n\r\n    const onSortClick = useCallback(\r\n      (field: SortField, ev: MouseEvent) => {\r\n        ev.preventDefault()\r\n\r\n        if (sortMethod.field == field) {\r\n          // Toggle\r\n          setSortMethod({\r\n            field,\r\n            direction:\r\n              sortMethod.direction === SortDirection.ASCENDING\r\n                ? SortDirection.DESCENDING\r\n                : SortDirection.ASCENDING,\r\n          })\r\n        } else {\r\n          // Set a sane default\r\n          switch (field) {\r\n            case SortField.SYMBOL_NAME: {\r\n              setSortMethod({field, direction: SortDirection.ASCENDING})\r\n              break\r\n            }\r\n            case SortField.SELF: {\r\n              setSortMethod({field, direction: SortDirection.DESCENDING})\r\n              break\r\n            }\r\n            case SortField.TOTAL: {\r\n              setSortMethod({field, direction: SortDirection.DESCENDING})\r\n              break\r\n            }\r\n          }\r\n        }\r\n      },\r\n      [sortMethod, setSortMethod],\r\n    )\r\n\r\n    const sandwichContext = useContext(SandwichViewContext)\r\n\r\n    const renderItems = useCallback(\r\n      (firstIndex: number, lastIndex: number) => {\r\n        if (!sandwichContext) return null\r\n\r\n        const rows: JSX.Element[] = []\r\n\r\n        for (let i = firstIndex; i <= lastIndex; i++) {\r\n          const frame = sandwichContext.rowList[i]\r\n          const match = sandwichContext.getSearchMatchForFrame(frame)\r\n          rows.push(\r\n            ProfileTableRowView({\r\n              frame,\r\n              matchedRanges: match == null ? null : match,\r\n              index: i,\r\n              profile: profile,\r\n              selectedFrame: selectedFrame,\r\n              setSelectedFrame: setSelectedFrame,\r\n              getCSSColorForFrame: getCSSColorForFrame,\r\n            }),\r\n          )\r\n        }\r\n\r\n        if (rows.length === 0) {\r\n          if (searchIsActive) {\r\n            rows.push(\r\n              <tr>\r\n                <td className={css(style.emptyState)}>\r\n                  No symbol names match query \"{searchQuery}\".\r\n                </td>\r\n              </tr>,\r\n            )\r\n          } else {\r\n            rows.push(\r\n              <tr>\r\n                <td className={css(style.emptyState)}>No symbols found.</td>\r\n              </tr>,\r\n            )\r\n          }\r\n        }\r\n\r\n        return <table className={css(style.tableView)}>{rows}</table>\r\n      },\r\n      [\r\n        sandwichContext,\r\n        profile,\r\n        selectedFrame,\r\n        setSelectedFrame,\r\n        getCSSColorForFrame,\r\n        searchIsActive,\r\n        searchQuery,\r\n        style.emptyState,\r\n        style.tableView,\r\n      ],\r\n    )\r\n\r\n    const listItems: ListItem[] = useMemo(\r\n      () =>\r\n        sandwichContext == null\r\n          ? []\r\n          : sandwichContext.rowList.map(f => ({size: Sizes.FRAME_HEIGHT})),\r\n      [sandwichContext],\r\n    )\r\n\r\n    const onTotalClick = useCallback((ev: MouseEvent) => onSortClick(SortField.TOTAL, ev), [\r\n      onSortClick,\r\n    ])\r\n    const onSelfClick = useCallback((ev: MouseEvent) => onSortClick(SortField.SELF, ev), [\r\n      onSortClick,\r\n    ])\r\n    const onSymbolNameClick = useCallback(\r\n      (ev: MouseEvent) => onSortClick(SortField.SYMBOL_NAME, ev),\r\n      [onSortClick],\r\n    )\r\n\r\n    return (\r\n      <div className={css(commonStyle.vbox, style.profileTableView)}>\r\n        <table className={css(style.tableView)}>\r\n          <thead className={css(style.tableHeader)}>\r\n            <tr>\r\n              <th className={css(style.numericCell)} onClick={onTotalClick}>\r\n                <SortIcon\r\n                  activeDirection={\r\n                    sortMethod.field === SortField.TOTAL ? sortMethod.direction : null\r\n                  }\r\n                />\r\n                Total\r\n              </th>\r\n              <th className={css(style.numericCell)} onClick={onSelfClick}>\r\n                <SortIcon\r\n                  activeDirection={\r\n                    sortMethod.field === SortField.SELF ? sortMethod.direction : null\r\n                  }\r\n                />\r\n                Self\r\n              </th>\r\n              <th className={css(style.textCell)} onClick={onSymbolNameClick}>\r\n                <SortIcon\r\n                  activeDirection={\r\n                    sortMethod.field === SortField.SYMBOL_NAME ? sortMethod.direction : null\r\n                  }\r\n                />\r\n                Symbol Name\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n        </table>\r\n        <ScrollableListView\r\n          axis={'y'}\r\n          items={listItems}\r\n          className={css(style.scrollView)}\r\n          renderItems={renderItems}\r\n          initialIndexInView={\r\n            selectedFrame == null ? null : sandwichContext?.getIndexForFrame(selectedFrame)\r\n          }\r\n        />\r\n      </div>\r\n    )\r\n  },\r\n)\r\n\r\nconst getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    profileTableView: {\r\n      background: theme.bgPrimaryColor,\r\n      height: '100%',\r\n    },\r\n    scrollView: {\r\n      overflowY: 'auto',\r\n      overflowX: 'hidden',\r\n      flexGrow: 1,\r\n      '::-webkit-scrollbar': {\r\n        background: theme.bgPrimaryColor,\r\n      },\r\n      '::-webkit-scrollbar-thumb': {\r\n        background: theme.fgSecondaryColor,\r\n        borderRadius: 20,\r\n        border: `3px solid ${theme.bgPrimaryColor}`,\r\n        ':hover': {\r\n          background: theme.fgPrimaryColor,\r\n        },\r\n      },\r\n    },\r\n    tableView: {\r\n      width: '100%',\r\n      fontSize: FontSize.LABEL,\r\n      background: theme.bgPrimaryColor,\r\n    },\r\n    tableHeader: {\r\n      borderBottom: `2px solid ${theme.bgSecondaryColor}`,\r\n      textAlign: 'left',\r\n      color: theme.fgPrimaryColor,\r\n      userSelect: 'none',\r\n    },\r\n    sortIcon: {\r\n      position: 'relative',\r\n      top: 1,\r\n      marginRight: Sizes.FRAME_HEIGHT / 4,\r\n    },\r\n    tableRow: {\r\n      background: theme.bgPrimaryColor,\r\n      height: Sizes.FRAME_HEIGHT,\r\n    },\r\n    tableRowEven: {\r\n      background: theme.bgSecondaryColor,\r\n    },\r\n    tableRowSelected: {\r\n      background: theme.selectionPrimaryColor,\r\n      color: theme.altFgPrimaryColor,\r\n    },\r\n    numericCell: {\r\n      textOverflow: 'ellipsis',\r\n      overflow: 'hidden',\r\n      whiteSpace: 'nowrap',\r\n      position: 'relative',\r\n      textAlign: 'right',\r\n      paddingRight: Sizes.FRAME_HEIGHT,\r\n      width: 6 * Sizes.FRAME_HEIGHT,\r\n      minWidth: 6 * Sizes.FRAME_HEIGHT,\r\n    },\r\n    textCell: {\r\n      textOverflow: 'ellipsis',\r\n      overflow: 'hidden',\r\n      whiteSpace: 'nowrap',\r\n      width: '100%',\r\n      maxWidth: 0,\r\n    },\r\n    hBarDisplay: {\r\n      position: 'absolute',\r\n      background: Color.fromCSSHex(theme.weightColor).withAlpha(0.2).toCSS(),\r\n      bottom: 2,\r\n      height: 2,\r\n      width: `calc(100% - ${2 * Sizes.FRAME_HEIGHT}px)`,\r\n      right: Sizes.FRAME_HEIGHT,\r\n    },\r\n    hBarDisplayFilled: {\r\n      height: '100%',\r\n      position: 'absolute',\r\n      background: theme.weightColor,\r\n      right: 0,\r\n    },\r\n    matched: {\r\n      borderBottom: `2px solid ${theme.fgPrimaryColor}`,\r\n    },\r\n    matchedSelected: {\r\n      borderColor: theme.altFgPrimaryColor,\r\n    },\r\n    emptyState: {\r\n      textAlign: 'center',\r\n      fontWeight: 'bold',\r\n    },\r\n  }),\r\n)\r\n\r\ninterface ProfileTableViewContainerProps {\r\n  activeProfileState: ActiveProfileState\r\n}\r\n\r\nexport const ProfileTableViewContainer = memo((ownProps: ProfileTableViewContainerProps) => {\r\n  const {activeProfileState} = ownProps\r\n  const {profile, sandwichViewState} = activeProfileState\r\n  if (!profile) throw new Error('profile missing')\r\n  const tableSortMethod = useAtom(tableSortMethodAtom)\r\n  const theme = useTheme()\r\n  const {callerCallee} = sandwichViewState\r\n  const selectedFrame = callerCallee ? callerCallee.selectedFrame : null\r\n  const frameToColorBucket = getFrameToColorBucket(profile)\r\n  const getCSSColorForFrame = createGetCSSColorForFrame({theme, frameToColorBucket})\r\n\r\n  const setSelectedFrame = useCallback((selectedFrame: Frame | null) => {\r\n    profileGroupAtom.setSelectedFrame(selectedFrame)\r\n  }, [])\r\n  const searchIsActive = useAtom(searchIsActiveAtom)\r\n  const searchQuery = useAtom(searchQueryAtom)\r\n\r\n  return (\r\n    <ProfileTableView\r\n      profile={profile}\r\n      selectedFrame={selectedFrame}\r\n      getCSSColorForFrame={getCSSColorForFrame}\r\n      sortMethod={tableSortMethod}\r\n      setSelectedFrame={setSelectedFrame}\r\n      setSortMethod={tableSortMethodAtom.set}\r\n      searchIsActive={searchIsActive}\r\n      searchQuery={searchQuery}\r\n    />\r\n  )\r\n})\r\n","import {Frame, CallTreeNode} from './profile'\r\n\r\nimport {lastOf} from './utils'\r\nimport {clamp, Rect, Vec2} from './math'\r\n\r\nexport interface FlamechartFrame {\r\n  node: CallTreeNode\r\n  start: number\r\n  end: number\r\n  parent: FlamechartFrame | null\r\n  children: FlamechartFrame[]\r\n}\r\n\r\ntype StackLayer = FlamechartFrame[]\r\n\r\ninterface FlamechartDataSource {\r\n  getTotalWeight(): number\r\n\r\n  formatValue(v: number): string\r\n\r\n  forEachCall(\r\n    openFrame: (node: CallTreeNode, value: number) => void,\r\n    closeFrame: (node: CallTreeNode, value: number) => void,\r\n  ): void\r\n\r\n  getColorBucketForFrame(f: Frame): number\r\n}\r\n\r\nexport class Flamechart {\r\n  // Bottom to top\r\n  private layers: StackLayer[] = []\r\n  private totalWeight: number = 0\r\n  private minFrameWidth: number = 1\r\n\r\n  getTotalWeight() {\r\n    return this.totalWeight\r\n  }\r\n  getLayers() {\r\n    return this.layers\r\n  }\r\n  getColorBucketForFrame(frame: Frame) {\r\n    return this.source.getColorBucketForFrame(frame)\r\n  }\r\n  getMinFrameWidth() {\r\n    return this.minFrameWidth\r\n  }\r\n  formatValue(v: number) {\r\n    return this.source.formatValue(v)\r\n  }\r\n\r\n  getClampedViewportWidth(viewportWidth: number) {\r\n    const maxWidth = this.getTotalWeight()\r\n\r\n    // In order to avoid floating point error, we cap the maximum zoom. In\r\n    // particular, it's important that at the maximum zoom level, the total\r\n    // trace size + a viewport width is not equal to the trace size due to\r\n    // floating point rounding.\r\n    //\r\n    // For instance, if the profile's total weight is 2^60, and the viewport\r\n    // size is 1, trying to move one viewport width right will result in no\r\n    // change because 2^60 + 1 = 2^60 in floating point arithmetic. JavaScript\r\n    // numbers are 64 bit floats, and therefore have 53 mantissa bits. You can\r\n    // see this for yourself in the console. Try:\r\n    //\r\n    //   > Math.pow(2, 60) + 1 === Math.pow(2, 60)\r\n    //   true\r\n    //   > Math.pow(2, 53) + 1 === Math.pow(2, 53)\r\n    //   true\r\n    //   > Math.pow(2, 52) + 1 === Math.pow(2, 52)\r\n    //   false\r\n    //\r\n    // We use 2^40 as a cap instead, since we want to be able to make small\r\n    // adjustments within a viewport width.\r\n    //\r\n    // For reference, this will still allow you to zoom until 1 nanosecond fills\r\n    // the screen in a profile with a duration of over 18 minutes.\r\n    //\r\n    //   > Math.pow(2, 40) / (60 * Math.pow(10, 9))\r\n    //   18.325193796266667\r\n    //\r\n    const maxZoom = Math.pow(2, 40)\r\n\r\n    // In addition to capping zoom to avoid floating point error, we further cap\r\n    // zoom to avoid letting you zoom in so that the smallest element more than\r\n    // fills the screen, since that probably isn't useful. The final zoom cap is\r\n    // determined by the minimum zoom of either 2^40x zoom or the necessary zoom\r\n    // for the smallest frame to fill the screen three times.\r\n    const minWidth = clamp(3 * this.getMinFrameWidth(), maxWidth / maxZoom, maxWidth)\r\n\r\n    return clamp(viewportWidth, minWidth, maxWidth)\r\n  }\r\n\r\n  // Given a desired config-space viewport rectangle, clamp the rectangle so\r\n  // that it fits within the given flamechart. This prevents the viewport from\r\n  // extending past the bounds of the flamechart or zooming in too far.\r\n  getClampedConfigSpaceViewportRect({\r\n    configSpaceViewportRect,\r\n    renderInverted,\r\n  }: {\r\n    configSpaceViewportRect: Rect\r\n    renderInverted?: boolean\r\n  }) {\r\n    const configSpaceSize = new Vec2(this.getTotalWeight(), this.getLayers().length)\r\n    const width = this.getClampedViewportWidth(configSpaceViewportRect.size.x)\r\n    const size = configSpaceViewportRect.size.withX(width)\r\n    const origin = Vec2.clamp(\r\n      configSpaceViewportRect.origin,\r\n      new Vec2(0, renderInverted ? 0 : -1),\r\n      Vec2.max(Vec2.zero, configSpaceSize.minus(size).plus(new Vec2(0, 1))),\r\n    )\r\n    return new Rect(origin, configSpaceViewportRect.size.withX(width))\r\n  }\r\n\r\n  constructor(private source: FlamechartDataSource) {\r\n    const stack: FlamechartFrame[] = []\r\n    const openFrame = (node: CallTreeNode, value: number) => {\r\n      const parent = lastOf(stack)\r\n      const frame: FlamechartFrame = {\r\n        node,\r\n        parent,\r\n        children: [],\r\n        start: value,\r\n        end: value,\r\n      }\r\n      if (parent) {\r\n        parent.children.push(frame)\r\n      }\r\n      stack.push(frame)\r\n    }\r\n\r\n    this.minFrameWidth = Infinity\r\n    const closeFrame = (node: CallTreeNode, value: number) => {\r\n      console.assert(stack.length > 0)\r\n      const stackTop = stack.pop()!\r\n      stackTop.end = value\r\n      if (stackTop.end - stackTop.start === 0) return\r\n      const layerIndex = stack.length\r\n      while (this.layers.length <= layerIndex) this.layers.push([])\r\n      this.layers[layerIndex].push(stackTop)\r\n      this.minFrameWidth = Math.min(this.minFrameWidth, stackTop.end - stackTop.start)\r\n    }\r\n\r\n    this.totalWeight = source.getTotalWeight()\r\n    source.forEachCall(openFrame, closeFrame)\r\n\r\n    if (!isFinite(this.minFrameWidth)) this.minFrameWidth = 1\r\n  }\r\n}\r\n","import {Flamechart} from '../lib/flamechart'\r\nimport {RectangleBatch, RectangleBatchRenderer} from './rectangle-batch-renderer'\r\nimport {Vec2, Rect, AffineTransform} from '../lib/math'\r\nimport {Color} from '../lib/color'\r\nimport {KeyedSet} from '../lib/utils'\r\nimport {RowAtlas} from './row-atlas'\r\nimport {Graphics} from './graphics'\r\nimport {FlamechartColorPassRenderer} from './flamechart-color-pass-renderer'\r\nimport {renderInto} from './utils'\r\n\r\nconst MAX_BATCH_SIZE = 10000\r\n\r\ninterface RangeTreeNode {\r\n  getBounds(): Rect\r\n  getRectCount(): number\r\n  getChildren(): RangeTreeNode[]\r\n  forEachLeafNodeWithinBounds(configSpaceBounds: Rect, cb: (leaf: RangeTreeLeafNode) => void): void\r\n}\r\n\r\nclass RangeTreeLeafNode implements RangeTreeNode {\r\n  private children: RangeTreeNode[] = []\r\n\r\n  constructor(\r\n    private batch: RectangleBatch,\r\n    private bounds: Rect,\r\n    private numPrecedingRectanglesInRow: number,\r\n  ) {}\r\n\r\n  getBatch() {\r\n    return this.batch\r\n  }\r\n  getBounds() {\r\n    return this.bounds\r\n  }\r\n  getRectCount() {\r\n    return this.batch.getRectCount()\r\n  }\r\n  getChildren() {\r\n    return this.children\r\n  }\r\n  getParity() {\r\n    return this.numPrecedingRectanglesInRow % 2\r\n  }\r\n  forEachLeafNodeWithinBounds(configSpaceBounds: Rect, cb: (leaf: RangeTreeLeafNode) => void) {\r\n    if (!this.bounds.hasIntersectionWith(configSpaceBounds)) return\r\n    cb(this)\r\n  }\r\n}\r\n\r\nclass RangeTreeInteriorNode implements RangeTreeNode {\r\n  private rectCount: number = 0\r\n  private bounds: Rect\r\n  constructor(private children: RangeTreeNode[]) {\r\n    if (children.length === 0) {\r\n      throw new Error('Empty interior node')\r\n    }\r\n    let minLeft = Infinity\r\n    let maxRight = -Infinity\r\n    let minTop = Infinity\r\n    let maxBottom = -Infinity\r\n    for (let child of children) {\r\n      this.rectCount += child.getRectCount()\r\n      const bounds = child.getBounds()\r\n      minLeft = Math.min(minLeft, bounds.left())\r\n      maxRight = Math.max(maxRight, bounds.right())\r\n      minTop = Math.min(minTop, bounds.top())\r\n      maxBottom = Math.max(maxBottom, bounds.bottom())\r\n    }\r\n    this.bounds = new Rect(\r\n      new Vec2(minLeft, minTop),\r\n      new Vec2(maxRight - minLeft, maxBottom - minTop),\r\n    )\r\n  }\r\n\r\n  getBounds() {\r\n    return this.bounds\r\n  }\r\n  getRectCount() {\r\n    return this.rectCount\r\n  }\r\n  getChildren() {\r\n    return this.children\r\n  }\r\n\r\n  forEachLeafNodeWithinBounds(configSpaceBounds: Rect, cb: (leaf: RangeTreeLeafNode) => void) {\r\n    if (!this.bounds.hasIntersectionWith(configSpaceBounds)) return\r\n    for (let child of this.children) {\r\n      child.forEachLeafNodeWithinBounds(configSpaceBounds, cb)\r\n    }\r\n  }\r\n}\r\n\r\nexport interface FlamechartRendererProps {\r\n  configSpaceSrcRect: Rect\r\n  physicalSpaceDstRect: Rect\r\n  renderOutlines: boolean\r\n}\r\n\r\ninterface FlamechartRowAtlasKeyInfo {\r\n  stackDepth: number\r\n  zoomLevel: number\r\n  index: number\r\n}\r\n\r\nexport class FlamechartRowAtlasKey {\r\n  readonly stackDepth: number\r\n  readonly zoomLevel: number\r\n  readonly index: number\r\n\r\n  get key() {\r\n    return `${this.stackDepth}_${this.index}_${this.zoomLevel}`\r\n  }\r\n  private constructor(options: FlamechartRowAtlasKeyInfo) {\r\n    this.stackDepth = options.stackDepth\r\n    this.zoomLevel = options.zoomLevel\r\n    this.index = options.index\r\n  }\r\n  static getOrInsert(set: KeyedSet<FlamechartRowAtlasKey>, info: FlamechartRowAtlasKeyInfo) {\r\n    return set.getOrInsert(new FlamechartRowAtlasKey(info))\r\n  }\r\n}\r\n\r\nexport interface FlamechartRendererOptions {\r\n  inverted: boolean\r\n}\r\n\r\nexport class FlamechartRenderer {\r\n  private layers: RangeTreeNode[] = []\r\n\r\n  constructor(\r\n    private gl: Graphics.Context,\r\n    private rowAtlas: RowAtlas<FlamechartRowAtlasKey>,\r\n    private flamechart: Flamechart,\r\n    private rectangleBatchRenderer: RectangleBatchRenderer,\r\n    private colorPassRenderer: FlamechartColorPassRenderer,\r\n    private options: FlamechartRendererOptions = {inverted: false},\r\n  ) {\r\n    const nLayers = flamechart.getLayers().length\r\n    for (let stackDepth = 0; stackDepth < nLayers; stackDepth++) {\r\n      const leafNodes: RangeTreeLeafNode[] = []\r\n      const y = options.inverted ? nLayers - 1 - stackDepth : stackDepth\r\n\r\n      let minLeft = Infinity\r\n      let maxRight = -Infinity\r\n      let batch = new RectangleBatch(this.gl)\r\n\r\n      let rectCount = 0\r\n\r\n      const layer = flamechart.getLayers()[stackDepth]\r\n\r\n      for (let i = 0; i < layer.length; i++) {\r\n        const frame = layer[i]\r\n        if (batch.getRectCount() >= MAX_BATCH_SIZE) {\r\n          leafNodes.push(\r\n            new RangeTreeLeafNode(\r\n              batch,\r\n              new Rect(new Vec2(minLeft, y), new Vec2(maxRight - minLeft, 1)),\r\n              rectCount,\r\n            ),\r\n          )\r\n          minLeft = Infinity\r\n          maxRight = -Infinity\r\n          batch = new RectangleBatch(this.gl)\r\n        }\r\n        const configSpaceBounds = new Rect(\r\n          new Vec2(frame.start, y),\r\n          new Vec2(frame.end - frame.start, 1),\r\n        )\r\n        minLeft = Math.min(minLeft, configSpaceBounds.left())\r\n        maxRight = Math.max(maxRight, configSpaceBounds.right())\r\n\r\n        // We'll use the red channel to indicate the index to allow\r\n        // us to separate adjacent rectangles within a row from one another,\r\n        // the green channel to indicate the row,\r\n        // and the blue channel to indicate the color bucket to render.\r\n        // We add one to each so we have zero reserved for the background color.\r\n        const color = new Color(\r\n          (1 + (i % 255)) / 256,\r\n          (1 + (stackDepth % 255)) / 256,\r\n          (1 + this.flamechart.getColorBucketForFrame(frame.node.frame)) / 256,\r\n        )\r\n        batch.addRect(configSpaceBounds, color)\r\n        rectCount++\r\n      }\r\n\r\n      if (batch.getRectCount() > 0) {\r\n        leafNodes.push(\r\n          new RangeTreeLeafNode(\r\n            batch,\r\n            new Rect(new Vec2(minLeft, y), new Vec2(maxRight - minLeft, 1)),\r\n            rectCount,\r\n          ),\r\n        )\r\n      }\r\n\r\n      // TODO(jlfwong): Making this into a binary tree\r\n      // range than a tree of always-height-two might make this run faster\r\n      this.layers.push(new RangeTreeInteriorNode(leafNodes))\r\n    }\r\n  }\r\n\r\n  private rectInfoTexture: Graphics.Texture | null = null\r\n  getRectInfoTexture(width: number, height: number): Graphics.Texture {\r\n    if (this.rectInfoTexture) {\r\n      const texture = this.rectInfoTexture\r\n      if (texture.width != width || texture.height != height) {\r\n        texture.resize(width, height)\r\n      }\r\n    } else {\r\n      this.rectInfoTexture = this.gl.createTexture(\r\n        Graphics.TextureFormat.NEAREST_CLAMP,\r\n        width,\r\n        height,\r\n      )\r\n    }\r\n    return this.rectInfoTexture\r\n  }\r\n\r\n  private rectInfoRenderTarget: Graphics.RenderTarget | null = null\r\n  getRectInfoRenderTarget(width: number, height: number): Graphics.RenderTarget {\r\n    const texture = this.getRectInfoTexture(width, height)\r\n    if (this.rectInfoRenderTarget) {\r\n      if (this.rectInfoRenderTarget.texture != texture) {\r\n        this.rectInfoRenderTarget.texture.free()\r\n        this.rectInfoRenderTarget.setColor(texture)\r\n      }\r\n    }\r\n    if (!this.rectInfoRenderTarget) {\r\n      this.rectInfoRenderTarget = this.gl.createRenderTarget(texture)\r\n    }\r\n    return this.rectInfoRenderTarget\r\n  }\r\n\r\n  free() {\r\n    if (this.rectInfoRenderTarget) {\r\n      this.rectInfoRenderTarget.free()\r\n    }\r\n    if (this.rectInfoTexture) {\r\n      this.rectInfoTexture.free()\r\n    }\r\n  }\r\n\r\n  private atlasKeys = new KeyedSet<FlamechartRowAtlasKey>()\r\n\r\n  configSpaceBoundsForKey(key: FlamechartRowAtlasKey): Rect {\r\n    const {stackDepth, zoomLevel, index} = key\r\n    const configSpaceContentWidth = this.flamechart.getTotalWeight()\r\n\r\n    const width = configSpaceContentWidth / Math.pow(2, zoomLevel)\r\n\r\n    const nLayers = this.flamechart.getLayers().length\r\n    const y = this.options.inverted ? nLayers - 1 - stackDepth : stackDepth\r\n    return new Rect(new Vec2(width * index, y), new Vec2(width, 1))\r\n  }\r\n\r\n  render(props: FlamechartRendererProps) {\r\n    const {configSpaceSrcRect, physicalSpaceDstRect} = props\r\n\r\n    const atlasKeysToRender: FlamechartRowAtlasKey[] = []\r\n\r\n    // We want to render the lowest resolution we can while still guaranteeing that the\r\n    // atlas line is higher resolution than its corresponding destination rectangle on\r\n    // the screen.\r\n    const configToPhysical = AffineTransform.betweenRects(configSpaceSrcRect, physicalSpaceDstRect)\r\n    if (configSpaceSrcRect.isEmpty()) {\r\n      // Prevent an infinite loop\r\n      return\r\n    }\r\n\r\n    let zoomLevel = 0\r\n    while (true) {\r\n      const key = FlamechartRowAtlasKey.getOrInsert(this.atlasKeys, {\r\n        stackDepth: 0,\r\n        zoomLevel,\r\n        index: 0,\r\n      })\r\n      const configSpaceBounds = this.configSpaceBoundsForKey(key)\r\n      const physicalBounds = configToPhysical.transformRect(configSpaceBounds)\r\n      if (physicalBounds.width() < this.rowAtlas.getResolution()) {\r\n        break\r\n      }\r\n      zoomLevel++\r\n    }\r\n\r\n    const top = Math.max(0, Math.floor(configSpaceSrcRect.top()))\r\n    const bottom = Math.min(this.layers.length, Math.ceil(configSpaceSrcRect.bottom()))\r\n\r\n    const configSpaceContentWidth = this.flamechart.getTotalWeight()\r\n    const numAtlasEntriesPerLayer = Math.pow(2, zoomLevel)\r\n    const left = Math.floor(\r\n      (numAtlasEntriesPerLayer * configSpaceSrcRect.left()) / configSpaceContentWidth,\r\n    )\r\n    const right = Math.ceil(\r\n      (numAtlasEntriesPerLayer * configSpaceSrcRect.right()) / configSpaceContentWidth,\r\n    )\r\n\r\n    const nLayers = this.flamechart.getLayers().length\r\n\r\n    for (let y = top; y < bottom; y++) {\r\n      for (let index = left; index <= right; index++) {\r\n        const stackDepth = this.options.inverted ? nLayers - 1 - y : y\r\n        const key = FlamechartRowAtlasKey.getOrInsert(this.atlasKeys, {\r\n          stackDepth,\r\n          zoomLevel,\r\n          index,\r\n        })\r\n        const configSpaceBounds = this.configSpaceBoundsForKey(key)\r\n        if (!configSpaceBounds.hasIntersectionWith(configSpaceSrcRect)) continue\r\n        atlasKeysToRender.push(key)\r\n      }\r\n    }\r\n\r\n    // TODO(jlfwong): When I switched the GL backend from regl to the port from\r\n    // evanw/sky, rendering uncached even for massive documents seemed fast\r\n    // enough. It's possible that the row cache is now unnecessary, but I'll\r\n    // leave it around for now since it's not causing issues.\r\n\r\n    const cacheCapacity = this.rowAtlas.getCapacity()\r\n    const keysToRenderCached = atlasKeysToRender.slice(0, cacheCapacity)\r\n    const keysToRenderUncached = atlasKeysToRender.slice(cacheCapacity)\r\n\r\n    // Fill the cache\r\n    this.rowAtlas.writeToAtlasIfNeeded(keysToRenderCached, (textureDstRect, key) => {\r\n      const configSpaceBounds = this.configSpaceBoundsForKey(key)\r\n      this.layers[key.stackDepth].forEachLeafNodeWithinBounds(configSpaceBounds, leaf => {\r\n        this.rectangleBatchRenderer.render({\r\n          batch: leaf.getBatch(),\r\n          configSpaceSrcRect: configSpaceBounds,\r\n          physicalSpaceDstRect: textureDstRect,\r\n        })\r\n      })\r\n    })\r\n\r\n    const renderTarget = this.getRectInfoRenderTarget(\r\n      physicalSpaceDstRect.width(),\r\n      physicalSpaceDstRect.height(),\r\n    )\r\n\r\n    renderInto(this.gl, renderTarget, () => {\r\n      this.gl.clear(new Graphics.Color(0, 0, 0, 0))\r\n\r\n      const viewportRect = new Rect(\r\n        Vec2.zero,\r\n        new Vec2(this.gl.viewport.width, this.gl.viewport.height),\r\n      )\r\n      const configToViewport = AffineTransform.betweenRects(configSpaceSrcRect, viewportRect)\r\n\r\n      // Render from the cache\r\n      for (let key of keysToRenderCached) {\r\n        const configSpaceSrcRect = this.configSpaceBoundsForKey(key)\r\n        this.rowAtlas.renderViaAtlas(key, configToViewport.transformRect(configSpaceSrcRect))\r\n      }\r\n\r\n      // Render entries that didn't make it into the cache\r\n      for (let key of keysToRenderUncached) {\r\n        const configSpaceBounds = this.configSpaceBoundsForKey(key)\r\n        const physicalBounds = configToViewport.transformRect(configSpaceBounds)\r\n        this.layers[key.stackDepth].forEachLeafNodeWithinBounds(configSpaceBounds, leaf => {\r\n          this.rectangleBatchRenderer.render({\r\n            batch: leaf.getBatch(),\r\n            configSpaceSrcRect: configSpaceBounds,\r\n            physicalSpaceDstRect: physicalBounds,\r\n          })\r\n        })\r\n      }\r\n    })\r\n\r\n    const rectInfoTexture = this.getRectInfoTexture(\r\n      physicalSpaceDstRect.width(),\r\n      physicalSpaceDstRect.height(),\r\n    )\r\n\r\n    this.colorPassRenderer.render({\r\n      rectInfoTexture,\r\n      srcRect: new Rect(Vec2.zero, new Vec2(rectInfoTexture.width, rectInfoTexture.height)),\r\n      dstRect: physicalSpaceDstRect,\r\n      renderOutlines: props.renderOutlines,\r\n    })\r\n  }\r\n}\r\n","import {StyleSheet} from 'aphrodite'\r\nimport {FontSize, Sizes} from './style'\r\nimport {withTheme} from './themes/theme'\r\n\r\nexport const getFlamechartStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    hoverCount: {\r\n      color: theme.weightColor,\r\n    },\r\n    fill: {\r\n      width: '100%',\r\n      height: '100%',\r\n      position: 'absolute',\r\n      left: 0,\r\n      top: 0,\r\n    },\r\n    minimap: {\r\n      height: Sizes.MINIMAP_HEIGHT,\r\n      borderBottom: `${Sizes.SEPARATOR_HEIGHT}px solid ${theme.fgSecondaryColor}`,\r\n    },\r\n    panZoomView: {\r\n      flex: 1,\r\n    },\r\n\r\n    detailView: {\r\n      display: 'grid',\r\n      height: Sizes.DETAIL_VIEW_HEIGHT,\r\n      overflow: 'hidden',\r\n      gridTemplateColumns: '120px 120px 1fr',\r\n      gridTemplateRows: 'repeat(4, 1fr)',\r\n      borderTop: `${Sizes.SEPARATOR_HEIGHT}px solid ${theme.fgSecondaryColor}`,\r\n      fontSize: FontSize.LABEL,\r\n      position: 'absolute',\r\n      background: theme.bgPrimaryColor,\r\n      width: '100vw',\r\n      bottom: 0,\r\n    },\r\n    stackTraceViewPadding: {\r\n      padding: 5,\r\n    },\r\n    stackTraceView: {\r\n      height: Sizes.DETAIL_VIEW_HEIGHT,\r\n      lineHeight: `${FontSize.LABEL + 2}px`,\r\n      overflow: 'auto',\r\n      '::-webkit-scrollbar': {\r\n        background: theme.bgPrimaryColor,\r\n      },\r\n      '::-webkit-scrollbar-thumb': {\r\n        background: theme.fgSecondaryColor,\r\n        borderRadius: 20,\r\n        border: `3px solid ${theme.bgPrimaryColor}`,\r\n        ':hover': {\r\n          background: theme.fgPrimaryColor,\r\n        },\r\n      },\r\n    },\r\n    stackLine: {\r\n      whiteSpace: 'nowrap',\r\n    },\r\n    stackFileLine: {\r\n      color: theme.fgSecondaryColor,\r\n    },\r\n    statsTable: {\r\n      display: 'grid',\r\n      gridTemplateColumns: '1fr 1fr',\r\n      gridTemplateRows: `repeat(3, ${FontSize.LABEL + 10}px)`,\r\n      gridGap: '1px 1px',\r\n      textAlign: 'center',\r\n      paddingRight: 1,\r\n    },\r\n    statsTableHeader: {\r\n      gridColumn: '1 / 3',\r\n    },\r\n    statsTableCell: {\r\n      position: 'relative',\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      alignItems: 'center',\r\n    },\r\n    thisInstanceCell: {\r\n      background: theme.selectionPrimaryColor,\r\n      color: theme.altFgPrimaryColor,\r\n    },\r\n    allInstancesCell: {\r\n      background: theme.selectionSecondaryColor,\r\n      color: theme.altFgPrimaryColor,\r\n    },\r\n    barDisplay: {\r\n      position: 'absolute',\r\n      top: 0,\r\n      left: 0,\r\n      background: 'rgba(0, 0, 0, 0.2)',\r\n      width: '100%',\r\n    },\r\n  }),\r\n)\r\n","import {findValueBisect} from './utils'\r\n\r\nexport const ELLIPSIS = '\\u2026'\r\n\r\n// NOTE: This blindly assumes the same result across contexts.\r\nconst measureTextCache = new Map<string, number>()\r\n\r\nlet lastDevicePixelRatio = -1\r\nexport function cachedMeasureTextWidth(ctx: CanvasRenderingContext2D, text: string): number {\r\n  if (window.devicePixelRatio !== lastDevicePixelRatio) {\r\n    // This cache is no longer valid!\r\n    measureTextCache.clear()\r\n    lastDevicePixelRatio = window.devicePixelRatio\r\n  }\r\n  if (!measureTextCache.has(text)) {\r\n    measureTextCache.set(text, ctx.measureText(text).width)\r\n  }\r\n  return measureTextCache.get(text)!\r\n}\r\n\r\ninterface TrimmedTextResult {\r\n  trimmedString: string\r\n  trimmedLength: number\r\n  prefixLength: number\r\n  suffixLength: number\r\n  originalLength: number\r\n  originalString: string\r\n}\r\n\r\n// Trim text, placing an ellipsis in the middle, with a slight bias towards\r\n// keeping text from the beginning rather than the end\r\nexport function buildTrimmedText(text: string, length: number): TrimmedTextResult {\r\n  if (text.length <= length) {\r\n    return {\r\n      trimmedString: text,\r\n      trimmedLength: text.length,\r\n      prefixLength: text.length,\r\n      suffixLength: 0,\r\n      originalString: text,\r\n      originalLength: text.length,\r\n    }\r\n  }\r\n\r\n  let prefixLength = Math.floor(length / 2)\r\n  const suffixLength = length - prefixLength - 1\r\n  const prefix = text.substring(0, prefixLength)\r\n  const suffix = text.substring(text.length - suffixLength, text.length)\r\n  const trimmedString = prefix + ELLIPSIS + suffix\r\n  return {\r\n    trimmedString,\r\n    trimmedLength: trimmedString.length,\r\n    prefixLength: prefix.length,\r\n    suffixLength: suffix.length,\r\n    originalString: text,\r\n    originalLength: text.length,\r\n  }\r\n}\r\n\r\n// Trim text to fit within the given number of pixels on the canvas\r\nexport function trimTextMid(\r\n  ctx: CanvasRenderingContext2D,\r\n  text: string,\r\n  maxWidth: number,\r\n): TrimmedTextResult {\r\n  if (cachedMeasureTextWidth(ctx, text) <= maxWidth) {\r\n    return buildTrimmedText(text, text.length)\r\n  }\r\n  const [lo] = findValueBisect(\r\n    0,\r\n    text.length,\r\n    n => {\r\n      return cachedMeasureTextWidth(ctx, buildTrimmedText(text, Math.floor(n)).trimmedString)\r\n    },\r\n    maxWidth,\r\n  )\r\n  return buildTrimmedText(text, Math.floor(lo))\r\n}\r\n\r\nenum IndexTypeInTrimmed {\r\n  IN_PREFIX,\r\n  IN_SUFFIX,\r\n  ELIDED,\r\n}\r\n\r\nfunction getIndexTypeInTrimmed(result: TrimmedTextResult, index: number): IndexTypeInTrimmed {\r\n  if (index < result.prefixLength) {\r\n    return IndexTypeInTrimmed.IN_PREFIX\r\n  } else if (index < result.originalLength - result.suffixLength) {\r\n    return IndexTypeInTrimmed.ELIDED\r\n  } else {\r\n    return IndexTypeInTrimmed.IN_SUFFIX\r\n  }\r\n}\r\n\r\nexport function remapRangesToTrimmedText(\r\n  trimmedText: TrimmedTextResult,\r\n  ranges: [number, number][],\r\n): [number, number][] {\r\n  // We intentionally don't just re-run fuzzy matching on the trimmed\r\n  // text, beacuse if the search query is \"helloWorld\", the frame name\r\n  // is \"application::helloWorld\", and that gets trimmed down to\r\n  // \"appl...oWorld\", we still want \"oWorld\" to be highlighted, even\r\n  // though the string \"appl...oWorld\" is not matched by the query\r\n  // \"helloWorld\".\r\n  //\r\n  // There's a weird case to consider here: what if the trimmedText is\r\n  // also matched by the query, but results in a different match than\r\n  // the original query? Consider, e.g. the search string of \"ab\". The\r\n  // string \"hello ab shabby\" will be matched at the first \"ab\", but\r\n  // may be trimmed to \"hello...shabby\". In this case, should we\r\n  // highlight the \"ab\" hidden by the ellipsis, or the \"ab\" in\r\n  // \"shabby\"? The code below highlights the ellipsis so that the\r\n  // matched characters don't change as you zoom in and out.\r\n\r\n  const rangesToHighlightInTrimmedText: [number, number][] = []\r\n  const lengthLoss = trimmedText.originalLength - trimmedText.trimmedLength\r\n  let highlightedEllipsis = false\r\n\r\n  for (let [origStart, origEnd] of ranges) {\r\n    let startPosType = getIndexTypeInTrimmed(trimmedText, origStart)\r\n    let endPosType = getIndexTypeInTrimmed(trimmedText, origEnd - 1)\r\n\r\n    switch (startPosType) {\r\n      case IndexTypeInTrimmed.IN_PREFIX: {\r\n        switch (endPosType) {\r\n          case IndexTypeInTrimmed.IN_PREFIX: {\r\n            // The entire range fits in the prefix. Add it unmodified.\r\n            rangesToHighlightInTrimmedText.push([origStart, origEnd])\r\n            break\r\n          }\r\n          case IndexTypeInTrimmed.ELIDED: {\r\n            // The range starts in the prefix, but ends in the elided\r\n            // section. Add just the prefix + one char for the ellipsis.\r\n            rangesToHighlightInTrimmedText.push([origStart, trimmedText.prefixLength + 1])\r\n            highlightedEllipsis = true\r\n            break\r\n          }\r\n          case IndexTypeInTrimmed.IN_SUFFIX: {\r\n            // The range crosses from the prefix to the suffix.\r\n            // Highlight everything including the ellipsis.\r\n            rangesToHighlightInTrimmedText.push([origStart, origEnd - lengthLoss])\r\n            break\r\n          }\r\n        }\r\n        break\r\n      }\r\n      case IndexTypeInTrimmed.ELIDED: {\r\n        switch (endPosType) {\r\n          case IndexTypeInTrimmed.IN_PREFIX: {\r\n            // This should be impossible\r\n            throw new Error('Unexpected highlight range starts in elided and ends in prefix')\r\n          }\r\n          case IndexTypeInTrimmed.ELIDED: {\r\n            // The match starts & ends within the elided section.\r\n            if (!highlightedEllipsis) {\r\n              rangesToHighlightInTrimmedText.push([\r\n                trimmedText.prefixLength,\r\n                trimmedText.prefixLength + 1,\r\n              ])\r\n              highlightedEllipsis = true\r\n            }\r\n            break\r\n          }\r\n          case IndexTypeInTrimmed.IN_SUFFIX: {\r\n            // The match starts in elided, but ends in suffix.\r\n            if (highlightedEllipsis) {\r\n              rangesToHighlightInTrimmedText.push([\r\n                trimmedText.trimmedLength - trimmedText.suffixLength,\r\n                origEnd - lengthLoss,\r\n              ])\r\n            } else {\r\n              rangesToHighlightInTrimmedText.push([trimmedText.prefixLength, origEnd - lengthLoss])\r\n              highlightedEllipsis = true\r\n            }\r\n            break\r\n          }\r\n        }\r\n        break\r\n      }\r\n      case IndexTypeInTrimmed.IN_SUFFIX: {\r\n        switch (endPosType) {\r\n          case IndexTypeInTrimmed.IN_PREFIX: {\r\n            // This should be impossible\r\n            throw new Error('Unexpected highlight range starts in suffix and ends in prefix')\r\n          }\r\n          case IndexTypeInTrimmed.ELIDED: {\r\n            // This should be impossible\r\n            throw new Error('Unexpected highlight range starts in suffix and ends in elided')\r\n            break\r\n          }\r\n          case IndexTypeInTrimmed.IN_SUFFIX: {\r\n            // Match starts & ends in suffix\r\n            rangesToHighlightInTrimmedText.push([origStart - lengthLoss, origEnd - lengthLoss])\r\n            break\r\n          }\r\n        }\r\n        break\r\n      }\r\n    }\r\n  }\r\n  return rangesToHighlightInTrimmedText\r\n}\r\n","import {h, Component} from 'preact'\r\nimport {css} from 'aphrodite'\r\nimport {Flamechart} from '../lib/flamechart'\r\nimport {Rect, Vec2, AffineTransform, clamp} from '../lib/math'\r\nimport {FlamechartRenderer} from '../gl/flamechart-renderer'\r\nimport {getFlamechartStyle} from './flamechart-style'\r\nimport {FontFamily, FontSize, Sizes, commonStyle} from './style'\r\nimport {CanvasContext} from '../gl/canvas-context'\r\nimport {cachedMeasureTextWidth} from '../lib/text-utils'\r\nimport {Color} from '../lib/color'\r\nimport {Theme} from './themes/theme'\r\n\r\ninterface FlamechartMinimapViewProps {\r\n  theme: Theme\r\n\r\n  flamechart: Flamechart\r\n  configSpaceViewportRect: Rect\r\n\r\n  canvasContext: CanvasContext\r\n  flamechartRenderer: FlamechartRenderer\r\n\r\n  transformViewport: (transform: AffineTransform) => void\r\n  setConfigSpaceViewportRect: (rect: Rect) => void\r\n}\r\n\r\nenum DraggingMode {\r\n  DRAW_NEW_VIEWPORT,\r\n  TRANSLATE_VIEWPORT,\r\n}\r\n\r\nexport class FlamechartMinimapView extends Component<FlamechartMinimapViewProps, {}> {\r\n  container: Element | null = null\r\n  containerRef = (element: Element | null) => {\r\n    this.container = element || null\r\n  }\r\n\r\n  overlayCanvas: HTMLCanvasElement | null = null\r\n  overlayCtx: CanvasRenderingContext2D | null = null\r\n\r\n  private physicalViewSize() {\r\n    return new Vec2(\r\n      this.overlayCanvas ? this.overlayCanvas.width : 0,\r\n      this.overlayCanvas ? this.overlayCanvas.height : 0,\r\n    )\r\n  }\r\n\r\n  private getStyle() {\r\n    return getFlamechartStyle(this.props.theme)\r\n  }\r\n\r\n  private minimapOrigin() {\r\n    return new Vec2(0, Sizes.FRAME_HEIGHT * window.devicePixelRatio)\r\n  }\r\n\r\n  private configSpaceSize() {\r\n    return new Vec2(\r\n      this.props.flamechart.getTotalWeight(),\r\n      this.props.flamechart.getLayers().length,\r\n    )\r\n  }\r\n\r\n  private configSpaceToPhysicalViewSpace() {\r\n    const minimapOrigin = this.minimapOrigin()\r\n\r\n    return AffineTransform.betweenRects(\r\n      new Rect(new Vec2(0, 0), this.configSpaceSize()),\r\n      new Rect(minimapOrigin, this.physicalViewSize().minus(minimapOrigin)),\r\n    )\r\n  }\r\n\r\n  private logicalToPhysicalViewSpace() {\r\n    return AffineTransform.withScale(new Vec2(window.devicePixelRatio, window.devicePixelRatio))\r\n  }\r\n\r\n  private windowToLogicalViewSpace() {\r\n    if (!this.container) return new AffineTransform()\r\n    const bounds = this.container.getBoundingClientRect()\r\n    return AffineTransform.withTranslation(new Vec2(-bounds.left, -bounds.top))\r\n  }\r\n\r\n  private renderRects() {\r\n    if (!this.container) return\r\n\r\n    // Hasn't resized yet -- no point in rendering yet\r\n    if (this.physicalViewSize().x < 2) return\r\n\r\n    this.props.canvasContext.renderBehind(this.container, () => {\r\n      this.props.flamechartRenderer.render({\r\n        configSpaceSrcRect: new Rect(new Vec2(0, 0), this.configSpaceSize()),\r\n        physicalSpaceDstRect: new Rect(\r\n          this.minimapOrigin(),\r\n          this.physicalViewSize().minus(this.minimapOrigin()),\r\n        ),\r\n        renderOutlines: false,\r\n      })\r\n\r\n      this.props.canvasContext.viewportRectangleRenderer.render({\r\n        configSpaceViewportRect: this.props.configSpaceViewportRect,\r\n        configSpaceToPhysicalViewSpace: this.configSpaceToPhysicalViewSpace(),\r\n      })\r\n    })\r\n  }\r\n\r\n  private renderOverlays() {\r\n    const ctx = this.overlayCtx\r\n    if (!ctx) return\r\n    const physicalViewSize = this.physicalViewSize()\r\n    ctx.clearRect(0, 0, physicalViewSize.x, physicalViewSize.y)\r\n\r\n    const configToPhysical = this.configSpaceToPhysicalViewSpace()\r\n\r\n    const left = 0\r\n    const right = this.configSpaceSize().x\r\n\r\n    // TODO(jlfwong): There's a huge amount of code duplication here between\r\n    // this and the FlamechartView.renderOverlays(). Consolidate.\r\n\r\n    // We want about 10 gridlines to be visible, and want the unit to be\r\n    // 1eN, 2eN, or 5eN for some N\r\n\r\n    // Ideally, we want an interval every 100 logical screen pixels\r\n    const logicalToConfig = (\r\n      this.configSpaceToPhysicalViewSpace().inverted() || new AffineTransform()\r\n    ).times(this.logicalToPhysicalViewSpace())\r\n    const targetInterval = logicalToConfig.transformVector(new Vec2(200, 1)).x\r\n\r\n    const physicalViewSpaceFrameHeight = Sizes.FRAME_HEIGHT * window.devicePixelRatio\r\n    const physicalViewSpaceFontSize = FontSize.LABEL * window.devicePixelRatio\r\n    const labelPaddingPx = (physicalViewSpaceFrameHeight - physicalViewSpaceFontSize) / 2\r\n\r\n    ctx.font = `${physicalViewSpaceFontSize}px/${physicalViewSpaceFrameHeight}px ${FontFamily.MONOSPACE}`\r\n    ctx.textBaseline = 'top'\r\n\r\n    const minInterval = Math.pow(10, Math.floor(Math.log10(targetInterval)))\r\n    let interval = minInterval\r\n\r\n    if (targetInterval / interval > 5) {\r\n      interval *= 5\r\n    } else if (targetInterval / interval > 2) {\r\n      interval *= 2\r\n    }\r\n\r\n    const theme = this.props.theme\r\n\r\n    {\r\n      ctx.fillStyle = Color.fromCSSHex(theme.bgPrimaryColor).withAlpha(0.8).toCSS()\r\n      ctx.fillRect(0, 0, physicalViewSize.x, physicalViewSpaceFrameHeight)\r\n      ctx.textBaseline = 'top'\r\n\r\n      for (let x = Math.ceil(left / interval) * interval; x < right; x += interval) {\r\n        // TODO(jlfwong): Ensure that labels do not overlap\r\n        const pos = Math.round(configToPhysical.transformPosition(new Vec2(x, 0)).x)\r\n        const labelText = this.props.flamechart.formatValue(x)\r\n        const textWidth = Math.ceil(cachedMeasureTextWidth(ctx, labelText))\r\n\r\n        ctx.fillStyle = theme.fgPrimaryColor\r\n        ctx.fillText(labelText, pos - textWidth - labelPaddingPx, labelPaddingPx)\r\n        ctx.fillStyle = theme.fgSecondaryColor\r\n        ctx.fillRect(pos, 0, 1, physicalViewSize.y)\r\n      }\r\n    }\r\n  }\r\n\r\n  onWindowResize = () => {\r\n    this.onBeforeFrame()\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps: FlamechartMinimapViewProps) {\r\n    if (this.props.flamechart !== nextProps.flamechart) {\r\n      this.renderCanvas()\r\n    } else if (this.props.configSpaceViewportRect != nextProps.configSpaceViewportRect) {\r\n      this.renderCanvas()\r\n    } else if (this.props.canvasContext !== nextProps.canvasContext) {\r\n      if (this.props.canvasContext) {\r\n        this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame)\r\n      }\r\n      if (nextProps.canvasContext) {\r\n        nextProps.canvasContext.addBeforeFrameHandler(this.onBeforeFrame)\r\n        nextProps.canvasContext.requestFrame()\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('resize', this.onWindowResize)\r\n    this.props.canvasContext.addBeforeFrameHandler(this.onBeforeFrame)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('resize', this.onWindowResize)\r\n    this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame)\r\n  }\r\n\r\n  private resizeOverlayCanvasIfNeeded() {\r\n    if (!this.overlayCanvas) return\r\n    let {width, height} = this.overlayCanvas.getBoundingClientRect()\r\n    {\r\n      /*\r\n      We render text at a higher resolution then scale down to\r\n      ensure we're rendering at 1:1 device pixel ratio.\r\n      This ensures our text is rendered crisply.\r\n    */\r\n    }\r\n    width = Math.floor(width)\r\n    height = Math.floor(height)\r\n\r\n    // Still initializing: don't resize yet\r\n    if (width === 0 || height === 0) return\r\n\r\n    const scaledWidth = width * window.devicePixelRatio\r\n    const scaledHeight = height * window.devicePixelRatio\r\n\r\n    if (scaledWidth === this.overlayCanvas.width && scaledHeight === this.overlayCanvas.height)\r\n      return\r\n\r\n    this.overlayCanvas.width = scaledWidth\r\n    this.overlayCanvas.height = scaledHeight\r\n  }\r\n\r\n  private onBeforeFrame = () => {\r\n    this.maybeClearInteractionLock()\r\n    this.resizeOverlayCanvasIfNeeded()\r\n    this.renderRects()\r\n    this.renderOverlays()\r\n  }\r\n\r\n  private renderCanvas = () => {\r\n    this.props.canvasContext.requestFrame()\r\n  }\r\n\r\n  // Inertial scrolling introduces tricky interaction problems.\r\n  // Namely, if you start panning, and hit the edge of the scrollable\r\n  // area, the browser continues to receive WheelEvents from inertial\r\n  // scrolling. If we start zooming by holding Cmd + scrolling, then\r\n  // release the Cmd key, this can cause us to interpret the incoming\r\n  // inertial scrolling events as panning. To prevent this, we introduce\r\n  // a concept of an \"Interaction Lock\". Once a certain interaction has\r\n  // begun, we don't allow the other type of interaction to begin until\r\n  // we've received two frames with no inertial wheel events. This\r\n  // prevents us from accidentally switching between panning & zooming.\r\n  private frameHadWheelEvent = false\r\n  private framesWithoutWheelEvents = 0\r\n  private interactionLock: 'pan' | 'zoom' | null = null\r\n  private maybeClearInteractionLock = () => {\r\n    if (this.interactionLock) {\r\n      if (!this.frameHadWheelEvent) {\r\n        this.framesWithoutWheelEvents++\r\n        if (this.framesWithoutWheelEvents >= 2) {\r\n          this.interactionLock = null\r\n          this.framesWithoutWheelEvents = 0\r\n        }\r\n      }\r\n      this.props.canvasContext.requestFrame()\r\n    }\r\n    this.frameHadWheelEvent = false\r\n  }\r\n\r\n  private pan(logicalViewSpaceDelta: Vec2) {\r\n    this.interactionLock = 'pan'\r\n    const physicalDelta = this.logicalToPhysicalViewSpace().transformVector(logicalViewSpaceDelta)\r\n    const configDelta = this.configSpaceToPhysicalViewSpace().inverseTransformVector(physicalDelta)\r\n\r\n    if (!configDelta) return\r\n    this.props.transformViewport(AffineTransform.withTranslation(configDelta))\r\n  }\r\n\r\n  private zoom(multiplier: number) {\r\n    this.interactionLock = 'zoom'\r\n    const configSpaceViewport = this.props.configSpaceViewportRect\r\n    const configSpaceCenter = configSpaceViewport.origin.plus(configSpaceViewport.size.times(1 / 2))\r\n    if (!configSpaceCenter) return\r\n\r\n    const zoomTransform = AffineTransform.withTranslation(configSpaceCenter.times(-1))\r\n      .scaledBy(new Vec2(multiplier, 1))\r\n      .translatedBy(configSpaceCenter)\r\n\r\n    this.props.transformViewport(zoomTransform)\r\n  }\r\n\r\n  private onWheel = (ev: WheelEvent) => {\r\n    ev.preventDefault()\r\n\r\n    this.frameHadWheelEvent = true\r\n\r\n    const isZoom = ev.metaKey || ev.ctrlKey\r\n\r\n    if (isZoom && this.interactionLock !== 'pan') {\r\n      let multiplier = 1 + ev.deltaY / 100\r\n\r\n      // On Chrome & Firefox, pinch-to-zoom maps to\r\n      // WheelEvent + Ctrl Key. We'll accelerate it in\r\n      // this case, since it feels a bit sluggish otherwise.\r\n      if (ev.ctrlKey) {\r\n        multiplier = 1 + ev.deltaY / 40\r\n      }\r\n\r\n      multiplier = clamp(multiplier, 0.1, 10.0)\r\n\r\n      this.zoom(multiplier)\r\n    } else if (this.interactionLock !== 'zoom') {\r\n      this.pan(new Vec2(ev.deltaX, ev.deltaY))\r\n    }\r\n\r\n    this.renderCanvas()\r\n  }\r\n\r\n  private configSpaceMouse(ev: MouseEvent): Vec2 | null {\r\n    const logicalSpaceMouse = this.windowToLogicalViewSpace().transformPosition(\r\n      new Vec2(ev.clientX, ev.clientY),\r\n    )\r\n    const physicalSpaceMouse = this.logicalToPhysicalViewSpace().transformPosition(\r\n      logicalSpaceMouse,\r\n    )\r\n    return this.configSpaceToPhysicalViewSpace().inverseTransformPosition(physicalSpaceMouse)\r\n  }\r\n\r\n  private dragStartConfigSpaceMouse: Vec2 | null = null\r\n  private dragConfigSpaceViewportOffset: Vec2 | null = null\r\n  private draggingMode: DraggingMode | null = null\r\n  private onMouseDown = (ev: MouseEvent) => {\r\n    const configSpaceMouse = this.configSpaceMouse(ev)\r\n\r\n    if (configSpaceMouse) {\r\n      if (this.props.configSpaceViewportRect.contains(configSpaceMouse)) {\r\n        // If dragging starting inside the viewport rectangle,\r\n        // we'll move the existing viewport\r\n        this.draggingMode = DraggingMode.TRANSLATE_VIEWPORT\r\n        this.dragConfigSpaceViewportOffset = configSpaceMouse.minus(\r\n          this.props.configSpaceViewportRect.origin,\r\n        )\r\n      } else {\r\n        // If dragging starts outside the the viewport rectangle,\r\n        // we'll start drawing a new viewport\r\n        this.draggingMode = DraggingMode.DRAW_NEW_VIEWPORT\r\n      }\r\n\r\n      this.dragStartConfigSpaceMouse = configSpaceMouse\r\n      window.addEventListener('mousemove', this.onWindowMouseMove)\r\n      window.addEventListener('mouseup', this.onWindowMouseUp)\r\n      this.updateCursor(configSpaceMouse)\r\n    }\r\n  }\r\n\r\n  private onWindowMouseMove = (ev: MouseEvent) => {\r\n    if (!this.dragStartConfigSpaceMouse) return\r\n    let configSpaceMouse = this.configSpaceMouse(ev)\r\n\r\n    if (!configSpaceMouse) return\r\n    this.updateCursor(configSpaceMouse)\r\n\r\n    // Clamp the mouse position to avoid weird behavior when outside the canvas bounds\r\n    configSpaceMouse = new Rect(new Vec2(0, 0), this.configSpaceSize()).closestPointTo(\r\n      configSpaceMouse,\r\n    )\r\n\r\n    if (this.draggingMode === DraggingMode.DRAW_NEW_VIEWPORT) {\r\n      const configStart = this.dragStartConfigSpaceMouse\r\n      let configEnd = configSpaceMouse\r\n\r\n      if (!configStart || !configEnd) return\r\n      const left = Math.min(configStart.x, configEnd.x)\r\n      const right = Math.max(configStart.x, configEnd.x)\r\n\r\n      const width = right - left\r\n      const height = this.props.configSpaceViewportRect.height()\r\n\r\n      this.props.setConfigSpaceViewportRect(\r\n        new Rect(new Vec2(left, configEnd.y - height / 2), new Vec2(width, height)),\r\n      )\r\n    } else if (this.draggingMode === DraggingMode.TRANSLATE_VIEWPORT) {\r\n      if (!this.dragConfigSpaceViewportOffset) return\r\n\r\n      const newOrigin = configSpaceMouse.minus(this.dragConfigSpaceViewportOffset)\r\n      this.props.setConfigSpaceViewportRect(\r\n        this.props.configSpaceViewportRect.withOrigin(newOrigin),\r\n      )\r\n    }\r\n  }\r\n\r\n  private updateCursor = (configSpaceMouse: Vec2) => {\r\n    if (this.draggingMode === DraggingMode.TRANSLATE_VIEWPORT) {\r\n      document.body.style.cursor = 'grabbing'\r\n      document.body.style.cursor = '-webkit-grabbing'\r\n    } else if (this.draggingMode === DraggingMode.DRAW_NEW_VIEWPORT) {\r\n      document.body.style.cursor = 'col-resize'\r\n    } else if (this.props.configSpaceViewportRect.contains(configSpaceMouse)) {\r\n      document.body.style.cursor = 'grab'\r\n      document.body.style.cursor = '-webkit-grab'\r\n    } else {\r\n      document.body.style.cursor = 'col-resize'\r\n    }\r\n  }\r\n\r\n  private onMouseLeave = () => {\r\n    if (this.draggingMode == null) {\r\n      document.body.style.cursor = 'default'\r\n    }\r\n  }\r\n\r\n  private onMouseMove = (ev: MouseEvent) => {\r\n    const configSpaceMouse = this.configSpaceMouse(ev)\r\n    if (!configSpaceMouse) return\r\n    this.updateCursor(configSpaceMouse)\r\n  }\r\n\r\n  private onWindowMouseUp = (ev: MouseEvent) => {\r\n    this.draggingMode = null\r\n    window.removeEventListener('mousemove', this.onWindowMouseMove)\r\n    window.removeEventListener('mouseup', this.onWindowMouseUp)\r\n\r\n    const configSpaceMouse = this.configSpaceMouse(ev)\r\n    if (!configSpaceMouse) return\r\n    this.updateCursor(configSpaceMouse)\r\n  }\r\n\r\n  private overlayCanvasRef = (element: Element | null) => {\r\n    if (element) {\r\n      this.overlayCanvas = element as HTMLCanvasElement\r\n      this.overlayCtx = this.overlayCanvas.getContext('2d')\r\n      this.renderCanvas()\r\n    } else {\r\n      this.overlayCanvas = null\r\n      this.overlayCtx = null\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const style = this.getStyle()\r\n\r\n    return (\r\n      <div\r\n        ref={this.containerRef}\r\n        onWheel={this.onWheel}\r\n        onMouseDown={this.onMouseDown}\r\n        onMouseMove={this.onMouseMove}\r\n        onMouseLeave={this.onMouseLeave}\r\n        className={css(style.minimap, commonStyle.vbox)}\r\n      >\r\n        <canvas width={1} height={1} ref={this.overlayCanvasRef} className={css(style.fill)} />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import {StyleDeclarationValue, css} from 'aphrodite'\r\nimport {h, JSX} from 'preact'\r\nimport {getFlamechartStyle} from './flamechart-style'\r\nimport {formatPercent} from '../lib/utils'\r\nimport {Frame, CallTreeNode} from '../lib/profile'\r\nimport {ColorChit} from './color-chit'\r\nimport {Flamechart} from '../lib/flamechart'\r\nimport {useTheme} from './themes/theme'\r\n\r\ninterface StatisticsTableProps {\r\n  title: string\r\n  grandTotal: number\r\n  selectedTotal: number\r\n  selectedSelf: number\r\n  cellStyle: StyleDeclarationValue\r\n  formatter: (v: number) => string\r\n}\r\n\r\nfunction StatisticsTable(props: StatisticsTableProps) {\r\n  const style = getFlamechartStyle(useTheme())\r\n\r\n  const total = props.formatter(props.selectedTotal)\r\n  const self = props.formatter(props.selectedSelf)\r\n  const totalPerc = (100.0 * props.selectedTotal) / props.grandTotal\r\n  const selfPerc = (100.0 * props.selectedSelf) / props.grandTotal\r\n\r\n  return (\r\n    <div className={css(style.statsTable)}>\r\n      <div className={css(props.cellStyle, style.statsTableCell, style.statsTableHeader)}>\r\n        {props.title}\r\n      </div>\r\n\r\n      <div className={css(props.cellStyle, style.statsTableCell)}>Total</div>\r\n      <div className={css(props.cellStyle, style.statsTableCell)}>Self</div>\r\n\r\n      <div className={css(props.cellStyle, style.statsTableCell)}>{total}</div>\r\n      <div className={css(props.cellStyle, style.statsTableCell)}>{self}</div>\r\n\r\n      <div className={css(props.cellStyle, style.statsTableCell)}>\r\n        {formatPercent(totalPerc)}\r\n        <div className={css(style.barDisplay)} style={{height: `${totalPerc}%`}} />\r\n      </div>\r\n      <div className={css(props.cellStyle, style.statsTableCell)}>\r\n        {formatPercent(selfPerc)}\r\n        <div className={css(style.barDisplay)} style={{height: `${selfPerc}%`}} />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\ninterface StackTraceViewProps {\r\n  getFrameColor: (frame: Frame) => string\r\n  node: CallTreeNode\r\n}\r\nfunction StackTraceView(props: StackTraceViewProps) {\r\n  const style = getFlamechartStyle(useTheme())\r\n\r\n  const rows: JSX.Element[] = []\r\n  let node: CallTreeNode | null = props.node\r\n  for (; node && !node.isRoot(); node = node.parent) {\r\n    const row: (JSX.Element | string)[] = []\r\n    const {frame} = node\r\n\r\n    row.push(<ColorChit color={props.getFrameColor(frame)} />)\r\n\r\n    if (rows.length) {\r\n      row.push(<span className={css(style.stackFileLine)}>&gt; </span>)\r\n    }\r\n    row.push(frame.name)\r\n\r\n    if (frame.file) {\r\n      let pos = frame.file\r\n      if (frame.line != null) {\r\n        pos += `:${frame.line}`\r\n        if (frame.col != null) {\r\n          pos += `:${frame.col}`\r\n        }\r\n      }\r\n      row.push(<span className={css(style.stackFileLine)}> ({pos})</span>)\r\n    }\r\n    rows.push(<div className={css(style.stackLine)}>{row}</div>)\r\n  }\r\n  return (\r\n    <div className={css(style.stackTraceView)}>\r\n      <div className={css(style.stackTraceViewPadding)}>{rows}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\ninterface FlamechartDetailViewProps {\r\n  flamechart: Flamechart\r\n  getCSSColorForFrame: (frame: Frame) => string\r\n  selectedNode: CallTreeNode\r\n}\r\n\r\nexport function FlamechartDetailView(props: FlamechartDetailViewProps) {\r\n  const style = getFlamechartStyle(useTheme())\r\n\r\n  const {flamechart, selectedNode} = props\r\n  const {frame} = selectedNode\r\n\r\n  return (\r\n    <div className={css(style.detailView)}>\r\n      <StatisticsTable\r\n        title={'This Instance'}\r\n        cellStyle={style.thisInstanceCell}\r\n        grandTotal={flamechart.getTotalWeight()}\r\n        selectedTotal={selectedNode.getTotalWeight()}\r\n        selectedSelf={selectedNode.getSelfWeight()}\r\n        formatter={flamechart.formatValue.bind(flamechart)}\r\n      />\r\n      <StatisticsTable\r\n        title={'All Instances'}\r\n        cellStyle={style.allInstancesCell}\r\n        grandTotal={flamechart.getTotalWeight()}\r\n        selectedTotal={frame.getTotalWeight()}\r\n        selectedSelf={frame.getSelfWeight()}\r\n        formatter={flamechart.formatValue.bind(flamechart)}\r\n      />\r\n      <StackTraceView node={selectedNode} getFrameColor={props.getCSSColorForFrame} />\r\n    </div>\r\n  )\r\n}\r\n","// This file contains a collection of classes which make it easier to perform\r\n// batch rendering of Canvas2D primitives. The advantage of this over just doing\r\n// ctx.beginPath() ... ctx.rect(...) ... ctx.endPath() is that you can construct\r\n// several different batch renderers are the same time, then decide on their\r\n// paint order at the end.\r\n//\r\n// See FlamechartPanZoomView.renderOverlays for an example of how this is used.\r\n\r\nexport interface TextArgs {\r\n  text: string\r\n  x: number\r\n  y: number\r\n}\r\n\r\nexport class BatchCanvasTextRenderer {\r\n  private argsBatch: TextArgs[] = []\r\n\r\n  text(args: TextArgs) {\r\n    this.argsBatch.push(args)\r\n  }\r\n\r\n  fill(ctx: CanvasRenderingContext2D, color: string) {\r\n    if (this.argsBatch.length === 0) return\r\n    ctx.fillStyle = color\r\n    for (let args of this.argsBatch) {\r\n      ctx.fillText(args.text, args.x, args.y)\r\n    }\r\n    this.argsBatch = []\r\n  }\r\n}\r\n\r\nexport interface RectArgs {\r\n  x: number\r\n  y: number\r\n  w: number\r\n  h: number\r\n}\r\n\r\nexport class BatchCanvasRectRenderer {\r\n  private argsBatch: RectArgs[] = []\r\n\r\n  rect(args: RectArgs) {\r\n    this.argsBatch.push(args)\r\n  }\r\n\r\n  private drawPath(ctx: CanvasRenderingContext2D) {\r\n    ctx.beginPath()\r\n    for (let args of this.argsBatch) {\r\n      ctx.rect(args.x, args.y, args.w, args.h)\r\n    }\r\n    ctx.closePath()\r\n    this.argsBatch = []\r\n  }\r\n\r\n  fill(ctx: CanvasRenderingContext2D, color: string) {\r\n    if (this.argsBatch.length === 0) return\r\n    ctx.fillStyle = color\r\n    this.drawPath(ctx)\r\n    ctx.fill()\r\n  }\r\n\r\n  stroke(ctx: CanvasRenderingContext2D, color: string, lineWidth: number) {\r\n    if (this.argsBatch.length === 0) return\r\n    ctx.strokeStyle = color\r\n    ctx.lineWidth = lineWidth\r\n    this.drawPath(ctx)\r\n    ctx.stroke()\r\n  }\r\n}\r\n","/**\r\n * VS Code extension integration code\r\n */\r\n\r\nimport type { WebviewApi } from 'vscode-webview'\r\nimport { CallTreeNode } from './profile'\r\n\r\nexport const VSCODE_ENABLED = typeof acquireVsCodeApi !== 'undefined'\r\n\r\nlet vscode: WebviewApi<unknown>\r\nif (VSCODE_ENABLED) {\r\n  vscode = acquireVsCodeApi()\r\n}\r\n\r\nexport function sendJumpToMessage(node: CallTreeNode) {\r\n  const file = node.frame.file\r\n  if (!file) {\r\n    return\r\n  }\r\n  const line = node.frame.line ?? 0\r\n  const col = node.frame.col ?? 0\r\n\r\n  vscode.postMessage({\r\n    command: 'jumpTo',\r\n    file,\r\n    line,\r\n    col,\r\n  })\r\n}\r\n","import {Rect, AffineTransform, Vec2, clamp} from '../lib/math'\r\nimport {CallTreeNode} from '../lib/profile'\r\nimport {Flamechart, FlamechartFrame} from '../lib/flamechart'\r\nimport {CanvasContext} from '../gl/canvas-context'\r\nimport {FlamechartRenderer} from '../gl/flamechart-renderer'\r\nimport {Sizes, FontSize, FontFamily, commonStyle} from './style'\r\nimport {\r\n  cachedMeasureTextWidth,\r\n  ELLIPSIS,\r\n  trimTextMid,\r\n  remapRangesToTrimmedText,\r\n} from '../lib/text-utils'\r\nimport {getFlamechartStyle} from './flamechart-style'\r\nimport {h, Component} from 'preact'\r\nimport {css} from 'aphrodite'\r\nimport {ProfileSearchResults} from '../lib/profile-search'\r\nimport {BatchCanvasTextRenderer, BatchCanvasRectRenderer} from '../lib/canvas-2d-batch-renderers'\r\nimport {Color} from '../lib/color'\r\nimport {Theme} from './themes/theme'\r\nimport {VSCODE_ENABLED, sendJumpToMessage} from '../lib/vscode-extension'\r\n\r\ninterface FlamechartFrameLabel {\r\n  configSpaceBounds: Rect\r\n  node: CallTreeNode\r\n}\r\n\r\n/**\r\n * Component to visualize a Flamechart and interact with it via hovering,\r\n * zooming, and panning.\r\n *\r\n * There are 3 vector spaces involved:\r\n * - Configuration Space: In this space, the horizontal unit is ms, and the\r\n *   vertical unit is stack depth. Each stack frame is one unit high.\r\n * - Logical view space: Origin is top-left, with +y downwards. This represents\r\n *   the coordinate space of the view as specified in CSS: horizontal and vertical\r\n *   units are both \"logical\" pixels.\r\n * - Physical view space: Origin is top-left, with +y downwards. This represents\r\n *   the coordinate space of the view as specified in hardware pixels: horizontal\r\n *   and vertical units are both \"physical\" pixels.\r\n *\r\n * We use two canvases to draw the flamechart itself: one for the rectangles,\r\n * which we render via WebGL, and one for the labels, which we render via 2D\r\n * canvas primitives.\r\n */\r\nexport interface FlamechartPanZoomViewProps {\r\n  flamechart: Flamechart\r\n  canvasContext: CanvasContext\r\n  flamechartRenderer: FlamechartRenderer\r\n  renderInverted: boolean\r\n  selectedNode: CallTreeNode | null\r\n  theme: Theme\r\n\r\n  onNodeHover: (hover: {node: CallTreeNode; event: MouseEvent} | null) => void\r\n  onNodeSelect: (node: CallTreeNode | null) => void\r\n\r\n  configSpaceViewportRect: Rect\r\n  transformViewport: (transform: AffineTransform) => void\r\n  setConfigSpaceViewportRect: (rect: Rect) => void\r\n\r\n  logicalSpaceViewportSize: Vec2\r\n  setLogicalSpaceViewportSize: (size: Vec2) => void\r\n\r\n  searchResults: ProfileSearchResults | null\r\n}\r\n\r\nexport class FlamechartPanZoomView extends Component<FlamechartPanZoomViewProps, {}> {\r\n  private container: Element | null = null\r\n  private containerRef = (element: Element | null) => {\r\n    this.container = element || null\r\n  }\r\n\r\n  private overlayCanvas: HTMLCanvasElement | null = null\r\n  private overlayCtx: CanvasRenderingContext2D | null = null\r\n\r\n  private hoveredLabel: FlamechartFrameLabel | null = null\r\n\r\n  private getStyle() {\r\n    return getFlamechartStyle(this.props.theme)\r\n  }\r\n\r\n  private setConfigSpaceViewportRect(r: Rect) {\r\n    this.props.setConfigSpaceViewportRect(r)\r\n  }\r\n\r\n  private overlayCanvasRef = (element: Element | null) => {\r\n    if (element) {\r\n      this.overlayCanvas = element as HTMLCanvasElement\r\n      this.overlayCtx = this.overlayCanvas.getContext('2d')\r\n      this.renderCanvas()\r\n    } else {\r\n      this.overlayCanvas = null\r\n      this.overlayCtx = null\r\n    }\r\n  }\r\n\r\n  private configSpaceSize() {\r\n    return new Vec2(\r\n      this.props.flamechart.getTotalWeight(),\r\n      this.props.flamechart.getLayers().length,\r\n    )\r\n  }\r\n\r\n  private physicalViewSize() {\r\n    return new Vec2(\r\n      this.overlayCanvas ? this.overlayCanvas.width : 0,\r\n      this.overlayCanvas ? this.overlayCanvas.height : 0,\r\n    )\r\n  }\r\n\r\n  private physicalBounds(): Rect {\r\n    if (this.props.renderInverted) {\r\n      // If we're rendering inverted and the flamegraph won't fill the viewport,\r\n      // we want to stick the flamegraph to the bottom of the viewport, not the top.\r\n\r\n      const physicalViewportHeight = this.physicalViewSize().y\r\n      const physicalFlamegraphHeight =\r\n        (this.configSpaceSize().y + 1) *\r\n        this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT *\r\n        window.devicePixelRatio\r\n\r\n      if (physicalFlamegraphHeight < physicalViewportHeight) {\r\n        return new Rect(\r\n          new Vec2(0, physicalViewportHeight - physicalFlamegraphHeight),\r\n          this.physicalViewSize(),\r\n        )\r\n      }\r\n    }\r\n\r\n    return new Rect(new Vec2(0, 0), this.physicalViewSize())\r\n  }\r\n\r\n  private LOGICAL_VIEW_SPACE_FRAME_HEIGHT = Sizes.FRAME_HEIGHT\r\n\r\n  private configSpaceToPhysicalViewSpace() {\r\n    return AffineTransform.betweenRects(this.props.configSpaceViewportRect, this.physicalBounds())\r\n  }\r\n\r\n  private logicalToPhysicalViewSpace() {\r\n    return AffineTransform.withScale(new Vec2(window.devicePixelRatio, window.devicePixelRatio))\r\n  }\r\n\r\n  private resizeOverlayCanvasIfNeeded() {\r\n    if (!this.overlayCanvas) return\r\n    let {width, height} = this.overlayCanvas.getBoundingClientRect()\r\n    {\r\n      /*\r\n      We render text at a higher resolution then scale down to\r\n      ensure we're rendering at 1:1 device pixel ratio.\r\n      This ensures our text is rendered crisply.\r\n    */\r\n    }\r\n    width = Math.floor(width)\r\n    height = Math.floor(height)\r\n\r\n    // Still initializing: don't resize yet\r\n    if (width === 0 || height === 0) return\r\n\r\n    const scaledWidth = width * window.devicePixelRatio\r\n    const scaledHeight = height * window.devicePixelRatio\r\n\r\n    if (scaledWidth === this.overlayCanvas.width && scaledHeight === this.overlayCanvas.height)\r\n      return\r\n\r\n    this.overlayCanvas.width = scaledWidth\r\n    this.overlayCanvas.height = scaledHeight\r\n  }\r\n\r\n  private renderOverlays() {\r\n    const ctx = this.overlayCtx\r\n    if (!ctx) return\r\n    if (this.props.configSpaceViewportRect.isEmpty()) return\r\n\r\n    const configToPhysical = this.configSpaceToPhysicalViewSpace()\r\n\r\n    const physicalViewSpaceFontSize = FontSize.LABEL * window.devicePixelRatio\r\n    const physicalViewSpaceFrameHeight =\r\n      this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT * window.devicePixelRatio\r\n\r\n    const physicalViewSize = this.physicalViewSize()\r\n\r\n    ctx.clearRect(0, 0, physicalViewSize.x, physicalViewSize.y)\r\n\r\n    ctx.font = `${physicalViewSpaceFontSize}px/${physicalViewSpaceFrameHeight}px ${FontFamily.MONOSPACE}`\r\n    ctx.textBaseline = 'alphabetic'\r\n\r\n    const minWidthToRender = cachedMeasureTextWidth(ctx, 'M' + ELLIPSIS + 'M')\r\n    const minConfigSpaceWidthToRender = (\r\n      configToPhysical.inverseTransformVector(new Vec2(minWidthToRender, 0)) || new Vec2(0, 0)\r\n    ).x\r\n\r\n    const LABEL_PADDING_PX = 5 * window.devicePixelRatio\r\n\r\n    const labelBatch = new BatchCanvasTextRenderer()\r\n    const fadedLabelBatch = new BatchCanvasTextRenderer()\r\n    const matchedTextHighlightBatch = new BatchCanvasRectRenderer()\r\n    const directlySelectedOutlineBatch = new BatchCanvasRectRenderer()\r\n    const indirectlySelectedOutlineBatch = new BatchCanvasRectRenderer()\r\n    const matchedFrameBatch = new BatchCanvasRectRenderer()\r\n\r\n    const renderFrameLabelAndChildren = (frame: FlamechartFrame, depth = 0) => {\r\n      const width = frame.end - frame.start\r\n      const y = this.props.renderInverted ? this.configSpaceSize().y - 1 - depth : depth\r\n      const configSpaceBounds = new Rect(new Vec2(frame.start, y), new Vec2(width, 1))\r\n\r\n      if (width < minConfigSpaceWidthToRender) return\r\n      if (configSpaceBounds.left() > this.props.configSpaceViewportRect.right()) return\r\n      if (configSpaceBounds.right() < this.props.configSpaceViewportRect.left()) return\r\n\r\n      if (this.props.renderInverted) {\r\n        if (configSpaceBounds.bottom() < this.props.configSpaceViewportRect.top()) return\r\n      } else {\r\n        if (configSpaceBounds.top() > this.props.configSpaceViewportRect.bottom()) return\r\n      }\r\n\r\n      if (configSpaceBounds.hasIntersectionWith(this.props.configSpaceViewportRect)) {\r\n        let physicalLabelBounds = configToPhysical.transformRect(configSpaceBounds)\r\n\r\n        if (physicalLabelBounds.left() < 0) {\r\n          physicalLabelBounds = physicalLabelBounds\r\n            .withOrigin(physicalLabelBounds.origin.withX(0))\r\n            .withSize(\r\n              physicalLabelBounds.size.withX(\r\n                physicalLabelBounds.size.x + physicalLabelBounds.left(),\r\n              ),\r\n            )\r\n        }\r\n        if (physicalLabelBounds.right() > physicalViewSize.x) {\r\n          physicalLabelBounds = physicalLabelBounds.withSize(\r\n            physicalLabelBounds.size.withX(physicalViewSize.x - physicalLabelBounds.left()),\r\n          )\r\n        }\r\n\r\n        if (physicalLabelBounds.width() > minWidthToRender) {\r\n          const match = this.props.searchResults?.getMatchForFrame(frame.node.frame)\r\n\r\n          const trimmedText = trimTextMid(\r\n            ctx,\r\n            frame.node.frame.name,\r\n            physicalLabelBounds.width() - 2 * LABEL_PADDING_PX,\r\n          )\r\n\r\n          if (match) {\r\n            const rangesToHighlightInTrimmedText = remapRangesToTrimmedText(\r\n              trimmedText,\r\n              match\r\n            )\r\n\r\n            // Once we have the character ranges to highlight, we need to\r\n            // actually do the highlighting.\r\n            let lastEndIndex = 0\r\n            let left = physicalLabelBounds.left() + LABEL_PADDING_PX\r\n\r\n            const padding = (physicalViewSpaceFrameHeight - physicalViewSpaceFontSize) / 2 - 2\r\n            for (let [startIndex, endIndex] of rangesToHighlightInTrimmedText) {\r\n              left += cachedMeasureTextWidth(\r\n                ctx,\r\n                trimmedText.trimmedString.substring(lastEndIndex, startIndex),\r\n              )\r\n              const highlightWidth = cachedMeasureTextWidth(\r\n                ctx,\r\n                trimmedText.trimmedString.substring(startIndex, endIndex),\r\n              )\r\n              matchedTextHighlightBatch.rect({\r\n                x: left,\r\n                y: physicalLabelBounds.top() + padding,\r\n                w: highlightWidth,\r\n                h: physicalViewSpaceFrameHeight - 2 * padding,\r\n              })\r\n\r\n              left += highlightWidth\r\n              lastEndIndex = endIndex\r\n            }\r\n          }\r\n\r\n          const batch = this.props.searchResults != null && !match ? fadedLabelBatch : labelBatch\r\n          batch.text({\r\n            text: trimmedText.trimmedString,\r\n\r\n            // This is specifying the position of the starting text baseline.\r\n            x: physicalLabelBounds.left() + LABEL_PADDING_PX,\r\n            y: Math.round(\r\n              physicalLabelBounds.bottom() -\r\n                (physicalViewSpaceFrameHeight - physicalViewSpaceFontSize) / 2,\r\n            ),\r\n          })\r\n        }\r\n      }\r\n      for (let child of frame.children) {\r\n        renderFrameLabelAndChildren(child, depth + 1)\r\n      }\r\n    }\r\n\r\n    const frameOutlineWidth = 2 * window.devicePixelRatio\r\n    ctx.strokeStyle = this.props.theme.selectionSecondaryColor\r\n    const minConfigSpaceWidthToRenderOutline = (\r\n      configToPhysical.inverseTransformVector(new Vec2(1, 0)) || new Vec2(0, 0)\r\n    ).x\r\n\r\n    const renderSpecialFrameOutlines = (frame: FlamechartFrame, depth = 0) => {\r\n      if (!this.props.selectedNode && this.props.searchResults == null) return\r\n      const width = frame.end - frame.start\r\n      const y = this.props.renderInverted ? this.configSpaceSize().y - 1 - depth : depth\r\n      const configSpaceBounds = new Rect(new Vec2(frame.start, y), new Vec2(width, 1))\r\n\r\n      if (width < minConfigSpaceWidthToRenderOutline) return\r\n      if (configSpaceBounds.left() > this.props.configSpaceViewportRect.right()) return\r\n      if (configSpaceBounds.right() < this.props.configSpaceViewportRect.left()) return\r\n      if (configSpaceBounds.top() > this.props.configSpaceViewportRect.bottom()) return\r\n\r\n      if (configSpaceBounds.hasIntersectionWith(this.props.configSpaceViewportRect)) {\r\n        if (this.props.searchResults?.getMatchForFrame(frame.node.frame)) {\r\n          const physicalRectBounds = configToPhysical.transformRect(configSpaceBounds)\r\n          matchedFrameBatch.rect({\r\n            x: Math.round(physicalRectBounds.left() + frameOutlineWidth / 2),\r\n            y: Math.round(physicalRectBounds.top() + frameOutlineWidth / 2),\r\n            w: Math.round(Math.max(0, physicalRectBounds.width() - frameOutlineWidth)),\r\n            h: Math.round(Math.max(0, physicalRectBounds.height() - frameOutlineWidth)),\r\n          })\r\n        }\r\n\r\n        if (this.props.selectedNode != null && frame.node.frame === this.props.selectedNode.frame) {\r\n          let batch =\r\n            frame.node === this.props.selectedNode\r\n              ? directlySelectedOutlineBatch\r\n              : indirectlySelectedOutlineBatch\r\n\r\n          const physicalRectBounds = configToPhysical.transformRect(configSpaceBounds)\r\n          batch.rect({\r\n            x: Math.round(physicalRectBounds.left() + 1 + frameOutlineWidth / 2),\r\n            y: Math.round(physicalRectBounds.top() + 1 + frameOutlineWidth / 2),\r\n            w: Math.round(Math.max(0, physicalRectBounds.width() - 2 - frameOutlineWidth)),\r\n            h: Math.round(Math.max(0, physicalRectBounds.height() - 2 - frameOutlineWidth)),\r\n          })\r\n        }\r\n      }\r\n      for (let child of frame.children) {\r\n        renderSpecialFrameOutlines(child, depth + 1)\r\n      }\r\n    }\r\n\r\n    for (let frame of this.props.flamechart.getLayers()[0] || []) {\r\n      renderSpecialFrameOutlines(frame)\r\n    }\r\n\r\n    for (let frame of this.props.flamechart.getLayers()[0] || []) {\r\n      renderFrameLabelAndChildren(frame)\r\n    }\r\n\r\n    const theme = this.props.theme\r\n\r\n    matchedFrameBatch.fill(ctx, theme.searchMatchPrimaryColor)\r\n    matchedTextHighlightBatch.fill(ctx, theme.searchMatchSecondaryColor)\r\n    fadedLabelBatch.fill(ctx, theme.fgSecondaryColor)\r\n    labelBatch.fill(\r\n      ctx,\r\n      this.props.searchResults != null ? theme.searchMatchTextColor : theme.fgPrimaryColor,\r\n    )\r\n    indirectlySelectedOutlineBatch.stroke(ctx, theme.selectionSecondaryColor, frameOutlineWidth)\r\n    directlySelectedOutlineBatch.stroke(ctx, theme.selectionPrimaryColor, frameOutlineWidth)\r\n\r\n    if (this.hoveredLabel) {\r\n      let color: string = theme.fgPrimaryColor\r\n      if (this.props.selectedNode === this.hoveredLabel.node) {\r\n        color = theme.selectionPrimaryColor\r\n      }\r\n\r\n      ctx.lineWidth = 2 * devicePixelRatio\r\n      ctx.strokeStyle = color\r\n\r\n      const physicalViewBounds = configToPhysical.transformRect(this.hoveredLabel.configSpaceBounds)\r\n      ctx.strokeRect(\r\n        Math.round(physicalViewBounds.left()),\r\n        Math.round(physicalViewBounds.top()),\r\n        Math.round(Math.max(0, physicalViewBounds.width())),\r\n        Math.round(Math.max(0, physicalViewBounds.height())),\r\n      )\r\n    }\r\n\r\n    this.renderTimeIndicators()\r\n  }\r\n\r\n  private renderTimeIndicators() {\r\n    const ctx = this.overlayCtx\r\n    if (!ctx) return\r\n\r\n    const physicalViewSpaceFrameHeight =\r\n      this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT * window.devicePixelRatio\r\n    const physicalViewSize = this.physicalViewSize()\r\n    const configToPhysical = this.configSpaceToPhysicalViewSpace()\r\n    const physicalViewSpaceFontSize = FontSize.LABEL * window.devicePixelRatio\r\n    const labelPaddingPx = (physicalViewSpaceFrameHeight - physicalViewSpaceFontSize) / 2\r\n\r\n    const left = this.props.configSpaceViewportRect.left()\r\n    const right = this.props.configSpaceViewportRect.right()\r\n    // We want about 10 gridlines to be visible, and want the unit to be\r\n    // 1eN, 2eN, or 5eN for some N\r\n    // Ideally, we want an interval every 100 logical screen pixels\r\n    const logicalToConfig = (\r\n      this.configSpaceToPhysicalViewSpace().inverted() || new AffineTransform()\r\n    ).times(this.logicalToPhysicalViewSpace())\r\n    const targetInterval = logicalToConfig.transformVector(new Vec2(200, 1)).x\r\n    const minInterval = Math.pow(10, Math.floor(Math.log10(targetInterval)))\r\n    let interval = minInterval\r\n    if (targetInterval / interval > 5) {\r\n      interval *= 5\r\n    } else if (targetInterval / interval > 2) {\r\n      interval *= 2\r\n    }\r\n\r\n    const theme = this.props.theme\r\n\r\n    {\r\n      const y = this.props.renderInverted ? physicalViewSize.y - physicalViewSpaceFrameHeight : 0\r\n\r\n      ctx.fillStyle = Color.fromCSSHex(theme.bgPrimaryColor).withAlpha(0.8).toCSS()\r\n      ctx.fillRect(0, y, physicalViewSize.x, physicalViewSpaceFrameHeight)\r\n      ctx.textBaseline = 'top'\r\n      for (let x = Math.ceil(left / interval) * interval; x < right; x += interval) {\r\n        // TODO(jlfwong): Ensure that labels do not overlap\r\n        const pos = Math.round(configToPhysical.transformPosition(new Vec2(x, 0)).x)\r\n        const labelText = this.props.flamechart.formatValue(x)\r\n        const textWidth = cachedMeasureTextWidth(ctx, labelText)\r\n        ctx.fillStyle = theme.fgPrimaryColor\r\n        ctx.fillText(labelText, pos - textWidth - labelPaddingPx, y + labelPaddingPx)\r\n        ctx.fillStyle = theme.fgSecondaryColor\r\n        ctx.fillRect(pos, 0, 1, physicalViewSize.y)\r\n      }\r\n    }\r\n  }\r\n\r\n  private updateConfigSpaceViewport() {\r\n    if (!this.container) return\r\n    const {logicalSpaceViewportSize} = this.props\r\n    const bounds = this.container.getBoundingClientRect()\r\n    const {width, height} = bounds\r\n\r\n    // Still initializing: don't resize yet\r\n    if (width < 2 || height < 2) return\r\n\r\n    if (this.props.configSpaceViewportRect.isEmpty()) {\r\n      const configSpaceViewportHeight = height / this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT\r\n      if (this.props.renderInverted) {\r\n        this.setConfigSpaceViewportRect(\r\n          new Rect(\r\n            new Vec2(0, this.configSpaceSize().y - configSpaceViewportHeight + 1),\r\n            new Vec2(this.configSpaceSize().x, configSpaceViewportHeight),\r\n          ),\r\n        )\r\n      } else {\r\n        this.setConfigSpaceViewportRect(\r\n          new Rect(new Vec2(0, -1), new Vec2(this.configSpaceSize().x, configSpaceViewportHeight)),\r\n        )\r\n      }\r\n    } else if (\r\n      !logicalSpaceViewportSize.equals(Vec2.zero) &&\r\n      (logicalSpaceViewportSize.x !== width || logicalSpaceViewportSize.y !== height)\r\n    ) {\r\n      // Resize the viewport rectangle to match the window size aspect\r\n      // ratio.\r\n      this.setConfigSpaceViewportRect(\r\n        this.props.configSpaceViewportRect.withSize(\r\n          this.props.configSpaceViewportRect.size.timesPointwise(\r\n            new Vec2(width / logicalSpaceViewportSize.x, height / logicalSpaceViewportSize.y),\r\n          ),\r\n        ),\r\n      )\r\n    }\r\n\r\n    const newSize = new Vec2(width, height)\r\n    if (!newSize.equals(logicalSpaceViewportSize)) {\r\n      this.props.setLogicalSpaceViewportSize(newSize)\r\n    }\r\n  }\r\n\r\n  onWindowResize = () => {\r\n    this.updateConfigSpaceViewport()\r\n    this.onBeforeFrame()\r\n  }\r\n\r\n  private renderRects() {\r\n    if (!this.container) return\r\n    this.updateConfigSpaceViewport()\r\n\r\n    if (this.props.configSpaceViewportRect.isEmpty()) return\r\n\r\n    this.props.canvasContext.renderBehind(this.container, () => {\r\n      this.props.flamechartRenderer.render({\r\n        physicalSpaceDstRect: this.physicalBounds(),\r\n        configSpaceSrcRect: this.props.configSpaceViewportRect,\r\n        renderOutlines: true,\r\n      })\r\n    })\r\n  }\r\n\r\n  // Inertial scrolling introduces tricky interaction problems.\r\n  // Namely, if you start panning, and hit the edge of the scrollable\r\n  // area, the browser continues to receive WheelEvents from inertial\r\n  // scrolling. If we start zooming by holding Cmd + scrolling, then\r\n  // release the Cmd key, this can cause us to interpret the incoming\r\n  // inertial scrolling events as panning. To prevent this, we introduce\r\n  // a concept of an \"Interaction Lock\". Once a certain interaction has\r\n  // begun, we don't allow the other type of interaction to begin until\r\n  // we've received two frames with no inertial wheel events. This\r\n  // prevents us from accidentally switching between panning & zooming.\r\n  private frameHadWheelEvent = false\r\n  private framesWithoutWheelEvents = 0\r\n  private interactionLock: 'pan' | 'zoom' | null = null\r\n  private maybeClearInteractionLock = () => {\r\n    if (this.interactionLock) {\r\n      if (!this.frameHadWheelEvent) {\r\n        this.framesWithoutWheelEvents++\r\n        if (this.framesWithoutWheelEvents >= 2) {\r\n          this.interactionLock = null\r\n          this.framesWithoutWheelEvents = 0\r\n        }\r\n      }\r\n      this.props.canvasContext.requestFrame()\r\n    }\r\n    this.frameHadWheelEvent = false\r\n  }\r\n\r\n  private onBeforeFrame = () => {\r\n    this.resizeOverlayCanvasIfNeeded()\r\n    this.renderRects()\r\n    this.renderOverlays()\r\n    this.maybeClearInteractionLock()\r\n  }\r\n\r\n  private renderCanvas = () => {\r\n    this.props.canvasContext.requestFrame()\r\n  }\r\n\r\n  private pan(logicalViewSpaceDelta: Vec2) {\r\n    this.interactionLock = 'pan'\r\n\r\n    const physicalDelta = this.logicalToPhysicalViewSpace().transformVector(logicalViewSpaceDelta)\r\n    const configDelta = this.configSpaceToPhysicalViewSpace().inverseTransformVector(physicalDelta)\r\n\r\n    if (this.hoveredLabel) {\r\n      this.props.onNodeHover(null)\r\n    }\r\n\r\n    if (!configDelta) return\r\n    this.props.transformViewport(AffineTransform.withTranslation(configDelta))\r\n  }\r\n\r\n  private zoom(logicalViewSpaceCenter: Vec2, multiplier: number) {\r\n    this.interactionLock = 'zoom'\r\n\r\n    const physicalCenter = this.logicalToPhysicalViewSpace().transformPosition(\r\n      logicalViewSpaceCenter,\r\n    )\r\n    const configSpaceCenter = this.configSpaceToPhysicalViewSpace().inverseTransformPosition(\r\n      physicalCenter,\r\n    )\r\n    if (!configSpaceCenter) return\r\n\r\n    const zoomTransform = AffineTransform.withTranslation(configSpaceCenter.times(-1))\r\n      .scaledBy(new Vec2(multiplier, 1))\r\n      .translatedBy(configSpaceCenter)\r\n\r\n    this.props.transformViewport(zoomTransform)\r\n  }\r\n\r\n  private lastDragPos: Vec2 | null = null\r\n  private mouseDownPos: Vec2 | null = null\r\n  private onMouseDown = (ev: MouseEvent) => {\r\n    this.mouseDownPos = this.lastDragPos = new Vec2(ev.offsetX, ev.offsetY)\r\n    this.updateCursor()\r\n    window.addEventListener('mouseup', this.onWindowMouseUp)\r\n  }\r\n\r\n  private onMouseDrag = (ev: MouseEvent) => {\r\n    if (!this.lastDragPos) return\r\n    const logicalMousePos = new Vec2(ev.offsetX, ev.offsetY)\r\n    this.pan(this.lastDragPos.minus(logicalMousePos))\r\n    this.lastDragPos = logicalMousePos\r\n\r\n    // When panning by scrolling, the element under\r\n    // the cursor will change, so clear the hovered label.\r\n    if (this.hoveredLabel) {\r\n      this.props.onNodeHover(null)\r\n    }\r\n  }\r\n\r\n  private onDblClick = (ev: MouseEvent) => {\r\n    if (this.hoveredLabel) {\r\n      const hoveredBounds = this.hoveredLabel.configSpaceBounds\r\n      const viewportRect = new Rect(\r\n        hoveredBounds.origin.minus(new Vec2(0, 1)),\r\n        hoveredBounds.size.withY(this.props.configSpaceViewportRect.height()),\r\n      )\r\n      this.props.setConfigSpaceViewportRect(viewportRect)\r\n    }\r\n  }\r\n\r\n  private onClick = (ev: MouseEvent) => {\r\n    const logicalMousePos = new Vec2(ev.offsetX, ev.offsetY)\r\n    const mouseDownPos = this.mouseDownPos\r\n    this.mouseDownPos = null\r\n\r\n    if (mouseDownPos && logicalMousePos.minus(mouseDownPos).length() > 5) {\r\n      // If the cursor is more than 5 logical space pixels away from the mouse\r\n      // down location, then don't interpret this event as a click.\r\n      return\r\n    }\r\n\r\n    if (this.hoveredLabel) {\r\n      this.props.onNodeSelect(this.hoveredLabel.node)\r\n      this.renderCanvas()\r\n\r\n      if (VSCODE_ENABLED && ev.ctrlKey) {\r\n        sendJumpToMessage(this.hoveredLabel.node)\r\n      }\r\n    } else {\r\n      this.props.onNodeSelect(null)\r\n    }\r\n  }\r\n\r\n  private updateCursor() {\r\n    if (this.lastDragPos) {\r\n      document.body.style.cursor = 'grabbing'\r\n      document.body.style.cursor = '-webkit-grabbing'\r\n    } else {\r\n      document.body.style.cursor = 'default'\r\n    }\r\n  }\r\n\r\n  private onWindowMouseUp = (ev: MouseEvent) => {\r\n    this.lastDragPos = null\r\n    this.updateCursor()\r\n    window.removeEventListener('mouseup', this.onWindowMouseUp)\r\n  }\r\n\r\n  private onMouseMove = (ev: MouseEvent) => {\r\n    this.updateCursor()\r\n    if (this.lastDragPos) {\r\n      ev.preventDefault()\r\n      this.onMouseDrag(ev)\r\n      return\r\n    }\r\n    this.hoveredLabel = null\r\n    const logicalViewSpaceMouse = new Vec2(ev.offsetX, ev.offsetY)\r\n    const physicalViewSpaceMouse = this.logicalToPhysicalViewSpace().transformPosition(\r\n      logicalViewSpaceMouse,\r\n    )\r\n    const configSpaceMouse = this.configSpaceToPhysicalViewSpace().inverseTransformPosition(\r\n      physicalViewSpaceMouse,\r\n    )\r\n\r\n    if (!configSpaceMouse) return\r\n\r\n    const setHoveredLabel = (frame: FlamechartFrame, depth = 0) => {\r\n      const width = frame.end - frame.start\r\n      const y = this.props.renderInverted ? this.configSpaceSize().y - 1 - depth : depth\r\n      const configSpaceBounds = new Rect(new Vec2(frame.start, y), new Vec2(width, 1))\r\n      if (configSpaceMouse.x < configSpaceBounds.left()) return null\r\n      if (configSpaceMouse.x > configSpaceBounds.right()) return null\r\n\r\n      if (configSpaceBounds.contains(configSpaceMouse)) {\r\n        this.hoveredLabel = {\r\n          configSpaceBounds,\r\n          node: frame.node,\r\n        }\r\n      }\r\n\r\n      for (let child of frame.children) {\r\n        setHoveredLabel(child, depth + 1)\r\n      }\r\n    }\r\n\r\n    for (let frame of this.props.flamechart.getLayers()[0] || []) {\r\n      setHoveredLabel(frame)\r\n    }\r\n\r\n    if (this.hoveredLabel) {\r\n      this.props.onNodeHover({node: this.hoveredLabel!.node, event: ev})\r\n    } else {\r\n      this.props.onNodeHover(null)\r\n    }\r\n\r\n    this.renderCanvas()\r\n  }\r\n\r\n  private onMouseLeave = (ev: MouseEvent) => {\r\n    this.hoveredLabel = null\r\n    this.props.onNodeHover(null)\r\n    this.renderCanvas()\r\n  }\r\n\r\n  private onWheel = (ev: WheelEvent) => {\r\n    ev.preventDefault()\r\n    this.frameHadWheelEvent = true\r\n\r\n    const isZoom = ev.metaKey || ev.ctrlKey\r\n\r\n    let deltaY = ev.deltaY\r\n    let deltaX = ev.deltaX\r\n    if (ev.deltaMode === ev.DOM_DELTA_LINE) {\r\n      deltaY *= this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT\r\n      deltaX *= this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT\r\n    }\r\n\r\n    if (isZoom && this.interactionLock !== 'pan') {\r\n      let multiplier = 1 + deltaY / 100\r\n\r\n      // On Chrome & Firefox, pinch-to-zoom maps to\r\n      // WheelEvent + Ctrl Key. We'll accelerate it in\r\n      // this case, since it feels a bit sluggish otherwise.\r\n      if (ev.ctrlKey) {\r\n        multiplier = 1 + deltaY / 40\r\n      }\r\n\r\n      multiplier = clamp(multiplier, 0.1, 10.0)\r\n\r\n      this.zoom(new Vec2(ev.offsetX, ev.offsetY), multiplier)\r\n    } else if (this.interactionLock !== 'zoom') {\r\n      this.pan(new Vec2(deltaX, deltaY))\r\n    }\r\n\r\n    this.renderCanvas()\r\n  }\r\n\r\n  onWindowKeyPress = (ev: KeyboardEvent) => {\r\n    if (!this.container) return\r\n    const {width, height} = this.container.getBoundingClientRect()\r\n\r\n    if (ev.key === '=' || ev.key === '+') {\r\n      this.zoom(new Vec2(width / 2, height / 2), 0.5)\r\n      ev.preventDefault()\r\n    } else if (ev.key === '-' || ev.key === '_') {\r\n      this.zoom(new Vec2(width / 2, height / 2), 2)\r\n      ev.preventDefault()\r\n    }\r\n\r\n    if (ev.ctrlKey || ev.shiftKey || ev.metaKey) return\r\n\r\n    // NOTE: We intentionally use ev.code rather than ev.key for\r\n    // WASD in order to have the keys retain the same layout even\r\n    // if the keyboard layout is not QWERTY.\r\n    //\r\n    // See: https://github.com/jlfwong/speedscope/pull/184\r\n    if (ev.key === '0') {\r\n      this.zoom(new Vec2(width / 2, height / 2), 1e9)\r\n    } else if (ev.key === 'ArrowRight' || ev.code === 'KeyD') {\r\n      this.pan(new Vec2(100, 0))\r\n    } else if (ev.key === 'ArrowLeft' || ev.code === 'KeyA') {\r\n      this.pan(new Vec2(-100, 0))\r\n    } else if (ev.key === 'ArrowUp' || ev.code === 'KeyW') {\r\n      this.pan(new Vec2(0, -100))\r\n    } else if (ev.key === 'ArrowDown' || ev.code === 'KeyS') {\r\n      this.pan(new Vec2(0, 100))\r\n    } else if (ev.key === 'Escape') {\r\n      this.props.onNodeSelect(null)\r\n      this.renderCanvas()\r\n    }\r\n  }\r\n\r\n  shouldComponentUpdate() {\r\n    return false\r\n  }\r\n  componentWillReceiveProps(nextProps: FlamechartPanZoomViewProps) {\r\n    if (this.props.flamechart !== nextProps.flamechart) {\r\n      this.hoveredLabel = null\r\n      this.renderCanvas()\r\n    } else if (this.props.searchResults !== nextProps.searchResults) {\r\n      this.renderCanvas()\r\n    } else if (this.props.selectedNode !== nextProps.selectedNode) {\r\n      this.renderCanvas()\r\n    } else if (this.props.configSpaceViewportRect !== nextProps.configSpaceViewportRect) {\r\n      this.renderCanvas()\r\n    } else if (this.props.canvasContext !== nextProps.canvasContext) {\r\n      if (this.props.canvasContext) {\r\n        this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame)\r\n      }\r\n      if (nextProps.canvasContext) {\r\n        nextProps.canvasContext.addBeforeFrameHandler(this.onBeforeFrame)\r\n        nextProps.canvasContext.requestFrame()\r\n      }\r\n    }\r\n  }\r\n  componentDidMount() {\r\n    this.props.canvasContext.addBeforeFrameHandler(this.onBeforeFrame)\r\n    window.addEventListener('resize', this.onWindowResize)\r\n    window.addEventListener('keydown', this.onWindowKeyPress)\r\n  }\r\n  componentWillUnmount() {\r\n    this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame)\r\n    window.removeEventListener('resize', this.onWindowResize)\r\n    window.removeEventListener('keydown', this.onWindowKeyPress)\r\n  }\r\n\r\n  render() {\r\n    const style = this.getStyle()\r\n\r\n    return (\r\n      <div\r\n        className={css(style.panZoomView, commonStyle.vbox)}\r\n        onMouseDown={this.onMouseDown}\r\n        onMouseMove={this.onMouseMove}\r\n        onMouseLeave={this.onMouseLeave}\r\n        onClick={this.onClick}\r\n        onDblClick={this.onDblClick}\r\n        onWheel={this.onWheel}\r\n        ref={this.containerRef}\r\n      >\r\n        <canvas width={1} height={1} ref={this.overlayCanvasRef} className={css(style.fill)} />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import {Vec2} from '../lib/math'\r\nimport {Sizes, FontSize, FontFamily, ZIndex} from './style'\r\nimport {css, StyleSheet} from 'aphrodite'\r\nimport {ComponentChildren, h} from 'preact'\r\nimport {useTheme, withTheme} from './themes/theme'\r\nimport { useCallback } from 'preact/hooks'\r\n\r\ninterface HovertipProps {\r\n  containerSize: Vec2\r\n  offset: Vec2\r\n  children?: ComponentChildren\r\n}\r\n\r\nexport function Hovertip(props: HovertipProps) {\r\n  const style = getStyle(useTheme())\r\n\r\n  const {containerSize, offset} = props\r\n  const containerWidth = containerSize.x\r\n  const containerHeight = containerSize.y\r\n\r\n  const OFFSET_FROM_MOUSE = 7\r\n\r\n  const updateLocation = useCallback((el: HTMLDivElement | null) => {\r\n    if (!el) return\r\n\r\n    const clientRect = el.getBoundingClientRect()\r\n\r\n    // Place the hovertip to the right of the cursor.\r\n    let leftEdgeX = offset.x + OFFSET_FROM_MOUSE\r\n\r\n    // If this would cause it to overflow the container, align the right\r\n    // edge of the hovertip with the right edge of the container.\r\n    if (leftEdgeX + clientRect.width > containerWidth - 1) {\r\n      leftEdgeX = containerWidth - clientRect.width - 1\r\n\r\n      // If aligning the right edge overflows the container, align the left edge\r\n      // of the hovertip with the left edge of the container.\r\n      if (leftEdgeX < 1) { leftEdgeX = 1 }\r\n    }\r\n    el.style.left = `${leftEdgeX}px`\r\n\r\n    // Place the tooltip below the cursor\r\n    let topEdgeY = offset.y + OFFSET_FROM_MOUSE\r\n\r\n    // If this would cause it to overflow the container, place the hovertip\r\n    // above the cursor instead. This intentionally differs from the horizontal\r\n    // axis logic to avoid the cursor being in the middle of a hovertip when\r\n    // possible.\r\n    if (topEdgeY + clientRect.height > containerHeight - 1) {\r\n      topEdgeY = offset.y - clientRect.height - 1\r\n\r\n      // If placing the hovertip above the cursor overflows the container, align\r\n      // the top edge of the hovertip with the top edge of the container.\r\n      if (topEdgeY < 1) { topEdgeY = 1 }\r\n    }\r\n    el.style.top = `${topEdgeY}px`\r\n\r\n  }, [containerWidth, containerHeight, offset.x, offset.y])\r\n\r\n  return (\r\n    <div className={css(style.hoverTip)} ref={updateLocation}>\r\n      <div className={css(style.hoverTipRow)}>{props.children}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst HOVERTIP_PADDING = 2\r\n\r\nconst getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    hoverTip: {\r\n      position: 'absolute',\r\n      background: theme.bgPrimaryColor,\r\n      border: '1px solid black',\r\n      maxWidth: Sizes.TOOLTIP_WIDTH_MAX,\r\n      paddingTop: HOVERTIP_PADDING,\r\n      paddingBottom: HOVERTIP_PADDING,\r\n      pointerEvents: 'none',\r\n      userSelect: 'none',\r\n      fontSize: FontSize.LABEL,\r\n      fontFamily: FontFamily.MONOSPACE,\r\n      zIndex: ZIndex.HOVERTIP,\r\n    },\r\n    hoverTipRow: {\r\n      textOverflow: 'ellipsis',\r\n      whiteSpace: 'nowrap',\r\n      overflowX: 'hidden',\r\n      paddingLeft: HOVERTIP_PADDING,\r\n      paddingRight: HOVERTIP_PADDING,\r\n      maxWidth: Sizes.TOOLTIP_WIDTH_MAX,\r\n    },\r\n  }),\r\n)\r\n","import {memo} from 'preact/compat'\r\nimport {useContext, useMemo, useCallback} from 'preact/hooks'\r\nimport {SearchView, ProfileSearchContext} from './search-view'\r\nimport {\r\n  FlamechartSearchMatch,\r\n  FlamechartSearchResults,\r\n  ProfileSearchResults,\r\n} from '../lib/profile-search'\r\nimport {Rect, Vec2} from '../lib/math'\r\nimport {h, createContext, ComponentChildren} from 'preact'\r\nimport {Flamechart} from '../lib/flamechart'\r\nimport {CallTreeNode} from '../lib/profile'\r\n\r\nexport const FlamechartSearchContext = createContext<FlamechartSearchData | null>(null)\r\n\r\nexport interface FlamechartSearchProps {\r\n  flamechart: Flamechart\r\n  selectedNode: CallTreeNode | null\r\n  setSelectedNode: (node: CallTreeNode | null) => void\r\n  configSpaceViewportRect: Rect\r\n  setConfigSpaceViewportRect: (rect: Rect) => void\r\n  children: ComponentChildren\r\n}\r\n\r\ninterface FlamechartSearchData {\r\n  results: FlamechartSearchResults | null\r\n  flamechart: Flamechart\r\n  selectedNode: CallTreeNode | null\r\n  setSelectedNode: (node: CallTreeNode | null) => void\r\n  configSpaceViewportRect: Rect\r\n  setConfigSpaceViewportRect: (rect: Rect) => void\r\n}\r\n\r\nexport const FlamechartSearchContextProvider = ({\r\n  flamechart,\r\n  selectedNode,\r\n  setSelectedNode,\r\n  configSpaceViewportRect,\r\n  setConfigSpaceViewportRect,\r\n  children,\r\n}: FlamechartSearchProps) => {\r\n  const profileSearchResults: ProfileSearchResults | null = useContext(ProfileSearchContext)\r\n  const flamechartSearchResults: FlamechartSearchResults | null = useMemo(() => {\r\n    if (profileSearchResults == null) {\r\n      return null\r\n    }\r\n    return new FlamechartSearchResults(flamechart, profileSearchResults)\r\n  }, [flamechart, profileSearchResults])\r\n\r\n  return (\r\n    <FlamechartSearchContext.Provider\r\n      value={{\r\n        results: flamechartSearchResults,\r\n        flamechart,\r\n        selectedNode,\r\n        setSelectedNode,\r\n        configSpaceViewportRect,\r\n        setConfigSpaceViewportRect,\r\n      }}\r\n    >\r\n      {children}\r\n    </FlamechartSearchContext.Provider>\r\n  )\r\n}\r\n\r\nexport const FlamechartSearchView = memo(() => {\r\n  const flamechartData = useContext(FlamechartSearchContext)\r\n\r\n  // TODO(jlfwong): This pattern is pretty gross, but I really don't want values\r\n  // that can be undefined or null.\r\n  const searchResults = flamechartData == null ? null : flamechartData.results\r\n  const selectedNode = flamechartData == null ? null : flamechartData.selectedNode\r\n  const setSelectedNode = flamechartData == null ? null : flamechartData.setSelectedNode\r\n  const configSpaceViewportRect =\r\n    flamechartData == null ? null : flamechartData.configSpaceViewportRect\r\n  const setConfigSpaceViewportRect =\r\n    flamechartData == null ? null : flamechartData.setConfigSpaceViewportRect\r\n  const flamechart = flamechartData == null ? null : flamechartData.flamechart\r\n\r\n  const numResults = searchResults == null ? null : searchResults.count()\r\n  const resultIndex: number | null = useMemo(() => {\r\n    if (searchResults == null) return null\r\n    if (selectedNode == null) return null\r\n    return searchResults.indexOf(selectedNode)\r\n  }, [searchResults, selectedNode])\r\n\r\n  const selectAndZoomToMatch = useCallback(\r\n    (match: FlamechartSearchMatch) => {\r\n      if (!setSelectedNode) return\r\n      if (!flamechart) return\r\n      if (!configSpaceViewportRect) return\r\n      if (!setConfigSpaceViewportRect) return\r\n\r\n      // After the node is selected, we want to set the viewport so that the new\r\n      // node can be seen clearly.\r\n      //\r\n      // TODO(jlfwong): The lack of animation here can be kind of jarring. It\r\n      // would be nice to have some easier way for people to orient themselves\r\n      // after the viewport shifted.\r\n      const configSpaceResultBounds = match.configSpaceBounds\r\n\r\n      const viewportRect = new Rect(\r\n        configSpaceResultBounds.origin.minus(new Vec2(0, 1)),\r\n        configSpaceResultBounds.size.withY(configSpaceViewportRect.height()),\r\n      )\r\n\r\n      setSelectedNode(match.node)\r\n      setConfigSpaceViewportRect(\r\n        flamechart.getClampedConfigSpaceViewportRect({configSpaceViewportRect: viewportRect}),\r\n      )\r\n    },\r\n    [configSpaceViewportRect, setConfigSpaceViewportRect, setSelectedNode, flamechart],\r\n  )\r\n\r\n  const {selectPrev, selectNext} = useMemo(() => {\r\n    if (numResults == null || numResults === 0 || searchResults == null) {\r\n      return {selectPrev: () => {}, selectNext: () => {}}\r\n    }\r\n\r\n    return {\r\n      selectPrev: () => {\r\n        if (!searchResults?.at) return\r\n        if (numResults == null || numResults === 0) return\r\n\r\n        let index = resultIndex == null ? numResults - 1 : resultIndex - 1\r\n        if (index < 0) index = numResults - 1\r\n        const result = searchResults.at(index)\r\n        selectAndZoomToMatch(result)\r\n      },\r\n\r\n      selectNext: () => {\r\n        if (!searchResults?.at) return\r\n        if (numResults == null || numResults === 0) return\r\n\r\n        let index = resultIndex == null ? 0 : resultIndex + 1\r\n        if (index >= numResults) index = 0\r\n        const result = searchResults.at(index)\r\n        selectAndZoomToMatch(result)\r\n      },\r\n    }\r\n  }, [numResults, resultIndex, searchResults, selectAndZoomToMatch])\r\n\r\n  return (\r\n    <SearchView\r\n      resultIndex={resultIndex}\r\n      numResults={numResults}\r\n      selectPrev={selectPrev}\r\n      selectNext={selectNext}\r\n    />\r\n  )\r\n})\r\n","import {Component} from 'preact'\r\n\r\nexport type VoidState = {\r\n  __dummyField: void\r\n}\r\nexport abstract class StatelessComponent<P> extends Component<P, VoidState> {}\r\n","import {h, Fragment} from 'preact'\r\nimport {css} from 'aphrodite'\r\n\r\nimport {CallTreeNode} from '../lib/profile'\r\n\r\nimport {Rect, Vec2, AffineTransform} from '../lib/math'\r\nimport {formatPercent} from '../lib/utils'\r\nimport {FlamechartMinimapView} from './flamechart-minimap-view'\r\n\r\nimport {Sizes, commonStyle} from './style'\r\nimport {FlamechartDetailView} from './flamechart-detail-view'\r\nimport {FlamechartPanZoomView} from './flamechart-pan-zoom-view'\r\nimport {Hovertip} from './hovertip'\r\nimport {FlamechartViewProps} from './flamechart-view-container'\r\nimport {ProfileSearchContext} from './search-view'\r\nimport {FlamechartSearchView} from './flamechart-search-view'\r\nimport {getFlamechartStyle} from './flamechart-style'\r\nimport {StatelessComponent} from '../lib/preact-helpers'\r\n\r\nexport class FlamechartView extends StatelessComponent<FlamechartViewProps> {\r\n  private getStyle() {\r\n    return getFlamechartStyle(this.props.theme)\r\n  }\r\n\r\n  private configSpaceSize() {\r\n    return new Vec2(\r\n      this.props.flamechart.getTotalWeight(),\r\n      this.props.flamechart.getLayers().length,\r\n    )\r\n  }\r\n\r\n  private setConfigSpaceViewportRect = (viewportRect: Rect): void => {\r\n    const configSpaceDetailViewHeight = Sizes.DETAIL_VIEW_HEIGHT / Sizes.FRAME_HEIGHT\r\n\r\n    const configSpaceSize = this.configSpaceSize()\r\n\r\n    const width = this.props.flamechart.getClampedViewportWidth(viewportRect.size.x)\r\n    const size = viewportRect.size.withX(width)\r\n\r\n    const origin = Vec2.clamp(\r\n      viewportRect.origin,\r\n      new Vec2(0, -1),\r\n      Vec2.max(\r\n        Vec2.zero,\r\n        configSpaceSize.minus(size).plus(new Vec2(0, configSpaceDetailViewHeight + 1)),\r\n      ),\r\n    )\r\n\r\n    this.props.setConfigSpaceViewportRect(new Rect(origin, viewportRect.size.withX(width)))\r\n  }\r\n\r\n  private setLogicalSpaceViewportSize = (logicalSpaceViewportSize: Vec2): void => {\r\n    this.props.setLogicalSpaceViewportSize(logicalSpaceViewportSize)\r\n  }\r\n\r\n  private transformViewport = (transform: AffineTransform): void => {\r\n    const viewportRect = transform.transformRect(this.props.configSpaceViewportRect)\r\n    this.setConfigSpaceViewportRect(viewportRect)\r\n  }\r\n\r\n  private onNodeHover = (hover: {node: CallTreeNode; event: MouseEvent} | null) => {\r\n    this.props.setNodeHover(hover)\r\n  }\r\n\r\n  onNodeClick = (node: CallTreeNode | null) => {\r\n    this.props.setSelectedNode(node)\r\n  }\r\n\r\n  formatValue(weight: number) {\r\n    const totalWeight = this.props.flamechart.getTotalWeight()\r\n    const percent = (100 * weight) / totalWeight\r\n    const formattedPercent = formatPercent(percent)\r\n    return `${this.props.flamechart.formatValue(weight)} (${formattedPercent})`\r\n  }\r\n\r\n  renderTooltip() {\r\n    if (!this.container) return null\r\n\r\n    const {hover} = this.props\r\n    if (!hover) return null\r\n    const {width, height, left, top} = this.container.getBoundingClientRect()\r\n    const offset = new Vec2(hover.event.clientX - left, hover.event.clientY - top)\r\n    const frame = hover.node.frame\r\n\r\n    const style = this.getStyle()\r\n\r\n    return (\r\n      <Hovertip containerSize={new Vec2(width, height)} offset={offset}>\r\n        <span className={css(style.hoverCount)}>\r\n          {this.formatValue(hover.node.getTotalWeight())}\r\n        </span>{' '}\r\n        {frame.name}\r\n        {frame.file ? (\r\n          <div>\r\n            {frame.file}:{frame.line}\r\n          </div>\r\n        ) : undefined}\r\n      </Hovertip>\r\n    )\r\n  }\r\n\r\n  container: HTMLDivElement | null = null\r\n  containerRef = (container: Element | null) => {\r\n    this.container = (container as HTMLDivElement) || null\r\n  }\r\n\r\n  render() {\r\n    const style = this.getStyle()\r\n\r\n    return (\r\n      <div className={css(style.fill, commonStyle.vbox)} ref={this.containerRef}>\r\n        <FlamechartMinimapView\r\n          theme={this.props.theme}\r\n          configSpaceViewportRect={this.props.configSpaceViewportRect}\r\n          transformViewport={this.transformViewport}\r\n          flamechart={this.props.flamechart}\r\n          flamechartRenderer={this.props.flamechartRenderer}\r\n          canvasContext={this.props.canvasContext}\r\n          setConfigSpaceViewportRect={this.setConfigSpaceViewportRect}\r\n        />\r\n        <ProfileSearchContext.Consumer>\r\n          {searchResults => (\r\n            <Fragment>\r\n              <FlamechartPanZoomView\r\n                theme={this.props.theme}\r\n                canvasContext={this.props.canvasContext}\r\n                flamechart={this.props.flamechart}\r\n                flamechartRenderer={this.props.flamechartRenderer}\r\n                renderInverted={false}\r\n                onNodeHover={this.onNodeHover}\r\n                onNodeSelect={this.onNodeClick}\r\n                selectedNode={this.props.selectedNode}\r\n                transformViewport={this.transformViewport}\r\n                configSpaceViewportRect={this.props.configSpaceViewportRect}\r\n                setConfigSpaceViewportRect={this.setConfigSpaceViewportRect}\r\n                logicalSpaceViewportSize={this.props.logicalSpaceViewportSize}\r\n                setLogicalSpaceViewportSize={this.setLogicalSpaceViewportSize}\r\n                searchResults={searchResults}\r\n              />\r\n              <FlamechartSearchView />\r\n            </Fragment>\r\n          )}\r\n        </ProfileSearchContext.Consumer>\r\n        {this.renderTooltip()}\r\n        {this.props.selectedNode && (\r\n          <FlamechartDetailView\r\n            flamechart={this.props.flamechart}\r\n            getCSSColorForFrame={this.props.getCSSColorForFrame}\r\n            selectedNode={this.props.selectedNode}\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import {h} from 'preact'\r\nimport {CanvasContext} from '../gl/canvas-context'\r\nimport {Flamechart} from '../lib/flamechart'\r\nimport {FlamechartRenderer, FlamechartRendererOptions} from '../gl/flamechart-renderer'\r\nimport {Frame, Profile, CallTreeNode} from '../lib/profile'\r\nimport {memoizeByShallowEquality} from '../lib/utils'\r\nimport {FlamechartView} from './flamechart-view'\r\nimport {\r\n  getRowAtlas,\r\n  createGetColorBucketForFrame,\r\n  getCanvasContext,\r\n  createGetCSSColorForFrame,\r\n  getFrameToColorBucket,\r\n} from '../app-state/getters'\r\nimport {Vec2, Rect} from '../lib/math'\r\nimport {memo, useCallback} from 'preact/compat'\r\nimport {ActiveProfileState} from '../app-state/active-profile-state'\r\nimport {FlamechartSearchContextProvider} from './flamechart-search-view'\r\nimport {Theme, useTheme} from './themes/theme'\r\nimport {FlamechartID, FlamechartViewState} from '../app-state/profile-group'\r\nimport {profileGroupAtom} from '../app-state'\r\n\r\ninterface FlamechartSetters {\r\n  setLogicalSpaceViewportSize: (logicalSpaceViewportSize: Vec2) => void\r\n  setConfigSpaceViewportRect: (configSpaceViewportRect: Rect) => void\r\n  setNodeHover: (hover: {node: CallTreeNode; event: MouseEvent} | null) => void\r\n  setSelectedNode: (node: CallTreeNode | null) => void\r\n}\r\n\r\nexport function useFlamechartSetters(id: FlamechartID): FlamechartSetters {\r\n  return {\r\n    setNodeHover: useCallback(\r\n      (hover: {node: CallTreeNode; event: MouseEvent} | null) => {\r\n        profileGroupAtom.setFlamechartHoveredNode(id, hover)\r\n      },\r\n      [id],\r\n    ),\r\n    setLogicalSpaceViewportSize: useCallback(\r\n      (logicalSpaceViewportSize: Vec2) => {\r\n        profileGroupAtom.setLogicalSpaceViewportSize(id, logicalSpaceViewportSize)\r\n      },\r\n      [id],\r\n    ),\r\n    setConfigSpaceViewportRect: useCallback(\r\n      (configSpaceViewportRect: Rect) => {\r\n        profileGroupAtom.setConfigSpaceViewportRect(id, configSpaceViewportRect)\r\n      },\r\n      [id],\r\n    ),\r\n    setSelectedNode: useCallback(\r\n      (selectedNode: CallTreeNode | null) => {\r\n        profileGroupAtom.setSelectedNode(id, selectedNode)\r\n      },\r\n      [id],\r\n    ),\r\n  }\r\n}\r\n\r\nexport type FlamechartViewProps = {\r\n  theme: Theme\r\n  canvasContext: CanvasContext\r\n  flamechart: Flamechart\r\n  flamechartRenderer: FlamechartRenderer\r\n  renderInverted: boolean\r\n  getCSSColorForFrame: (frame: Frame) => string\r\n} & FlamechartSetters &\r\n  FlamechartViewState\r\n\r\nexport const getChronoViewFlamechart = memoizeByShallowEquality(\r\n  ({\r\n    profile,\r\n    getColorBucketForFrame,\r\n  }: {\r\n    profile: Profile\r\n    getColorBucketForFrame: (frame: Frame) => number\r\n  }): Flamechart => {\r\n    return new Flamechart({\r\n      getTotalWeight: profile.getTotalWeight.bind(profile),\r\n      forEachCall: profile.forEachCall.bind(profile),\r\n      formatValue: profile.formatValue.bind(profile),\r\n      getColorBucketForFrame,\r\n    })\r\n  },\r\n)\r\n\r\nexport const createMemoizedFlamechartRenderer = (options?: FlamechartRendererOptions) =>\r\n  memoizeByShallowEquality(\r\n    ({\r\n      canvasContext,\r\n      flamechart,\r\n    }: {\r\n      canvasContext: CanvasContext\r\n      flamechart: Flamechart\r\n    }): FlamechartRenderer => {\r\n      return new FlamechartRenderer(\r\n        canvasContext.gl,\r\n        getRowAtlas(canvasContext),\r\n        flamechart,\r\n        canvasContext.rectangleBatchRenderer,\r\n        canvasContext.flamechartColorPassRenderer,\r\n        options,\r\n      )\r\n    },\r\n  )\r\n\r\nconst getChronoViewFlamechartRenderer = createMemoizedFlamechartRenderer()\r\n\r\nexport interface FlamechartViewContainerProps {\r\n  activeProfileState: ActiveProfileState\r\n  glCanvas: HTMLCanvasElement\r\n}\r\n\r\nexport const ChronoFlamechartView = memo((props: FlamechartViewContainerProps) => {\r\n  const {activeProfileState, glCanvas} = props\r\n  const {profile, chronoViewState} = activeProfileState\r\n\r\n  const theme = useTheme()\r\n\r\n  const canvasContext = getCanvasContext({theme, canvas: glCanvas})\r\n  const frameToColorBucket = getFrameToColorBucket(profile)\r\n  const getColorBucketForFrame = createGetColorBucketForFrame(frameToColorBucket)\r\n  const getCSSColorForFrame = createGetCSSColorForFrame({theme, frameToColorBucket})\r\n\r\n  const flamechart = getChronoViewFlamechart({profile, getColorBucketForFrame})\r\n  const flamechartRenderer = getChronoViewFlamechartRenderer({\r\n    canvasContext,\r\n    flamechart,\r\n  })\r\n\r\n  const setters = useFlamechartSetters(FlamechartID.CHRONO)\r\n\r\n  return (\r\n    <FlamechartSearchContextProvider\r\n      flamechart={flamechart}\r\n      selectedNode={chronoViewState.selectedNode}\r\n      setSelectedNode={setters.setSelectedNode}\r\n      configSpaceViewportRect={chronoViewState.configSpaceViewportRect}\r\n      setConfigSpaceViewportRect={setters.setConfigSpaceViewportRect}\r\n    >\r\n      <FlamechartView\r\n        theme={theme}\r\n        renderInverted={false}\r\n        flamechart={flamechart}\r\n        flamechartRenderer={flamechartRenderer}\r\n        canvasContext={canvasContext}\r\n        getCSSColorForFrame={getCSSColorForFrame}\r\n        {...chronoViewState}\r\n        {...setters}\r\n      />\r\n    </FlamechartSearchContextProvider>\r\n  )\r\n})\r\n\r\nexport const getLeftHeavyFlamechart = memoizeByShallowEquality(\r\n  ({\r\n    profile,\r\n    getColorBucketForFrame,\r\n  }: {\r\n    profile: Profile\r\n    getColorBucketForFrame: (frame: Frame) => number\r\n  }): Flamechart => {\r\n    return new Flamechart({\r\n      getTotalWeight: profile.getTotalNonIdleWeight.bind(profile),\r\n      forEachCall: profile.forEachCallGrouped.bind(profile),\r\n      formatValue: profile.formatValue.bind(profile),\r\n      getColorBucketForFrame,\r\n    })\r\n  },\r\n)\r\n\r\nconst getLeftHeavyFlamechartRenderer = createMemoizedFlamechartRenderer()\r\n\r\nexport const LeftHeavyFlamechartView = memo((ownProps: FlamechartViewContainerProps) => {\r\n  const {activeProfileState, glCanvas} = ownProps\r\n\r\n  const {profile, leftHeavyViewState} = activeProfileState\r\n\r\n  const theme = useTheme()\r\n\r\n  const canvasContext = getCanvasContext({theme, canvas: glCanvas})\r\n  const frameToColorBucket = getFrameToColorBucket(profile)\r\n  const getColorBucketForFrame = createGetColorBucketForFrame(frameToColorBucket)\r\n  const getCSSColorForFrame = createGetCSSColorForFrame({theme, frameToColorBucket})\r\n\r\n  const flamechart = getLeftHeavyFlamechart({\r\n    profile,\r\n    getColorBucketForFrame,\r\n  })\r\n  const flamechartRenderer = getLeftHeavyFlamechartRenderer({\r\n    canvasContext,\r\n    flamechart,\r\n  })\r\n\r\n  const setters = useFlamechartSetters(FlamechartID.LEFT_HEAVY)\r\n\r\n  return (\r\n    <FlamechartSearchContextProvider\r\n      flamechart={flamechart}\r\n      selectedNode={leftHeavyViewState.selectedNode}\r\n      setSelectedNode={setters.setSelectedNode}\r\n      configSpaceViewportRect={leftHeavyViewState.configSpaceViewportRect}\r\n      setConfigSpaceViewportRect={setters.setConfigSpaceViewportRect}\r\n    >\r\n      <FlamechartView\r\n        theme={theme}\r\n        renderInverted={false}\r\n        flamechart={flamechart}\r\n        flamechartRenderer={flamechartRenderer}\r\n        canvasContext={canvasContext}\r\n        getCSSColorForFrame={getCSSColorForFrame}\r\n        {...leftHeavyViewState}\r\n        {...setters}\r\n      />\r\n    </FlamechartSearchContextProvider>\r\n  )\r\n})\r\n","import {CallTreeNode} from '../lib/profile'\r\nimport {StyleSheet, css} from 'aphrodite'\r\nimport {h} from 'preact'\r\nimport {commonStyle} from './style'\r\nimport {Rect, AffineTransform, Vec2} from '../lib/math'\r\nimport {FlamechartPanZoomView} from './flamechart-pan-zoom-view'\r\nimport {noop, formatPercent} from '../lib/utils'\r\nimport {Hovertip} from './hovertip'\r\nimport {FlamechartViewProps} from './flamechart-view-container'\r\nimport {withTheme} from './themes/theme'\r\nimport {StatelessComponent} from '../lib/preact-helpers'\r\n\r\nexport class FlamechartWrapper extends StatelessComponent<FlamechartViewProps> {\r\n  private clampViewportToFlamegraph(viewportRect: Rect) {\r\n    const {flamechart, renderInverted} = this.props\r\n    return flamechart.getClampedConfigSpaceViewportRect({\r\n      configSpaceViewportRect: viewportRect,\r\n      renderInverted,\r\n    })\r\n  }\r\n  private setConfigSpaceViewportRect = (configSpaceViewportRect: Rect) => {\r\n    this.props.setConfigSpaceViewportRect(this.clampViewportToFlamegraph(configSpaceViewportRect))\r\n  }\r\n  private setLogicalSpaceViewportSize = (logicalSpaceViewportSize: Vec2): void => {\r\n    this.props.setLogicalSpaceViewportSize(logicalSpaceViewportSize)\r\n  }\r\n\r\n  private transformViewport = (transform: AffineTransform) => {\r\n    this.setConfigSpaceViewportRect(transform.transformRect(this.props.configSpaceViewportRect))\r\n  }\r\n  private formatValue(weight: number) {\r\n    const totalWeight = this.props.flamechart.getTotalWeight()\r\n    const percent = (100 * weight) / totalWeight\r\n    const formattedPercent = formatPercent(percent)\r\n    return `${this.props.flamechart.formatValue(weight)} (${formattedPercent})`\r\n  }\r\n  private renderTooltip() {\r\n    if (!this.container) return null\r\n    const {hover} = this.props\r\n    if (!hover) return null\r\n    const {width, height, left, top} = this.container.getBoundingClientRect()\r\n    const offset = new Vec2(hover.event.clientX - left, hover.event.clientY - top)\r\n    const style = getStyle(this.props.theme)\r\n    const frame = hover.node.frame\r\n\r\n    return (\r\n      <Hovertip containerSize={new Vec2(width, height)} offset={offset}>\r\n        <span className={css(style.hoverCount)}>\r\n          {this.formatValue(hover.node.getTotalWeight())}\r\n        </span>{' '}\r\n        {frame.name}\r\n        {frame.file ? (\r\n          <div>\r\n            {frame.file}:{frame.line}\r\n          </div>\r\n        ) : undefined}\r\n      </Hovertip>\r\n    )\r\n  }\r\n  container: HTMLDivElement | null = null\r\n  containerRef = (container: Element | null) => {\r\n    this.container = (container as HTMLDivElement) || null\r\n  }\r\n  private setNodeHover = (\r\n    hover: {\r\n      node: CallTreeNode\r\n      event: MouseEvent\r\n    } | null,\r\n  ) => {\r\n    this.props.setNodeHover(hover)\r\n  }\r\n  render() {\r\n    return (\r\n      <div\r\n        className={css(commonStyle.fillY, commonStyle.fillX, commonStyle.vbox)}\r\n        ref={this.containerRef}\r\n      >\r\n        <FlamechartPanZoomView\r\n          theme={this.props.theme}\r\n          selectedNode={null}\r\n          onNodeHover={this.setNodeHover}\r\n          onNodeSelect={noop}\r\n          configSpaceViewportRect={this.props.configSpaceViewportRect}\r\n          setConfigSpaceViewportRect={this.setConfigSpaceViewportRect}\r\n          transformViewport={this.transformViewport}\r\n          flamechart={this.props.flamechart}\r\n          flamechartRenderer={this.props.flamechartRenderer}\r\n          canvasContext={this.props.canvasContext}\r\n          renderInverted={this.props.renderInverted}\r\n          logicalSpaceViewportSize={this.props.logicalSpaceViewportSize}\r\n          setLogicalSpaceViewportSize={this.setLogicalSpaceViewportSize}\r\n          searchResults={null}\r\n        />\r\n        {this.renderTooltip()}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport const getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    hoverCount: {\r\n      color: theme.weightColor,\r\n    },\r\n  }),\r\n)\r\n","import {memoizeByShallowEquality, noop} from '../lib/utils'\r\nimport {Profile, Frame} from '../lib/profile'\r\nimport {Flamechart} from '../lib/flamechart'\r\nimport {\r\n  createMemoizedFlamechartRenderer,\r\n  FlamechartViewContainerProps,\r\n  useFlamechartSetters,\r\n} from './flamechart-view-container'\r\nimport {\r\n  getCanvasContext,\r\n  createGetColorBucketForFrame,\r\n  createGetCSSColorForFrame,\r\n  getFrameToColorBucket,\r\n} from '../app-state/getters'\r\nimport {FlamechartWrapper} from './flamechart-wrapper'\r\nimport {h} from 'preact'\r\nimport {memo} from 'preact/compat'\r\nimport {useTheme} from './themes/theme'\r\nimport {FlamechartID} from '../app-state/profile-group'\r\nimport {flattenRecursionAtom, glCanvasAtom} from '../app-state'\r\nimport {useAtom} from '../lib/atom'\r\n\r\nconst getInvertedCallerProfile = memoizeByShallowEquality(\r\n  ({\r\n    profile,\r\n    frame,\r\n    flattenRecursion,\r\n  }: {\r\n    profile: Profile\r\n    frame: Frame\r\n    flattenRecursion: boolean\r\n  }): Profile => {\r\n    let p = profile.getInvertedProfileForCallersOf(frame)\r\n    return flattenRecursion ? p.getProfileWithRecursionFlattened() : p\r\n  },\r\n)\r\n\r\nconst getInvertedCallerFlamegraph = memoizeByShallowEquality(\r\n  ({\r\n    invertedCallerProfile,\r\n    getColorBucketForFrame,\r\n  }: {\r\n    invertedCallerProfile: Profile\r\n    getColorBucketForFrame: (frame: Frame) => number\r\n  }): Flamechart => {\r\n    return new Flamechart({\r\n      getTotalWeight: invertedCallerProfile.getTotalNonIdleWeight.bind(invertedCallerProfile),\r\n      forEachCall: invertedCallerProfile.forEachCallGrouped.bind(invertedCallerProfile),\r\n      formatValue: invertedCallerProfile.formatValue.bind(invertedCallerProfile),\r\n      getColorBucketForFrame,\r\n    })\r\n  },\r\n)\r\n\r\nconst getInvertedCallerFlamegraphRenderer = createMemoizedFlamechartRenderer({inverted: true})\r\n\r\nexport const InvertedCallerFlamegraphView = memo((ownProps: FlamechartViewContainerProps) => {\r\n  const {activeProfileState} = ownProps\r\n  let {profile, sandwichViewState} = activeProfileState\r\n  const flattenRecursion = useAtom(flattenRecursionAtom)\r\n  const glCanvas = useAtom(glCanvasAtom)\r\n  const theme = useTheme()\r\n\r\n  if (!profile) throw new Error('profile missing')\r\n  if (!glCanvas) throw new Error('glCanvas missing')\r\n  const {callerCallee} = sandwichViewState\r\n  if (!callerCallee) throw new Error('callerCallee missing')\r\n  const {selectedFrame} = callerCallee\r\n\r\n  const frameToColorBucket = getFrameToColorBucket(profile)\r\n  const getColorBucketForFrame = createGetColorBucketForFrame(frameToColorBucket)\r\n  const getCSSColorForFrame = createGetCSSColorForFrame({theme, frameToColorBucket})\r\n  const canvasContext = getCanvasContext({theme, canvas: glCanvas})\r\n\r\n  const flamechart = getInvertedCallerFlamegraph({\r\n    invertedCallerProfile: getInvertedCallerProfile({\r\n      profile,\r\n      frame: selectedFrame,\r\n      flattenRecursion,\r\n    }),\r\n    getColorBucketForFrame,\r\n  })\r\n  const flamechartRenderer = getInvertedCallerFlamegraphRenderer({canvasContext, flamechart})\r\n\r\n  return (\r\n    <FlamechartWrapper\r\n      theme={theme}\r\n      renderInverted={true}\r\n      flamechart={flamechart}\r\n      flamechartRenderer={flamechartRenderer}\r\n      canvasContext={canvasContext}\r\n      getCSSColorForFrame={getCSSColorForFrame}\r\n      {...useFlamechartSetters(FlamechartID.SANDWICH_INVERTED_CALLERS)}\r\n      {...callerCallee.invertedCallerFlamegraph}\r\n      // This overrides the setSelectedNode specified in useFlamechartSettesr\r\n      setSelectedNode={noop}\r\n    />\r\n  )\r\n})\r\n","import {memoizeByShallowEquality, noop} from '../lib/utils'\r\nimport {Profile, Frame} from '../lib/profile'\r\nimport {Flamechart} from '../lib/flamechart'\r\nimport {\r\n  createMemoizedFlamechartRenderer,\r\n  FlamechartViewContainerProps,\r\n  useFlamechartSetters,\r\n} from './flamechart-view-container'\r\nimport {\r\n  getCanvasContext,\r\n  createGetColorBucketForFrame,\r\n  createGetCSSColorForFrame,\r\n  getFrameToColorBucket,\r\n} from '../app-state/getters'\r\nimport {FlamechartWrapper} from './flamechart-wrapper'\r\nimport {h} from 'preact'\r\nimport {memo} from 'preact/compat'\r\nimport {useTheme} from './themes/theme'\r\nimport {FlamechartID} from '../app-state/profile-group'\r\nimport {flattenRecursionAtom, glCanvasAtom} from '../app-state'\r\nimport {useAtom} from '../lib/atom'\r\n\r\nconst getCalleeProfile = memoizeByShallowEquality<\r\n  {\r\n    profile: Profile\r\n    frame: Frame\r\n    flattenRecursion: boolean\r\n  },\r\n  Profile\r\n>(({profile, frame, flattenRecursion}) => {\r\n  let p = profile.getProfileForCalleesOf(frame)\r\n  return flattenRecursion ? p.getProfileWithRecursionFlattened() : p\r\n})\r\n\r\nconst getCalleeFlamegraph = memoizeByShallowEquality<\r\n  {\r\n    calleeProfile: Profile\r\n    getColorBucketForFrame: (frame: Frame) => number\r\n  },\r\n  Flamechart\r\n>(({calleeProfile, getColorBucketForFrame}) => {\r\n  return new Flamechart({\r\n    getTotalWeight: calleeProfile.getTotalNonIdleWeight.bind(calleeProfile),\r\n    forEachCall: calleeProfile.forEachCallGrouped.bind(calleeProfile),\r\n    formatValue: calleeProfile.formatValue.bind(calleeProfile),\r\n    getColorBucketForFrame,\r\n  })\r\n})\r\n\r\nconst getCalleeFlamegraphRenderer = createMemoizedFlamechartRenderer()\r\n\r\nexport const CalleeFlamegraphView = memo((ownProps: FlamechartViewContainerProps) => {\r\n  const {activeProfileState} = ownProps\r\n  const {profile, sandwichViewState} = activeProfileState\r\n  const flattenRecursion = useAtom(flattenRecursionAtom)\r\n  const glCanvas = useAtom(glCanvasAtom)\r\n  const theme = useTheme()\r\n\r\n  if (!profile) throw new Error('profile missing')\r\n  if (!glCanvas) throw new Error('glCanvas missing')\r\n  const {callerCallee} = sandwichViewState\r\n  if (!callerCallee) throw new Error('callerCallee missing')\r\n  const {selectedFrame} = callerCallee\r\n\r\n  const frameToColorBucket = getFrameToColorBucket(profile)\r\n  const getColorBucketForFrame = createGetColorBucketForFrame(frameToColorBucket)\r\n  const getCSSColorForFrame = createGetCSSColorForFrame({theme, frameToColorBucket})\r\n  const canvasContext = getCanvasContext({theme, canvas: glCanvas})\r\n\r\n  const flamechart = getCalleeFlamegraph({\r\n    calleeProfile: getCalleeProfile({profile, frame: selectedFrame, flattenRecursion}),\r\n    getColorBucketForFrame,\r\n  })\r\n  const flamechartRenderer = getCalleeFlamegraphRenderer({canvasContext, flamechart})\r\n\r\n  return (\r\n    <FlamechartWrapper\r\n      theme={theme}\r\n      renderInverted={false}\r\n      flamechart={flamechart}\r\n      flamechartRenderer={flamechartRenderer}\r\n      canvasContext={canvasContext}\r\n      getCSSColorForFrame={getCSSColorForFrame}\r\n      {...useFlamechartSetters(FlamechartID.SANDWICH_CALLEES)}\r\n      {...callerCallee.calleeFlamegraph}\r\n      // This overrides the setSelectedNode specified in useFlamechartSettesr\r\n      setSelectedNode={noop}\r\n    />\r\n  )\r\n})\r\n","import {memo} from 'preact/compat'\r\nimport {useContext, useMemo} from 'preact/hooks'\r\nimport {SearchView} from './search-view'\r\nimport {h} from 'preact'\r\nimport {SandwichViewContext} from './sandwich-view'\r\n\r\nexport const SandwichSearchView = memo(() => {\r\n  const sandwichViewContext = useContext(SandwichViewContext)\r\n\r\n  const rowList = sandwichViewContext != null ? sandwichViewContext.rowList : null\r\n  const resultIndex =\r\n    sandwichViewContext?.selectedFrame != null\r\n      ? sandwichViewContext.getIndexForFrame(sandwichViewContext.selectedFrame)\r\n      : null\r\n  const numResults = rowList != null ? rowList.length : null\r\n\r\n  const {selectPrev, selectNext} = useMemo(() => {\r\n    if (rowList == null || numResults == null || numResults === 0 || sandwichViewContext == null) {\r\n      return {selectPrev: () => {}, selectNext: () => {}}\r\n    }\r\n\r\n    return {\r\n      selectPrev: () => {\r\n        let index = resultIndex == null ? numResults - 1 : resultIndex - 1\r\n        if (index < 0) index = numResults - 1\r\n        sandwichViewContext.setSelectedFrame(rowList[index])\r\n      },\r\n      selectNext: () => {\r\n        let index = resultIndex == null ? 0 : resultIndex + 1\r\n        if (index >= numResults) index = 0\r\n        sandwichViewContext.setSelectedFrame(rowList[index])\r\n      },\r\n    }\r\n  }, [resultIndex, rowList, numResults, sandwichViewContext])\r\n\r\n  return (\r\n    <SearchView\r\n      resultIndex={resultIndex}\r\n      numResults={numResults}\r\n      selectPrev={selectPrev}\r\n      selectNext={selectNext}\r\n    />\r\n  )\r\n})\r\n","import {Frame} from '../lib/profile'\r\nimport {StyleSheet, css} from 'aphrodite'\r\nimport {ProfileTableViewContainer} from './profile-table-view'\r\nimport {h, JSX, createContext} from 'preact'\r\nimport {memo} from 'preact/compat'\r\nimport {useCallback, useMemo, useContext} from 'preact/hooks'\r\nimport {commonStyle, Sizes, FontSize} from './style'\r\nimport {InvertedCallerFlamegraphView} from './inverted-caller-flamegraph-view'\r\nimport {CalleeFlamegraphView} from './callee-flamegraph-view'\r\nimport {SandwichSearchView} from './sandwich-search-view'\r\nimport {ActiveProfileState} from '../app-state/active-profile-state'\r\nimport {sortBy} from '../lib/utils'\r\nimport {ProfileSearchContext} from './search-view'\r\nimport {Theme, useTheme, withTheme} from './themes/theme'\r\nimport {SortField, SortDirection, profileGroupAtom, tableSortMethodAtom} from '../app-state'\r\nimport {useAtom} from '../lib/atom'\r\nimport {StatelessComponent} from '../lib/preact-helpers'\r\n\r\ninterface SandwichViewProps {\r\n  selectedFrame: Frame | null\r\n  profileIndex: number\r\n  theme: Theme\r\n  activeProfileState: ActiveProfileState\r\n  setSelectedFrame: (selectedFrame: Frame | null) => void\r\n  glCanvas: HTMLCanvasElement\r\n}\r\n\r\nclass SandwichView extends StatelessComponent<SandwichViewProps> {\r\n  private setSelectedFrame = (selectedFrame: Frame | null) => {\r\n    this.props.setSelectedFrame(selectedFrame)\r\n  }\r\n\r\n  onWindowKeyPress = (ev: KeyboardEvent) => {\r\n    if (ev.key === 'Escape') {\r\n      this.setSelectedFrame(null)\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('keydown', this.onWindowKeyPress)\r\n  }\r\n  componentWillUnmount() {\r\n    window.removeEventListener('keydown', this.onWindowKeyPress)\r\n  }\r\n\r\n  render() {\r\n    const style = getStyle(this.props.theme)\r\n\r\n    const {selectedFrame} = this.props\r\n    let flamegraphViews: JSX.Element | null = null\r\n\r\n    if (selectedFrame) {\r\n      flamegraphViews = (\r\n        <div className={css(commonStyle.fillY, style.callersAndCallees, commonStyle.vbox)}>\r\n          <div className={css(commonStyle.hbox, style.panZoomViewWraper)}>\r\n            <div className={css(style.flamechartLabelParent)}>\r\n              <div className={css(style.flamechartLabel)}>Callers</div>\r\n            </div>\r\n            <InvertedCallerFlamegraphView\r\n              glCanvas={this.props.glCanvas}\r\n              activeProfileState={this.props.activeProfileState}\r\n            />\r\n          </div>\r\n          <div className={css(style.divider)} />\r\n          <div className={css(commonStyle.hbox, style.panZoomViewWraper)}>\r\n            <div className={css(style.flamechartLabelParent, style.flamechartLabelParentBottom)}>\r\n              <div className={css(style.flamechartLabel, style.flamechartLabelBottom)}>Callees</div>\r\n            </div>\r\n            <CalleeFlamegraphView\r\n              glCanvas={this.props.glCanvas}\r\n              activeProfileState={this.props.activeProfileState}\r\n            />\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className={css(commonStyle.hbox, commonStyle.fillY)}>\r\n        <div className={css(style.tableView)}>\r\n          <ProfileTableViewContainer activeProfileState={this.props.activeProfileState} />\r\n          <SandwichSearchView />\r\n        </div>\r\n        {flamegraphViews}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    tableView: {\r\n      position: 'relative',\r\n      flex: 1,\r\n    },\r\n    panZoomViewWraper: {\r\n      flex: 1,\r\n    },\r\n    flamechartLabelParent: {\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      justifyContent: 'flex-end',\r\n      alignItems: 'flex-start',\r\n      fontSize: FontSize.TITLE,\r\n      width: FontSize.TITLE * 1.2,\r\n      borderRight: `1px solid ${theme.fgSecondaryColor}`,\r\n    },\r\n    flamechartLabelParentBottom: {\r\n      justifyContent: 'flex-start',\r\n    },\r\n    flamechartLabel: {\r\n      transform: 'rotate(-90deg)',\r\n      transformOrigin: '50% 50% 0',\r\n      width: FontSize.TITLE * 1.2,\r\n      flexShrink: 1,\r\n    },\r\n    flamechartLabelBottom: {\r\n      transform: 'rotate(-90deg)',\r\n      display: 'flex',\r\n      justifyContent: 'flex-end',\r\n    },\r\n    callersAndCallees: {\r\n      flex: 1,\r\n      borderLeft: `${Sizes.SEPARATOR_HEIGHT}px solid ${theme.fgSecondaryColor}`,\r\n    },\r\n    divider: {\r\n      height: 2,\r\n      background: theme.fgSecondaryColor,\r\n    },\r\n  }),\r\n)\r\n\r\ninterface SandwichViewContainerProps {\r\n  activeProfileState: ActiveProfileState\r\n  glCanvas: HTMLCanvasElement\r\n}\r\n\r\ninterface SandwichViewContextData {\r\n  rowList: Frame[]\r\n  selectedFrame: Frame | null\r\n  setSelectedFrame: (frame: Frame | null) => void\r\n  getIndexForFrame: (frame: Frame) => number | null\r\n  getSearchMatchForFrame: (frame: Frame) => [number, number][] | null\r\n}\r\n\r\nexport const SandwichViewContext = createContext<SandwichViewContextData | null>(null)\r\n\r\nexport const SandwichViewContainer = memo((ownProps: SandwichViewContainerProps) => {\r\n  const {activeProfileState, glCanvas} = ownProps\r\n  const {sandwichViewState, index} = activeProfileState\r\n  const {callerCallee} = sandwichViewState\r\n\r\n  const theme = useTheme()\r\n  const setSelectedFrame = useCallback((selectedFrame: Frame | null) => {\r\n    profileGroupAtom.setSelectedFrame(selectedFrame)\r\n  }, [])\r\n\r\n  const profile = activeProfileState.profile\r\n  const tableSortMethod = useAtom(tableSortMethodAtom)\r\n  const profileSearchResults = useContext(ProfileSearchContext)\r\n\r\n  const selectedFrame = callerCallee ? callerCallee.selectedFrame : null\r\n\r\n  const rowList: Frame[] = useMemo(() => {\r\n    const rowList: Frame[] = []\r\n\r\n    profile.forEachFrame(frame => {\r\n      if (profileSearchResults && !profileSearchResults.getMatchForFrame(frame)) {\r\n        return\r\n      }\r\n      rowList.push(frame)\r\n    })\r\n\r\n    switch (tableSortMethod.field) {\r\n      case SortField.SYMBOL_NAME: {\r\n        sortBy(rowList, f => f.name.toLowerCase())\r\n        break\r\n      }\r\n      case SortField.SELF: {\r\n        sortBy(rowList, f => f.getSelfWeight())\r\n        break\r\n      }\r\n      case SortField.TOTAL: {\r\n        sortBy(rowList, f => f.getTotalWeight())\r\n        break\r\n      }\r\n    }\r\n    if (tableSortMethod.direction === SortDirection.DESCENDING) {\r\n      rowList.reverse()\r\n    }\r\n\r\n    return rowList\r\n  }, [profile, profileSearchResults, tableSortMethod])\r\n\r\n  const getIndexForFrame: (frame: Frame) => number | null = useMemo(() => {\r\n    const indexByFrame = new Map<Frame, number>()\r\n    for (let i = 0; i < rowList.length; i++) {\r\n      indexByFrame.set(rowList[i], i)\r\n    }\r\n    return (frame: Frame) => {\r\n      const index = indexByFrame.get(frame)\r\n      return index == null ? null : index\r\n    }\r\n  }, [rowList])\r\n\r\n  const getSearchMatchForFrame: (frame: Frame) => [number, number][] | null = useMemo(() => {\r\n    return (frame: Frame) => {\r\n      if (profileSearchResults == null) return null\r\n      return profileSearchResults.getMatchForFrame(frame)\r\n    }\r\n  }, [profileSearchResults])\r\n\r\n  const contextData: SandwichViewContextData = {\r\n    rowList,\r\n    selectedFrame,\r\n    setSelectedFrame,\r\n    getIndexForFrame,\r\n    getSearchMatchForFrame,\r\n  }\r\n\r\n  return (\r\n    <SandwichViewContext.Provider value={contextData}>\r\n      <SandwichView\r\n        theme={theme}\r\n        activeProfileState={activeProfileState}\r\n        glCanvas={glCanvas}\r\n        setSelectedFrame={setSelectedFrame}\r\n        selectedFrame={selectedFrame}\r\n        profileIndex={index}\r\n      />\r\n    </SandwichViewContext.Provider>\r\n  )\r\n})\r\n","import {FileFormat} from './file-format-spec'\r\nimport {zeroPad} from './utils'\r\n\r\nexport interface ValueFormatter {\r\n  unit: FileFormat.ValueUnit\r\n  format(v: number): string\r\n}\r\n\r\nexport class RawValueFormatter implements ValueFormatter {\r\n  unit: FileFormat.ValueUnit = 'none'\r\n  format(v: number) {\r\n    return v.toLocaleString()\r\n  }\r\n}\r\n\r\nexport class TimeFormatter implements ValueFormatter {\r\n  private multiplier: number\r\n\r\n  constructor(public unit: 'nanoseconds' | 'microseconds' | 'milliseconds' | 'seconds') {\r\n    if (unit === 'nanoseconds') this.multiplier = 1e-9\r\n    else if (unit === 'microseconds') this.multiplier = 1e-6\r\n    else if (unit === 'milliseconds') this.multiplier = 1e-3\r\n    else this.multiplier = 1\r\n  }\r\n\r\n  formatUnsigned(v: number) {\r\n    const s = v * this.multiplier\r\n\r\n    if (s / 60 >= 1) {\r\n      const minutes = Math.floor(s / 60)\r\n      const seconds = Math.floor(s - minutes * 60).toString()\r\n      return `${minutes}:${zeroPad(seconds, 2)}`\r\n    }\r\n    if (s / 1 >= 1) return `${s.toFixed(2)}s`\r\n    if (s / 1e-3 >= 1) return `${(s / 1e-3).toFixed(2)}ms`\r\n    if (s / 1e-6 >= 1) return `${(s / 1e-6).toFixed(2)}s`\r\n    else return `${(s / 1e-9).toFixed(2)}ns`\r\n  }\r\n\r\n  format(v: number) {\r\n    return `${v < 0 ? '-' : ''}${this.formatUnsigned(Math.abs(v))}`\r\n  }\r\n}\r\n\r\nexport class ByteFormatter implements ValueFormatter {\r\n  unit: FileFormat.ValueUnit = 'bytes'\r\n\r\n  format(v: number) {\r\n    if (v < 1024) return `${v.toFixed(0)} B`\r\n    v /= 1024\r\n    if (v < 1024) return `${v.toFixed(2)} KB`\r\n    v /= 1024\r\n    if (v < 1024) return `${v.toFixed(2)} MB`\r\n    v /= 1024\r\n    return `${v.toFixed(2)} GB`\r\n  }\r\n}\r\n","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var getBundleURL = require('./bundle-url').getBundleURL;\n\nfunction loadBundlesLazy(bundles) {\n  if (!Array.isArray(bundles)) {\n    bundles = [bundles]\n  }\n\n  var id = bundles[bundles.length - 1];\n\n  try {\n    return Promise.resolve(require(id));\n  } catch (err) {\n    if (err.code === 'MODULE_NOT_FOUND') {\n      return new LazyPromise(function (resolve, reject) {\n        loadBundles(bundles.slice(0, -1))\n          .then(function () {\n            return require(id);\n          })\n          .then(resolve, reject);\n      });\n    }\n\n    throw err;\n  }\n}\n\nfunction loadBundles(bundles) {\n  return Promise.all(bundles.map(loadBundle));\n}\n\nvar bundleLoaders = {};\nfunction registerBundleLoader(type, loader) {\n  bundleLoaders[type] = loader;\n}\n\nmodule.exports = exports = loadBundlesLazy;\nexports.load = loadBundles;\nexports.register = registerBundleLoader;\n\nvar bundles = {};\nfunction loadBundle(bundle) {\n  var id;\n  if (Array.isArray(bundle)) {\n    id = bundle[1];\n    bundle = bundle[0];\n  }\n\n  if (bundles[bundle]) {\n    return bundles[bundle];\n  }\n\n  var type = (bundle.substring(bundle.lastIndexOf('.') + 1, bundle.length) || bundle).toLowerCase();\n  var bundleLoader = bundleLoaders[type];\n  if (bundleLoader) {\n    return bundles[bundle] = bundleLoader(getBundleURL() + bundle)\n      .then(function (resolved) {\n        if (resolved) {\n          module.bundle.register(id, resolved);\n        }\n\n        return resolved;\n      }).catch(function(e) {\n        delete bundles[bundle];\n        \n        throw e;\n      });\n  }\n}\n\nfunction LazyPromise(executor) {\n  this.executor = executor;\n  this.promise = null;\n}\n\nLazyPromise.prototype.then = function (onSuccess, onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.then(onSuccess, onError)\n};\n\nLazyPromise.prototype.catch = function (onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.catch(onError)\n};\n","import {lastOf, KeyedSet} from './utils'\r\nimport {ValueFormatter, RawValueFormatter} from './value-formatters'\r\nimport {FileFormat} from './file-format-spec'\r\nconst demangleCppModule = import('./demangle-cpp')\r\n\r\nexport interface FrameInfo {\r\n  key: string | number\r\n\r\n  // Name of the frame. May be a method name, e.g.\r\n  // \"ActiveRecord##to_hash\"\r\n  name: string\r\n\r\n  // File path of the code corresponding to this\r\n  // call stack frame.\r\n  file?: string\r\n\r\n  // Line in the given file where this frame occurs, 1-based.\r\n  line?: number\r\n\r\n  // Column in the file, 1-based.\r\n  col?: number\r\n}\r\n\r\nexport type SymbolRemapper = (\r\n  frame: Frame,\r\n) => {name?: string; file?: string; line?: number; col?: number} | null\r\n\r\nexport class HasWeights {\r\n  private selfWeight = 0\r\n  private totalWeight = 0\r\n  getSelfWeight() {\r\n    return this.selfWeight\r\n  }\r\n  getTotalWeight() {\r\n    return this.totalWeight\r\n  }\r\n  addToTotalWeight(delta: number) {\r\n    this.totalWeight += delta\r\n  }\r\n  addToSelfWeight(delta: number) {\r\n    this.selfWeight += delta\r\n  }\r\n\r\n  overwriteWeightWith(other: HasWeights) {\r\n    this.selfWeight = other.selfWeight\r\n    this.totalWeight = other.totalWeight\r\n  }\r\n}\r\n\r\nexport class Frame extends HasWeights {\r\n  key: string | number\r\n\r\n  // Name of the frame. May be a method name, e.g.\r\n  // \"ActiveRecord##to_hash\"\r\n  name: string\r\n\r\n  // File path of the code corresponding to this\r\n  // call stack frame.\r\n  file?: string\r\n\r\n  // Line in the given file where this frame occurs\r\n  line?: number\r\n\r\n  // Column in the file\r\n  col?: number\r\n\r\n  private constructor(info: FrameInfo) {\r\n    super()\r\n    this.key = info.key\r\n    this.name = info.name\r\n    this.file = info.file\r\n    this.line = info.line\r\n    this.col = info.col\r\n  }\r\n\r\n  static root = new Frame({\r\n    key: '(speedscope root)',\r\n    name: '(speedscope root)',\r\n  })\r\n\r\n  static getOrInsert(set: KeyedSet<Frame>, info: FrameInfo) {\r\n    return set.getOrInsert(new Frame(info))\r\n  }\r\n}\r\n\r\nexport class CallTreeNode extends HasWeights {\r\n  children: CallTreeNode[] = []\r\n\r\n  isRoot() {\r\n    return this.frame === Frame.root\r\n  }\r\n\r\n  // If a node is \"frozen\", it means it should no longer be mutated.\r\n  private frozen = false\r\n  isFrozen() {\r\n    return this.frozen\r\n  }\r\n  freeze() {\r\n    this.frozen = true\r\n  }\r\n\r\n  constructor(readonly frame: Frame, readonly parent: CallTreeNode | null) {\r\n    super()\r\n  }\r\n}\r\n\r\nexport interface ProfileGroup {\r\n  name: string\r\n  indexToView: number\r\n  profiles: Profile[]\r\n}\r\n\r\nexport class Profile {\r\n  protected name: string = ''\r\n\r\n  protected totalWeight: number\r\n\r\n  protected frames = new KeyedSet<Frame>()\r\n\r\n  // Profiles store two call-trees.\r\n  //\r\n  // The \"append order\" call tree is the one in which nodes are ordered in\r\n  // whatever order they were appended to their parent.\r\n  //\r\n  // The \"grouped\" call tree is one in which each node has at most one child per\r\n  // frame. Nodes are ordered in decreasing order of weight\r\n  protected appendOrderCalltreeRoot = new CallTreeNode(Frame.root, null)\r\n  protected groupedCalltreeRoot = new CallTreeNode(Frame.root, null)\r\n\r\n  public getAppendOrderCalltreeRoot() {\r\n    return this.appendOrderCalltreeRoot\r\n  }\r\n  public getGroupedCalltreeRoot() {\r\n    return this.groupedCalltreeRoot\r\n  }\r\n\r\n  // List of references to CallTreeNodes at the top of the\r\n  // stack at the time of the sample.\r\n  protected samples: CallTreeNode[] = []\r\n  protected weights: number[] = []\r\n\r\n  protected valueFormatter: ValueFormatter = new RawValueFormatter()\r\n\r\n  constructor(totalWeight: number = 0) {\r\n    this.totalWeight = totalWeight\r\n  }\r\n\r\n  shallowClone(): Profile {\r\n    const profile = new Profile(this.totalWeight)\r\n    Object.assign(profile, this)\r\n    return profile\r\n  }\r\n\r\n  formatValue(v: number) {\r\n    return this.valueFormatter.format(v)\r\n  }\r\n  setValueFormatter(f: ValueFormatter) {\r\n    this.valueFormatter = f\r\n  }\r\n  getWeightUnit(): FileFormat.ValueUnit {\r\n    return this.valueFormatter.unit\r\n  }\r\n\r\n  getName() {\r\n    return this.name\r\n  }\r\n  setName(name: string) {\r\n    this.name = name\r\n  }\r\n\r\n  getTotalWeight() {\r\n    return this.totalWeight\r\n  }\r\n\r\n  private totalNonIdleWeight: number | null = null\r\n  getTotalNonIdleWeight() {\r\n    if (this.totalNonIdleWeight === null) {\r\n      this.totalNonIdleWeight = this.groupedCalltreeRoot.children.reduce(\r\n        (n, c) => n + c.getTotalWeight(),\r\n        0,\r\n      )\r\n    }\r\n    return this.totalNonIdleWeight\r\n  }\r\n\r\n  // This is private because it should only be called in the ProfileBuilder\r\n  // classes. Once a Profile instance has been constructed, it should be treated\r\n  // as immutable.\r\n  protected sortGroupedCallTree() {\r\n    function visit(node: CallTreeNode) {\r\n      node.children.sort((a, b) => -(a.getTotalWeight() - b.getTotalWeight()))\r\n      node.children.forEach(visit)\r\n    }\r\n    visit(this.groupedCalltreeRoot)\r\n  }\r\n\r\n  forEachCallGrouped(\r\n    openFrame: (node: CallTreeNode, value: number) => void,\r\n    closeFrame: (node: CallTreeNode, value: number) => void,\r\n  ) {\r\n    function visit(node: CallTreeNode, start: number) {\r\n      if (node.frame !== Frame.root) {\r\n        openFrame(node, start)\r\n      }\r\n\r\n      let childTime = 0\r\n\r\n      node.children.forEach(function (child) {\r\n        visit(child, start + childTime)\r\n        childTime += child.getTotalWeight()\r\n      })\r\n\r\n      if (node.frame !== Frame.root) {\r\n        closeFrame(node, start + node.getTotalWeight())\r\n      }\r\n    }\r\n    visit(this.groupedCalltreeRoot, 0)\r\n  }\r\n\r\n  forEachCall(\r\n    openFrame: (node: CallTreeNode, value: number) => void,\r\n    closeFrame: (node: CallTreeNode, value: number) => void,\r\n  ) {\r\n    let prevStack: CallTreeNode[] = []\r\n    let value = 0\r\n\r\n    let sampleIndex = 0\r\n    for (let stackTop of this.samples) {\r\n      // Find lowest common ancestor of the current stack and the previous one\r\n      let lca: CallTreeNode | null = null\r\n\r\n      // This is O(n^2), but n should be relatively small here (stack height),\r\n      // so hopefully this isn't much of a problem\r\n      for (\r\n        lca = stackTop;\r\n        lca && lca.frame != Frame.root && prevStack.indexOf(lca) === -1;\r\n        lca = lca.parent\r\n      ) {}\r\n\r\n      // Close frames that are no longer open\r\n      while (prevStack.length > 0 && lastOf(prevStack) != lca) {\r\n        const node = prevStack.pop()!\r\n        closeFrame(node, value)\r\n      }\r\n\r\n      // Open frames that are now becoming open\r\n      const toOpen: CallTreeNode[] = []\r\n      for (\r\n        let node: CallTreeNode | null = stackTop;\r\n        node && node.frame != Frame.root && node != lca;\r\n        node = node.parent\r\n      ) {\r\n        toOpen.push(node)\r\n      }\r\n      toOpen.reverse()\r\n\r\n      for (let node of toOpen) {\r\n        openFrame(node, value)\r\n      }\r\n\r\n      prevStack = prevStack.concat(toOpen)\r\n      value += this.weights[sampleIndex++]\r\n    }\r\n\r\n    // Close frames that are open at the end of the trace\r\n    for (let i = prevStack.length - 1; i >= 0; i--) {\r\n      closeFrame(prevStack[i], value)\r\n    }\r\n  }\r\n\r\n  forEachFrame(fn: (frame: Frame) => void) {\r\n    this.frames.forEach(fn)\r\n  }\r\n\r\n  getProfileWithRecursionFlattened(): Profile {\r\n    const builder = new CallTreeProfileBuilder()\r\n\r\n    const stack: (CallTreeNode | null)[] = []\r\n    const framesInStack = new Set<Frame>()\r\n\r\n    function openFrame(node: CallTreeNode, value: number) {\r\n      if (framesInStack.has(node.frame)) {\r\n        stack.push(null)\r\n      } else {\r\n        framesInStack.add(node.frame)\r\n        stack.push(node)\r\n        builder.enterFrame(node.frame, value)\r\n      }\r\n    }\r\n    function closeFrame(node: CallTreeNode, value: number) {\r\n      const stackTop = stack.pop()\r\n      if (stackTop) {\r\n        framesInStack.delete(stackTop.frame)\r\n        builder.leaveFrame(stackTop.frame, value)\r\n      }\r\n    }\r\n\r\n    this.forEachCall(openFrame, closeFrame)\r\n\r\n    const flattenedProfile = builder.build()\r\n    flattenedProfile.name = this.name\r\n    flattenedProfile.valueFormatter = this.valueFormatter\r\n\r\n    // When constructing a profile with recursion flattened,\r\n    // counter-intuitive things can happen to \"self time\" measurements\r\n    // for functions.\r\n    // For example, given the following list of stacks w/ weights:\r\n    //\r\n    // a 1\r\n    // a;b;a 1\r\n    // a;b;a;b;a 1\r\n    // a;b;a 1\r\n    //\r\n    // The resulting profile with recursion flattened out will look like this:\r\n    //\r\n    // a 1\r\n    // a;b 3\r\n    //\r\n    // Which is useful to view, but it's counter-intuitive to move self-time\r\n    // for frames around, since analyzing the self-time of functions is an important\r\n    // thing to be able to do accurately, and we don't want this to change when recursion\r\n    // is flattened. To work around that, we'll just copy the weights directly from the\r\n    // un-flattened profile.\r\n    this.forEachFrame(f => {\r\n      flattenedProfile.frames.getOrInsert(f).overwriteWeightWith(f)\r\n    })\r\n\r\n    return flattenedProfile\r\n  }\r\n\r\n  getInvertedProfileForCallersOf(focalFrameInfo: FrameInfo): Profile {\r\n    const focalFrame = Frame.getOrInsert(this.frames, focalFrameInfo)\r\n    const builder = new StackListProfileBuilder()\r\n\r\n    // TODO(jlfwong): Could construct this at profile\r\n    // construction time rather than on demand.\r\n    const nodes: CallTreeNode[] = []\r\n\r\n    function visit(node: CallTreeNode) {\r\n      if (node.frame === focalFrame) {\r\n        nodes.push(node)\r\n      } else {\r\n        for (let child of node.children) {\r\n          visit(child)\r\n        }\r\n      }\r\n    }\r\n\r\n    visit(this.appendOrderCalltreeRoot)\r\n\r\n    for (let node of nodes) {\r\n      const stack: FrameInfo[] = []\r\n      for (let n: CallTreeNode | null = node; n != null && n.frame !== Frame.root; n = n.parent) {\r\n        stack.push(n.frame)\r\n      }\r\n      builder.appendSampleWithWeight(stack, node.getTotalWeight())\r\n    }\r\n\r\n    const ret = builder.build()\r\n    ret.name = this.name\r\n    ret.valueFormatter = this.valueFormatter\r\n    return ret\r\n  }\r\n\r\n  getProfileForCalleesOf(focalFrameInfo: FrameInfo): Profile {\r\n    const focalFrame = Frame.getOrInsert(this.frames, focalFrameInfo)\r\n    const builder = new StackListProfileBuilder()\r\n\r\n    function recordSubtree(focalFrameNode: CallTreeNode) {\r\n      const stack: FrameInfo[] = []\r\n\r\n      function visit(node: CallTreeNode) {\r\n        stack.push(node.frame)\r\n        builder.appendSampleWithWeight(stack, node.getSelfWeight())\r\n        for (let child of node.children) {\r\n          visit(child)\r\n        }\r\n        stack.pop()\r\n      }\r\n\r\n      visit(focalFrameNode)\r\n    }\r\n\r\n    function findCalls(node: CallTreeNode) {\r\n      if (node.frame === focalFrame) {\r\n        recordSubtree(node)\r\n      } else {\r\n        for (let child of node.children) {\r\n          findCalls(child)\r\n        }\r\n      }\r\n    }\r\n\r\n    findCalls(this.appendOrderCalltreeRoot)\r\n\r\n    const ret = builder.build()\r\n    ret.name = this.name\r\n    ret.valueFormatter = this.valueFormatter\r\n    return ret\r\n  }\r\n\r\n  // Demangle symbols for readability\r\n  async demangle() {\r\n    let demangleCpp: ((name: string) => string) | null = null\r\n\r\n    for (let frame of this.frames) {\r\n      // This function converts a mangled C++ name such as \"__ZNK7Support6ColorFeqERKS0_\"\r\n      // into a human-readable symbol (in this case \"Support::ColorF::==(Support::ColorF&)\")\r\n      if (frame.name.startsWith('__Z')) {\r\n        if (!demangleCpp) {\r\n          demangleCpp = (await demangleCppModule).demangleCpp\r\n        }\r\n        frame.name = demangleCpp(frame.name)\r\n      }\r\n    }\r\n  }\r\n\r\n  remapSymbols(callback: SymbolRemapper) {\r\n    for (let frame of this.frames) {\r\n      const remapped = callback(frame)\r\n      if (remapped == null) {\r\n        continue\r\n      }\r\n      const {name, file, line, col} = remapped\r\n      if (name != null) {\r\n        frame.name = name\r\n      }\r\n      if (file != null) {\r\n        frame.file = file\r\n      }\r\n      if (line != null) {\r\n        frame.line = line\r\n      }\r\n      if (col != null) {\r\n        frame.col = col\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport class StackListProfileBuilder extends Profile {\r\n  _appendSample(stack: Frame[], weight: number, useAppendOrder: boolean) {\r\n    if (isNaN(weight)) throw new Error('invalid weight')\r\n    let node = useAppendOrder ? this.appendOrderCalltreeRoot : this.groupedCalltreeRoot\r\n\r\n    let framesInStack = new Set<Frame>()\r\n\r\n    for (let frame of stack) {\r\n      const last = useAppendOrder\r\n        ? lastOf(node.children)\r\n        : node.children.find(c => c.frame === frame)\r\n      if (last && !last.isFrozen() && last.frame == frame) {\r\n        node = last\r\n      } else {\r\n        const parent = node\r\n        node = new CallTreeNode(frame, node)\r\n        parent.children.push(node)\r\n      }\r\n      node.addToTotalWeight(weight)\r\n\r\n      // It's possible for the same frame to occur multiple\r\n      // times in the same call stack due to either direct\r\n      // or indirect recursion. We want to avoid counting that\r\n      // frame multiple times for a single sample, we so just\r\n      // track all of the unique frames that participated in\r\n      // this call stack, then add to their weight at the end.\r\n      framesInStack.add(node.frame)\r\n    }\r\n    node.addToSelfWeight(weight)\r\n\r\n    if (useAppendOrder) {\r\n      for (let child of node.children) {\r\n        child.freeze()\r\n      }\r\n    }\r\n\r\n    if (useAppendOrder) {\r\n      node.frame.addToSelfWeight(weight)\r\n\r\n      for (let frame of framesInStack) {\r\n        frame.addToTotalWeight(weight)\r\n      }\r\n\r\n      if (node === lastOf(this.samples)) {\r\n        this.weights[this.weights.length - 1] += weight\r\n      } else {\r\n        this.samples.push(node)\r\n        this.weights.push(weight)\r\n      }\r\n    }\r\n  }\r\n\r\n  appendSampleWithWeight(stack: FrameInfo[], weight: number) {\r\n    if (weight === 0) {\r\n      // Samples with zero weight have no effect, so let's ignore them\r\n      return\r\n    }\r\n    if (weight < 0) {\r\n      throw new Error('Samples must have positive weights')\r\n    }\r\n\r\n    const frames = stack.map(fr => Frame.getOrInsert(this.frames, fr))\r\n    this._appendSample(frames, weight, true)\r\n    this._appendSample(frames, weight, false)\r\n  }\r\n\r\n  private pendingSample: {\r\n    stack: FrameInfo[]\r\n    startTimestamp: number\r\n    centralTimestamp: number\r\n  } | null = null\r\n  appendSampleWithTimestamp(stack: FrameInfo[], timestamp: number) {\r\n    if (this.pendingSample) {\r\n      if (timestamp < this.pendingSample.centralTimestamp) {\r\n        throw new Error('Timestamps received out of order')\r\n      }\r\n      const endTimestamp = (timestamp + this.pendingSample.centralTimestamp) / 2\r\n      this.appendSampleWithWeight(\r\n        this.pendingSample.stack,\r\n        endTimestamp - this.pendingSample.startTimestamp,\r\n      )\r\n      this.pendingSample = {stack, startTimestamp: endTimestamp, centralTimestamp: timestamp}\r\n    } else {\r\n      this.pendingSample = {stack, startTimestamp: timestamp, centralTimestamp: timestamp}\r\n    }\r\n  }\r\n\r\n  build(): Profile {\r\n    if (this.pendingSample) {\r\n      if (this.samples.length > 0) {\r\n        this.appendSampleWithWeight(\r\n          this.pendingSample.stack,\r\n          this.pendingSample.centralTimestamp - this.pendingSample.startTimestamp,\r\n        )\r\n      } else {\r\n        // There is only a single sample. In this case, units will be meaningless,\r\n        // so we'll append with a weight of 1 and also clear any value formatter\r\n        this.appendSampleWithWeight(this.pendingSample.stack, 1)\r\n        this.setValueFormatter(new RawValueFormatter())\r\n      }\r\n    }\r\n    this.totalWeight = Math.max(\r\n      this.totalWeight,\r\n      this.weights.reduce((a, b) => a + b, 0),\r\n    )\r\n    this.sortGroupedCallTree()\r\n    return this\r\n  }\r\n}\r\n\r\n// As an alternative API for importing profiles more efficiently, provide a\r\n// way to open & close frames directly without needing to construct tons of\r\n// arrays as intermediaries.\r\nexport class CallTreeProfileBuilder extends Profile {\r\n  private appendOrderStack: CallTreeNode[] = [this.appendOrderCalltreeRoot]\r\n  private groupedOrderStack: CallTreeNode[] = [this.groupedCalltreeRoot]\r\n  private framesInStack = new Map<Frame, number>()\r\n  private stack: Frame[] = []\r\n\r\n  private lastValue: number = 0\r\n  private addWeightsToFrames(value: number) {\r\n    const delta = value - this.lastValue\r\n    for (let frame of this.framesInStack.keys()) {\r\n      frame.addToTotalWeight(delta)\r\n    }\r\n    const stackTop = lastOf(this.stack)\r\n    if (stackTop) {\r\n      stackTop.addToSelfWeight(delta)\r\n    }\r\n  }\r\n  private addWeightsToNodes(value: number, stack: CallTreeNode[]) {\r\n    const delta = value - this.lastValue\r\n    for (let node of stack) {\r\n      node.addToTotalWeight(delta)\r\n    }\r\n    const stackTop = lastOf(stack)\r\n    if (stackTop) {\r\n      stackTop.addToSelfWeight(delta)\r\n    }\r\n  }\r\n\r\n  private _enterFrame(frame: Frame, value: number, useAppendOrder: boolean) {\r\n    let stack = useAppendOrder ? this.appendOrderStack : this.groupedOrderStack\r\n    this.addWeightsToNodes(value, stack)\r\n\r\n    let prevTop = lastOf(stack)\r\n\r\n    if (prevTop) {\r\n      if (useAppendOrder) {\r\n        const delta = value - this.lastValue\r\n        if (delta > 0) {\r\n          this.samples.push(prevTop)\r\n          this.weights.push(value - this.lastValue)\r\n        } else if (delta < 0) {\r\n          throw new Error(\r\n            `Samples must be provided in increasing order of cumulative value. Last sample was ${this.lastValue}, this sample was ${value}`,\r\n          )\r\n        }\r\n      }\r\n\r\n      const last = useAppendOrder\r\n        ? lastOf(prevTop.children)\r\n        : prevTop.children.find(c => c.frame === frame)\r\n      let node: CallTreeNode\r\n      if (last && !last.isFrozen() && last.frame == frame) {\r\n        node = last\r\n      } else {\r\n        node = new CallTreeNode(frame, prevTop)\r\n        prevTop.children.push(node)\r\n      }\r\n      stack.push(node)\r\n    }\r\n  }\r\n  enterFrame(frameInfo: FrameInfo, value: number) {\r\n    const frame = Frame.getOrInsert(this.frames, frameInfo)\r\n    this.addWeightsToFrames(value)\r\n    this._enterFrame(frame, value, true)\r\n    this._enterFrame(frame, value, false)\r\n\r\n    this.stack.push(frame)\r\n    const frameCount = this.framesInStack.get(frame) || 0\r\n    this.framesInStack.set(frame, frameCount + 1)\r\n    this.lastValue = value\r\n    this.totalWeight = Math.max(this.totalWeight, this.lastValue)\r\n  }\r\n\r\n  private _leaveFrame(frame: Frame, value: number, useAppendOrder: boolean) {\r\n    let stack = useAppendOrder ? this.appendOrderStack : this.groupedOrderStack\r\n    this.addWeightsToNodes(value, stack)\r\n\r\n    if (useAppendOrder) {\r\n      const leavingStackTop = this.appendOrderStack.pop()\r\n      if (leavingStackTop == null) {\r\n        throw new Error(`Trying to leave ${frame.key} when stack is empty`)\r\n      }\r\n      if (this.lastValue == null) {\r\n        throw new Error(`Trying to leave a ${frame.key} before any have been entered`)\r\n      }\r\n      leavingStackTop.freeze()\r\n\r\n      if (leavingStackTop.frame.key !== frame.key) {\r\n        throw new Error(\r\n          `Tried to leave frame \"${frame.name}\" while frame \"${leavingStackTop.frame.name}\" was at the top at ${value}`,\r\n        )\r\n      }\r\n\r\n      const delta = value - this.lastValue\r\n      if (delta > 0) {\r\n        this.samples.push(leavingStackTop)\r\n        this.weights.push(value - this.lastValue)\r\n      } else if (delta < 0) {\r\n        throw new Error(\r\n          `Samples must be provided in increasing order of cumulative value. Last sample was ${this\r\n            .lastValue!}, this sample was ${value}`,\r\n        )\r\n      }\r\n    } else {\r\n      this.groupedOrderStack.pop()\r\n    }\r\n  }\r\n\r\n  leaveFrame(frameInfo: FrameInfo, value: number) {\r\n    const frame = Frame.getOrInsert(this.frames, frameInfo)\r\n    this.addWeightsToFrames(value)\r\n\r\n    this._leaveFrame(frame, value, true)\r\n    this._leaveFrame(frame, value, false)\r\n\r\n    this.stack.pop()\r\n    const frameCount = this.framesInStack.get(frame)\r\n    if (frameCount == null) return\r\n    if (frameCount === 1) {\r\n      this.framesInStack.delete(frame)\r\n    } else {\r\n      this.framesInStack.set(frame, frameCount - 1)\r\n    }\r\n    this.lastValue = value\r\n\r\n    this.totalWeight = Math.max(this.totalWeight, this.lastValue)\r\n  }\r\n\r\n  build(): Profile {\r\n    // Each stack is expected to contain a single node which we initialize to be\r\n    // the root node.\r\n    if (this.appendOrderStack.length > 1 || this.groupedOrderStack.length > 1) {\r\n      throw new Error('Tried to complete profile construction with a non-empty stack')\r\n    }\r\n    this.sortGroupedCallTree()\r\n    return this\r\n  }\r\n}\r\n","// This file contains types which specify the speedscope file format.\r\n\r\nexport namespace FileFormat {\r\n  export type Profile = EventedProfile | SampledProfile\r\n\r\n  export interface File {\r\n    $schema: 'https://www.speedscope.app/file-format-schema.json'\r\n\r\n    // Data shared between profiles\r\n    shared: {\r\n      frames: Frame[]\r\n    }\r\n\r\n    // List of profile definitions\r\n    profiles: Profile[]\r\n\r\n    // The name of the contained profile group. If omitted, will use the name of\r\n    // the file itself.\r\n    // Added in 0.6.0\r\n    name?: string\r\n\r\n    // The index into the `profiles` array that should be displayed upon file\r\n    // load. If omitted, will default to displaying the first profile in the\r\n    // file.\r\n    //\r\n    // Added in 0.6.0\r\n    activeProfileIndex?: number\r\n\r\n    // The name of the the program which exported this profile. This isn't\r\n    // consumed but can be helpful for debugging generated data by seeing what\r\n    // was generating it! Recommended format is \"name@version\". e.g. when the\r\n    // file was exported by speedscope v0.6.0 itself, it will be\r\n    // \"speedscope@0.6.0\"\r\n    //\r\n    // Added in 0.6.0\r\n    exporter?: string\r\n  }\r\n\r\n  export interface Frame {\r\n    name: string\r\n    file?: string\r\n    line?: number\r\n    col?: number\r\n  }\r\n\r\n  export enum ProfileType {\r\n    EVENTED = 'evented',\r\n    SAMPLED = 'sampled',\r\n  }\r\n\r\n  export interface IProfile {\r\n    // Type of profile. This will future proof the file format to allow many\r\n    // different kinds of profiles to be contained and each type to be part of\r\n    // a discriminated union.\r\n    type: ProfileType\r\n  }\r\n\r\n  export interface EventedProfile extends IProfile {\r\n    type: ProfileType.EVENTED\r\n\r\n    // Name of the profile. Typically a filename for the source of the profile.\r\n    name: string\r\n\r\n    // Unit which all value are specified using in the profile.\r\n    unit: ValueUnit\r\n\r\n    // The starting value of the profile. This will typically be a timestamp.\r\n    // All event values will be relative to this startValue.\r\n    startValue: number\r\n\r\n    // The final value of the profile. This will typically be a timestamp. This\r\n    // must be greater than or equal to the startValue. This is useful in\r\n    // situations where the recorded profile extends past the end of the recorded\r\n    // events, which may happen if nothing was happening at the end of the\r\n    // profile.\r\n    endValue: number\r\n\r\n    // List of events that occured as part of this profile.\r\n    // The \"at\" field of every event must be in non-decreasing order.\r\n    events: (OpenFrameEvent | CloseFrameEvent)[]\r\n  }\r\n\r\n  // List of indices into the frame array\r\n  type SampledStack = number[]\r\n\r\n  export interface SampledProfile extends IProfile {\r\n    type: ProfileType.SAMPLED\r\n\r\n    // Name of the profile. Typically a filename for the source of the profile.\r\n    name: string\r\n\r\n    // Unit which all value are specified using in the profile.\r\n    unit: ValueUnit\r\n\r\n    // The starting value of the profile. This will typically be a timestamp.\r\n    // All event values will be relative to this startValue.\r\n    startValue: number\r\n\r\n    // The final value of the profile. This will typically be a timestamp. This\r\n    // must be greater than or equal to the startValue. This is useful in\r\n    // situations where the recorded profile extends past the end of the recorded\r\n    // events, which may happen if nothing was happening at the end of the\r\n    // profile.\r\n    endValue: number\r\n\r\n    // List of stacks\r\n    samples: SampledStack[]\r\n\r\n    // The weight of the sample at the given index. Should have\r\n    // the same length as the samples array.\r\n    weights: number[]\r\n  }\r\n\r\n  export type ValueUnit =\r\n    | 'none'\r\n    | 'nanoseconds'\r\n    | 'microseconds'\r\n    | 'milliseconds'\r\n    | 'seconds'\r\n    | 'bytes'\r\n\r\n  export enum EventType {\r\n    OPEN_FRAME = 'O',\r\n    CLOSE_FRAME = 'C',\r\n  }\r\n\r\n  interface IEvent {\r\n    type: EventType\r\n    at: number\r\n  }\r\n\r\n  // Indicates a stack frame opened. Every opened stack frame must have a\r\n  // corresponding close frame event, and the ordering must be balanced.\r\n  interface OpenFrameEvent extends IEvent {\r\n    type: EventType.OPEN_FRAME\r\n    // An index into the frames array in the shared data within the profile\r\n    frame: number\r\n  }\r\n\r\n  interface CloseFrameEvent extends IEvent {\r\n    type: EventType.CLOSE_FRAME\r\n    // An index into the frames array in the shared data within the profile\r\n    frame: number\r\n  }\r\n}\r\n","module.exports={name:\"speedscope\",version:\"1.16.0\",description:\"\",repository:\"jlfwong/speedscope\",main:\"index.js\",bin:{speedscope:\"./bin/cli.js\"},scripts:{deploy:\"./scripts/deploy.sh\",prepack:\"./scripts/build-release.sh\",prettier:\"prettier --write 'src/**/*.ts' 'src/**/*.tsx'\",lint:\"eslint 'src/**/*.ts' 'src/**/*.tsx'\",jest:\"./scripts/test-setup.sh && jest --runInBand\",coverage:\"npm run jest -- --coverage\",typecheck:\"tsc --noEmit\",test:\"./scripts/ci.sh\",serve:\"parcel assets/index.html --open --no-autoinstall\"},files:[\"bin/cli.js\",\"dist/release/**\",\"!*.map\"],browserslist:[\"last 2 Chrome versions\",\"last 2 Firefox versions\"],author:\"\",license:\"MIT\",devDependencies:{\"@types/jest\":\"22.2.3\",\"@types/jszip\":\"3.1.4\",\"@types/node\":\"14.0.1\",\"@types/pako\":\"1.0.0\",\"@types/vscode-webview\":\"^1.57.2\",\"@typescript-eslint/eslint-plugin\":\"4.19.0\",\"@typescript-eslint/parser\":\"4.19.0\",acorn:\"7.2.0\",aphrodite:\"2.1.0\",eslint:\"6.0.0\",\"eslint-plugin-prettier\":\"2.6.0\",\"eslint-plugin-react-hooks\":\"4.0.2\",jest:\"24.3.0\",jsverify:\"0.8.3\",jszip:\"3.1.5\",pako:\"1.0.6\",\"parcel-bundler\":\"1.12.4\",preact:\"10.4.1\",prettier:\"2.0.4\",protobufjs:\"6.8.8\",\"source-map\":\"0.6.1\",\"ts-jest\":\"24.3.0\",typescript:\"4.2.3\",\"typescript-json-schema\":\"0.42.0\",\"uglify-es\":\"3.2.2\",\"uint8array-json-parser\":\"0.0.2\"},jest:{transform:{\"^.+\\\\.tsx?$\":\"ts-jest\"},setupFilesAfterEnv:[\"./src/jest-setup.js\"],testRegex:\"\\\\.test\\\\.tsx?$\",collectCoverageFrom:[\"**/*.{ts,tsx}\",\"!**/*.d.{ts,tsx}\"],moduleFileExtensions:[\"ts\",\"tsx\",\"js\",\"jsx\",\"json\"]},dependencies:{open:\"7.2.0\"}};","import {\r\n  Profile,\r\n  CallTreeNode,\r\n  Frame,\r\n  CallTreeProfileBuilder,\r\n  FrameInfo,\r\n  StackListProfileBuilder,\r\n  ProfileGroup,\r\n} from './profile'\r\nimport {TimeFormatter, ByteFormatter, RawValueFormatter} from './value-formatters'\r\nimport {FileFormat} from './file-format-spec'\r\n\r\nexport function exportProfileGroup(profileGroup: ProfileGroup): FileFormat.File {\r\n  const frames: FileFormat.Frame[] = []\r\n\r\n  const indexForFrame = new Map<Frame, number>()\r\n  function getIndexForFrame(frame: Frame): number {\r\n    let index = indexForFrame.get(frame)\r\n    if (index == null) {\r\n      const serializedFrame: FileFormat.Frame = {\r\n        name: frame.name,\r\n      }\r\n      if (frame.file != null) serializedFrame.file = frame.file\r\n      if (frame.line != null) serializedFrame.line = frame.line\r\n      if (frame.col != null) serializedFrame.col = frame.col\r\n      index = frames.length\r\n      indexForFrame.set(frame, index)\r\n      frames.push(serializedFrame)\r\n    }\r\n    return index\r\n  }\r\n\r\n  const file: FileFormat.File = {\r\n    exporter: `speedscope@${require('../../package.json').version}`,\r\n    name: profileGroup.name,\r\n    activeProfileIndex: profileGroup.indexToView,\r\n    $schema: 'https://www.speedscope.app/file-format-schema.json',\r\n    shared: {frames},\r\n    profiles: [],\r\n  }\r\n\r\n  for (let profile of profileGroup.profiles) {\r\n    file.profiles.push(exportProfile(profile, getIndexForFrame))\r\n  }\r\n\r\n  return file\r\n}\r\n\r\nfunction exportProfile(profile: Profile, getIndexForFrame: (frame: Frame) => number) {\r\n  const eventedProfile: FileFormat.EventedProfile = {\r\n    type: FileFormat.ProfileType.EVENTED,\r\n    name: profile.getName(),\r\n    unit: profile.getWeightUnit(),\r\n    startValue: 0,\r\n    endValue: profile.getTotalWeight(),\r\n    events: [],\r\n  }\r\n  const openFrame = (node: CallTreeNode, value: number) => {\r\n    eventedProfile.events.push({\r\n      type: FileFormat.EventType.OPEN_FRAME,\r\n      frame: getIndexForFrame(node.frame),\r\n      at: value,\r\n    })\r\n  }\r\n  const closeFrame = (node: CallTreeNode, value: number) => {\r\n    eventedProfile.events.push({\r\n      type: FileFormat.EventType.CLOSE_FRAME,\r\n      frame: getIndexForFrame(node.frame),\r\n      at: value,\r\n    })\r\n  }\r\n  profile.forEachCall(openFrame, closeFrame)\r\n  return eventedProfile\r\n}\r\n\r\nfunction importSpeedscopeProfile(\r\n  serialized: FileFormat.Profile,\r\n  frames: FileFormat.Frame[],\r\n): Profile {\r\n  function setCommonProperties(p: Profile) {\r\n    const {name, unit} = serialized\r\n\r\n    switch (unit) {\r\n      case 'nanoseconds':\r\n      case 'microseconds':\r\n      case 'milliseconds':\r\n      case 'seconds':\r\n        p.setValueFormatter(new TimeFormatter(unit))\r\n        break\r\n\r\n      case 'bytes':\r\n        p.setValueFormatter(new ByteFormatter())\r\n        break\r\n\r\n      case 'none':\r\n        p.setValueFormatter(new RawValueFormatter())\r\n        break\r\n    }\r\n    p.setName(name)\r\n  }\r\n\r\n  function importEventedProfile(evented: FileFormat.EventedProfile) {\r\n    const {startValue, endValue, events} = evented\r\n\r\n    const profile = new CallTreeProfileBuilder(endValue - startValue)\r\n    setCommonProperties(profile)\r\n\r\n    const frameInfos: FrameInfo[] = frames.map((frame, i) => ({key: i, ...frame}))\r\n\r\n    for (let ev of events) {\r\n      switch (ev.type) {\r\n        case FileFormat.EventType.OPEN_FRAME: {\r\n          profile.enterFrame(frameInfos[ev.frame], ev.at - startValue)\r\n          break\r\n        }\r\n        case FileFormat.EventType.CLOSE_FRAME: {\r\n          profile.leaveFrame(frameInfos[ev.frame], ev.at - startValue)\r\n          break\r\n        }\r\n      }\r\n    }\r\n    return profile.build()\r\n  }\r\n\r\n  function importSampledProfile(sampled: FileFormat.SampledProfile) {\r\n    const {startValue, endValue, samples, weights} = sampled\r\n    const profile = new StackListProfileBuilder(endValue - startValue)\r\n    setCommonProperties(profile)\r\n\r\n    const frameInfos: FrameInfo[] = frames.map((frame, i) => ({key: i, ...frame}))\r\n\r\n    if (samples.length !== weights.length) {\r\n      throw new Error(\r\n        `Expected samples.length (${samples.length}) to equal weights.length (${weights.length})`,\r\n      )\r\n    }\r\n\r\n    for (let i = 0; i < samples.length; i++) {\r\n      const stack = samples[i]\r\n      const weight = weights[i]\r\n      profile.appendSampleWithWeight(\r\n        stack.map(n => frameInfos[n]),\r\n        weight,\r\n      )\r\n    }\r\n\r\n    return profile.build()\r\n  }\r\n\r\n  switch (serialized.type) {\r\n    case FileFormat.ProfileType.EVENTED:\r\n      return importEventedProfile(serialized)\r\n    case FileFormat.ProfileType.SAMPLED:\r\n      return importSampledProfile(serialized)\r\n  }\r\n}\r\n\r\nexport function importSpeedscopeProfiles(serialized: FileFormat.File): ProfileGroup {\r\n  return {\r\n    name: serialized.name || serialized.profiles[0].name || 'profile',\r\n    indexToView: serialized.activeProfileIndex || 0,\r\n    profiles: serialized.profiles.map(p => importSpeedscopeProfile(p, serialized.shared.frames)),\r\n  }\r\n}\r\n\r\nexport function saveToFile(profileGroup: ProfileGroup): void {\r\n  const file = exportProfileGroup(profileGroup)\r\n  const blob = new Blob([JSON.stringify(file)], {type: 'text/json'})\r\n\r\n  const nameWithoutExt = file.name ? file.name.split('.')[0]! : 'profile'\r\n  const filename = `${nameWithoutExt.replace(/\\W+/g, '_')}.speedscope.json`\r\n\r\n  console.log('Saving', filename)\r\n\r\n  const a = document.createElement('a')\r\n  a.download = filename\r\n  a.href = window.URL.createObjectURL(blob)\r\n  a.dataset.downloadurl = ['text/json', a.download, a.href].join(':')\r\n\r\n  // For this to work in Firefox, the <a> must be in the DOM\r\n  document.body.appendChild(a)\r\n  a.click()\r\n  document.body.removeChild(a)\r\n}\r\n","/**\r\n * This file contains an implementation of fuzzy string matching.\r\n */\r\n\r\nexport interface FuzzyMatch {\r\n  // List of [start, end] indices in the haystack string that match the needle string\r\n  matchedRanges: [number, number][]\r\n\r\n  // The score of the match for relative ranking. Higher scores indicate\r\n  // \"better\" matches.\r\n  score: number\r\n}\r\n\r\nexport function fuzzyMatchStrings(text: string, pattern: string): FuzzyMatch | null {\r\n  return fzfFuzzyMatchV1(text, pattern)\r\n}\r\n\r\n// The implementation here is based on FuzzyMatchV1, as described here:\r\n// https://github.com/junegunn/fzf/blob/f81feb1e69e5cb75797d50817752ddfe4933cd68/src/algo/algo.go#L8-L15\r\n//\r\n// This is a hand-port to better understand what the code is doing and for added\r\n// clarity.\r\n//\r\n// Capitalized letters only match capitalized letters, but lower-case letters\r\n// match both.\r\n//\r\n// Note: fzf includes a normalization table for homoglyphs. I'm going to ignore that too\r\n// https://github.com/junegunn/fzf/blob/master/src/algo/normalize.go\r\nconst charCodeLowerA = 'a'.charCodeAt(0)\r\nconst charCodeLowerZ = 'z'.charCodeAt(0)\r\nconst charCodeUpperA = 'A'.charCodeAt(0)\r\nconst charCodeUpperZ = 'Z'.charCodeAt(0)\r\nconst charCodeDigit0 = '0'.charCodeAt(0)\r\nconst charCodeDigit9 = '9'.charCodeAt(0)\r\n\r\nenum fzfCharClass {\r\n  charNonWord,\r\n  charLower,\r\n  charUpper,\r\n  charNumber,\r\n}\r\n\r\nfunction fzfCharClassOf(char: string): fzfCharClass {\r\n  const code = char.charCodeAt(0)\r\n  if (charCodeLowerA <= code && code <= charCodeLowerZ) {\r\n    return fzfCharClass.charLower\r\n  } else if (charCodeUpperA <= code && code <= charCodeUpperZ) {\r\n    return fzfCharClass.charUpper\r\n  } else if (charCodeDigit0 <= code && code <= charCodeDigit9) {\r\n    return fzfCharClass.charNumber\r\n  }\r\n  return fzfCharClass.charNonWord\r\n}\r\n\r\nfunction charsMatch(textChar: string, patternChar: string): boolean {\r\n  if (textChar === patternChar) return true\r\n\r\n  const patternCharCode = patternChar.charCodeAt(0)\r\n  if (charCodeLowerA <= patternCharCode && patternCharCode <= charCodeLowerZ) {\r\n    return textChar.charCodeAt(0) === patternCharCode - charCodeLowerA + charCodeUpperA\r\n  }\r\n  return false\r\n}\r\n\r\nfunction fzfFuzzyMatchV1(text: string, pattern: string): FuzzyMatch | null {\r\n  if (pattern.length == 0) {\r\n    return {matchedRanges: [], score: 0}\r\n  }\r\n\r\n  // I removed the fzfAsciiFuzzyIndex code because it's not actually clear to\r\n  // me that it's a very helpful optimization.\r\n\r\n  let pidx = 0\r\n  let sidx = -1\r\n  let eidx = -1\r\n\r\n  let lenRunes = text.length\r\n  let lenPattern = pattern.length\r\n\r\n  // Forward pass: scan over the text pattern, identifying the earliest start\r\n  // and the latest end to consider.\r\n  for (let index = 0; index < lenRunes; index++) {\r\n    let char = text[index]\r\n    let pchar = pattern[pidx]\r\n    if (charsMatch(char, pchar)) {\r\n      if (sidx < 0) {\r\n        sidx = index\r\n      }\r\n      pidx++\r\n      if (pidx == lenPattern) {\r\n        // We found the last character in the pattern! eidx is exclusive, so\r\n        // we'll set it to the current index + 1.\r\n        eidx = index + 1\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  if (eidx == -1) {\r\n    // We couldn't find all the characters in the pattern. No match.\r\n    return null\r\n  }\r\n\r\n  // Assuming we found all the characters in the pattern, perform the backwards\r\n  // pass.\r\n  pidx--\r\n  for (let index = eidx - 1; index >= sidx; index--) {\r\n    const char = text[index]\r\n    const pchar = pattern[pidx]\r\n    if (charsMatch(char, pchar)) {\r\n      pidx--\r\n      if (pidx < 0) {\r\n        // We found the first character of the pattern, scanning\r\n        // backwards. This *may* have narrowed the match further.\r\n        // For example, for the following inputs:\r\n        //\r\n        //    text = \"xxx a b c abc xxx\"\r\n        // pattern = \"abc\"\r\n        //\r\n        // For the forward pass, you get:\r\n        //\r\n        //    \"xxx a b c abc xxx\"\r\n        //    start^        ^end\r\n        //\r\n        // But after the backward pass, we can narrow this to:\r\n        //\r\n        //    \"xxx a b c abc xxx\"\r\n        //          start^  ^end\r\n        sidx = index\r\n        return fzfCalculateScore(text, pattern, sidx, eidx)\r\n      }\r\n    }\r\n  }\r\n\r\n  // This should be unreachable.\r\n  throw new Error('Implementation error. This must be a bug in fzfFuzzyMatchV1')\r\n}\r\n\r\nconst fzfScoreMatch = 16\r\nconst fzfScoreGapStart = -3\r\nconst fzfScoreGapExtension = -1\r\nconst fzfBonusBoundary = fzfScoreMatch / 2\r\nconst fzfBonusNonWord = fzfScoreMatch / 2\r\nconst fzfBonusCamel123 = fzfBonusBoundary + fzfScoreGapExtension\r\nconst fzfBonusConsecutive = -(fzfScoreGapStart + fzfScoreGapExtension)\r\nconst fzfBonusFirstCharMultiplier = 2\r\n\r\nfunction bonusFor(prevClass: fzfCharClass, curClass: fzfCharClass): number {\r\n  if (prevClass === fzfCharClass.charNonWord && curClass !== fzfCharClass.charNonWord) {\r\n    // Prefer matching at word boundaries\r\n    //\r\n    // This should prefer \"a c\" over \"abc\" for a pattern of \"ac\".\r\n    return fzfBonusBoundary\r\n  }\r\n\r\n  if (\r\n    (prevClass === fzfCharClass.charLower && curClass == fzfCharClass.charUpper) ||\r\n    (prevClass !== fzfCharClass.charNumber && curClass == fzfCharClass.charNumber)\r\n  ) {\r\n    // Prefer matching at the transition point between lower & upper for camelCase,\r\n    // and from transition from letter to number for identifiers like letter123.\r\n    //\r\n    // This should prefer \"OutNode\" over \"phone\" for a pattern of \"n\",\r\n    // and \"abc123\" over \"x211\" for a pattern of \"1\".\r\n    return fzfBonusCamel123\r\n  }\r\n\r\n  if (curClass === fzfCharClass.charNonWord) {\r\n    return fzfBonusNonWord\r\n  }\r\n  return 0\r\n}\r\n\r\nfunction fzfCalculateScore(text: string, pattern: string, sidx: number, eidx: number): FuzzyMatch {\r\n  let pidx = 0\r\n  let score = 0\r\n  let inGap = false\r\n  let consecutive = 0\r\n  let firstBonus = 0\r\n  let pos: number[] = new Array(pattern.length)\r\n  let prevClass = fzfCharClass.charNonWord\r\n\r\n  if (sidx > 0) {\r\n    prevClass = fzfCharClassOf(text[sidx - 1])\r\n  }\r\n  for (let idx = sidx; idx < eidx; idx++) {\r\n    let char = text[idx]\r\n    let curClass = fzfCharClassOf(char)\r\n    if (charsMatch(char, pattern[pidx])) {\r\n      pos[pidx] = idx\r\n      score += fzfScoreMatch\r\n      let bonus = bonusFor(prevClass, curClass)\r\n      if (consecutive == 0) {\r\n        firstBonus = bonus\r\n      } else {\r\n        // Break consecutive chunk\r\n        if (bonus === fzfBonusBoundary) {\r\n          firstBonus = bonus\r\n        }\r\n        bonus = Math.max(bonus, firstBonus, fzfBonusConsecutive)\r\n      }\r\n      if (pidx === 0) {\r\n        score += bonus * fzfBonusFirstCharMultiplier\r\n      } else {\r\n        score += bonus\r\n      }\r\n      inGap = false\r\n      consecutive++\r\n      pidx++\r\n    } else {\r\n      if (inGap) {\r\n        // Penalize gaps (this bonus is negative)\r\n        score += fzfScoreGapExtension\r\n      } else {\r\n        // Penalize the beginning of gaps more harshly\r\n        score += fzfScoreGapStart\r\n      }\r\n      inGap = true\r\n      consecutive = 0\r\n      firstBonus = 0\r\n    }\r\n    prevClass = curClass\r\n  }\r\n\r\n  if (pidx !== pattern.length) {\r\n    throw new Error(\r\n      'fzfCalculateScore should only be called when pattern is found between sidx and eidx',\r\n    )\r\n  }\r\n\r\n  let matchedRanges: [number, number][] = [[pos[0], pos[0] + 1]]\r\n  for (let i = 1; i < pos.length; i++) {\r\n    const curPos = pos[i]\r\n    const curRange = matchedRanges[matchedRanges.length - 1]\r\n    if (curRange[1] === curPos) {\r\n      curRange[1] = curPos + 1\r\n    } else {\r\n      matchedRanges.push([curPos, curPos + 1])\r\n    }\r\n  }\r\n\r\n  return {\r\n    score,\r\n    matchedRanges,\r\n  }\r\n}\r\n","import {Profile} from '../lib/profile'\r\nimport {h, JSX, ComponentChild, Ref} from 'preact'\r\nimport {useCallback, useState, useMemo, useEffect, useRef} from 'preact/hooks'\r\nimport {StyleSheet, css} from 'aphrodite'\r\nimport {ZIndex, Sizes} from './style'\r\nimport {fuzzyMatchStrings} from '../lib/fuzzy-find'\r\nimport {sortBy} from '../lib/utils'\r\nimport {useTheme, withTheme} from './themes/theme'\r\n\r\ninterface ProfileSelectRowProps {\r\n  setProfileIndexToView: (profileIndex: number) => void\r\n  setHoveredProfileIndex: (profileIndex: number) => void\r\n  profile: Profile\r\n  matchedRanges: [number, number][]\r\n  hovered: boolean\r\n  selected: boolean\r\n  indexInProfileGroup: number\r\n  indexInFilteredListView: number\r\n  profileCount: number\r\n  nodeRef?: Ref<HTMLDivElement>\r\n  closeProfileSelect: () => void\r\n}\r\n\r\nfunction highlightRanges(\r\n  text: string,\r\n  ranges: [number, number][],\r\n  highlightedClassName: string,\r\n): JSX.Element {\r\n  const spans: ComponentChild[] = []\r\n  let last = 0\r\n  for (let range of ranges) {\r\n    spans.push(text.slice(last, range[0]))\r\n    spans.push(<span className={highlightedClassName}>{text.slice(range[0], range[1])}</span>)\r\n    last = range[1]\r\n  }\r\n  spans.push(text.slice(last))\r\n\r\n  return <span>{spans}</span>\r\n}\r\n\r\nexport function ProfileSelectRow({\r\n  setProfileIndexToView,\r\n  setHoveredProfileIndex,\r\n  profile,\r\n  selected,\r\n  hovered,\r\n  profileCount,\r\n  nodeRef,\r\n  closeProfileSelect,\r\n  indexInProfileGroup,\r\n  matchedRanges,\r\n  indexInFilteredListView,\r\n}: ProfileSelectRowProps) {\r\n  const style = getStyle(useTheme())\r\n\r\n  const onMouseUp = useCallback(() => {\r\n    closeProfileSelect()\r\n    setProfileIndexToView(indexInProfileGroup)\r\n  }, [closeProfileSelect, setProfileIndexToView, indexInProfileGroup])\r\n\r\n  const onMouseEnter = useCallback(\r\n    (ev: Event) => {\r\n      setHoveredProfileIndex(indexInProfileGroup)\r\n    },\r\n    [setHoveredProfileIndex, indexInProfileGroup],\r\n  )\r\n\r\n  const name = profile.getName()\r\n\r\n  const maxDigits = 1 + Math.floor(Math.log10(profileCount))\r\n\r\n  const highlightedClassName = css(style.highlighted)\r\n  const highlighted = useMemo(() => {\r\n    const result = highlightRanges(name, matchedRanges, highlightedClassName)\r\n    return result\r\n  }, [name, matchedRanges, highlightedClassName])\r\n\r\n  // TODO(jlfwong): There's a really gnarly edge-case here where the highlighted\r\n  // ranges are part of the text truncated by ellipsis. I'm just going to punt\r\n  // on solving for that.\r\n  return (\r\n    <div\r\n      ref={nodeRef}\r\n      onMouseUp={onMouseUp}\r\n      onMouseEnter={onMouseEnter}\r\n      title={name}\r\n      className={css(\r\n        style.profileRow,\r\n        indexInFilteredListView % 2 === 0 && style.profileRowEven,\r\n        selected && style.profileRowSelected,\r\n        hovered && style.profileRowHovered,\r\n      )}\r\n    >\r\n      <span\r\n        className={css(style.profileIndex, selected && style.profileIndexSelected)}\r\n        style={{width: maxDigits + 'em'}}\r\n      >\r\n        {indexInProfileGroup + 1}:\r\n      </span>{' '}\r\n      {highlighted}\r\n    </div>\r\n  )\r\n}\r\n\r\ninterface ProfileSelectProps {\r\n  setProfileIndexToView: (profileIndex: number) => void\r\n  indexToView: number\r\n  profiles: Profile[]\r\n  closeProfileSelect: () => void\r\n  visible: boolean\r\n}\r\n\r\nfunction stopPropagation(ev: Event) {\r\n  ev.stopPropagation()\r\n}\r\n\r\ninterface FilteredProfile {\r\n  indexInProfileGroup: number\r\n  profile: Profile\r\n  matchedRanges: [number, number][]\r\n  score: number\r\n}\r\n\r\nfunction getSortedFilteredProfiles(profiles: Profile[], filterText: string): FilteredProfile[] {\r\n  const filtered: FilteredProfile[] = []\r\n  for (let i = 0; i < profiles.length; i++) {\r\n    const profile = profiles[i]\r\n    const match = fuzzyMatchStrings(profile.getName(), filterText)\r\n    if (!match) continue\r\n    filtered.push({\r\n      indexInProfileGroup: i,\r\n      profile,\r\n      ...match,\r\n    })\r\n  }\r\n  sortBy(filtered, p => -p.score)\r\n  return filtered\r\n}\r\n\r\nexport function ProfileSelect({\r\n  profiles,\r\n  closeProfileSelect,\r\n  indexToView,\r\n  visible,\r\n  setProfileIndexToView,\r\n}: ProfileSelectProps) {\r\n  const style = getStyle(useTheme())\r\n\r\n  const [filterText, setFilterText] = useState('')\r\n\r\n  const onFilterTextChange = useCallback(\r\n    (ev: Event) => {\r\n      const value = (ev.target as HTMLInputElement).value\r\n      setFilterText(value)\r\n    },\r\n    [setFilterText],\r\n  )\r\n\r\n  const focusFilterInput = useCallback(\r\n    (node: HTMLInputElement | null) => {\r\n      if (node) {\r\n        if (visible) {\r\n          node.select()\r\n        } else {\r\n          node.blur()\r\n        }\r\n      }\r\n    },\r\n    [visible],\r\n  )\r\n\r\n  const filteredProfiles = useMemo(() => {\r\n    return getSortedFilteredProfiles(profiles, filterText)\r\n  }, [profiles, filterText])\r\n\r\n  const [hoveredProfileIndex, setHoveredProfileIndex] = useState<number | null>(0)\r\n\r\n  const selectedNodeRef = useRef<HTMLDivElement | null>(null)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      // Whenever the profile select becomes visible...\r\n\r\n      // Clear any hovered element\r\n      setHoveredProfileIndex(null)\r\n\r\n      // And scroll the selected profile into view, if possible\r\n      if (selectedNodeRef.current !== null) {\r\n        selectedNodeRef.current.scrollIntoView({\r\n          behavior: 'auto',\r\n          block: 'nearest',\r\n          inline: 'nearest',\r\n        })\r\n      }\r\n    }\r\n  }, [visible])\r\n\r\n  // TODO(jlfwong): Hi-jacking the behavior of enter and the arrow keys won't\r\n  // work well for some composition methods (e.g. a Chinese character\r\n  // composition keyboard input method).\r\n  const onFilterKeyUp = useCallback(\r\n    (ev: KeyboardEvent) => {\r\n      // Prevent the key-press from propagating to other keyboard shortcut\r\n      // handlers in other components.\r\n      ev.stopPropagation()\r\n\r\n      let newHoveredIndexInFilteredList: number | null = null\r\n\r\n      switch (ev.key) {\r\n        case 'Enter': {\r\n          if (hoveredProfileIndex != null) {\r\n            closeProfileSelect()\r\n            setProfileIndexToView(hoveredProfileIndex)\r\n          }\r\n          break\r\n        }\r\n        case 'Escape': {\r\n          closeProfileSelect()\r\n          break\r\n        }\r\n        case 'ArrowDown': {\r\n          ev.preventDefault()\r\n          newHoveredIndexInFilteredList = 0\r\n          if (hoveredProfileIndex != null) {\r\n            const indexInFilteredList = filteredProfiles.findIndex(\r\n              p => p.indexInProfileGroup === hoveredProfileIndex,\r\n            )\r\n            if (indexInFilteredList !== -1) {\r\n              newHoveredIndexInFilteredList = indexInFilteredList + 1\r\n            }\r\n          }\r\n          break\r\n        }\r\n        case 'ArrowUp': {\r\n          ev.preventDefault()\r\n          newHoveredIndexInFilteredList = filteredProfiles.length - 1\r\n          if (hoveredProfileIndex != null) {\r\n            const indexInFilteredList = filteredProfiles.findIndex(\r\n              p => p.indexInProfileGroup === hoveredProfileIndex,\r\n            )\r\n            if (indexInFilteredList !== -1) {\r\n              newHoveredIndexInFilteredList = indexInFilteredList - 1\r\n            }\r\n          }\r\n          break\r\n        }\r\n      }\r\n\r\n      if (\r\n        newHoveredIndexInFilteredList != null &&\r\n        newHoveredIndexInFilteredList >= 0 &&\r\n        newHoveredIndexInFilteredList < filteredProfiles.length\r\n      ) {\r\n        const indexInProfileGroup =\r\n          filteredProfiles[newHoveredIndexInFilteredList].indexInProfileGroup\r\n        setHoveredProfileIndex(indexInProfileGroup)\r\n        setPendingForcedScroll(true)\r\n      }\r\n    },\r\n    [closeProfileSelect, setProfileIndexToView, hoveredProfileIndex, filteredProfiles],\r\n  )\r\n\r\n  const [pendingForcedScroll, setPendingForcedScroll] = useState(false)\r\n  useEffect(() => {\r\n    // Whenever the list of filtered profiles changes, set the first element hovered.\r\n    if (filteredProfiles.length > 0) {\r\n      setHoveredProfileIndex(filteredProfiles[0].indexInProfileGroup)\r\n      setPendingForcedScroll(true)\r\n    }\r\n  }, [setHoveredProfileIndex, filteredProfiles])\r\n\r\n  const hoveredNodeRef = useCallback(\r\n    (hoveredNode: HTMLDivElement | null) => {\r\n      if (pendingForcedScroll && hoveredNode) {\r\n        hoveredNode.scrollIntoView({\r\n          behavior: 'auto',\r\n          block: 'nearest',\r\n          inline: 'nearest',\r\n        })\r\n        setPendingForcedScroll(false)\r\n      }\r\n    },\r\n    [pendingForcedScroll, setPendingForcedScroll],\r\n  )\r\n\r\n  const selectedHoveredRef = useCallback(\r\n    (node: HTMLDivElement | null) => {\r\n      selectedNodeRef.current = node\r\n      hoveredNodeRef(node)\r\n    },\r\n    [selectedNodeRef, hoveredNodeRef],\r\n  )\r\n\r\n  // We allow ProfileSelect to be aware of its own visibility in order to retain\r\n  // its scroll offset state between times when it's hidden & shown, and also to\r\n  // scroll the selected node into view once it becomes shown again after the\r\n  // selected profile has changed.\r\n  return (\r\n    <div className={css(style.profileSelectOuter)}>\r\n      <div className={css(style.caret)} />\r\n      <div className={css(style.profileSelectBox)}>\r\n        {/* We stop event propagation for key events on the input to prevent\r\n            this from triggering keyboard shortcuts. */}\r\n        <div className={css(style.filterInputContainer)}>\r\n          <input\r\n            type=\"text\"\r\n            className={css(style.filterInput)}\r\n            ref={focusFilterInput}\r\n            placeholder={'Filter...'}\r\n            value={filterText}\r\n            onInput={onFilterTextChange}\r\n            onKeyDown={onFilterKeyUp}\r\n            onKeyUp={stopPropagation}\r\n            onKeyPress={stopPropagation}\r\n          />\r\n        </div>\r\n        <div className={css(style.profileSelectScrolling)}>\r\n          {filteredProfiles.map(({profile, matchedRanges, indexInProfileGroup}, indexInList) => {\r\n            let ref: Ref<HTMLDivElement> | undefined = undefined\r\n            const selected = indexInProfileGroup === indexToView\r\n            const hovered = indexInProfileGroup === hoveredProfileIndex\r\n            if (selected && hovered) {\r\n              ref = selectedHoveredRef\r\n            } else if (selected) {\r\n              ref = selectedNodeRef\r\n            } else if (hovered) {\r\n              ref = hoveredNodeRef\r\n            }\r\n            return (\r\n              <ProfileSelectRow\r\n                setHoveredProfileIndex={setHoveredProfileIndex}\r\n                indexInProfileGroup={indexInProfileGroup}\r\n                indexInFilteredListView={indexInList}\r\n                hovered={indexInProfileGroup == hoveredProfileIndex}\r\n                selected={indexInProfileGroup === indexToView}\r\n                profile={profile}\r\n                profileCount={profiles.length}\r\n                nodeRef={ref}\r\n                matchedRanges={matchedRanges}\r\n                setProfileIndexToView={setProfileIndexToView}\r\n                closeProfileSelect={closeProfileSelect}\r\n              />\r\n            )\r\n          })}\r\n          {filteredProfiles.length === 0 ? (\r\n            <div className={css(style.profileRow)}>No results match filter \"{filterText}\"</div>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst paddingHeight = 10\r\n\r\nconst getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    filterInputContainer: {\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      padding: 5,\r\n      alignItems: 'stretch',\r\n    },\r\n    filterInput: {\r\n      color: theme.altFgPrimaryColor,\r\n      background: theme.altBgSecondaryColor,\r\n      borderRadius: 5,\r\n      padding: 5,\r\n      ':focus': {\r\n        border: 'none',\r\n        outline: 'none',\r\n      },\r\n      '::selection': {\r\n        color: theme.altFgPrimaryColor,\r\n        background: theme.selectionPrimaryColor,\r\n      },\r\n    },\r\n    caret: {\r\n      width: 0,\r\n      height: 0,\r\n      borderLeft: '5px solid transparent',\r\n      borderRight: '5px solid transparent',\r\n      borderBottom: '5px solid black',\r\n    },\r\n    highlighted: {\r\n      background: theme.selectionSecondaryColor,\r\n    },\r\n    padding: {\r\n      height: paddingHeight,\r\n      background: theme.altBgPrimaryColor,\r\n    },\r\n    profileRow: {\r\n      height: Sizes.FRAME_HEIGHT - 2,\r\n      border: '1px solid transparent',\r\n      textAlign: 'left',\r\n      paddingLeft: 10,\r\n      paddingRight: 10,\r\n      background: theme.altBgPrimaryColor,\r\n      overflow: 'hidden',\r\n      whiteSpace: 'nowrap',\r\n      textOverflow: 'ellipsis',\r\n      cursor: 'pointer',\r\n    },\r\n    profileRowHovered: {\r\n      border: `1px solid ${theme.selectionPrimaryColor}`,\r\n    },\r\n    profileRowSelected: {\r\n      background: theme.selectionPrimaryColor,\r\n    },\r\n    profileRowEven: {\r\n      background: theme.altBgSecondaryColor,\r\n    },\r\n    profileSelectScrolling: {\r\n      maxHeight: `min(calc(100vh - ${Sizes.TOOLBAR_HEIGHT - 2 * paddingHeight}px), ${\r\n        20 * Sizes.FRAME_HEIGHT\r\n      }px)`,\r\n      overflow: 'auto',\r\n      '::-webkit-scrollbar': {\r\n        background: theme.altBgPrimaryColor,\r\n      },\r\n      '::-webkit-scrollbar-thumb': {\r\n        background: theme.altFgSecondaryColor,\r\n        borderRadius: 20,\r\n        border: `3px solid ${theme.altBgPrimaryColor}`,\r\n        ':hover': {\r\n          background: theme.altBgPrimaryColor,\r\n        },\r\n      },\r\n    },\r\n    profileSelectBox: {\r\n      width: '100%',\r\n      paddingBottom: 10,\r\n      background: theme.altBgPrimaryColor,\r\n      color: theme.altFgPrimaryColor,\r\n    },\r\n    profileSelectOuter: {\r\n      width: '100%',\r\n      maxWidth: 480,\r\n      margin: '0 auto',\r\n      position: 'relative',\r\n      zIndex: ZIndex.PROFILE_SELECT,\r\n      alignItems: 'center',\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n    },\r\n    profileIndex: {\r\n      textAlign: 'right',\r\n      display: 'inline-block',\r\n      color: theme.altFgSecondaryColor,\r\n    },\r\n    profileIndexSelected: {\r\n      color: theme.altFgPrimaryColor,\r\n    },\r\n  }),\r\n)\r\n","import {ApplicationProps} from './application'\r\nimport {h, JSX, Fragment} from 'preact'\r\nimport {useCallback, useState, useEffect} from 'preact/hooks'\r\nimport {StyleSheet, css} from 'aphrodite'\r\nimport {Sizes, FontFamily, FontSize, Duration} from './style'\r\nimport {ProfileSelect} from './profile-select'\r\nimport {Profile} from '../lib/profile'\r\nimport {objectsHaveShallowEquality} from '../lib/utils'\r\nimport {colorSchemeToString, useTheme, withTheme} from './themes/theme'\r\nimport {ViewMode} from '../lib/view-mode'\r\nimport {viewModeAtom} from '../app-state'\r\nimport {ProfileGroupState} from '../app-state/profile-group'\r\nimport {colorSchemeAtom} from '../app-state/color-scheme'\r\nimport {useAtom} from '../lib/atom'\r\n\r\ninterface ToolbarProps extends ApplicationProps {\r\n  browseForFile(): void\r\n  saveFile(): void\r\n}\r\n\r\nfunction useSetViewMode(setViewMode: (viewMode: ViewMode) => void, viewMode: ViewMode) {\r\n  return useCallback(() => setViewMode(viewMode), [setViewMode, viewMode])\r\n}\r\n\r\nfunction ToolbarLeftContent(props: ToolbarProps) {\r\n  const style = getStyle(useTheme())\r\n  const setChronoFlameChart = useSetViewMode(viewModeAtom.set, ViewMode.CHRONO_FLAME_CHART)\r\n  const setLeftHeavyFlameGraph = useSetViewMode(viewModeAtom.set, ViewMode.LEFT_HEAVY_FLAME_GRAPH)\r\n  const setSandwichView = useSetViewMode(viewModeAtom.set, ViewMode.SANDWICH_VIEW)\r\n\r\n  if (!props.activeProfileState) return null\r\n\r\n  return (\r\n    <div className={css(style.toolbarLeft)}>\r\n      <div\r\n        className={css(\r\n          style.toolbarTab,\r\n          props.viewMode === ViewMode.CHRONO_FLAME_CHART && style.toolbarTabActive,\r\n        )}\r\n        onClick={setChronoFlameChart}\r\n      >\r\n        <span className={css(style.emoji)}></span>Time Order\r\n      </div>\r\n      <div\r\n        className={css(\r\n          style.toolbarTab,\r\n          props.viewMode === ViewMode.LEFT_HEAVY_FLAME_GRAPH && style.toolbarTabActive,\r\n        )}\r\n        onClick={setLeftHeavyFlameGraph}\r\n      >\r\n        <span className={css(style.emoji)}></span>Left Heavy\r\n      </div>\r\n      <div\r\n        className={css(\r\n          style.toolbarTab,\r\n          props.viewMode === ViewMode.SANDWICH_VIEW && style.toolbarTabActive,\r\n        )}\r\n        onClick={setSandwichView}\r\n      >\r\n        <span className={css(style.emoji)}></span>Sandwich\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst getCachedProfileList = (() => {\r\n  // TODO(jlfwong): It would be nice to just implement this as useMemo, but if\r\n  // we do that using profileGroup or profileGroup.profiles as the cache key,\r\n  // then it will invalidate whenever *anything* changes, because\r\n  // profileGroup.profiles is ProfileState[], which contains component state\r\n  // information for each tab for each profile. So whenever any property in any\r\n  // persisted view state changes for *any* view in *any* profile, the profiles\r\n  // list will get re-generated.\r\n  let cachedProfileList: Profile[] | null = null\r\n\r\n  return (profileGroup: ProfileGroupState): Profile[] | null => {\r\n    let nextProfileList = profileGroup?.profiles.map(p => p.profile) || null\r\n\r\n    if (\r\n      cachedProfileList === null ||\r\n      (nextProfileList != null && !objectsHaveShallowEquality(cachedProfileList, nextProfileList))\r\n    ) {\r\n      cachedProfileList = nextProfileList\r\n    }\r\n\r\n    return cachedProfileList\r\n  }\r\n})()\r\n\r\nfunction ToolbarCenterContent(props: ToolbarProps): JSX.Element {\r\n  const style = getStyle(useTheme())\r\n\r\n  const {activeProfileState, profileGroup} = props\r\n  const profiles = getCachedProfileList(profileGroup)\r\n  const [profileSelectShown, setProfileSelectShown] = useState(false)\r\n\r\n  const openProfileSelect = useCallback(() => {\r\n    setProfileSelectShown(true)\r\n  }, [setProfileSelectShown])\r\n\r\n  const closeProfileSelect = useCallback(() => {\r\n    setProfileSelectShown(false)\r\n  }, [setProfileSelectShown])\r\n\r\n  useEffect(() => {\r\n    const onWindowKeyPress = (ev: KeyboardEvent) => {\r\n      if (ev.key === 't') {\r\n        ev.preventDefault()\r\n        setProfileSelectShown(true)\r\n      }\r\n    }\r\n    window.addEventListener('keypress', onWindowKeyPress)\r\n    return () => {\r\n      window.removeEventListener('keypress', onWindowKeyPress)\r\n    }\r\n  }, [setProfileSelectShown])\r\n\r\n  useEffect(() => {\r\n    const onWindowKeyPress = (ev: KeyboardEvent) => {\r\n      if (ev.key === 't') {\r\n        ev.preventDefault()\r\n        setProfileSelectShown(true)\r\n      }\r\n    }\r\n    window.addEventListener('keypress', onWindowKeyPress)\r\n    return () => {\r\n      window.removeEventListener('keypress', onWindowKeyPress)\r\n    }\r\n  }, [setProfileSelectShown])\r\n\r\n  if (activeProfileState && profileGroup && profiles) {\r\n    if (profileGroup.profiles.length === 1) {\r\n      return <Fragment>{activeProfileState.profile.getName()}</Fragment>\r\n    } else {\r\n      return (\r\n        <div className={css(style.toolbarCenter)} onMouseLeave={closeProfileSelect}>\r\n          <span onMouseOver={openProfileSelect}>\r\n            {activeProfileState.profile.getName()}{' '}\r\n            <span className={css(style.toolbarProfileIndex)}>\r\n              ({activeProfileState.index + 1}/{profileGroup.profiles.length})\r\n            </span>\r\n          </span>\r\n          <div style={{display: profileSelectShown ? 'block' : 'none'}}>\r\n            <ProfileSelect\r\n              setProfileIndexToView={props.setProfileIndexToView}\r\n              indexToView={profileGroup.indexToView}\r\n              profiles={profiles}\r\n              closeProfileSelect={closeProfileSelect}\r\n              visible={profileSelectShown}\r\n            />\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n  }\r\n  return <Fragment>{'speedscope'}</Fragment>\r\n}\r\n\r\nfunction ToolbarRightContent(props: ToolbarProps) {\r\n  const style = getStyle(useTheme())\r\n  const colorScheme = useAtom(colorSchemeAtom)\r\n\r\n  const exportFile = (\r\n    <div className={css(style.toolbarTab)} onClick={props.saveFile}>\r\n      <span className={css(style.emoji)}></span>Export\r\n    </div>\r\n  )\r\n  const importFile = (\r\n    <div className={css(style.toolbarTab)} onClick={props.browseForFile}>\r\n      <span className={css(style.emoji)}></span>Import\r\n    </div>\r\n  )\r\n\r\n  const colorSchemeToggle = (\r\n    <div className={css(style.toolbarTab)} onClick={colorSchemeAtom.cycleToNextColorScheme}>\r\n      <span className={css(style.emoji)}></span>\r\n      <span className={css(style.toolbarTabColorSchemeToggle)}>\r\n        {colorSchemeToString(colorScheme)}\r\n      </span>\r\n    </div>\r\n  )\r\n\r\n  const help = (\r\n    <div className={css(style.toolbarTab)}>\r\n      <a\r\n        href=\"https://github.com/jlfwong/speedscope#usage\"\r\n        className={css(style.noLinkStyle)}\r\n        target=\"_blank\"\r\n      >\r\n        <span className={css(style.emoji)}></span>Help\r\n      </a>\r\n    </div>\r\n  )\r\n\r\n  return (\r\n    <div className={css(style.toolbarRight)}>\r\n      {props.activeProfileState && exportFile}\r\n      {importFile}\r\n      {colorSchemeToggle}\r\n      {help}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport function Toolbar(props: ToolbarProps) {\r\n  const style = getStyle(useTheme())\r\n  return (\r\n    <div className={css(style.toolbar)}>\r\n      <ToolbarLeftContent {...props} />\r\n      <ToolbarCenterContent {...props} />\r\n      <ToolbarRightContent {...props} />\r\n    </div>\r\n  )\r\n}\r\n\r\nconst getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    toolbar: {\r\n      height: Sizes.TOOLBAR_HEIGHT,\r\n      flexShrink: 0,\r\n      background: theme.altBgPrimaryColor,\r\n      color: theme.altFgPrimaryColor,\r\n      textAlign: 'center',\r\n      fontFamily: FontFamily.MONOSPACE,\r\n      fontSize: FontSize.TITLE,\r\n      lineHeight: `${Sizes.TOOLBAR_TAB_HEIGHT}px`,\r\n      userSelect: 'none',\r\n    },\r\n    toolbarLeft: {\r\n      position: 'absolute',\r\n      height: Sizes.TOOLBAR_HEIGHT,\r\n      overflow: 'hidden',\r\n      top: 0,\r\n      left: 0,\r\n      marginRight: 2,\r\n      textAlign: 'left',\r\n    },\r\n    toolbarCenter: {\r\n      paddingTop: 1,\r\n      height: Sizes.TOOLBAR_HEIGHT,\r\n    },\r\n    toolbarRight: {\r\n      height: Sizes.TOOLBAR_HEIGHT,\r\n      overflow: 'hidden',\r\n      position: 'absolute',\r\n      top: 0,\r\n      right: 0,\r\n      marginRight: 2,\r\n      textAlign: 'right',\r\n    },\r\n    toolbarProfileIndex: {\r\n      color: theme.altFgSecondaryColor,\r\n    },\r\n    toolbarTab: {\r\n      background: theme.altBgSecondaryColor,\r\n      marginTop: Sizes.SEPARATOR_HEIGHT,\r\n      height: Sizes.TOOLBAR_TAB_HEIGHT,\r\n      lineHeight: `${Sizes.TOOLBAR_TAB_HEIGHT}px`,\r\n      paddingLeft: 2,\r\n      paddingRight: 8,\r\n      display: 'inline-block',\r\n      marginLeft: 2,\r\n      transition: `all ${Duration.HOVER_CHANGE} ease-in`,\r\n      ':hover': {\r\n        background: theme.selectionSecondaryColor,\r\n      },\r\n    },\r\n    toolbarTabActive: {\r\n      background: theme.selectionPrimaryColor,\r\n      ':hover': {\r\n        background: theme.selectionPrimaryColor,\r\n      },\r\n    },\r\n    toolbarTabColorSchemeToggle: {\r\n      display: 'inline-block',\r\n      textAlign: 'center',\r\n      minWidth: '50px',\r\n    },\r\n    emoji: {\r\n      display: 'inline-block',\r\n      verticalAlign: 'middle',\r\n      paddingTop: '0px',\r\n      marginRight: '0.3em',\r\n    },\r\n    noLinkStyle: {\r\n      textDecoration: 'none',\r\n      color: 'inherit',\r\n    },\r\n  }),\r\n)\r\n","// This file contains code to allow profiles to be remapped by JavaScript source maps.\r\n//\r\n// As of writing, this is using an out-of-date version of source-map, because the\r\n// source-map library migrated to using web-assembly. This requires loading the\r\n// web-assembly ball. The easiest way to do this is to load it from a third-party\r\n// URL, but I want speedscope to work standalone offline. This means that the remaining\r\n// options require some way of having a local URL that corresponds the .wasm file.\r\n//\r\n// Also as of writing, speedscope is bundled with Parcel v1. Trying to import\r\n// a .wasm file in Parcel v1 tries to load the wasm module itself, which is not\r\n// what I'm trying to do -- I want SourceMapConsumer.initialize to be the thing\r\n// booting the WebAssembly, not Parcel itself.\r\n//\r\n// One way of getting around this problem is to modify the build system to\r\n// copy the .wasm file from node_modules/source-map/lib/mappings.wasm. I could do\r\n// this, but it's a bit of a pain.\r\n//\r\n// Another would be to use something like\r\n// import(\"url:../node_modules/source-map/lib/mappings.wasm\"), and then pass the\r\n// resulting URL to SourceMapConsumer.initialize. This is also kind of a pain,\r\n// because I can only do that if I upgrade to Parcel v2. Ultimately, I'd like to\r\n// use esbuild rather than parcel at all, so for now I'm just punting on this by\r\n// using an old-version of source-map which doesn't depend on wasm.\r\n\r\n// This is rarely used, so let's load it async to avoid bloating the initial\r\n// bundle.\r\nimport type {MappingItem, RawSourceMap, SourceMapConsumer} from 'source-map'\r\nconst sourceMapModule = import('source-map')\r\n\r\nimport {Frame, SymbolRemapper} from './profile'\r\nimport {findIndexBisect} from './utils'\r\n\r\nconst DEBUG = false\r\n\r\nexport async function importJavaScriptSourceMapSymbolRemapper(\r\n  contentsString: string,\r\n  sourceMapFileName: string,\r\n): Promise<SymbolRemapper | null> {\r\n  const sourceMap = await sourceMapModule\r\n\r\n  let consumer: SourceMapConsumer | null = null\r\n  let contents: RawSourceMap | null = null\r\n\r\n  try {\r\n    contents = JSON.parse(contentsString)\r\n    consumer = new sourceMap.SourceMapConsumer(contents!)\r\n  } catch (e) {\r\n    return null\r\n  }\r\n\r\n  const mappingItems: MappingItem[] = []\r\n\r\n  consumer.eachMapping(\r\n    function (m: MappingItem) {\r\n      // The sourcemap library uses 1-based line numbers, and 0-based column\r\n      // numbers. speedscope uses 1-based line-numbers, and 1-based column\r\n      // numbers for its in-memory representation, so we'll normalize that\r\n      // here too.\r\n      mappingItems.push({\r\n        ...m,\r\n        generatedColumn: m.generatedColumn + 1,\r\n        originalColumn: m.originalColumn + 1,\r\n      })\r\n    },\r\n    {},\r\n\r\n    // We're going to binary search through these later, so make sure they're\r\n    // sorted by their order in the generated file.\r\n    sourceMap.SourceMapConsumer.GENERATED_ORDER,\r\n  )\r\n\r\n  const sourceMapFileNameWithoutExt = sourceMapFileName.replace(/\\.[^/]*$/, '')\r\n\r\n  return (frame: Frame) => {\r\n    let fileMatches = false\r\n    if (contents?.file && contents?.file === frame.file) {\r\n      fileMatches = true\r\n    } else if (\r\n      ('/' + frame.file?.replace(/\\.[^/]*$/, '')).endsWith('/' + sourceMapFileNameWithoutExt)\r\n    ) {\r\n      fileMatches = true\r\n    }\r\n    if (!fileMatches) {\r\n      // The source-map doesn't apply to the file this frame is defined in.\r\n      return null\r\n    }\r\n\r\n    if (frame.line == null || frame.col == null) {\r\n      // If we don't have a line & column number for the frame, we can't\r\n      // remap it.\r\n      return null\r\n    }\r\n\r\n    // If we got here, then we hopefully have an remapping.\r\n    //\r\n    // Ideally, we'd look up a symbol whose generatedLine & generatedColumn\r\n    // match what we have in our profile, but unfortunately browsers don't do\r\n    // this.\r\n    //\r\n    // Browsers set the column number for a function to the index of the\r\n    // opening paren for the argument list, rather than the beginning of the\r\n    // index of the name.\r\n    //\r\n    // function alpha() { ... }\r\n    //               ^\r\n    //\r\n    // const beta = function() { ... }\r\n    //                      ^\r\n    //\r\n    // const gamma = () => { ... }\r\n    //               ^\r\n    //\r\n    // Since we don't have the source code being profiled, we unfortunately\r\n    // can't normalize this to set the column to the first character of the\r\n    // actual name.\r\n    //\r\n    // To work around this limitation, we'll search backwards from the first\r\n    // mapping whose generatedLine & generatedColumn are beyond the location\r\n    // in the profile.\r\n    let mappingIndex = findIndexBisect(mappingItems, m => {\r\n      if (m.generatedLine > frame.line!) return true\r\n      if (m.generatedLine < frame.line!) return false\r\n      if (m.generatedColumn >= frame.col!) return true\r\n      return false\r\n    })\r\n\r\n    if (mappingIndex === -1) {\r\n      // There are no symbols following the given profile frame symbol, so try\r\n      // to apply the very last mapping.\r\n      mappingIndex = mappingItems.length - 1\r\n    } else if (mappingIndex === 0) {\r\n      // If the very first index in mappingItems is beyond the location in the\r\n      // profile, it means the name we're looking for doesn't have a\r\n      // corresponding entry in the source-map (this can happen if the\r\n      // source-map isn't the right source-map)\r\n      return null\r\n    } else {\r\n      mappingIndex--\r\n    }\r\n\r\n    const sourceMapItem = mappingItems[mappingIndex]\r\n    const remappedFrameInfo: {name?: string; file?: string; line?: number; col?: number} = {}\r\n\r\n    if (sourceMapItem.name != null) {\r\n      remappedFrameInfo.name = sourceMapItem.name\r\n    } else if (sourceMapItem.source != null) {\r\n      // HACK: If the item name isn't specified, but the source is present, then\r\n      // we're going to try to guess what the name is by using the originalLine\r\n      // and originalColumn.\r\n\r\n      // The second argument here is \"returnNullOnMissing\". Without this, it\r\n      // throws instead of returning null.\r\n      const content = consumer?.sourceContentFor(sourceMapItem.source, true)\r\n      if (content) {\r\n        const lines = content.split('\\n')\r\n        const line = lines[sourceMapItem.originalLine - 1]\r\n        if (line) {\r\n          // It's possible this source map entry will contain stuff other than\r\n          // the name, so let's only consider word-ish characters that are part\r\n          // of the prefix.\r\n          const identifierMatch = /\\w+/.exec(line.substr(sourceMapItem.originalColumn - 1))\r\n          if (identifierMatch) {\r\n            remappedFrameInfo.name = identifierMatch[0]\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    switch (remappedFrameInfo.name) {\r\n      case 'constructor': {\r\n        // If the name was remapped to \"constructor\", then let's use the\r\n        // original name, since \"constructor\" isn't very helpful.\r\n        //\r\n        // TODO(jlfwong): Search backwards for the class keyword and see if we\r\n        // can guess the right name.\r\n        remappedFrameInfo.name = frame.name + ' constructor'\r\n        break\r\n      }\r\n\r\n      case 'function': {\r\n        // If the name is just \"function\", it probably means we either messed up\r\n        // the remapping, or that we matched an anonymous function. In either\r\n        // case, this isn't helpful, so put this back.\r\n        remappedFrameInfo.name = frame.name\r\n        break\r\n      }\r\n\r\n      case 'const':\r\n      case 'export': {\r\n        // If we got this, we probably just did a bad job leveraging the hack\r\n        // looking through the source code. Let's fall-back to whatever the\r\n        // original name was.\r\n        remappedFrameInfo.name = frame.name\r\n        break\r\n      }\r\n    }\r\n\r\n    if (remappedFrameInfo.name && frame.name.includes(remappedFrameInfo.name)) {\r\n      // If the remapped name is a substring of the original name, the original\r\n      // name probably contains more useful information. In that case, just use\r\n      // the original name instead.\r\n      //\r\n      // This can happen, for example, when remapping method names. If a\r\n      // call stack says the symbol name is \"n.zap\" and we remapped it to a\r\n      // function just called \"zap\", we might as well use the original name\r\n      // instead.\r\n      remappedFrameInfo.name = frame.name\r\n    }\r\n\r\n    if (sourceMapItem.source != null) {\r\n      remappedFrameInfo.file = sourceMapItem.source\r\n      remappedFrameInfo.line = sourceMapItem.originalLine\r\n      remappedFrameInfo.col = sourceMapItem.originalColumn\r\n    }\r\n\r\n    if (DEBUG) {\r\n      console.groupCollapsed(`Remapping \"${frame.name}\" -> \"${remappedFrameInfo.name}\"`)\r\n      console.log('before', {...frame})\r\n      console.log('item @ index', sourceMapItem)\r\n      console.log('item @ index + 1', mappingItems[mappingIndex + 1])\r\n      console.log('after', remappedFrameInfo)\r\n      console.groupEnd()\r\n    }\r\n\r\n    return remappedFrameInfo\r\n  }\r\n}\r\n","import {h} from 'preact'\r\nimport {StyleSheet, css} from 'aphrodite'\r\nimport {FileSystemDirectoryEntry} from '../import/file-system-entry'\r\n\r\nimport {ProfileGroup, SymbolRemapper} from '../lib/profile'\r\nimport {FontFamily, FontSize, Duration} from './style'\r\nimport {importEmscriptenSymbolMap as importEmscriptenSymbolRemapper} from '../lib/emscripten'\r\nimport {SandwichViewContainer} from './sandwich-view'\r\nimport {saveToFile} from '../lib/file-format'\r\nimport {ActiveProfileState} from '../app-state/active-profile-state'\r\nimport {LeftHeavyFlamechartView, ChronoFlamechartView} from './flamechart-view-container'\r\nimport {CanvasContext} from '../gl/canvas-context'\r\nimport {Toolbar} from './toolbar'\r\nimport {importJavaScriptSourceMapSymbolRemapper} from '../lib/js-source-map'\r\nimport {Theme, withTheme} from './themes/theme'\r\nimport {ViewMode} from '../lib/view-mode'\r\nimport {canUseXHR} from '../app-state'\r\nimport {ProfileGroupState} from '../app-state/profile-group'\r\nimport {HashParams} from '../lib/hash-params'\r\nimport {StatelessComponent} from '../lib/preact-helpers'\r\n\r\nconst importModule = import('../import')\r\n\r\n// Force eager loading of a few code-split modules.\r\n//\r\n// We put them all in one place so we can directly control the relative priority\r\n// of these.\r\nimportModule.then(() => {})\r\nimport('../lib/demangle-cpp').then(() => {})\r\nimport('source-map').then(() => {})\r\n\r\nasync function importProfilesFromText(\r\n  fileName: string,\r\n  contents: string,\r\n): Promise<ProfileGroup | null> {\r\n  return (await importModule).importProfileGroupFromText(fileName, contents)\r\n}\r\n\r\nasync function importProfilesFromBase64(\r\n  fileName: string,\r\n  contents: string,\r\n): Promise<ProfileGroup | null> {\r\n  return (await importModule).importProfileGroupFromBase64(fileName, contents)\r\n}\r\n\r\nasync function importProfilesFromArrayBuffer(\r\n  fileName: string,\r\n  contents: ArrayBuffer,\r\n): Promise<ProfileGroup | null> {\r\n  return (await importModule).importProfilesFromArrayBuffer(fileName, contents)\r\n}\r\n\r\nasync function importProfilesFromFile(file: File): Promise<ProfileGroup | null> {\r\n  return (await importModule).importProfilesFromFile(file)\r\n}\r\nasync function importFromFileSystemDirectoryEntry(entry: FileSystemDirectoryEntry) {\r\n  return (await importModule).importFromFileSystemDirectoryEntry(entry)\r\n}\r\n\r\ndeclare function require(x: string): any\r\nconst exampleProfileURL = require('../../sample/profiles/stackcollapse/perf-vertx-stacks-01-collapsed-all.txt')\r\n\r\ninterface GLCanvasProps {\r\n  canvasContext: CanvasContext | null\r\n  theme: Theme\r\n  setGLCanvas: (canvas: HTMLCanvasElement | null) => void\r\n}\r\nexport class GLCanvas extends StatelessComponent<GLCanvasProps> {\r\n  private canvas: HTMLCanvasElement | null = null\r\n\r\n  private ref = (canvas: Element | null) => {\r\n    if (canvas instanceof HTMLCanvasElement) {\r\n      this.canvas = canvas\r\n    } else {\r\n      this.canvas = null\r\n    }\r\n\r\n    this.props.setGLCanvas(this.canvas)\r\n  }\r\n\r\n  private container: HTMLElement | null = null\r\n  private containerRef = (container: Element | null) => {\r\n    if (container instanceof HTMLElement) {\r\n      this.container = container\r\n    } else {\r\n      this.container = null\r\n    }\r\n  }\r\n\r\n  private maybeResize = () => {\r\n    if (!this.container) return\r\n    if (!this.props.canvasContext) return\r\n\r\n    let {width, height} = this.container.getBoundingClientRect()\r\n\r\n    const widthInAppUnits = width\r\n    const heightInAppUnits = height\r\n    const widthInPixels = width * window.devicePixelRatio\r\n    const heightInPixels = height * window.devicePixelRatio\r\n\r\n    this.props.canvasContext.gl.resize(\r\n      widthInPixels,\r\n      heightInPixels,\r\n      widthInAppUnits,\r\n      heightInAppUnits,\r\n    )\r\n  }\r\n\r\n  onWindowResize = () => {\r\n    if (this.props.canvasContext) {\r\n      this.props.canvasContext.requestFrame()\r\n    }\r\n  }\r\n  componentWillReceiveProps(nextProps: GLCanvasProps) {\r\n    if (this.props.canvasContext !== nextProps.canvasContext) {\r\n      if (this.props.canvasContext) {\r\n        this.props.canvasContext.removeBeforeFrameHandler(this.maybeResize)\r\n      }\r\n      if (nextProps.canvasContext) {\r\n        nextProps.canvasContext.addBeforeFrameHandler(this.maybeResize)\r\n        nextProps.canvasContext.requestFrame()\r\n      }\r\n    }\r\n  }\r\n  componentDidMount() {\r\n    window.addEventListener('resize', this.onWindowResize)\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.props.canvasContext) {\r\n      this.props.canvasContext.removeBeforeFrameHandler(this.maybeResize)\r\n    }\r\n    window.removeEventListener('resize', this.onWindowResize)\r\n  }\r\n  render() {\r\n    const style = getStyle(this.props.theme)\r\n    return (\r\n      <div ref={this.containerRef} className={css(style.glCanvasView)}>\r\n        <canvas ref={this.ref} width={1} height={1} />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport type ApplicationProps = {\r\n  setGLCanvas: (canvas: HTMLCanvasElement | null) => void\r\n  setLoading: (loading: boolean) => void\r\n  setError: (error: boolean) => void\r\n  setProfileGroup: (profileGroup: ProfileGroup) => void\r\n  setDragActive: (dragActive: boolean) => void\r\n  setViewMode: (viewMode: ViewMode) => void\r\n  setFlattenRecursion: (flattenRecursion: boolean) => void\r\n  setProfileIndexToView: (profileIndex: number) => void\r\n  activeProfileState: ActiveProfileState | null\r\n  canvasContext: CanvasContext | null\r\n  theme: Theme\r\n  profileGroup: ProfileGroupState\r\n  flattenRecursion: boolean\r\n  viewMode: ViewMode\r\n  hashParams: HashParams\r\n  dragActive: boolean\r\n  loading: boolean\r\n  glCanvas: HTMLCanvasElement | null\r\n  error: boolean\r\n}\r\n\r\nexport class Application extends StatelessComponent<ApplicationProps> {\r\n  private async loadProfile(loader: () => Promise<ProfileGroup | null>) {\r\n    this.props.setLoading(true)\r\n    await new Promise(resolve => setTimeout(resolve, 0))\r\n\r\n    if (!this.props.glCanvas) return\r\n\r\n    console.time('import')\r\n\r\n    let profileGroup: ProfileGroup | null = null\r\n    try {\r\n      profileGroup = await loader()\r\n    } catch (e) {\r\n      console.log('Failed to load format', e)\r\n      this.props.setError(true)\r\n      return\r\n    }\r\n\r\n    // TODO(jlfwong): Make these into nicer overlays\r\n    if (profileGroup == null) {\r\n      alert('Unrecognized format! See documentation about supported formats.')\r\n      this.props.setLoading(false)\r\n      return\r\n    } else if (profileGroup.profiles.length === 0) {\r\n      alert(\"Successfully imported profile, but it's empty!\")\r\n      this.props.setLoading(false)\r\n      return\r\n    }\r\n\r\n    if (this.props.hashParams.title) {\r\n      profileGroup = {\r\n        ...profileGroup,\r\n        name: this.props.hashParams.title,\r\n      }\r\n    }\r\n    document.title = `${profileGroup.name} - speedscope`\r\n\r\n    if (this.props.hashParams.viewMode) {\r\n      this.props.setViewMode(this.props.hashParams.viewMode)\r\n    }\r\n\r\n    for (let profile of profileGroup.profiles) {\r\n      await profile.demangle()\r\n    }\r\n\r\n    for (let profile of profileGroup.profiles) {\r\n      const title = this.props.hashParams.title || profile.getName()\r\n      profile.setName(title)\r\n    }\r\n\r\n    console.timeEnd('import')\r\n\r\n    this.props.setProfileGroup(profileGroup)\r\n    this.props.setLoading(false)\r\n  }\r\n\r\n  getStyle(): ReturnType<typeof getStyle> {\r\n    return getStyle(this.props.theme)\r\n  }\r\n\r\n  loadFromFile(file: File) {\r\n    this.loadProfile(async () => {\r\n      const profiles = await importProfilesFromFile(file)\r\n      if (profiles) {\r\n        for (let profile of profiles.profiles) {\r\n          if (!profile.getName()) {\r\n            profile.setName(file.name)\r\n          }\r\n        }\r\n        return profiles\r\n      }\r\n\r\n      if (this.props.profileGroup && this.props.activeProfileState) {\r\n        // If a profile is already loaded, it's possible the file being imported is\r\n        // a symbol map. If that's the case, we want to parse it, and apply the symbol\r\n        // mapping to the already loaded profile. This can be use to take an opaque\r\n        // profile and make it readable.\r\n        const reader = new FileReader()\r\n        const fileContentsPromise = new Promise<string>(resolve => {\r\n          reader.addEventListener('loadend', () => {\r\n            if (typeof reader.result !== 'string') {\r\n              throw new Error('Expected reader.result to be a string')\r\n            }\r\n            resolve(reader.result)\r\n          })\r\n        })\r\n        reader.readAsText(file)\r\n        const fileContents = await fileContentsPromise\r\n\r\n        let symbolRemapper: SymbolRemapper | null = null\r\n\r\n        const emscriptenSymbolRemapper = importEmscriptenSymbolRemapper(fileContents)\r\n        if (emscriptenSymbolRemapper) {\r\n          console.log('Importing as emscripten symbol map')\r\n          symbolRemapper = emscriptenSymbolRemapper\r\n        }\r\n\r\n        const jsSourceMapRemapper = await importJavaScriptSourceMapSymbolRemapper(\r\n          fileContents,\r\n          file.name,\r\n        )\r\n        if (!symbolRemapper && jsSourceMapRemapper) {\r\n          console.log('Importing as JavaScript source map')\r\n          symbolRemapper = jsSourceMapRemapper\r\n        }\r\n\r\n        if (symbolRemapper != null) {\r\n          return {\r\n            name: this.props.profileGroup.name || 'profile',\r\n            indexToView: this.props.profileGroup.indexToView,\r\n            profiles: this.props.profileGroup.profiles.map(profileState => {\r\n              // We do a shallow clone here to invalidate certain caches keyed\r\n              // on a reference to the profile group under the assumption that\r\n              // profiles are immutable. Symbol remapping is (at time of\r\n              // writing) the only exception to that immutability.\r\n              const p = profileState.profile.shallowClone()\r\n              p.remapSymbols(symbolRemapper!)\r\n              return p\r\n            }),\r\n          }\r\n        }\r\n      }\r\n\r\n      return null\r\n    })\r\n  }\r\n\r\n  loadExample = () => {\r\n    this.loadProfile(async () => {\r\n      const filename = 'perf-vertx-stacks-01-collapsed-all.txt'\r\n      const data = await fetch(exampleProfileURL).then(resp => resp.text())\r\n      return await importProfilesFromText(filename, data)\r\n    })\r\n  }\r\n\r\n  onDrop = (ev: DragEvent) => {\r\n    this.props.setDragActive(false)\r\n    ev.preventDefault()\r\n\r\n    if (!ev.dataTransfer) return\r\n\r\n    const firstItem = ev.dataTransfer.items[0]\r\n    if ('webkitGetAsEntry' in firstItem) {\r\n      const webkitEntry: FileSystemDirectoryEntry = firstItem.webkitGetAsEntry()\r\n\r\n      // Instrument.app file format is actually a directory.\r\n      if (webkitEntry.isDirectory && webkitEntry.name.endsWith('.trace')) {\r\n        console.log('Importing as Instruments.app .trace file')\r\n        this.loadProfile(async () => {\r\n          return await importFromFileSystemDirectoryEntry(webkitEntry)\r\n        })\r\n        return\r\n      }\r\n    }\r\n\r\n    let file: File | null = ev.dataTransfer.files.item(0)\r\n    if (file) {\r\n      this.loadFromFile(file)\r\n    }\r\n  }\r\n\r\n  onDragOver = (ev: DragEvent) => {\r\n    this.props.setDragActive(true)\r\n    ev.preventDefault()\r\n  }\r\n\r\n  onDragLeave = (ev: DragEvent) => {\r\n    this.props.setDragActive(false)\r\n    ev.preventDefault()\r\n  }\r\n\r\n  onWindowKeyPress = async (ev: KeyboardEvent) => {\r\n    if (ev.key === '1') {\r\n      this.props.setViewMode(ViewMode.CHRONO_FLAME_CHART)\r\n    } else if (ev.key === '2') {\r\n      this.props.setViewMode(ViewMode.LEFT_HEAVY_FLAME_GRAPH)\r\n    } else if (ev.key === '3') {\r\n      this.props.setViewMode(ViewMode.SANDWICH_VIEW)\r\n    } else if (ev.key === 'r') {\r\n      const {flattenRecursion} = this.props\r\n      this.props.setFlattenRecursion(!flattenRecursion)\r\n    } else if (ev.key === 'n') {\r\n      const {activeProfileState} = this.props\r\n      if (activeProfileState) {\r\n        this.props.setProfileIndexToView(activeProfileState.index + 1)\r\n      }\r\n    } else if (ev.key === 'p') {\r\n      const {activeProfileState} = this.props\r\n      if (activeProfileState) {\r\n        this.props.setProfileIndexToView(activeProfileState.index - 1)\r\n      }\r\n    }\r\n  }\r\n\r\n  private saveFile = () => {\r\n    if (this.props.profileGroup) {\r\n      const {name, indexToView, profiles} = this.props.profileGroup\r\n      const profileGroup: ProfileGroup = {\r\n        name,\r\n        indexToView,\r\n        profiles: profiles.map(p => p.profile),\r\n      }\r\n      saveToFile(profileGroup)\r\n    }\r\n  }\r\n\r\n  private browseForFile = () => {\r\n    const input = document.createElement('input')\r\n    input.type = 'file'\r\n    input.addEventListener('change', this.onFileSelect)\r\n    input.click()\r\n  }\r\n\r\n  private onWindowKeyDown = async (ev: KeyboardEvent) => {\r\n    // This has to be handled on key down in order to prevent the default\r\n    // page save action.\r\n    if (ev.key === 's' && (ev.ctrlKey || ev.metaKey)) {\r\n      ev.preventDefault()\r\n      this.saveFile()\r\n    } else if (ev.key === 'o' && (ev.ctrlKey || ev.metaKey)) {\r\n      ev.preventDefault()\r\n      this.browseForFile()\r\n    }\r\n  }\r\n\r\n  onDocumentPaste = (ev: Event) => {\r\n    if (document.activeElement != null && document.activeElement.nodeName === 'INPUT') return\r\n\r\n    ev.preventDefault()\r\n    ev.stopPropagation()\r\n\r\n    const clipboardData = (ev as ClipboardEvent).clipboardData\r\n    if (!clipboardData) return\r\n    const pasted = clipboardData.getData('text')\r\n    this.loadProfile(async () => {\r\n      return await importProfilesFromText('From Clipboard', pasted)\r\n    })\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('keydown', this.onWindowKeyDown)\r\n    window.addEventListener('keypress', this.onWindowKeyPress)\r\n    document.addEventListener('paste', this.onDocumentPaste)\r\n    this.maybeLoadHashParamProfile()\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('keydown', this.onWindowKeyDown)\r\n    window.removeEventListener('keypress', this.onWindowKeyPress)\r\n    document.removeEventListener('paste', this.onDocumentPaste)\r\n  }\r\n\r\n  async maybeLoadHashParamProfile() {\r\n    const {profileURL} = this.props.hashParams;\r\n    if (profileURL) {\r\n      if (!canUseXHR) {\r\n        alert(\r\n          `Cannot load a profile URL when loading from \"${window.location.protocol}\" URL protocol`,\r\n        )\r\n        return\r\n      }\r\n      this.loadProfile(async () => {\r\n        const response: Response = await fetch(profileURL)\r\n        let filename = new URL(profileURL, window.location.href).pathname\r\n        if (filename.includes('/')) {\r\n          filename = filename.slice(filename.lastIndexOf('/') + 1)\r\n        }\r\n        return await importProfilesFromArrayBuffer(filename, await response.arrayBuffer())\r\n      })\r\n    } else if (this.props.hashParams.localProfilePath) {\r\n      // There isn't good cross-browser support for XHR of local files, even from\r\n      // other local files. To work around this restriction, we load the local profile\r\n      // as a JavaScript file which will invoke a global function.\r\n      ;(window as any)['speedscope'] = {\r\n        loadFileFromBase64: (filename: string, base64source: string) => {\r\n          this.loadProfile(() => importProfilesFromBase64(filename, base64source))\r\n        },\r\n      }\r\n\r\n      const script = document.createElement('script')\r\n      script.src = `file:///${this.props.hashParams.localProfilePath}`\r\n      document.head.appendChild(script)\r\n    }\r\n  }\r\n\r\n  onFileSelect = (ev: Event) => {\r\n    const file = (ev.target as HTMLInputElement).files!.item(0)\r\n    if (file) {\r\n      this.loadFromFile(file)\r\n    }\r\n  }\r\n\r\n  renderLanding() {\r\n    const style = this.getStyle()\r\n\r\n    return (\r\n      <div className={css(style.landingContainer)}>\r\n        <div className={css(style.landingMessage)}>\r\n          <p className={css(style.landingP)}>\r\n             Hi there! Welcome to speedscope, an interactive{' '}\r\n            <a\r\n              className={css(style.link)}\r\n              href=\"http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html\"\r\n            >\r\n              flamegraph\r\n            </a>{' '}\r\n            visualizer. Use it to help you make your software faster.\r\n          </p>\r\n          {canUseXHR ? (\r\n            <p className={css(style.landingP)}>\r\n              Drag and drop a profile file onto this window to get started, click the big blue\r\n              button below to browse for a profile to explore, or{' '}\r\n              <a tabIndex={0} className={css(style.link)} onClick={this.loadExample}>\r\n                click here\r\n              </a>{' '}\r\n              to load an example profile.\r\n            </p>\r\n          ) : (\r\n            <p className={css(style.landingP)}>\r\n              Drag and drop a profile file onto this window to get started, or click the big blue\r\n              button below to browse for a profile to explore.\r\n            </p>\r\n          )}\r\n          <div className={css(style.browseButtonContainer)}>\r\n            <input\r\n              type=\"file\"\r\n              name=\"file\"\r\n              id=\"file\"\r\n              onChange={this.onFileSelect}\r\n              className={css(style.hide)}\r\n            />\r\n            <label for=\"file\" className={css(style.browseButton)} tabIndex={0}>\r\n              Browse\r\n            </label>\r\n          </div>\r\n\r\n          <p className={css(style.landingP)}>\r\n            See the{' '}\r\n            <a\r\n              className={css(style.link)}\r\n              href=\"https://github.com/jlfwong/speedscope#usage\"\r\n              target=\"_blank\"\r\n            >\r\n              documentation\r\n            </a>{' '}\r\n            for information about supported file formats, keyboard shortcuts, and how to navigate\r\n            around the profile.\r\n          </p>\r\n\r\n          <p className={css(style.landingP)}>\r\n            speedscope is open source. Please{' '}\r\n            <a\r\n              className={css(style.link)}\r\n              target=\"_blank\"\r\n              href=\"https://github.com/jlfwong/speedscope/issues\"\r\n            >\r\n              report any issues on GitHub\r\n            </a>\r\n            .\r\n          </p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  renderError() {\r\n    const style = this.getStyle()\r\n\r\n    return (\r\n      <div className={css(style.error)}>\r\n        <div> Something went wrong.</div>\r\n        <div>Check the JS console for more details.</div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  renderLoadingBar() {\r\n    const style = this.getStyle()\r\n    return <div className={css(style.loading)} />\r\n  }\r\n\r\n  renderContent() {\r\n    const {viewMode, activeProfileState, error, loading, glCanvas} = this.props\r\n\r\n    if (error) {\r\n      return this.renderError()\r\n    }\r\n\r\n    if (loading) {\r\n      return this.renderLoadingBar()\r\n    }\r\n\r\n    if (!activeProfileState || !glCanvas) {\r\n      return this.renderLanding()\r\n    }\r\n\r\n    switch (viewMode) {\r\n      case ViewMode.CHRONO_FLAME_CHART: {\r\n        return <ChronoFlamechartView activeProfileState={activeProfileState} glCanvas={glCanvas} />\r\n      }\r\n      case ViewMode.LEFT_HEAVY_FLAME_GRAPH: {\r\n        return (\r\n          <LeftHeavyFlamechartView activeProfileState={activeProfileState} glCanvas={glCanvas} />\r\n        )\r\n      }\r\n      case ViewMode.SANDWICH_VIEW: {\r\n        return <SandwichViewContainer activeProfileState={activeProfileState} glCanvas={glCanvas} />\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const style = this.getStyle()\r\n    return (\r\n      <div\r\n        onDrop={this.onDrop}\r\n        onDragOver={this.onDragOver}\r\n        onDragLeave={this.onDragLeave}\r\n        className={css(style.root, this.props.dragActive && style.dragTargetRoot)}\r\n      >\r\n        <GLCanvas\r\n          setGLCanvas={this.props.setGLCanvas}\r\n          canvasContext={this.props.canvasContext}\r\n          theme={this.props.theme}\r\n        />\r\n        <Toolbar\r\n          saveFile={this.saveFile}\r\n          browseForFile={this.browseForFile}\r\n          {...(this.props as ApplicationProps)}\r\n        />\r\n        <div className={css(style.contentContainer)}>{this.renderContent()}</div>\r\n        {this.props.dragActive && <div className={css(style.dragTarget)} />}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst getStyle = withTheme(theme =>\r\n  StyleSheet.create({\r\n    glCanvasView: {\r\n      position: 'absolute',\r\n      width: '100vw',\r\n      height: '100vh',\r\n      zIndex: -1,\r\n      pointerEvents: 'none',\r\n    },\r\n    error: {\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      height: '100%',\r\n    },\r\n    loading: {\r\n      height: 3,\r\n      marginBottom: -3,\r\n      background: theme.selectionPrimaryColor,\r\n      transformOrigin: '0% 50%',\r\n      animationName: [\r\n        {\r\n          from: {\r\n            transform: `scaleX(0)`,\r\n          },\r\n          to: {\r\n            transform: `scaleX(1)`,\r\n          },\r\n        },\r\n      ],\r\n      animationTimingFunction: 'cubic-bezier(0, 1, 0, 1)',\r\n      animationDuration: '30s',\r\n    },\r\n    root: {\r\n      width: '100vw',\r\n      height: '100vh',\r\n      overflow: 'hidden',\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      position: 'relative',\r\n      fontFamily: FontFamily.MONOSPACE,\r\n      lineHeight: '20px',\r\n      color: theme.fgPrimaryColor,\r\n    },\r\n    dragTargetRoot: {\r\n      cursor: 'copy',\r\n    },\r\n    dragTarget: {\r\n      boxSizing: 'border-box',\r\n      position: 'absolute',\r\n      top: 0,\r\n      left: 0,\r\n      width: '100%',\r\n      height: '100%',\r\n      border: `5px dashed ${theme.selectionPrimaryColor}`,\r\n      pointerEvents: 'none',\r\n    },\r\n    contentContainer: {\r\n      position: 'relative',\r\n      display: 'flex',\r\n      overflow: 'hidden',\r\n      flexDirection: 'column',\r\n      flex: 1,\r\n    },\r\n    landingContainer: {\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      flex: 1,\r\n    },\r\n    landingMessage: {\r\n      maxWidth: 600,\r\n    },\r\n    landingP: {\r\n      marginBottom: 16,\r\n    },\r\n    hide: {\r\n      display: 'none',\r\n    },\r\n    browseButtonContainer: {\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n    },\r\n    browseButton: {\r\n      marginBottom: 16,\r\n      height: 72,\r\n      flex: 1,\r\n      maxWidth: 256,\r\n      textAlign: 'center',\r\n      fontSize: FontSize.BIG_BUTTON,\r\n      lineHeight: '72px',\r\n      background: theme.selectionPrimaryColor,\r\n      color: theme.altFgPrimaryColor,\r\n      transition: `all ${Duration.HOVER_CHANGE} ease-in`,\r\n      ':hover': {\r\n        background: theme.selectionSecondaryColor,\r\n      },\r\n    },\r\n    link: {\r\n      color: theme.selectionPrimaryColor,\r\n      cursor: 'pointer',\r\n      textDecoration: 'none',\r\n      transition: `all ${Duration.HOVER_CHANGE} ease-in`,\r\n      ':hover': {\r\n        color: theme.selectionSecondaryColor,\r\n      },\r\n    },\r\n  }),\r\n)\r\n","import {h} from 'preact'\r\nimport {getCanvasContext} from '../app-state/getters'\r\nimport {memo, useMemo} from 'preact/compat'\r\nimport {useActiveProfileState} from '../app-state/active-profile-state'\r\nimport {useTheme} from './themes/theme'\r\nimport {\r\n  dragActiveAtom,\r\n  errorAtom,\r\n  flattenRecursionAtom,\r\n  glCanvasAtom,\r\n  hashParamsAtom,\r\n  loadingAtom,\r\n  profileGroupAtom,\r\n  viewModeAtom,\r\n} from '../app-state'\r\nimport {useAtom} from '../lib/atom'\r\nimport {ProfileSearchContextProvider} from './search-view'\r\nimport {Application} from './application'\r\n\r\nexport const ApplicationContainer = memo(() => {\r\n  const canvas = useAtom(glCanvasAtom)\r\n  const theme = useTheme()\r\n  const canvasContext = useMemo(() => (canvas ? getCanvasContext({theme, canvas}) : null), [\r\n    theme,\r\n    canvas,\r\n  ])\r\n\r\n  return (\r\n    <ProfileSearchContextProvider>\r\n      <Application\r\n        activeProfileState={useActiveProfileState()}\r\n        canvasContext={canvasContext}\r\n        setGLCanvas={glCanvasAtom.set}\r\n        setLoading={loadingAtom.set}\r\n        setError={errorAtom.set}\r\n        setProfileGroup={profileGroupAtom.setProfileGroup}\r\n        setDragActive={dragActiveAtom.set}\r\n        setViewMode={viewModeAtom.set}\r\n        setFlattenRecursion={flattenRecursionAtom.set}\r\n        setProfileIndexToView={profileGroupAtom.setProfileIndexToView}\r\n        profileGroup={useAtom(profileGroupAtom)}\r\n        theme={theme}\r\n        flattenRecursion={useAtom(flattenRecursionAtom)}\r\n        viewMode={useAtom(viewModeAtom)}\r\n        hashParams={useAtom(hashParamsAtom)}\r\n        glCanvas={canvas}\r\n        dragActive={useAtom(dragActiveAtom)}\r\n        loading={useAtom(loadingAtom)}\r\n        error={useAtom(errorAtom)}\r\n      />\r\n    </ProfileSearchContextProvider>\r\n  )\r\n})\r\n","import {h, render} from 'preact'\r\nimport {ApplicationContainer} from './views/application-container'\r\nimport {ThemeProvider} from './views/themes/theme'\r\n\r\nconsole.log(`speedscope v${require('../package.json').version}`)\r\n\r\ndeclare const module: any\r\nif (module.hot) {\r\n  module.hot.dispose(() => {\r\n    // Force the old component go through teardown steps\r\n    render(<div />, document.body, document.body.lastElementChild || undefined)\r\n  })\r\n  module.hot.accept()\r\n}\r\n\r\nrender(\r\n  <ThemeProvider>\r\n    <ApplicationContainer />\r\n  </ThemeProvider>,\r\n  document.body,\r\n  document.body.lastElementChild || undefined,\r\n)\r\n","module.exports = function loadJSBundle(bundle) {\n  return new Promise(function (resolve, reject) {\n    var script = document.createElement('script');\n    script.async = true;\n    script.type = 'text/javascript';\n    script.charset = 'utf-8';\n    script.src = bundle;\n    script.onerror = function (e) {\n      script.onerror = script.onload = null;\n      reject(e);\n    };\n\n    script.onload = function () {\n      script.onerror = script.onload = null;\n      resolve();\n    };\n\n    document.getElementsByTagName('head')[0].appendChild(script);\n  });\n};\n"]}